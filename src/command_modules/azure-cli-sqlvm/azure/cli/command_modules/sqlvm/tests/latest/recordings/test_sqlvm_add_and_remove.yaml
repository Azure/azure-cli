interactions:
- request:
    body: '{"location": "westus", "tags": {"product": "azurecli", "cause": "automation",
      "date": "2019-04-17T06:52:55Z"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - group create
      Connection:
      - keep-alive
      Content-Length:
      - '110'
      Content-Type:
      - application/json; charset=utf-8
      ParameterSetName:
      - --location --name --tag
      User-Agent:
      - python/3.6.5 (Darwin-18.0.0-x86_64-i386-64bit) msrest/0.6.6 msrest_azure/0.6.0
        resourcemanagementclient/2.1.0 Azure-SDK-For-Python AZURECLI/2.0.62
      accept-language:
      - en-US
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2018-05-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001","name":"clitest.rg000001","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2019-04-17T06:52:55Z"},"properties":{"provisioningState":"Succeeded"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '384'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 17 Apr 2019 06:52:56 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-writes:
      - '1199'
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      Connection:
      - close
      Host:
      - raw.githubusercontent.com
      User-Agent:
      - Python-urllib/3.6
    method: GET
    uri: https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/active-directory-new-domain/azuredeploy.json
  response:
    body:
      string: "{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\"\
        ,\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"\
        adminUsername\": {\n            \"type\": \"string\",\n            \"metadata\"\
        : {\n                \"description\": \"The name of the administrator account\
        \ of the new VM and domain\"\n            }\n        },\n        \"adminPassword\"\
        : {\n            \"type\": \"securestring\",\n            \"metadata\": {\n\
        \                \"description\": \"The password for the administrator account\
        \ of the new VM and domain\"\n            }\n        },\n        \"domainName\"\
        : {\n            \"type\": \"string\",\n            \"metadata\": {\n    \
        \            \"description\": \"The FQDN of the Active Directory Domain to\
        \ be created\"\n            }\n        },\n        \"dnsPrefix\": {\n    \
        \        \"type\": \"string\",\n            \"metadata\": {\n            \
        \    \"description\": \"The DNS prefix for the public IP address used by the\
        \ Load Balancer\"\n            }\n        },\n        \"vmSize\": {\n    \
        \        \"type\": \"string\",\n            \"defaultValue\": \"Standard_D2s_v3\"\
        ,\n            \"metadata\": {\n                \"description\": \"Size of\
        \ the VM for the controller\"\n            }\n        },\n        \"_artifactsLocation\"\
        : {\n            \"type\": \"string\",\n            \"metadata\": {\n    \
        \            \"description\": \"The location of resources, such as templates\
        \ and DSC modules, that the template depends on\"\n            },\n      \
        \      \"defaultValue\": \"[deployment().properties.templateLink.uri]\"\n\
        \        },\n        \"_artifactsLocationSasToken\": {\n            \"type\"\
        : \"securestring\",\n            \"metadata\": {\n                \"description\"\
        : \"Auto-generated token to access _artifactsLocation\"\n            },\n\
        \            \"defaultValue\": \"\"\n        },\n        \"location\": {\n\
        \            \"type\": \"string\",\n            \"defaultValue\": \"[resourceGroup().location]\"\
        ,\n            \"metadata\": {\n                \"description\": \"Location\
        \ for all resources.\"\n            }\n        }\n    },\n    \"variables\"\
        : {\n        \"virtualNetworkName\": \"adVNET\",\n        \"virtualNetworkAddressRange\"\
        : \"10.0.0.0/16\",\n        \"adLBFE\": \"LBFE\",\n        \"adLBBE\": \"\
        LBBE\",\n        \"adRDPNAT\": \"adRDP\",\n        \"adNicName\": \"adNic\"\
        ,\n        \"adNicIPAddress\": \"10.0.0.4\",\n        \"adVMName\": \"adVM\"\
        ,\n        \"adSubnetName\": \"adSubnet\",\n        \"adSubnetAddressPrefix\"\
        : \"10.0.0.0/24\",\n        \"publicIPAddressName\": \"adPublicIP\",\n   \
        \     \"adAvailabilitySetName\": \"adAvailabiltySet\",\n        \"adLBName\"\
        : \"adLoadBalancer\"\n    },\n    \"resources\": [\n        {\n          \
        \  \"type\": \"Microsoft.Network/publicIPAddresses\",\n            \"apiVersion\"\
        : \"2019-02-01\",\n            \"name\": \"[variables('publicIPAddressName')]\"\
        ,\n            \"location\": \"[parameters('location')]\",\n            \"\
        properties\": {\n                \"publicIPAllocationMethod\": \"Static\"\
        ,\n                \"dnsSettings\": {\n                    \"domainNameLabel\"\
        : \"[parameters('dnsPrefix')]\"\n                }\n            }\n      \
        \  },\n        {\n            \"type\": \"Microsoft.Compute/availabilitySets\"\
        ,\n            \"apiVersion\": \"2019-03-01\",\n            \"location\":\
        \ \"[parameters('location')]\",\n            \"name\": \"[variables('adAvailabilitySetName')]\"\
        ,\n            \"properties\": {\n                \"PlatformUpdateDomainCount\"\
        : 20,\n                \"PlatformFaultDomainCount\": 2\n            },\n \
        \           \"sku\": {\n                \"name\": \"Aligned\"\n          \
        \  }\n        },\n        {\n            \"type\": \"Microsoft.Resources/deployments\"\
        ,\n            \"apiVersion\": \"2018-11-01\",\n            \"name\": \"VNet\"\
        ,\n            \"properties\": {\n                \"mode\": \"Incremental\"\
        ,\n                \"templateLink\": {\n                    \"uri\": \"[uri(parameters('_artifactsLocation'),\
        \ concat('nestedtemplates/vnet.json', parameters('_artifactsLocationSasToken')))]\"\
        ,\n                    \"contentVersion\": \"1.0.0.0\"\n                },\n\
        \                \"parameters\": {\n                    \"virtualNetworkName\"\
        : {\n                        \"value\": \"[variables('virtualNetworkName')]\"\
        \n                    },\n                    \"virtualNetworkAddressRange\"\
        : {\n                        \"value\": \"[variables('virtualNetworkAddressRange')]\"\
        \n                    },\n                    \"subnetName\": {\n        \
        \                \"value\": \"[variables('adSubnetName')]\"\n            \
        \        },\n                    \"subnetRange\": {\n                    \
        \    \"value\": \"[variables('adSubnetAddressPrefix')]\"\n               \
        \     },\n                    \"location\": {\n                        \"\
        value\": \"[parameters('location')]\"\n                    }\n           \
        \     }\n            }\n        },\n        {\n            \"type\": \"Microsoft.Network/loadBalancers\"\
        ,\n            \"apiVersion\": \"2019-02-01\",\n            \"name\": \"[variables('adLBName')]\"\
        ,\n            \"location\": \"[parameters('location')]\",\n            \"\
        dependsOn\": [\n                \"[variables('publicIPAddressName')]\"\n \
        \           ],\n            \"properties\": {\n                \"frontendIPConfigurations\"\
        : [\n                    {\n                        \"name\": \"[variables('adLBFE')]\"\
        ,\n                        \"properties\": {\n                           \
        \ \"publicIPAddress\": {\n                                \"id\": \"[resourceId('Microsoft.Network/publicIPAddresses',\
        \ variables('publicIPAddressName'))]\"\n                            }\n  \
        \                      }\n                    }\n                ],\n    \
        \            \"backendAddressPools\": [\n                    {\n         \
        \               \"name\": \"[variables('adLBBE')]\"\n                    }\n\
        \                ],\n                \"inboundNatRules\": [\n            \
        \        {\n                        \"name\": \"[variables('adRDPNAT')]\"\
        ,\n                        \"properties\": {\n                           \
        \ \"frontendIPConfiguration\": {\n                                \"id\":\
        \ \"[resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations',\
        \ variables('adLBName'), variables('adLBFE'))]\"\n                       \
        \     },\n                            \"protocol\": \"Tcp\",\n           \
        \                 \"frontendPort\": 3389,\n                            \"\
        backendPort\": 3389,\n                            \"enableFloatingIP\": false\n\
        \                        }\n                    }\n                ]\n   \
        \         }\n        },\n        {\n            \"type\": \"Microsoft.Network/networkInterfaces\"\
        ,\n            \"apiVersion\": \"2019-02-01\",\n            \"name\": \"[variables('adNicName')]\"\
        ,\n            \"location\": \"[parameters('location')]\",\n            \"\
        dependsOn\": [\n                \"VNet\",\n                \"[variables('adLBName')]\"\
        \n            ],\n            \"properties\": {\n                \"ipConfigurations\"\
        : [\n                    {\n                        \"name\": \"ipconfig1\"\
        ,\n                        \"properties\": {\n                           \
        \ \"privateIPAllocationMethod\": \"Static\",\n                           \
        \ \"privateIPAddress\": \"[variables('adNicIPAddress')]\",\n             \
        \               \"subnet\": {\n                                \"id\": \"\
        [resourceId('Microsoft.Network/virtualNetworks/subnets', variables('virtualNetworkName'),\
        \ variables('adSubnetName'))]\"\n                            },\n        \
        \                    \"loadBalancerBackendAddressPools\": [\n            \
        \                    {\n                                    \"id\": \"[resourceId('Microsoft.Network/loadBalancers/backendAddressPools',\
        \ variables('adLBName'), variables('adLBBE'))]\"\n                       \
        \         }\n                            ],\n                            \"\
        loadBalancerInboundNatRules\": [\n                                {\n    \
        \                                \"id\": \"[resourceId('Microsoft.Network/loadBalancers/inboundNatRules',\
        \ variables('adLBName'), variables('adRDPNAT'))]\"\n                     \
        \           }\n                            ]\n                        }\n\
        \                    }\n                ]\n            }\n        },\n   \
        \     {\n            \"type\": \"Microsoft.Compute/virtualMachines\",\n  \
        \          \"apiVersion\": \"2019-03-01\",\n            \"name\": \"[variables('adVMName')]\"\
        ,\n            \"location\": \"[parameters('location')]\",\n            \"\
        dependsOn\": [\n                \"[variables('adNicName')]\",\n          \
        \      \"[variables('adAvailabilitySetName')]\",\n                \"[variables('adLBName')]\"\
        \n            ],\n            \"properties\": {\n                \"hardwareProfile\"\
        : {\n                    \"vmSize\": \"[parameters('vmSize')]\"\n        \
        \        },\n                \"availabilitySet\": {\n                    \"\
        id\": \"[resourceId('Microsoft.Compute/availabilitySets', variables('adAvailabilitySetName'))]\"\
        \n                },\n                \"osProfile\": {\n                 \
        \   \"computerName\": \"[variables('adVMName')]\",\n                    \"\
        adminUsername\": \"[parameters('adminUsername')]\",\n                    \"\
        adminPassword\": \"[parameters('adminPassword')]\"\n                },\n \
        \               \"storageProfile\": {\n                    \"imageReference\"\
        : {\n                        \"publisher\": \"MicrosoftWindowsServer\",\n\
        \                        \"offer\": \"WindowsServer\",\n                 \
        \       \"sku\": \"2016-Datacenter\",\n                        \"version\"\
        : \"latest\"\n                    },\n                    \"osDisk\": {\n\
        \                        \"name\": \"[concat(variables('adVMName'),'_OSDisk')]\"\
        ,\n                        \"caching\": \"ReadOnly\",\n                  \
        \      \"createOption\": \"FromImage\",\n                        \"managedDisk\"\
        : {\n                            \"storageAccountType\": \"StandardSSD_LRS\"\
        \n                        }\n                    },\n                    \"\
        dataDisks\": [\n                        {\n                            \"\
        name\": \"[concat(variables('adVMName'), '_DataDisk')]\",\n              \
        \              \"caching\": \"ReadWrite\",\n                            \"\
        createOption\": \"Empty\",\n                            \"diskSizeGB\": 20,\n\
        \                            \"managedDisk\": {\n                        \
        \        \"storageAccountType\": \"StandardSSD_LRS\"\n                   \
        \         },\n                            \"lun\": 0\n                   \
        \     }\n                    ]\n                },\n                \"networkProfile\"\
        : {\n                    \"networkInterfaces\": [\n                      \
        \  {\n                            \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',\
        \ variables('adNicName'))]\"\n                        }\n                \
        \    ]\n                }\n            },\n            \"resources\": [\n\
        \                {\n                    \"type\": \"extensions\",\n      \
        \              \"apiVersion\": \"2019-03-01\",\n                    \"name\"\
        : \"CreateADForest\",\n                    \"location\": \"[parameters('location')]\"\
        ,\n                    \"dependsOn\": [\n                        \"[variables('adVMName')]\"\
        \n                    ],\n                    \"properties\": {\n        \
        \                \"publisher\": \"Microsoft.Powershell\",\n              \
        \          \"type\": \"DSC\",\n                        \"typeHandlerVersion\"\
        : \"2.19\",\n                        \"autoUpgradeMinorVersion\": true,\n\
        \                        \"settings\": {\n                            \"ModulesUrl\"\
        : \"[uri(parameters('_artifactsLocation'), concat('DSC/CreateADPDC.zip', parameters('_artifactsLocationSasToken')))]\"\
        ,\n                            \"ConfigurationFunction\": \"CreateADPDC.ps1\\\
        \\CreateADPDC\",\n                            \"Properties\": {\n        \
        \                        \"DomainName\": \"[parameters('domainName')]\",\n\
        \                                \"AdminCreds\": {\n                     \
        \               \"UserName\": \"[parameters('adminUsername')]\",\n       \
        \                             \"Password\": \"PrivateSettingsRef:AdminPassword\"\
        \n                                }\n                            }\n     \
        \                   },\n                        \"protectedSettings\": {\n\
        \                            \"Items\": {\n                              \
        \  \"AdminPassword\": \"[parameters('adminPassword')]\"\n                \
        \            }\n                        }\n                    }\n       \
        \         }\n            ]\n        },\n        {\n            \"type\": \"\
        Microsoft.Resources/deployments\",\n            \"apiVersion\": \"2018-11-01\"\
        ,\n            \"name\": \"UpdateVNetDNS\",\n            \"dependsOn\": [\n\
        \                \"CreateADForest\"\n            ],\n            \"properties\"\
        : {\n                \"mode\": \"Incremental\",\n                \"templateLink\"\
        : {\n                    \"uri\": \"[uri(parameters('_artifactsLocation'),\
        \ concat('nestedtemplates/vnet-with-dns-server.json', parameters('_artifactsLocationSasToken')))]\"\
        ,\n                    \"contentVersion\": \"1.0.0.0\"\n                },\n\
        \                \"parameters\": {\n                    \"virtualNetworkName\"\
        : {\n                        \"value\": \"[variables('virtualNetworkName')]\"\
        \n                    },\n                    \"virtualNetworkAddressRange\"\
        : {\n                        \"value\": \"[variables('virtualNetworkAddressRange')]\"\
        \n                    },\n                    \"subnetName\": {\n        \
        \                \"value\": \"[variables('adSubnetName')]\"\n            \
        \        },\n                    \"subnetRange\": {\n                    \
        \    \"value\": \"[variables('adSubnetAddressPrefix')]\"\n               \
        \     },\n                    \"DNSServerAddress\": {\n                  \
        \      \"value\": [\n                            \"[variables('adNicIPAddress')]\"\
        \n                        ]\n                    },\n                    \"\
        location\": {\n                        \"value\": \"[parameters('location')]\"\
        \n                    }\n                }\n            }\n        }\n   \
        \ ]\n}\n"
    headers:
      accept-ranges:
      - bytes
      access-control-allow-origin:
      - '*'
      cache-control:
      - max-age=300
      connection:
      - close
      content-length:
      - '13307'
      content-security-policy:
      - default-src 'none'; style-src 'unsafe-inline'; sandbox
      content-type:
      - text/plain; charset=utf-8
      date:
      - Wed, 17 Apr 2019 06:52:58 GMT
      etag:
      - '"fa312c46cd79de46f87bda86a87d64e502367fe5"'
      expires:
      - Wed, 17 Apr 2019 06:57:58 GMT
      source-age:
      - '0'
      strict-transport-security:
      - max-age=31536000
      vary:
      - Authorization,Accept-Encoding
      via:
      - 1.1 varnish
      x-cache:
      - MISS
      x-cache-hits:
      - '0'
      x-content-type-options:
      - nosniff
      x-fastly-request-id:
      - a5ef6fcbcce93875a29a73a390443d4aa5551bdd
      x-frame-options:
      - deny
      x-geo-block-list:
      - ''
      x-github-request-id:
      - B44A:63C1:547939:5B103E:5CB6CD47
      x-served-by:
      - cache-sea1033-SEA
      x-timer:
      - S1555483978.136652,VS0,VE146
      x-xss-protection:
      - 1; mode=block
    status:
      code: 200
      message: OK
- request:
    body: '{"properties": {"templateLink": {"uri": "https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/active-directory-new-domain/azuredeploy.json"},
      "parameters": {"adminUsername": {"value": "admin123"}, "adminPassword": {"value":
      "SecretPassword123"}, "location": {"value": "westus"}, "domainName": {"value":
      "domain.com"}, "dnsPrefix": {"value": "4lda65"}}, "mode": "Incremental"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - group deployment create
      Connection:
      - keep-alive
      Content-Length:
      - '397'
      Content-Type:
      - application/json; charset=utf-8
      ParameterSetName:
      - --name -g --template-uri --parameters
      User-Agent:
      - python/3.6.5 (Darwin-18.0.0-x86_64-i386-64bit) msrest/0.6.6 msrest_azure/0.6.0
        resourcemanagementclient/2.1.0 Azure-SDK-For-Python AZURECLI/2.0.62
      accept-language:
      - en-US
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001/providers/Microsoft.Resources/deployments/mock-deployment?api-version=2018-05-01
  response:
    body:
      string: '{"error":{"code":"InvalidTemplateDeployment","message":"The template
        deployment ''domaintemplate'' is not valid according to the validation procedure.
        The tracking id is ''40593ca2-b360-46dc-8e2f-3482a8887a95''. See inner errors
        for details. Please see https://aka.ms/arm-deploy for usage details.","details":[{"code":"InvalidDomainNameLabel","message":"The
        domain name label 4lda65 is invalid. It must conform to the following regular
        expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]$.","details":[]}]}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '493'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 17 Apr 2019 06:53:00 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-failure-cause:
      - gateway
      x-ms-ratelimit-remaining-subscription-writes:
      - '1198'
    status:
      code: 400
      message: Bad Request
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - group delete
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      ParameterSetName:
      - --name --yes --no-wait
      User-Agent:
      - python/3.6.5 (Darwin-18.0.0-x86_64-i386-64bit) msrest/0.6.6 msrest_azure/0.6.0
        resourcemanagementclient/2.1.0 Azure-SDK-For-Python AZURECLI/2.0.62
      accept-language:
      - en-US
    method: DELETE
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2018-05-01
  response:
    body:
      string: ''
    headers:
      cache-control:
      - no-cache
      content-length:
      - '0'
      date:
      - Wed, 17 Apr 2019 06:53:01 GMT
      expires:
      - '-1'
      location:
      - https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/operationresults/eyJqb2JJZCI6IlJFU09VUkNFR1JPVVBERUxFVElPTkpPQi1DTElURVNUOjJFUkdWN1NQU1lTMzRBWEVXNzNXM1dNVkdTRDJRM0tRU1BKVkFET3w3Q0U1QzdBODUzMzc2M0E3LVdFU1RVUyIsImpvYkxvY2F0aW9uIjoid2VzdHVzIn0?api-version=2018-05-01
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-deletes:
      - '14999'
    status:
      code: 202
      message: Accepted
version: 1
