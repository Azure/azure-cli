interactions:
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy definition show
      Connection:
      - keep-alive
      ParameterSetName:
      - --name
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: GET
    uri: https://management.azure.com/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d?api-version=2024-05-01
  response:
    body:
      string: '{"properties":{"displayName":"Audit VMs that do not use managed disks","policyType":"BuiltIn","mode":"All","description":"This
        policy audits VMs that do not use managed disks","metadata":{"version":"1.0.0","category":"Compute"},"version":"1.0.0","parameters":{},"policyRule":{"if":{"anyOf":[{"allOf":[{"field":"type","equals":"Microsoft.Compute/virtualMachines"},{"field":"Microsoft.Compute/virtualMachines/osDisk.uri","exists":"True"}]},{"allOf":[{"field":"type","equals":"Microsoft.Compute/VirtualMachineScaleSets"},{"anyOf":[{"field":"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers","exists":"True"},{"field":"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl","exists":"True"}]}]}]},"then":{"effect":"audit"}},"versions":["1.0.0"]},"id":"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d","type":"Microsoft.Authorization/policyDefinitions","name":"06a78e20-9358-41c9-923c-fb736d382a4d"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '954'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:50 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-msedge-ref:
      - 'Ref A: E0EF21FC4B6647F188FB2F3C24BADA01 Ref B: MWH011020808040 Ref C: 2025-06-18T22:43:51Z'
    status:
      code: 200
      message: OK
- request:
    body: '{"properties": {"enforcementMode": "Default", "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy assignment create
      Connection:
      - keep-alive
      Content-Length:
      - '161'
      Content-Type:
      - application/json
      ParameterSetName:
      - --scope --policy -n
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: PUT
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.Authorization/policyAssignments/cli-test-pa000001?api-version=2024-05-01
  response:
    body:
      string: '{"properties":{"policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d","definitionVersion":"1.*.*","scope":"/providers/Microsoft.Management/managementGroups/PowershellTesting","metadata":{"createdBy":"3d826307-2481-45a0-a271-bcf9333f914a","createdOn":"2025-06-18T22:43:51.930019Z","updatedBy":null,"updatedOn":null},"enforcementMode":"Default"},"id":"/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.Authorization/policyAssignments/cli-test-pa000001","type":"Microsoft.Authorization/policyAssignments","name":"cli-test-pa000001","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:51.9116369Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:51.9116369Z"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '868'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:51 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-tenant-writes:
      - '799'
      x-msedge-ref:
      - 'Ref A: EBB5E4054EE144999F55E7AD3C6295B4 Ref B: MWH011020806060 Ref C: 2025-06-18T22:43:51Z'
    status:
      code: 201
      message: Created
- request:
    body: '{"properties": {"policyAssignmentId": "/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.authorization/policyassignments/cli-test-pa000001"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation create
      Connection:
      - keep-alive
      Content-Length:
      - '178'
      Content-Type:
      - application/json
      ParameterSetName:
      - -n -m -a
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: PUT
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations/cli-test-remediation000002?api-version=2021-10-01
  response:
    body:
      string: '{"properties":{"policyAssignmentId":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.authorization/policyassignments/cli-test-pa000001","provisioningState":"Succeeded","createdOn":"2025-06-18T22:43:53.050891Z","lastUpdatedOn":"2025-06-18T22:43:53.0510074Z","deploymentStatus":{"totalDeployments":0,"successfulDeployments":0,"failedDeployments":0},"resourceDiscoveryMode":"ExistingNonCompliant","correlationId":"abc44d5c-a069-4156-835e-23502c869145"},"id":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.policyinsights/remediations/cli-test-remediation000002","name":"cli-test-remediation000002","type":"Microsoft.PolicyInsights/remediations","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:52.5740791Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:52.5740791Z"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '965'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:52 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-ms-ratelimit-remaining-tenant-writes:
      - '799'
      x-msedge-ref:
      - 'Ref A: E041DD2D35C740A89C47172E72C4D50A Ref B: MWH011020809054 Ref C: 2025-06-18T22:43:52Z'
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation show
      Connection:
      - keep-alive
      ParameterSetName:
      - -n -m
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: GET
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations/cli-test-remediation000002?api-version=2021-10-01
  response:
    body:
      string: '{"properties":{"policyAssignmentId":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.authorization/policyassignments/cli-test-pa000001","provisioningState":"Succeeded","createdOn":"2025-06-18T22:43:53.050891Z","lastUpdatedOn":"2025-06-18T22:43:53.0510074Z","deploymentStatus":{"totalDeployments":0,"successfulDeployments":0,"failedDeployments":0},"resourceDiscoveryMode":"ExistingNonCompliant","correlationId":"abc44d5c-a069-4156-835e-23502c869145"},"id":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.policyinsights/remediations/cli-test-remediation000002","name":"cli-test-remediation000002","type":"Microsoft.PolicyInsights/remediations","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:52.5740791Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:52.5740791Z"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '965'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:52 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-msedge-ref:
      - 'Ref A: 2EBD8566094341EEB38EB42A1BA74D16 Ref B: MWH011020808040 Ref C: 2025-06-18T22:43:53Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation list
      Connection:
      - keep-alive
      ParameterSetName:
      - -m
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: GET
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations?api-version=2021-10-01
  response:
    body:
      string: '{"value":[{"properties":{"policyAssignmentId":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.authorization/policyassignments/cli-test-pa000001","provisioningState":"Succeeded","createdOn":"2025-06-18T22:43:53.050891Z","lastUpdatedOn":"2025-06-18T22:43:53.0510074Z","deploymentStatus":{"totalDeployments":0,"successfulDeployments":0,"failedDeployments":0},"resourceDiscoveryMode":"ExistingNonCompliant","correlationId":"abc44d5c-a069-4156-835e-23502c869145"},"id":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.policyinsights/remediations/cli-test-remediation000002","name":"cli-test-remediation000002","type":"Microsoft.PolicyInsights/remediations","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:52.5740791Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:52.5740791Z"}}]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '977'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:53 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-msedge-ref:
      - 'Ref A: CBAB37EF4B10403D80C1234BECB64CB2 Ref B: CO6AA3150218011 Ref C: 2025-06-18T22:43:53Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation deployment list
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      ParameterSetName:
      - -n -m
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: POST
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations/cli-test-remediation000002/listDeployments?api-version=2021-10-01
  response:
    body:
      string: '{"value":[]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '12'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:53 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-msedge-ref:
      - 'Ref A: 01A7ADD97BDD4762ADED3C00B28E03DA Ref B: MWH011020807060 Ref C: 2025-06-18T22:43:54Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation delete
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      ParameterSetName:
      - -n -m
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: DELETE
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations/cli-test-remediation000002?api-version=2021-10-01
  response:
    body:
      string: '{"properties":{"policyAssignmentId":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.authorization/policyassignments/cli-test-pa000001","provisioningState":"Succeeded","createdOn":"2025-06-18T22:43:53.050891Z","lastUpdatedOn":"2025-06-18T22:43:53.0510074Z","deploymentStatus":{"totalDeployments":0,"successfulDeployments":0,"failedDeployments":0},"resourceDiscoveryMode":"ExistingNonCompliant","correlationId":"abc44d5c-a069-4156-835e-23502c869145"},"id":"/providers/microsoft.management/managementgroups/powershelltesting/providers/microsoft.policyinsights/remediations/cli-test-remediation000002","name":"cli-test-remediation000002","type":"Microsoft.PolicyInsights/remediations","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:52.5740791Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:52.5740791Z"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '965'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:54 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-ms-ratelimit-remaining-tenant-deletes:
      - '799'
      x-msedge-ref:
      - 'Ref A: 064D6E492C0D492299BC3C78E44BFF58 Ref B: CO6AA3150220047 Ref C: 2025-06-18T22:43:54Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy remediation list
      Connection:
      - keep-alive
      ParameterSetName:
      - -m
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: GET
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.PolicyInsights/remediations?api-version=2021-10-01
  response:
    body:
      string: '{"value":[]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '12'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:54 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-policy-insights-requests:
      - '149'
      x-msedge-ref:
      - 'Ref A: 022ACF575AF6404C924726D48B845E3C Ref B: CO6AA3150220037 Ref C: 2025-06-18T22:43:54Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - policy assignment delete
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      ParameterSetName:
      - -n --scope
      User-Agent:
      - AZURECLI/2.73.0 azsdk-python-core/1.31.0 Python/3.12.10 (Windows-11-10.0.26100-SP0)
    method: DELETE
    uri: https://management.azure.com/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.Authorization/policyAssignments/cli-test-pa000001?api-version=2024-05-01
  response:
    body:
      string: '{"properties":{"policyDefinitionId":"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d","definitionVersion":"1.*.*","scope":"/providers/Microsoft.Management/managementGroups/PowershellTesting","metadata":{"createdBy":"3d826307-2481-45a0-a271-bcf9333f914a","createdOn":"2025-06-18T22:43:51.930019Z","updatedBy":null,"updatedOn":null},"enforcementMode":"Default"},"id":"/providers/Microsoft.Management/managementGroups/PowershellTesting/providers/Microsoft.Authorization/policyAssignments/cli-test-pa000001","type":"Microsoft.Authorization/policyAssignments","name":"cli-test-pa000001","systemData":{"createdBy":"cstack@ntdev.microsoft.com","createdByType":"User","createdAt":"2025-06-18T22:43:51.9116369Z","lastModifiedBy":"cstack@ntdev.microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-06-18T22:43:51.9116369Z"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '868'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 18 Jun 2025 22:43:54 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - ''
      x-ms-ratelimit-remaining-tenant-deletes:
      - '799'
      x-msedge-ref:
      - 'Ref A: 09B756DC00694C00BD71B1031458E797 Ref B: CO6AA3150217047 Ref C: 2025-06-18T22:43:55Z'
    status:
      code: 200
      message: OK
version: 1
