version: 1
content:
- group:
    name: batchai
    summary: Manage Batch AI resources.
- group:
    name: batchai workspace
    summary: Commands to manage workspaces.
- command:
    name: batchai workspace create
    summary: Create a workspace.
    examples:
    - summary: Create a workspace in East US region.
      command: az batchai workspace create -g MyResourceGroup -n MyWorkspace -l eastus
- command:
    name: batchai workspace delete
    summary: Delete a workspace.
    examples:
    - summary: Delete a workspace.
      command: az batchai workspace delete -g MyResourceGroup -n MyWorkspace
- command:
    name: batchai workspace list
    summary: List workspaces.
    examples:
    - summary: List all workspaces under the current subscription.
      command: az batchai workspace list -o table
    - summary: List workspaces in the given resource group.
      command: az batchai workspace list -g MyResourceGroup -o table
- command:
    name: batchai workspace show
    summary: Show information about a workspace.
    examples:
    - summary: Show information about a workspace.
      command: az batchai workspace show -g MyResourceGroup -n MyWorkspace -o table
- group:
    name: batchai cluster
    summary: Commands to manage clusters.
- command:
    name: batchai cluster create
    summary: Create a cluster.
    examples:
    - summary: Create a single node GPU cluster with default image and auto-storage account.
      command: |
        az batchai cluster create -g MyResourceGroup -w MyWorkspace -n MyCluster \
            -s Standard_NC6 -t 1 --use-auto-storage --generate-ssh-keys
    - summary: Create a cluster with a setup command which installs unzip on every node, the command output will be stored on auto storage account Azure File Share.
      command: |
        az batchai cluster create -g MyResourceGroup -w MyWorkspace -n MyCluster \
            --use-auto-storage \
            -s Standard_NC6 -t 1 -k id_rsa.pub \
            --setup-task 'apt update; apt install unzip -y' \
            --setup-task-output '$AZ_BATCHAI_MOUNT_ROOT/autoafs'
    - summary: Create a cluster providing all parameters manually.
      command: |
        az batchai cluster create -g MyResourceGroup -w MyWorkspace -n MyCluster \
            -i UbuntuLTS -s Standard_NC6 --vm-priority lowpriority \
            --min 0 --target 1 --max 10 \
            --storage-account-name MyStorageAccount \
            --nfs MyNfsToMount --afs-name MyAzureFileShareToMount \
            --bfs-name MyBlobContainerNameToMount \
            -u AdminUserName -k id_rsa.pub -p ImpossibleToGuessPassword
    - summary: Create a cluster using a configuration file.
      command: >
        az batchai cluster create -g MyResourceGroup -w MyWorkspace -n MyCluster -f cluster.json
- command:
    name: batchai cluster resize
    summary: Resize a cluster.
    examples:
    - summary: Resize a cluster to zero size to stop paying for it.
      command: az batchai cluster resize -g MyResourceGroup -w MyWorkspace -n MyCluster -t 0
    - summary: Resize a cluster to have 10 nodes.
      command: az batchai cluster resize -g MyResourceGroup -w MyWorkspace -n MyCluster -t 10
- command:
    name: batchai cluster auto-scale
    summary: Set auto-scale parameters for a cluster.
    examples:
    - summary: Make a cluster to auto scale between 0 and 10 nodes depending on number of queued and running jobs.
      command: az batchai cluster auto-scale -g MyResourceGroup -w MyWorkspace -n MyCluster --min 0 --max 10
- command:
    name: batchai cluster delete
    summary: Delete a cluster.
    examples:
    - summary: Delete a cluster and wait for deletion to be completed.
      command: az batchai cluster delete -g MyResourceGroup -w MyWorkspace -n MyCluster
    - summary: Send a delete command for a cluster and do not wait for deletion to be completed.
      command: az batchai cluster delete -g MyResourceGroup -w MyWorkspace -n MyCluster --no-wait
    - summary: Delete cluster without asking for confirmation (for non-interactive scenarios).
      command: az batchai cluster delete -g MyResourceGroup -w MyWorkspace -n MyCluster -y
- command:
    name: batchai cluster list
    summary: List clusters.
    examples:
    - summary: List all clusters in a workspace.
      command: az batchai cluster list -g MyResourceGroup -w MyWorkspace -o table
- command:
    name: batchai cluster show
    summary: Show information about a cluster.
    examples:
    - summary: Show full information about a cluster.
      command: az batchai cluster show -g MyResourceGroup -w MyWorkspace -n MyCluster
    - summary: Show cluster's summary.
      command: az batchai cluster show -g MyResourceGroup -w MyWorkspace -n MyCluster -o table
- group:
    name: batchai cluster node
    summary: Commands to work with cluster nodes.
- command:
    name: batchai cluster node list
    summary: List remote login information for cluster's nodes.
    description: "List remote login information for cluster nodes. You can ssh to a particular node using the provided public IP address and the port number.\nE.g. ssh <admin user name>@<public ip> -p <node's SSH port number>"
    examples:
    - summary: List remote login information for a cluster.
      command: az batchai cluster node list -g MyResourceGroup -w MyWorkspace -c MyCluster -o table
- command:
    name: batchai cluster node exec
    summary: Executes a command line on a cluster's node with optional ports forwarding.
    examples:
    - summary: Report a snapshot of the current processes.
      command: |
        az batchai cluster node exec -g MyResourceGroup -w MyWorkspace -c MyCluster \
            -n tvm-xxx --exec "ps axu"
    - summary: Report a GPU information for a node.
      command: |
        az batchai cluster node exec -g MyResourceGroup -w MyWorkspace -c MyCluster \
            -n tvm-xxx --exec "nvidia-smi"
    - summary: Forward local 9000 to port 9001 on the node.
      command: |
        az batchai cluster node exec -g MyResourceGroup -w MyWorkspace -c MyCluster \
            -n tvm-xxx -L 9000:localhost:9001
- group:
    name: batchai cluster file
    summary: Commands to work with files generated by node setup task.
- command:
    name: batchai cluster file list
    summary: List files generated by the cluster's node setup task.
    description: List files generated by the cluster's node setup task under $AZ_BATCHAI_STDOUTERR_DIR path. This functionality is available only if the node setup task output directory is located on mounted Azure File Share or Azure Blob Container.
    examples:
    - summary: List names and sizes of files and directories inside of $AZ_BATCHAI_STDOUTERR_DIR.
      command: |
        az batchai cluster file list -g MyResourceGroup -w MyWorkspace -c MyCluster -o table
    - summary: List names, sizes and download URLs for files and directories inside of $AZ_BATCHAI_STDOUTERR_DIR.
      command: |
        az batchai cluster file list -g MyResourceGroup -w MyWorkspace -c MyCluster
    - summary: List names, sizes and download URLs for files and directories inside of $AZ_BATCHAI_STDOUTERR_DIR/folder/subfolder.
      command: |
        az batchai cluster file list -g MyResourceGroup -w MyWorkspace -c MyCluster \
            -p folder/subfolder
    - summary: List names, sizes and download URLs for files and directories inside of $AZ_BATCHAI_STDOUTERR_DIR making download URLs to remain valid for one hour.
      command: |
        az batchai cluster file list -g MyResourceGroup -w MyWorkspace -c MyCluster \
            --expiry 60
- group:
    name: batchai experiment
    summary: Commands to manage experiments.
- command:
    name: batchai experiment create
    summary: Create an experiment.
    examples:
    - summary: Create an experiment.
      command: az batchai experiment create -g MyResourceGroup -w MyWorkspace -n MyExperiment
- command:
    name: batchai experiment delete
    summary: Delete an experiment.
    examples:
    - summary: Delete an experiment. All running jobs will be terminated.
      command: az batchai experiment delete -g MyResourceGroup -w MyWorkspace -n MyExperiment
    - summary: Delete an experiment without asking for confirmation (for non-interactive scenarios).
      command: az batchai experiment delete -g MyResourceGroup -w MyWorkspace -n MyExperiment -y
    - summary: Request an experiment deletion without waiting for job to be deleted.
      command: az batchai experiment delete -g MyResourceGroup -w MyWorkspace -n MyExperiment --no-wait
- command:
    name: batchai experiment list
    summary: List experiments.
    examples:
    - summary: List experiments.
      command: az batchai experiment list -g MyResourceGroup -w MyWorkspace -o table
- command:
    name: batchai experiment show
    summary: Show information about an experiment.
    examples:
    - summary: Show information about an experiment.
      command: az batchai experiment show -g MyResourceGroup -w MyWorkspace -n MyExperiment -o table
- group:
    name: batchai job
    summary: Commands to manage jobs.
- command:
    name: batchai job create
    summary: Create a job.
    examples:
    - summary: Create a job to run on a cluster in the same resource group.
      command: |
        az batchai job create -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob \
            -c MyCluster -f job.json
    - summary: Create a job to run on a cluster in a different workspace.
      command: |
        az batchai job create -g MyJobResourceGroup -w MyJobWorkspace -e MyExperiment -n MyJob \
            -f job.json \
            -c "/subscriptions/00000000-0000-0000-0000-000000000000/\
            resourceGroups/MyClusterResourceGroup/\
            providers/Microsoft.BatchAI/workspaces/MyClusterWorkspace/clusters/MyCluster"
- command:
    name: batchai job terminate
    summary: Terminate a job.
    examples:
    - summary: Terminate a job and wait for the job to be terminated.
      command: az batchai job terminate -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob
    - summary: Terminate a job without asking for confirmation (for non-interactive scenarios).
      command: az batchai job terminate -g MyResourceGroup  -w MyWorkspace -e MyExperiment -n MyJob -y
    - summary: Request job termination without waiting for the job to be terminated.
      command: |
        az batchai job terminate -g MyResourceGroup -e MyExperiment -w MyWorkspace -n MyJob \
            --no-wait
- command:
    name: batchai job delete
    summary: Delete a job.
    examples:
    - summary: Delete a job. The job will be terminated if it's currently running.
      command: az batchai job delete -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob
    - summary: Delete a job without asking for confirmation (for non-interactive scenarios).
      command: az batchai job delete -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob -y
    - summary: Request job deletion without waiting for job to be deleted.
      command: az batchai job delete -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob --no-wait
- command:
    name: batchai job list
    summary: List jobs.
    examples:
    - summary: List jobs.
      command: az batchai job list -g MyResourceGroup -w MyWorkspace -e MyExperiment -o table
- command:
    name: batchai job show
    summary: Show information about a job.
    examples:
    - summary: Show full information about a job.
      command: az batchai job show -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob
    - summary: Show job's summary.
      command: az batchai job show -g MyResourceGroup -w MyWorkspace -e MyExperiment -n MyJob -o table
- group:
    name: batchai job node
    summary: Commands to work with nodes which executed a job.
- command:
    name: batchai job node list
    summary: List remote login information for nodes which executed the job.
    description: "List remote login information for currently existing (not deallocated) nodes on which the job was executed. You can ssh to a particular node using the provided public IP address and the port number.\nE.g. ssh <admin user name>@<public ip> -p <node's SSH port number>"
    examples:
    - summary: List remote login information for a job nodes.
      command: az batchai job node list -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob -o table
- command:
    name: batchai job node exec
    summary: Executes a command line on a cluster's node used to execute the job with optional ports forwarding.
    examples:
    - summary: Report a GPU state for a job's node.
      command: |
        az batchai job node exec -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            --exec "nvidia-smi"
    - summary: Report a snapshot of the current processes.
      command: |
        az batchai job node exec -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            --exec "ps aux"
    - summary: Forward local 9000 to port 9001 on the given node.
      command: |
        az batchai job node exec -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            -n tvm-xxx -L 9000:localhost:9001
- group:
    name: batchai job file
    summary: Commands to list and stream files in job's output directories.
- command:
    name: batchai job file list
    summary: List job's output files in a directory with given id.
    description: List job's output files in a directory with given id if the output directory is located on mounted Azure File Share or Blob Container.
    examples:
    - summary: List files in the standard output directory of the job.
      command: |
        az batchai job file list -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob
    - summary: List files in the standard output directory of the job. Generates output in a table format.
      command: |
        az batchai job file list -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob -o table
    - summary: List files in a folder 'MyFolder/MySubfolder' of an output directory with id 'MODELS'.
      command: |
        az batchai job file list -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            -d MODELS -p MyFolder/MySubfolder
    - summary: List files in the standard output directory of the job making download URLs to remain valid for 15 minutes.
      command: |
        az batchai job file list -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            --expiry 15
- command:
    name: batchai job file stream
    summary: Stream the content of a file (similar to 'tail -f').
    description: Waits for the job to create the given file and starts streaming it similar to 'tail -f' command. The command completes when the job finished execution.
    examples:
    - summary: Stream standard output file of the job.
      command: |
        az batchai job file stream -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            -f stdout.txt
    - summary: Stream a file 'log.txt' from a folder 'logs' of an output directory with id 'OUTPUTS'.
      command: |
        az batchai job file stream -g MyResourceGroup -w MyWorkspace -e MyExperiment -j MyJob \
            -d OUTPUTS -p logs -f log.txt
- command:
    name: batchai job wait
    summary: Waits for specified job completion and setups the exit code to the job's exit code.
    examples:
    - summary: Wait for the job completion.
      command: |
        az batchai job wait -g MyResourceGroup -w MyWorkspace -n MyJob
- group:
    name: batchai file-server
    summary: Commands to manage file servers.
- command:
    name: batchai file-server create
    summary: Create a file server.
    examples:
    - summary: Create a NFS file server using a configuration file.
      command: az batchai file-server create -g MyResourceGroup -w MyWorkspace -n MyNFS -f nfs.json
    - summary: Create a NFS manually providing parameters.
      command: |
        az batchai file-server create -g MyResourceGroup -w MyWorkspace -n MyNFS \
            -s Standard_D14 --disk-count 4 --disk-size 512 \
            --storage-sku Premium_LRS --caching-type readonly \
            -u $USER -k ~/.ssh/id_rsa.pub
- command:
    name: batchai file-server delete
    summary: Delete a file server.
    examples:
    - summary: Delete file server and wait for deletion to be completed.
      command: az batchai file-server delete -g MyResourceGroup -w MyWorkspace -n MyNFS
    - summary: Delete file server without asking for confirmation (for non-interactive scenarios).
      command: az batchai file-server delete -g MyResourceGroup -w MyWorkspace -n MyNFS -y
    - summary: Request file server deletion without waiting for deletion to be completed.
      command: az batchai file-server delete -g MyResourceGroup -w MyWorkspace -n MyNFS --no-wait
- command:
    name: batchai file-server list
    summary: List file servers.
    examples:
    - summary: List all file servers in the given workspace.
      command: az batchai file-server list -g MyResourceGroup -w MyWorkspace -o table
- command:
    name: batchai file-server show
    summary: Show information about a file server.
    examples:
    - summary: Show full information about a file server.
      command: az batchai file-server show -g MyResourceGroup -w MyWorkspace -n MyNFS
    - summary: Show file server summary.
      command: az batchai file-server show -g MyResourceGroup -w MyWorkspace -n MyNFS -o table
- command:
    name: batchai list-usages
    summary: Gets the current usage information as well as limits for Batch AI resources for given location.
    examples:
    - summary: Get information for eastus location.
      command: az batchai list-usages -l eastus -o table
