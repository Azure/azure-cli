version: 1
content:
- group:
    name: policy event
    summary: Manage policy events.
- command:
    name: policy event list
    summary: List policy events.
    examples:
    - summary: Get policy events at current subscription scope created in the last day.
      command: >
        az policy event list
    - summary: Get policy events at management group scope.
      command: >
        az policy event list -m "myMg"
    - summary: Get policy events at resource group scope in current subscription.
      command: >
        az policy event list -g "myRg"
    - summary: Get policy events for a resource using resource ID.
      command: >
        az policy event list --resource "/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup /providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1"
    - summary: Get policy events for a resource using resource name.
      command: >
        az policy event list --resource "myKeyVault" --namespace "Microsoft.KeyVault" --resource-type "vaults" -g "myresourcegroup"
    - summary: Get policy events for a nested resource using resource name.
      command: >
        az policy event list --resource "myRule1" --namespace "Microsoft.Network" --resource-type "securityRules" --parent "networkSecurityGroups/mysecuritygroup1" -g "myresourcegroup"
    - summary: Get policy events for a policy set definition in current subscription.
      command: >
        az policy event list -s "fff58873-fff8-fff5-fffc-fffbe7c9d697"
    - summary: Get policy events for a policy definition in current subscription.
      command: >
        az policy event list -d "fff69973-fff8-fff5-fffc-fffbe7c9d698"
    - summary: Get policy events for a policy assignment in current subscription.
      command: >
        az policy event list -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get policy events for a policy assignment in the specified resource group in current subscription.
      command: >
        az policy event list -g "myRg" -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get top 5 policy events in current subscription, selecting a subset of properties and customizing ordering.
      command: >
        az policy event list --top 5 --order-by "timestamp desc, policyAssignmentName asc" --select "timestamp, resourceId, policyAssignmentId, policySetDefinitionId, policyDefinitionId"
    - summary: Get policy events in current subscription during a custom time interval.
      command: >
        az policy event list --from "2018-03-08T00:00:00Z" --to "2018-03-15T00:00:00Z"
    - summary: Get policy events in current subscription filtering results based on some property values.
      command: >
        az policy event list --filter "(policyDefinitionAction eq 'deny' or policyDefinitionAction eq 'audit') and resourceLocation ne 'eastus'"
    - summary: Get number of policy events in current subscription.
      command: >
        az policy event list --apply "aggregate($count as numberOfRecords)"
    - summary: Get policy events in current subscription aggregating results based on some properties.
      command: >
        az policy event list --apply "groupby((policyAssignmentId, policyDefinitionId, policyDefinitionAction, resourceId), aggregate($count as numEvents))"
    - summary: Get policy events in current subscription grouping results based on some properties.
      command: >
        az policy event list --apply "groupby((policyAssignmentName, resourceId))"
    - summary: Get policy events in current subscription aggregating results based on some properties specifying multiple groupings.
      command: >
        az policy event list --apply "groupby((policyAssignmentId, policyDefinitionId, resourceId))/groupby((policyAssignmentId, policyDefinitionId), aggregate($count as numResourcesWithEvents))"
- group:
    name: policy state
    summary: Manage policy compliance states.
- command:
    name: policy state list
    summary: List policy compliance states.
    examples:
    - summary: Get latest policy states at current subscription scope.
      command: >
        az policy state list
    - summary: Get all policy states at current subscription scope.
      command: >
        az policy state list --all
    - summary: Get latest policy states at management group scope.
      command: >
        az policy state list -m "myMg"
    - summary: Get latest policy states at resource group scope in current subscription.
      command: >
        az policy state list -g "myRg"
    - summary: Get latest policy states for a resource using resource ID.
      command: >
        az policy state list --resource "/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup /providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1"
    - summary: Get latest policy states for a resource using resource name.
      command: >
        az policy state list --resource "myKeyVault" --namespace "Microsoft.KeyVault" --resource-type "vaults" -g "myresourcegroup"
    - summary: Get latest policy states for a nested resource using resource name.
      command: >
        az policy state list --resource "myRule1" --namespace "Microsoft.Network" --resource-type "securityRules" --parent "networkSecurityGroups/mysecuritygroup1" -g "myresourcegroup"
    - summary: Get latest policy states for a policy set definition in current subscription.
      command: >
        az policy state list -s "fff58873-fff8-fff5-fffc-fffbe7c9d697"
    - summary: Get latest policy states for a policy definition in current subscription.
      command: >
        az policy state list -d "fff69973-fff8-fff5-fffc-fffbe7c9d698"
    - summary: Get latest policy states for a policy assignment in current subscription.
      command: >
        az policy state list -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get latest policy states for a policy assignment in the specified resource group in current subscription.
      command: >
        az policy state list -g "myRg" -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get top 5 latest policy states in current subscription, selecting a subset of properties and customizing ordering.
      command: >
        az policy state list --top 5 --order-by "timestamp desc, policyAssignmentName asc" --select "timestamp, resourceId, policyAssignmentId, policySetDefinitionId, policyDefinitionId"
    - summary: Get latest policy states in current subscription during a custom time interval.
      command: >
        az policy state list --from "2018-03-08T00:00:00Z" --to "2018-03-15T00:00:00Z"
    - summary: Get latest policy states in current subscription filtering results based on some property values.
      command: >
        az policy state list --filter "(policyDefinitionAction eq 'deny' or policyDefinitionAction eq 'audit') and resourceLocation ne 'eastus'"
    - summary: Get number of latest policy states in current subscription.
      command: >
        az policy state list --apply "aggregate($count as numberOfRecords)"
    - summary: Get latest policy states in current subscription aggregating results based on some properties.
      command: >
        az policy state list --apply "groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId), aggregate($count as numStates))"
    - summary: Get latest policy states in current subscription grouping results based on some properties.
      command: >
        az policy state list --apply "groupby((policyAssignmentName, resourceId))"
    - summary: Get latest policy states in current subscription aggregating results based on some properties specifying multiple groupings.
      command: >
        az policy state list --apply "groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId, resourceId))/groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId), aggregate($count as numNonCompliantResources))"
- command:
    name: policy state summarize
    summary: Summarize policy compliance states.
    examples:
    - summary: Get latest non-compliant policy states summary at current subscription scope.
      command: >
        az policy state summarize
    - summary: Get latest non-compliant policy states summary at management group scope.
      command: >
        az policy state summarize -m "myMg"
    - summary: Get latest non-compliant policy states summary at resource group scope in current subscription.
      command: >
        az policy state summarize -g "myRg"
    - summary: Get latest non-compliant policy states summary for a resource using resource ID.
      command: >
        az policy state summarize --resource "/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup /providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1"
    - summary: Get latest non-compliant policy states summary for a resource using resource name.
      command: >
        az policy state summarize --resource "myKeyVault" --namespace "Microsoft.KeyVault" --resource-type "vaults" -g "myresourcegroup"
    - summary: Get latest non-compliant policy states summary for a nested resource using resource name.
      command: >
        az policy state summarize --resource "myRule1" --namespace "Microsoft.Network" --resource-type "securityRules" --parent "networkSecurityGroups/mysecuritygroup1" -g "myresourcegroup"
    - summary: Get latest non-compliant policy states summary for a policy set definition in current subscription.
      command: >
        az policy state summarize -s "fff58873-fff8-fff5-fffc-fffbe7c9d697"
    - summary: Get latest non-compliant policy states summary for a policy definition in current subscription.
      command: >
        az policy state summarize -d "fff69973-fff8-fff5-fffc-fffbe7c9d698"
    - summary: Get latest non-compliant policy states summary for a policy assignment in current subscription.
      command: >
        az policy state summarize -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get latest non-compliant policy states summary for a policy assignment in the specified resource group in current subscription.
      command: >
        az policy state summarize -g "myRg" -a "ddd8ef92e3714a5ea3d208c1"
    - summary: Get latest non-compliant policy states summary in current subscription, limiting the assignments summary to top 5.
      command: >
        az policy state summarize --top 5
    - summary: Get latest non-compliant policy states summary in current subscription for a custom time interval.
      command: >
        az policy state summarize --from "2018-03-08T00:00:00Z" --to "2018-03-15T00:00:00Z"
    - summary: Get latest non-compliant policy states summary in current subscription filtering results based on some property values.
      command: >
        az policy state summarize --filter "(policyDefinitionAction eq 'deny' or policyDefinitionAction eq 'audit') and resourceLocation ne 'eastus'"
