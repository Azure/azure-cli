interactions:
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - keyvault update
      Connection:
      - keep-alive
      ParameterSetName:
      - --name --resource-group --enable-rbac-authorization
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.KeyVault/vaults/clitest000002?api-version=2023-02-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.KeyVault/vaults/clitest000002","name":"clitest000002","type":"Microsoft.KeyVault/vaults","location":"westus","tags":{},"systemData":{"createdBy":"trisavo@microsoft.com","createdByType":"User","createdAt":"2025-03-19T16:44:37.709Z","lastModifiedBy":"trisavo@microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-03-19T16:44:37.709Z"},"properties":{"sku":{"family":"A","name":"standard"},"tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47","accessPolicies":[],"enabledForDeployment":false,"enableSoftDelete":true,"softDeleteRetentionInDays":7,"enableRbacAuthorization":true,"enablePurgeProtection":true,"vaultUri":"https://clitest000002.vault.azure.net/","provisioningState":"Succeeded","publicNetworkAccess":"Enabled"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '839'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:15 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-aspnet-version:
      - 4.0.30319
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-keyvault-service-version:
      - 2.2.29.0
      x-ms-ratelimit-remaining-subscription-global-reads:
      - '16499'
      x-msedge-ref:
      - 'Ref A: 36D38C102BE24F89992FAA590A6FB237 Ref B: CO6AA3150220037 Ref C: 2025-03-19T16:45:10Z'
    status:
      code: 200
      message: OK
- request:
    body: '{"location": "westus", "tags": {}, "properties": {"tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
      "sku": {"family": "A", "name": "standard"}, "accessPolicies": [], "vaultUri":
      "https://clitest000002.vault.azure.net/", "enabledForDeployment": false, "enableSoftDelete":
      true, "softDeleteRetentionInDays": 7, "enableRbacAuthorization": false, "enablePurgeProtection":
      true, "provisioningState": "Succeeded", "publicNetworkAccess": "Enabled"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - keyvault update
      Connection:
      - keep-alive
      Content-Length:
      - '444'
      Content-Type:
      - application/json
      ParameterSetName:
      - --name --resource-group --enable-rbac-authorization
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.KeyVault/vaults/clitest000002?api-version=2023-02-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.KeyVault/vaults/clitest000002","name":"clitest000002","type":"Microsoft.KeyVault/vaults","location":"westus","tags":{},"systemData":{"createdBy":"trisavo@microsoft.com","createdByType":"User","createdAt":"2025-03-19T16:44:37.709Z","lastModifiedBy":"trisavo@microsoft.com","lastModifiedByType":"User","lastModifiedAt":"2025-03-19T16:45:17.596Z"},"properties":{"sku":{"family":"A","name":"standard"},"tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47","accessPolicies":[],"enabledForDeployment":false,"enableSoftDelete":true,"softDeleteRetentionInDays":7,"enableRbacAuthorization":false,"enablePurgeProtection":true,"vaultUri":"https://clitest000002.vault.azure.net/","provisioningState":"Succeeded","publicNetworkAccess":"Enabled"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '840'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:20 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-aspnet-version:
      - 4.0.30319
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-keyvault-service-version:
      - 2.2.29.0
      x-ms-operation-identifier:
      - tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47,objectId=1cf15f1f-c610-4e5c-b680-970697d1bbba/westus2/014cd911-096b-4022-9022-068f6f19280a
      x-ms-ratelimit-remaining-subscription-global-writes:
      - '11999'
      x-ms-ratelimit-remaining-subscription-writes:
      - '799'
      x-msedge-ref:
      - 'Ref A: 544D50950A994686A9B4B82A2B98EA31 Ref B: CO6AA3150219049 Ref C: 2025-03-19T16:45:15Z'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      ParameterSetName:
      - --role --assignee --scope
      User-Agent:
      - python/3.11.9 (Windows-10-10.0.22631-SP0) AZURECLI/2.70.0
    method: GET
    uri: https://graph.microsoft.com/v1.0/users?$filter=userPrincipalName%20eq%20%27trisavo%40microsoft.com%27
  response:
    body:
      string: '{"@odata.context":"https://graph.microsoft.com/v1.0/$metadata#users","value":[{"businessPhones":["+1
        (425) 7277459"],"displayName":"Trisa Vo","givenName":"Trisa","jobTitle":"SOFTWARE
        ENGINEER","mail":"trisavo@microsoft.com","mobilePhone":null,"officeLocation":"Home
        Office","preferredLanguage":null,"surname":"Vo","userPrincipalName":"trisavo@microsoft.com","id":"1cf15f1f-c610-4e5c-b680-970697d1bbba"}]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '404'
      content-type:
      - application/json; odata.metadata=minimal; odata.streaming=true; IEEE754Compatible=false;
        charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:20 GMT
      odata-version:
      - '4.0'
      request-id:
      - 6b592d23-66b3-49dc-904c-c9348534822e
      strict-transport-security:
      - max-age=31536000
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-ms-ags-diagnostic:
      - '{"ServerInfo":{"DataCenter":"West US 2","Slice":"E","Ring":"4","ScaleUnit":"005","RoleInstance":"MWH0EPF000B674F"}}'
      x-ms-resource-unit:
      - '2'
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      ParameterSetName:
      - --role --assignee --scope
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001/providers/Microsoft.Authorization/roleDefinitions?$filter=roleName%20eq%20%27Key%20Vault%20Administrator%27&api-version=2022-05-01-preview
  response:
    body:
      string: '{"value":[{"properties":{"roleName":"Key Vault Administrator","type":"BuiltInRole","description":"Perform
        all data plane operations on a key vault and all objects in it, including
        certificates, keys, and secrets. Cannot manage key vault resources or manage
        role assignments. Only works for key vaults that use the ''Azure role-based
        access control'' permission model.","assignableScopes":["/"],"permissions":[{"actions":["Microsoft.Authorization/*/read","Microsoft.Insights/alertRules/*","Microsoft.Resources/deployments/*","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Support/*","Microsoft.KeyVault/checkNameAvailability/read","Microsoft.KeyVault/deletedVaults/read","Microsoft.KeyVault/locations/*/read","Microsoft.KeyVault/vaults/*/read","Microsoft.KeyVault/operations/read"],"notActions":[],"dataActions":["Microsoft.KeyVault/vaults/*"],"notDataActions":[]}],"createdOn":"2020-05-19T17:52:46.2349235Z","updatedOn":"2021-11-11T20:14:30.2542755Z","createdBy":null,"updatedBy":null},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/00482a5a-887f-4fb3-b363-3b7fe8e74483","type":"Microsoft.Authorization/roleDefinitions","name":"00482a5a-887f-4fb3-b363-3b7fe8e74483"}]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '1247'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:20 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-operation-identifier:
      - tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47,objectId=1cf15f1f-c610-4e5c-b680-970697d1bbba/westus2/6a233b88-8954-4daf-acf2-a33502b1d647
      x-ms-ratelimit-remaining-subscription-global-reads:
      - '16499'
      x-msedge-ref:
      - 'Ref A: 6B963EFC15614D8098353DBCD5AE02E8 Ref B: CO6AA3150218049 Ref C: 2025-03-19T16:45:20Z'
    status:
      code: 200
      message: OK
- request:
    body: '{"properties": {"roleDefinitionId": "/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/00482a5a-887f-4fb3-b363-3b7fe8e74483",
      "principalId": "1cf15f1f-c610-4e5c-b680-970697d1bbba", "principalType": "User"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      Content-Length:
      - '258'
      Content-Type:
      - application/json
      ParameterSetName:
      - --role --assignee --scope
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001/providers/Microsoft.Authorization/roleAssignments/8e9d5b98-c29b-4e9c-88c9-d16fd2761db4?api-version=2022-04-01
  response:
    body:
      string: '{"properties":{"roleDefinitionId":"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/00482a5a-887f-4fb3-b363-3b7fe8e74483","principalId":"1cf15f1f-c610-4e5c-b680-970697d1bbba","principalType":"User","scope":"/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001","condition":null,"conditionVersion":null,"createdOn":"2025-03-19T16:45:21.4501129Z","updatedOn":"2025-03-19T16:45:21.7211178Z","createdBy":null,"updatedBy":"1cf15f1f-c610-4e5c-b680-970697d1bbba","delegatedManagedIdentityResourceId":null,"description":null},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001/providers/Microsoft.Authorization/roleAssignments/8e9d5b98-c29b-4e9c-88c9-d16fd2761db4","type":"Microsoft.Authorization/roleAssignments","name":"8e9d5b98-c29b-4e9c-88c9-d16fd2761db4"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '875'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:23 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-cache:
      - CONFIG_NOCACHE
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-global-writes:
      - '11999'
      x-ms-ratelimit-remaining-subscription-writes:
      - '799'
      x-msedge-ref:
      - 'Ref A: 26924480018543FC94AFBF49D2EBDEE8 Ref B: CO6AA3150218049 Ref C: 2025-03-19T16:45:21Z'
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - keyvault key create
      Connection:
      - keep-alive
      Content-Length:
      - '0'
      Content-Type:
      - application/json
      ParameterSetName:
      - --name --vault-name
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: POST
    uri: https://clitest000002.vault.azure.net/keys/testkey000003/create?api-version=7.5-preview.1
  response:
    body:
      string: '{"error":{"code":"Unauthorized","message":"AKV10000: Request is missing
        a Bearer or PoP token."}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '97'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:23 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000;includeSubDomains
      www-authenticate:
      - Bearer authorization="https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47",
        resource="https://vault.azure.net"
      x-content-type-options:
      - nosniff
      x-ms-keyvault-network-info:
      - conn_type=Ipv4;addr=70.37.26.41;act_addr_fam=InterNetwork;
      x-ms-keyvault-region:
      - westus
      x-ms-keyvault-service-version:
      - 1.9.2203.1
    status:
      code: 401
      message: Unauthorized
- request:
    body: '{"kty": "RSA", "attributes": {"enabled": true}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - keyvault key create
      Connection:
      - keep-alive
      Content-Length:
      - '47'
      Content-Type:
      - application/json
      ParameterSetName:
      - --name --vault-name
      User-Agent:
      - AZURECLI/2.70.0 azsdk-python-core/1.31.0 Python/3.11.9 (Windows-10-10.0.22631-SP0)
    method: POST
    uri: https://clitest000002.vault.azure.net/keys/testkey000003/create?api-version=7.5-preview.1
  response:
    body:
      string: '{"error":{"code":"Forbidden","message":"The user, group or application
        ''appid=04b07795-8ddb-461a-bbee-02f9e1bf7b46;oid=1cf15f1f-c610-4e5c-b680-970697d1bbba;numgroups=851;iss=https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/''
        does not have keys create permission on key vault ''clitest000002;location=westus''.
        For help resolving this issue, please see https://go.microsoft.com/fwlink/?linkid=2125287","innererror":{"code":"AccessDenied"}}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '449'
      content-type:
      - application/json; charset=utf-8
      date:
      - Wed, 19 Mar 2025 16:45:23 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000;includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-keyvault-network-info:
      - conn_type=Ipv4;addr=70.37.26.41;act_addr_fam=InterNetwork;
      x-ms-keyvault-region:
      - westus
      x-ms-keyvault-service-version:
      - 1.9.2203.1
    status:
      code: 403
      message: Forbidden
version: 1
