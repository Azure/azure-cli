version: 1
content:
- group:
    name: sql vm
    summary: Manage SQL virtual machines.
- group:
    name: sql vm group
    summary: Manage SQL virtual machine groups.
- group:
    name: sql vm group ag-listener
    summary: Manage SQL availability group listeners.
- command:
    name: sql vm group create
    summary: Creates a SQL virtual machine group.
    examples:
    - summary: Create a SQL virtual machine group for SQL2016-WS2016 Enterprise virtual machines.
      command: >
        az sql vm group create -n sqlvmgroup -l eastus -g myresourcegroup --image-offer SQL2016-WS2016 --image-sku Enterprise
        --domain-fqdn Domain.com --operator-acc testop --service-acc testservice --sa-key {PublicKey} --storage-account 'https://storacc.blob.core.windows.net/'
- command:
    name: sql vm group update
    summary: Updates a SQL virtual machine group if there are not SQL virtual machines attached to the group.
    examples:
    - summary: Update an empty SQL virtual machine group operator account.
      command: >
        az sql vm group update -n sqlvmgroup -g myresourcegroup --operator-acc testop
    - summary: Update an empty SQL virtual machine group storage account and key.
      command: >
        az sql vm group update -n sqlvmgroup -g myresourcegroup --sa-key {PublicKey} --storage-account 'https://newstoracc.blob.core.windows.net/'
- command:
    name: sql vm group ag-listener create
    summary: Creates an availability group listener.
    examples:
    - summary: Create an availability group listener. Note the SQL virtual machines are in the same resource group as the SQL virtual machine group.
      command: >
        az sql vm group ag-listener create -n aglistenertest -g myresourcegroup --ag-name agname --group-name sqlvmgroup --ip-address 10.0.0.11
        --load-balancer '/subscriptions/{yoursubscription}/resourceGroups/{yourrg}/providers/Microsoft.Network/loadBalancers/{lbname}' --probe-port 59999
        --subnet '/subscriptions/{yoursubscription}/resourceGroups/{yourrg}/providers/Microsoft.Network/virtualNetworks/{vnname}/subnets/{subnetname}'
        --sqlvms sqlvm1 sqlvm2
    - summary: Create an availability group listener. Note all resources are in the same resource group.
      command: >
        az sql vm group ag-listener create -n aglistenertest -g myresourcegroup --ag-name agname --group-name sqlvmgroup --ip-address 10.0.0.11
        --load-balancer {lbname} --probe-port 59999 --subnet {subnetname} --vnet-name {vnname} --sqlvms sqlvm1 sqlvm2
- command:
    name: sql vm create
    summary: Creates a SQL virtual machine.
    arguments:
    - name: --name
      summary: Name of the SQL virtual machine. The name of the new SQL virtual machine must be equal to the underlying virtual machine created from SQL marketplace image.
    examples:
    - summary: Create a SQL virtual machine with AHUB billing tag.
      command: >
        az sql vm create -n sqlvm -g myresourcegroup -l eastus --license-type AHUB
    - summary: Enable R services in SQL2016 onwards.
      command: >
        az sql vm create -n sqlvm -g myresourcegroup -l eastus --enable-r-services true
    - summary: Create SQL virtual machine and configure auto backup settings.
      command: >
        az sql vm create -n sqlvm -g myresourcegroup -l eastus --backup-schedule-type manual --full-backup-frequency Weekly --full-backup-start-hour 2 --full-backup-duration 2
        --sa-key {storageKey} --storage-account 'https://storageacc.blob.core.windows.net/' --retention-period 30 --log-backup-frequency 60
    - summary: Create SQL virtual machine and configure auto patching settings.
      command: >
        az sql vm create -n sqlvm -g myresourcegroup -l eastus --day-of-week sunday --maintenance-window-duration 60 --maintenance-window-start-hour 2
    - summary: Create SQL virtual machine and configure SQL connectivity settings.
      command: >
        az sql vm create -n sqlvm -g myresourcegroup -l eastus --connectivity-type private --port 1433 --sql-auth-update-username {newlogin} --sql-auth-update-pwd {sqlpassword}
- command:
    name: sql vm update
    summary: Updates the properties of a SQL virtual machine.
    examples:
    - summary: Add or update a tag.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --set tags.tagName=tagValue
    - summary: Remove a tag.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --remove tags.tagName
    - summary: Update SQL virtual machine auto backup settings.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --backup-schedule-type manual --full-backup-frequency Weekly --full-backup-start-hour 2 --full-backup-duration 2
        --sa-key {storageKey} --storage-account 'https://storageacc.blob.core.windows.net/' --retention-period 30 --log-backup-frequency 60
    - summary: Disable SQL virtual machine auto backup settings.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --enable-auto-backup false
    - summary: Update SQL virtual machine auto patching settings.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --day-of-week sunday --maintenance-window-duration 60 --maintenance-window-start-hour 2
    - summary: Disable SQL virtual machine auto patching settings.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --enable-auto-patching false
    - summary: Update a SQL virtual machine billing tag to AHUB.
      command: >
        az sql vm update -n sqlvm -g myresourcegroup --license-type AHUB
- command:
    name: sql vm add-to-group
    summary: Adds SQL virtual machine to a SQL virtual machine group.
    examples:
    - summary: Add SQL virtual machine to a group.
      command: >
        az sql vm add-to-group -n sqlvm -g myresourcegroup --sqlvm-group sqlvmgroup --boostrap-acc-pwd
        {boostrappassword} --operator-acc-pwd {operatorpassword} --service-acc-pwd {servicepassword}
- command:
    name: sql vm remove-from-group
    summary: Remove SQL virtual machine from its current SQL virtual machine group.
    examples:
    - summary: Remove SQL virtual machine from a group.
      command: >
        az sql vm remove-from-group -n sqlvm -g myresourcegroup
- command:
    name: sql vm group ag-listener update
    summary: Updates an availability group listener.
    examples:
    - summary: Replace the SQL virtual machines that were in the availability group.
      command: >
        az sql vm group ag-listener update --sqlvms sqlvm3 sqlvm4 --group-name mygroup
