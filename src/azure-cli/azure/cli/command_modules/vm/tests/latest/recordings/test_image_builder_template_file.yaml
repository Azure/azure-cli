interactions:
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - identity create
      Connection:
      - keep-alive
      ParameterSetName:
      - -g -n
      User-Agent:
      - python/3.7.4 (Windows-10-10.0.18362-SP0) msrest/0.6.10 msrest_azure/0.6.3
        azure-mgmt-resource/9.0.0 Azure-SDK-For-Python AZURECLI/2.5.1
      accept-language:
      - en-US
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_image_builder_template_file_000001?api-version=2019-07-01
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001","name":"cli_test_image_builder_template_file_000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2020-05-09T07:26:51Z"},"properties":{"provisioningState":"Succeeded"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '428'
      content-type:
      - application/json; charset=utf-8
      date:
      - Sat, 09 May 2020 07:26:57 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: '{"location": "westus"}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - identity create
      Connection:
      - keep-alive
      Content-Length:
      - '22'
      Content-Type:
      - application/json; charset=utf-8
      ParameterSetName:
      - -g -n
      User-Agent:
      - python/3.7.4 (Windows-10-10.0.18362-SP0) msrest/0.6.10 msrest_azure/0.6.3
        azure-mgmt-msi/0.2.0 Azure-SDK-For-Python AZURECLI/2.5.1
      accept-language:
      - en-US
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/ide1?api-version=2015-08-31-preview
  response:
    body:
      string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_image_builder_template_file_000001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/ide1","name":"ide1","type":"Microsoft.ManagedIdentity/userAssignedIdentities","location":"westus","tags":{},"properties":{"tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47","principalId":"54667b7c-1f1b-4a2d-a8dc-c22d641cde03","clientId":"07d226b8-e02e-41d1-8040-58258b53e310","clientSecretUrl":"https://control-westus.identity.azure.net/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_image_builder_template_file_000001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/ide1/credentials?tid=72f988bf-86f1-41af-91ab-2d7cd011db47&oid=54667b7c-1f1b-4a2d-a8dc-c22d641cde03&aid=07d226b8-e02e-41d1-8040-58258b53e310"}}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '888'
      content-type:
      - application/json; charset=utf-8
      date:
      - Sat, 09 May 2020 07:27:04 GMT
      expires:
      - '-1'
      location:
      - /subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_image_builder_template_file_000001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/ide1
      pragma:
      - no-cache
      server:
      - Microsoft-HTTPAPI/2.0
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-writes:
      - '1196'
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      ParameterSetName:
      - --assignee --role --scope
      User-Agent:
      - python/3.7.4 (Windows-10-10.0.18362-SP0) msrest/0.6.10 msrest_azure/0.6.3
        azure-mgmt-authorization/0.52.0 Azure-SDK-For-Python AZURECLI/2.5.1
      accept-language:
      - en-US
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001/providers/Microsoft.Authorization/roleDefinitions?$filter=roleName%20eq%20%27Contributor%27&api-version=2018-01-01-preview
  response:
    body:
      string: '{"value":[{"properties":{"roleName":"Contributor","type":"BuiltInRole","description":"Lets
        you manage everything except access to resources.","assignableScopes":["/"],"permissions":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Delete","Microsoft.Authorization/*/Write","Microsoft.Authorization/elevateAccess/Action","Microsoft.Blueprint/blueprintAssignments/write","Microsoft.Blueprint/blueprintAssignments/delete"],"dataActions":[],"notDataActions":[]}],"createdOn":"2015-02-02T21:55:09.8806423Z","updatedOn":"2019-02-05T21:24:38.4580610Z","createdBy":null,"updatedBy":null},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c","type":"Microsoft.Authorization/roleDefinitions","name":"b24988ac-6180-42a0-ab88-20f7382dd24c"}]}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '832'
      content-type:
      - application/json; charset=utf-8
      date:
      - Sat, 09 May 2020 07:27:35 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      set-cookie:
      - x-ms-gateway-slice=Production; path=/; SameSite=None; secure; HttpOnly
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      transfer-encoding:
      - chunked
      vary:
      - Accept-Encoding
      x-content-type-options:
      - nosniff
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      ParameterSetName:
      - --assignee --role --scope
      User-Agent:
      - python/3.7.4 (Windows-10-10.0.18362-SP0) msrest/0.6.10 msrest_azure/0.6.3
        azure-graphrbac/0.60.0 Azure-SDK-For-Python AZURECLI/2.5.1
      accept-language:
      - en-US
    method: GET
    uri: https://graph.windows.net/00000000-0000-0000-0000-000000000000/servicePrincipals?$filter=servicePrincipalNames%2Fany%28c%3Ac%20eq%20%2707d226b8-e02e-41d1-8040-58258b53e310%27%29&api-version=1.6
  response:
    body:
      string: '{"odata.metadata":"https://graph.windows.net/00000000-0000-0000-0000-000000000000/$metadata#directoryObjects","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"54667b7c-1f1b-4a2d-a8dc-c22d641cde03","deletionTimestamp":null,"accountEnabled":true,"addIns":[],"alternativeNames":["isExplicit=True","/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_image_builder_template_file_000001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/ide1"],"appDisplayName":null,"appId":"07d226b8-e02e-41d1-8040-58258b53e310","applicationTemplateId":null,"appOwnerTenantId":null,"appRoleAssignmentRequired":false,"appRoles":[],"displayName":"ide1","errorUrl":null,"homepage":null,"informationalUrls":null,"keyCredentials":[{"customKeyIdentifier":"6AA515838AE0B19FBEE5EFBA8B2172CDDB755338","endDate":"2020-08-07T07:22:00Z","keyId":"47fad45f-bb3c-46e5-ba2d-f12446762452","startDate":"2020-05-09T07:22:00Z","type":"AsymmetricX509Cert","usage":"Verify","value":null}],"logoutUrl":null,"notificationEmailAddresses":[],"oauth2Permissions":[],"passwordCredentials":[],"preferredSingleSignOnMode":null,"preferredTokenSigningKeyEndDateTime":null,"preferredTokenSigningKeyThumbprint":null,"publisherName":null,"replyUrls":[],"samlMetadataUrl":null,"samlSingleSignOnSettings":null,"servicePrincipalNames":["07d226b8-e02e-41d1-8040-58258b53e310","https://identity.azure.net/ZX//MgWIoS/AzvhuG5em4xCswasg5AaOAPkuBNPfpYc="],"servicePrincipalType":"ManagedIdentity","signInAudience":null,"tags":[],"tokenEncryptionKeyId":null}]}'
    headers:
      access-control-allow-origin:
      - '*'
      cache-control:
      - no-cache
      content-length:
      - '1624'
      content-type:
      - application/json; odata=minimalmetadata; streaming=true; charset=utf-8
      dataserviceversion:
      - 3.0;
      date:
      - Sat, 09 May 2020 07:27:35 GMT
      duration:
      - '435891'
      expires:
      - '-1'
      ocp-aad-diagnostics-server-name:
      - 1X57t9wx8eQlbAjt9bJhyUgmh2yhN49WwbARYbg28Do=
      ocp-aad-session-key:
      - 2xCU11MMseRsL93frLZ-831BD5tirrgVnU1XazCt-vsgf5509d3NgxA61387jc-7R4v_m1PDU7_E-MyIKcedp0tC5Rx5NYrQza_qQJGkNd5kDSnOzMNJf7gKCjAe1Yeb.RAQ06cQRd03rHhZJizGF6qZmRjDzwgBZSuGg2RdwFjg
      pragma:
      - no-cache
      request-id:
      - d3768069-3ce1-483f-80fc-92981d7ded23
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-aspnet-version:
      - 4.0.30319
      x-ms-dirapi-data-contract-version:
      - '1.6'
      x-powered-by:
      - ASP.NET
    status:
      code: 200
      message: OK
- request:
    body: '{"properties": {"roleDefinitionId": "/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c",
      "principalId": "54667b7c-1f1b-4a2d-a8dc-c22d641cde03"}}'
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      CommandName:
      - role assignment create
      Connection:
      - keep-alive
      Content-Length:
      - '233'
      Content-Type:
      - application/json; charset=utf-8
      Cookie:
      - x-ms-gateway-slice=Production
      ParameterSetName:
      - --assignee --role --scope
      User-Agent:
      - python/3.7.4 (Windows-10-10.0.18362-SP0) msrest/0.6.10 msrest_azure/0.6.3
        azure-mgmt-authorization/0.52.0 Azure-SDK-For-Python AZURECLI/2.5.1
      accept-language:
      - en-US
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001/providers/Microsoft.Authorization/roleAssignments/88888888-0000-0000-0000-000000000001?api-version=2018-09-01-preview
  response:
    body:
      string: '{"properties":{"roleDefinitionId":"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c","principalId":"54667b7c-1f1b-4a2d-a8dc-c22d641cde03","principalType":"ServicePrincipal","scope":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001","createdOn":"2020-05-09T07:27:36.8281536Z","updatedOn":"2020-05-09T07:27:36.8281536Z","createdBy":null,"updatedBy":"8917b591-e9ee-4ad8-8340-a202d5f619e7"},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_image_builder_template_file_000001/providers/Microsoft.Authorization/roleAssignments/88888888-0000-0000-0000-000000000001","type":"Microsoft.Authorization/roleAssignments","name":"88888888-0000-0000-0000-000000000001"}'
    headers:
      cache-control:
      - no-cache
      content-length:
      - '903'
      content-type:
      - application/json; charset=utf-8
      date:
      - Sat, 09 May 2020 07:27:41 GMT
      expires:
      - '-1'
      pragma:
      - no-cache
      set-cookie:
      - x-ms-gateway-slice=Production; path=/; secure; HttpOnly; SameSite=None
      strict-transport-security:
      - max-age=31536000; includeSubDomains
      x-content-type-options:
      - nosniff
      x-ms-ratelimit-remaining-subscription-writes:
      - '1195'
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      Accept:
      - '*/*'
      Accept-Encoding:
      - gzip, deflate
      Connection:
      - keep-alive
      User-Agent:
      - python-requests/2.22.0
    method: GET
    uri: https://raw.githubusercontent.com/qwordy/azvmimagebuilder/master/quickquickstarts/0_Creating_a_Custom_Linux_Managed_Image/example.json
  response:
    body:
      string: "{\n    \"type\": \"Microsoft.VirtualMachineImages/imageTemplates\",\n
        \   \"apiVersion\": \"2019-05-01-preview\",\n    \"location\": \"westus\",\n
        \   \"dependsOn\": [],\n    \"tags\": {\n        \"imagebuilderTemplate\":
        \"ubuntu1804\"\n            },\n    \"properties\": {\n\n        \"buildTimeoutInMinutes\"
        : 80,\n        \n        \"vmProfile\": \n            {\n            \"vmSize\":
        \"Standard_D1_v2\",\n            \"osDiskSizeGB\": 30\n            },\n\n
        \       \"source\": {\n            \"type\": \"PlatformImage\",\n                \"publisher\":
        \"Canonical\",\n                \"offer\": \"UbuntuServer\",\n                \"sku\":
        \"18.04-LTS\",\n                \"version\": \"18.04.201903060\"\n            \n
        \       },\n        \"customize\": [\n            {\n                \"type\":
        \"Shell\",\n                \"name\": \"RunScriptFromSource\",\n                \"scriptUri\":
        \"https://raw.githubusercontent.com/danielsollondon/azvmimagebuilder/master/quickquickstarts/customizeScript.sh\"\n
        \           },\n\n            {\n                \"type\": \"Shell\",\n                \"name\":
        \"CheckSumCompareShellScript\",\n                \"scriptUri\": \"https://raw.githubusercontent.com/danielsollondon/azvmimagebuilder/master/quickquickstarts/customizeScript2.sh\",\n
        \               \"sha256Checksum\": \"ade4c5214c3c675e92c66e2d067a870c5b81b9844b3de3cc72c49ff36425fc93\"\n
        \           },\n            \n            {\n                \"type\": \"File\",\n
        \               \"name\": \"downloadBuildArtifacts\",\n                \"sourceUri\":
        \"https://raw.githubusercontent.com/danielsollondon/azvmimagebuilder/master/quickquickstarts/exampleArtifacts/buildArtifacts/index.html\",\n
        \               \"destination\":\"/tmp/index.html\"\n            },\n\n            {\n
        \               \"type\": \"Shell\",\n                \"name\": \"setupBuildPath\",\n
        \               \"inline\": [\n                    \"sudo mkdir /buildArtifacts\",\n
        \                   \"sudo cp /tmp/index.html /buildArtifacts/index.html\"\n
        \               ]\n            },\n\n            {\n                \"type\":
        \"Shell\",\n                \"name\": \"InstallUpgrades\",\n                \"inline\":
        [\n                    \"sudo apt install unattended-upgrades\"\n                ]\n
        \           }\n\n        ],\n        \"distribute\": \n            [\n                {
        \  \"type\":\"ManagedImage\",\n                    \"imageId\": \"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/fytest2/providers/Microsoft.Compute/images/image\",\n
        \                   \"location\": \"westus\",\n                    \"runOutputName\":
        \"runOutputName\",\n                    \"artifactTags\": {\n                        \"source\":
        \"azVmImageBuilder\",\n                        \"baseosimg\": \"ubuntu1804\"\n
        \                   }\n                }\n            ]\n        }\n    }\n"
    headers:
      accept-ranges:
      - bytes
      access-control-allow-origin:
      - '*'
      cache-control:
      - max-age=300
      connection:
      - keep-alive
      content-length:
      - '2666'
      content-security-policy:
      - default-src 'none'; style-src 'unsafe-inline'; sandbox
      content-type:
      - text/plain; charset=utf-8
      date:
      - Sat, 09 May 2020 07:27:43 GMT
      etag:
      - W/"308e89bcda38ef882050e78cdcfd78831d14d5d81ceba87b02fbf2215c092add"
      expires:
      - Sat, 09 May 2020 07:32:43 GMT
      source-age:
      - '0'
      strict-transport-security:
      - max-age=31536000
      vary:
      - Authorization,Accept-Encoding
      via:
      - 1.1 varnish (Varnish/6.0)
      - 1.1 varnish
      x-cache:
      - MISS, HIT
      x-cache-hits:
      - 0, 1
      x-content-type-options:
      - nosniff
      x-fastly-request-id:
      - dc8404029d94d454bf8fc1261f5370606e6ea308
      x-frame-options:
      - deny
      x-github-request-id:
      - F73A:7CDF:40C899:44F955:5EB65A09
      x-served-by:
      - cache-sin18038-SIN
      x-timer:
      - S1589009263.759540,VS0,VE325
      x-xss-protection:
      - 1; mode=block
    status:
      code: 200
      message: OK
version: 1
