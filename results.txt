
(env) C:\Users\daetienn\Desktop\azure-cli>FOR /L %x IN (1 1 2) DO (
az account set -s "a1bfa635-f2bf-42f1-86b5-848c674fc321"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set s "28cbf98f-381d-4425-9ac4-cf342dab9753"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set -s "5e87627b-4ffa-4abf-8040-b1103c84a2fd"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set -s "6898adc8-5045-473d-a1bf-7012564f43cb"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 azdev test --no-exitfirst 
) 

(env) C:\Users\daetienn\Desktop\azure-cli>(
az account set -s "a1bfa635-f2bf-42f1-86b5-848c674fc321"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set s "28cbf98f-381d-4425-9ac4-cf342dab9753"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set -s "5e87627b-4ffa-4abf-8040-b1103c84a2fd"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 az account set -s "6898adc8-5045-473d-a1bf-7012564f43cb"  
 azdev test --live --lf --no-exitfirst  
 azdev test --live --lf --no-exitfirst --series  
 azdev test --no-exitfirst 
) 
============================= test session starts =============================
platform win32 -- Python 3.8.6, pytest-6.1.2, py-1.9.0, pluggy-0.13.1 -- C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\daetienn\Desktop\azure-cli
plugins: forked-1.3.0, xdist-2.1.0
gw0 I / gw1 I / gw2 I / gw3 I
[gw0] win32 Python 3.8.6 cwd: C:\Users\daetienn\Desktop\azure-cli
[gw1] win32 Python 3.8.6 cwd: C:\Users\daetienn\Desktop\azure-cli
[gw2] win32 Python 3.8.6 cwd: C:\Users\daetienn\Desktop\azure-cli
[gw3] win32 Python 3.8.6 cwd: C:\Users\daetienn\Desktop\azure-cli
[gw0] Python 3.8.6 (tags/v3.8.6:db45529, Sep 23 2020, 15:52:53) [MSC v.1927 64 bit (AMD64)]
[gw1] Python 3.8.6 (tags/v3.8.6:db45529, Sep 23 2020, 15:52:53) [MSC v.1927 64 bit (AMD64)]
[gw2] Python 3.8.6 (tags/v3.8.6:db45529, Sep 23 2020, 15:52:53) [MSC v.1927 64 bit (AMD64)]
[gw3] Python 3.8.6 (tags/v3.8.6:db45529, Sep 23 2020, 15:52:53) [MSC v.1927 64 bit (AMD64)]
gw0 [548] / gw1 [548] / gw2 [548] / gw3 [548]

scheduling tests via LoadScheduling

src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_agentpool_commands.py::AcrAgentPoolCommandsTests::test_acr_agentpool 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_replication 
src/azure-cli/azure/cli/command_modules/kusto/tests/latest/test_kusto_commands.py::AzureKustoDatabaseTests::test_kusto_database_life_cycle 
src/azure-cli/azure/cli/command_modules/kusto/tests/latest/test_kusto_commands.py::AzureKustoClusterTests::test_kusto_cluster_stop_start 
[gw3] [  0%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_replication 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_encryption_with_cmk 
[gw3] [  0%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_encryption_with_cmk 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_private_endpoint 
[gw3] [  0%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_private_endpoint 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_taskrun_commands.py::AcrTaskRunCommandsTests::test_acr_taskrun 
[gw3] [  0%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_taskrun_commands.py::AcrTaskRunCommandsTests::test_acr_taskrun 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_control_plane_user_assigned_identity 
[gw3] [  0%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_control_plane_user_assigned_identity 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_blb_vmas_msi 
[gw3] [  1%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_blb_vmas_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_service_msi 
[gw1] [  1%] PASSED src/azure-cli/azure/cli/command_modules/kusto/tests/latest/test_kusto_commands.py::AzureKustoDatabaseTests::test_kusto_database_life_cycle 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_with_audits 
[gw1] [  1%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_with_audits 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_image_import 
[gw1] [  1%] SKIPPED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_image_import 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_network_rule_commands.py::AcrNetworkRuleCommandsTests::test_acr_network_rule 
[gw1] [  1%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_network_rule_commands.py::AcrNetworkRuleCommandsTests::test_acr_network_rule 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_availability_zones 
[gw3] [  2%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_service_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_nonaad_and_update_with_managed_aad_msi 
[gw3] [  2%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_nonaad_and_update_with_managed_aad_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi 
[gw1] [  2%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_availability_zones 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad_msi 
[gw3] [  2%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update_msi 
[gw1] [  2%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi 
[gw3] [  2%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ephemeral_disk 
[gw1] [  3%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting_msi 
[gw0] [  3%] PASSED src/azure-cli/azure/cli/command_modules/kusto/tests/latest/test_kusto_commands.py::AzureKustoClusterTests::test_kusto_cluster_stop_start 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_webhook 
[gw2] [  3%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_agentpool_commands.py::AcrAgentPoolCommandsTests::test_acr_agentpool 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_with_managed_registry 
[gw0] [  3%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_webhook 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_identity 
[gw2] [  3%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_create_with_managed_registry 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_dedicated_data_endpoints 
[gw2] [  4%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_dedicated_data_endpoints 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_task_commands.py::AcrTaskCommandsTests::test_acr_task 
[gw3] [  4%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ephemeral_disk 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ppg 
[gw1] [  4%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update_msi 
[gw2] [  4%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_task_commands.py::AcrTaskCommandsTests::test_acr_task 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_availability_zones_msi 
[gw0] [  4%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_identity 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_public_network_access 
[gw0] [  4%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_commands.py::AcrCommandsTests::test_acr_with_public_network_access 
src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_token.py::AcrTokenCommandsTests::test_repository_token_create 
[gw0] [  5%] PASSED src/azure-cli/azure/cli/command_modules/acr/tests/latest/test_acr_token.py::AcrTokenCommandsTests::test_repository_token_create 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad 
[gw2] [  5%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_availability_zones_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_blb_vmas 
[gw1] [  5%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_prefixes_then_update_msi 
[gw3] [  5%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ppg 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad 
[gw0] [  5%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update 
[gw2] [  6%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_blb_vmas 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_service 
[gw3] [  6%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete 
[gw1] [  6%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_prefixes_then_update_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool_msi 
[gw2] [  6%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_service 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_nonaad_and_update_with_managed_aad 
[gw1] [  6%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku 
[gw1] [  6%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows 
[gw3] [  7%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster 
[gw2] [  7%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_nonaad_and_update_with_managed_aad 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update 
[gw0] [  7%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting 
[gw3] [  7%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_custom.py::AcsCustomCommandTest::test_k8s_install_kubelogin_with_custom_source_url 
[gw3] [  7%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_custom.py::AcsCustomCommandTest::test_k8s_install_kubelogin_with_custom_source_url 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_ip_address_validation 
[gw3] [  8%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_ip_address_validation 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_remove_scm 
[gw3] [  8%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_remove_scm 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_slot 
[gw0] [  8%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update 
[gw3] [  8%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_slot 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_multicontainer_create 
[gw2] [  8%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update 
[gw3] [  8%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_multicontainer_create 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create_cd 
[gw3] [  9%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create_cd 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServicePlanScenarioTest::test_retain_plan 
[gw2] [  9%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ahub 
[gw0] [  9%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_prefixes_then_update 
[gw3] [  9%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServicePlanScenarioTest::test_retain_plan 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_update_site_configs_persists_ip_restrictions 
[gw3] [  9%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_update_site_configs_persists_ip_restrictions 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappRemoteSSHScenarioTest::test_linux_webapp_remote_ssh 
[gw0] [ 10%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_prefixes_then_update 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool 
[gw3] [ 10%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappRemoteSSHScenarioTest::test_linux_webapp_remote_ssh 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppCreateUsingACR::test_acr_create_function_app 
[gw1] [ 10%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_with_service_principal 
[gw3] [ 10%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppCreateUsingACR::test_acr_create_function_app 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotTrafficRouting::test_traffic_routing 
[gw3] [ 10%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotTrafficRouting::test_traffic_routing 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLCertTest::test_webapp_ssl 
[gw0] [ 10%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_managed_disk 
[gw1] [ 11%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_with_service_principal 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool 
[gw3] [ 11%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLCertTest::test_webapp_ssl 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_e2e 
[gw0] [ 11%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_managed_disk 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ppg_msi 
[gw3] [ 11%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_e2e 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux 
[gw3] [ 11%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_version_error 
[gw3] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_version_error 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_appsetting_update 
[gw1] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool 
[gw2] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ahub 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku_msi 
[gw3] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_appsetting_update 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappUpdateTest::test_webapp_update 
[gw0] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ppg_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad_msi 
[gw3] [ 12%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappUpdateTest::test_webapp_update 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_remove_identity 
[gw2] [ 13%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows_msi 
[gw1] [ 13%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_functionapp_access_restriction_commands.py::FunctionAppAccessRestrictionScenarioTest::test_functionapp_access_restriction_add_service_endpoint 
[gw3] [ 13%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_remove_identity 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_with_msi 
[gw0] [ 13%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete_msi 
[gw3] [ 13%] FAILED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_with_msi 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_hybridconnectionE2E 
[gw1] [ 14%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_functionapp_access_restriction_commands.py::FunctionAppAccessRestrictionScenarioTest::test_functionapp_access_restriction_add_service_endpoint 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_service_endpoint 
[gw1] [ 14%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_service_endpoint 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_set_simple 
[gw2] [ 14%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_without_service_principal 
[gw1] [ 14%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_set_simple 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_create_in_different_group 
[gw0] [ 14%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster_msi 
[gw1] [ 14%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_create_in_different_group 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_quick_create_cd 
[gw3] [ 15%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_hybridconnectionE2E 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetDelegation 
[gw3] [ 15%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetDelegation 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetE2E 
[gw0] [ 15%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster_msi 
src/azure-cli/azure/cli/command_modules/appconfig/tests/latest/test_appconfig_commands.py::AppConfigIdentityScenarioTest::test_azconfig_identity 
[gw3] [ 15%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetE2E 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetSameName 
[gw0] [ 15%] PASSED src/azure-cli/azure/cli/command_modules/appconfig/tests/latest/test_appconfig_commands.py::AppConfigIdentityScenarioTest::test_azconfig_identity 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_scm 
[gw2] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_without_service_principal 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool_msi 
[gw0] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add_scm 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_set_complex 
[gw1] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_quick_create_cd 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::BackupWithName::test_backup_with_name 
[gw3] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappNetworkConnectionTests::test_webapp_vnetSameName 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappDeploymentLogsScenarioTest::test_webapp_list_deployment_logs 
[gw0] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_set_complex 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappBasicE2ETest::test_webapp_e2e 
[gw1] [ 16%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::BackupWithName::test_backup_with_name 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_config 
[gw2] [ 17%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool_msi 
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool_msi 
[gw3] [ 17%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappDeploymentLogsScenarioTest::test_webapp_list_deployment_logs 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappDeploymentLogsScenarioTest::test_webapp_show_deployment_logs 
[gw0] [ 17%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappBasicE2ETest::test_webapp_e2e 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_quick_create 
[gw1] [ 17%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_config 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceBadErrorPolishTest::test_appservice_error_polish 
[gw3] [ 17%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappDeploymentLogsScenarioTest::test_webapp_show_deployment_logs 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappLocalContextScenarioTest::test_webapp_local_context 
[gw1] [ 18%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceBadErrorPolishTest::test_appservice_error_polish 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappACRScenarioTest::test_acr_integration 
[gw2] [ 18%] FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool_msi 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add 
[gw1] [ 18%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappACRScenarioTest::test_acr_integration 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappGitScenarioTest::test_webapp_git 
[gw3] [ 18%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappLocalContextScenarioTest::test_webapp_local_context 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappLocalContextScenarioTest::test_functionapp_local_context 
[gw2] [ 18%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_add 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_remove 
[gw0] [ 18%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_linux_webapp_quick_create 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create_runtime 
[gw2] [ 19%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_remove 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_show 
[gw3] [ 19%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappLocalContextScenarioTest::test_functionapp_local_context 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_create 
[gw2] [ 19%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_access_restriction_commands.py::WebAppAccessRestrictionScenarioTest::test_webapp_access_restriction_show 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_create_names_are_substrings 
[gw3] [ 19%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_create 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_delete 
[gw0] [ 19%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create_runtime 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_update_webapp_settings_thru_json 
[gw3] [ 20%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_delete 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list 
[gw1] [ 20%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappGitScenarioTest::test_webapp_git 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceCors::test_webapp_cors 
[gw3] [ 20%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list_credentials 
[gw0] [ 20%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_update_webapp_settings_thru_json 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappScaleTest::test_webapp_scale 
[gw3] [ 20%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list_credentials 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_show 
[gw3] [ 20%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_show 
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_update 
[gw0] [ 21%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappScaleTest::test_webapp_scale 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappMulticontainerSlotScenarioTest::test_linux_webapp_multicontainer_slot 
[gw3] [ 21%] FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_update 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_container 
[gw1] [ 21%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceCors::test_webapp_cors 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLImportCertTest::test_webapp_ssl_import_crossrg 
[gw2] [ 21%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_create_names_are_substrings 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create 
[gw2] [ 21%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappQuickCreateTest::test_win_webapp_quick_create 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceLogTest::test_download_win_web_log 
[gw0] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappMulticontainerSlotScenarioTest::test_linux_webapp_multicontainer_slot 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappACRDeploymentScenarioTest::test_acr_deployment_function_app 
[gw1] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLImportCertTest::test_webapp_ssl_import_crossrg 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_on_linux_app_service_java_with_runtime_version 
[gw1] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_on_linux_app_service_java_with_runtime_version 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_functions_version 
[gw2] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceLogTest::test_download_win_web_log 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_config_appsettings 
[gw0] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappACRDeploymentScenarioTest::test_acr_deployment_function_app 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceCors::test_functionapp_cors 
[gw1] [ 22%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_functions_version 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_elastic_plan 
[gw3] [ 23%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_container 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_disk_exclusion 
[gw1] [ 23%] FAILED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_elastic_plan 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_swap 
[gw2] [ 23%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappConfigureTest::test_webapp_config_appsettings 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappScenarioTest::test_linux_webapp 
[gw0] [ 23%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::AppServiceCors::test_functionapp_cors 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLImportCertTest::test_webapp_ssl_import 
[gw2] [ 23%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::LinuxWebappScenarioTest::test_linux_webapp 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappACRScenarioTest::test_acr_integration_function_app 
[gw1] [ 24%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_swap 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_assign_system_identity 
[gw0] [ 24%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSSLImportCertTest::test_webapp_ssl_import 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_on_linux_app_service_java 
[gw2] [ 24%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionappACRScenarioTest::test_acr_integration_function_app 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotScenarioTest::test_webapp_slot 
[gw0] [ 24%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppWithPlanE2ETest::test_functionapp_on_linux_app_service_java 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_custom_handler 
[gw1] [ 24%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_assign_system_identity 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_linux_free 
[gw0] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_custom_handler 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_app_service_plan 
[gw0] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_app_service_plan 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_creation 
[gw0] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppSlotTests::test_functionapp_slot_creation 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappZipDeployScenarioTest::test_deploy_zip 
[gw1] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_linux_free 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_start_and_stop 
[gw0] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappZipDeployScenarioTest::test_deploy_zip 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappListLocationsFreeSKUTest::test_webapp_list_locations_free_sku 
[gw1] [ 25%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_start_and_stop 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_private_link 
[gw1] [ 26%] SKIPPED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_private_link 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_rule_engine_crud 
[gw0] [ 26%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappListLocationsFreeSKUTest::test_webapp_list_locations_free_sku 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_hyperv_e2e 
[gw0] [ 26%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_hyperv_e2e 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_enable_multiple_write_locations 
[gw2] [ 26%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotScenarioTest::test_webapp_slot 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotSwapScenarioTest::test_webapp_slot_swap 
[gw0] [ 26%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_enable_multiple_write_locations 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_keys_database_account 
[gw1] [ 27%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_rule_engine_crud 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_origin_scenarios.py::CdnOriginScenarioTest::test_origin_crud 
[gw1] [ 27%] SKIPPED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_origin_scenarios.py::CdnOriginScenarioTest::test_origin_crud 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_profile_scenarios.py::CdnProfileScenarioTest::test_cdn_profile_crud 
[gw1] [ 27%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_profile_scenarios.py::CdnProfileScenarioTest::test_cdn_profile_crud 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_profile_scenarios.py::CdnProfileMicrosoftScenarioTest::test_cdn_microsoft_standard_sku 
[gw1] [ 27%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_profile_scenarios.py::CdnProfileMicrosoftScenarioTest::test_cdn_microsoft_standard_sku 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_waf_scenarios.py::CdnWafEndpointLinkScenarioTest::test_cdn_waf_endpoint_link 
[gw2] [ 27%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappSlotSwapScenarioTest::test_webapp_slot_swap 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappUndeleteTest::test_webapp_deleted_list 
[gw2] [ 27%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappUndeleteTest::test_webapp_deleted_list 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionUpdatePlan::test_move_plan_to_elastic 
[gw1] [ 28%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_waf_scenarios.py::CdnWafEndpointLinkScenarioTest::test_cdn_waf_endpoint_link 
src/azure-cli/azure/cli/command_modules/cognitiveservices/tests/latest/test_network_rules.py::CognitiveServicesNetworkRulesTests::test_cognitiveservices_network_rules 
[gw0] [ 28%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_keys_database_account 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_list_database_accounts 
[gw2] [ 28%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionUpdatePlan::test_move_plan_to_elastic 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_version 
[gw1] [ 28%] PASSED src/azure-cli/azure/cli/command_modules/cognitiveservices/tests/latest/test_network_rules.py::CognitiveServicesNetworkRulesTests::test_cognitiveservices_network_rules 
src/azure-cli/azure/cli/command_modules/container/tests/latest/test_container_commands.py::AzureContainerInstanceScenarioTest::test_container_create_with_acr 
[gw1] [ 28%] SKIPPED src/azure-cli/azure/cli/command_modules/container/tests/latest/test_container_commands.py::AzureContainerInstanceScenarioTest::test_container_create_with_acr 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_check_name_exists_database_account 
[gw2] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppOnLinux::test_functionapp_on_linux_version 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlanLinux::test_functionapp_app_service_plan_linux 
[gw2] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlanLinux::test_functionapp_app_service_plan_linux 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappAuthenticationTest::test_webapp_authentication 
[gw2] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappAuthenticationTest::test_webapp_authentication 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_assign_user_identity 
[gw2] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappImplictIdentityTest::test_webapp_assign_user_identity 
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_noAlwaysOn 
[gw0] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_list_database_accounts 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_list_databases 
[gw1] [ 29%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_check_name_exists_database_account 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_keyspace 
[gw2] [ 30%] PASSED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_noAlwaysOn 
src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyUsingHSMNameScenarioTest::test_keyvault_hsm_key_using_hsm_name 
[gw2] [ 30%] SKIPPED src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyUsingHSMNameScenarioTest::test_keyvault_hsm_key_using_hsm_name 
src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyUsingHSMURLScenarioTest::test_keyvault_hsm_key_using_hsm_url 
[gw2] [ 30%] SKIPPED src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyUsingHSMURLScenarioTest::test_keyvault_hsm_key_using_hsm_url 
src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyDownloadScenarioTest::test_keyvault_hsm_key_download 
[gw2] [ 30%] SKIPPED src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMKeyDownloadScenarioTest::test_keyvault_hsm_key_download 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_action 
[gw2] [ 30%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_action 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_condition 
[gw2] [ 31%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_condition 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_scope 
[gw0] [ 31%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_list_databases 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_locations_both_formats_database_accounts 
[gw2] [ 31%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_activity_log_alert_update_scope 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_create_default_activity_log_alert 
[gw2] [ 31%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_create_default_activity_log_alert 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_create_full_fledged_activity_log_alert 
[gw2] [ 31%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_activity_log_alert.py::TestMonitorActivityLogAlert::test_monitor_create_full_fledged_activity_log_alert 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_basic 
[gw2] [ 31%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_basic 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_fixed 
[gw2] [ 32%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_fixed 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_recurring 
[gw2] [ 32%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_recurring 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rule_with_dimensions 
[gw2] [ 32%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rule_with_dimensions 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rules 
[gw2] [ 32%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rules 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleComplexRules::test_monitor_autoscale_rule_for_spring_cloud 
[gw1] [ 32%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_keyspace 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_resource_throughput 
[gw0] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_locations_both_formats_database_accounts 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_locations_database_accounts 
[gw0] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_locations_database_accounts 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_update_database_account 
[gw1] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_resource_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_resource_throughput_autoscale 
[gw0] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_update_database_account 
src/azure-cli/azure/cli/command_modules/deploymentmanager/tests/latest/test_deploymentmanager_scenario.py::DeploymentManagerTests::test_deploymentmanager_scenario 
[gw2] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleComplexRules::test_monitor_autoscale_rule_for_spring_cloud 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_diagnostic_settings.py::TestMonitorDiagnosticSettings::test_monitor_diagnostic_settings_scenario 
[gw2] [ 33%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_diagnostic_settings.py::TestMonitorDiagnosticSettings::test_monitor_diagnostic_settings_scenario 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_general_operations.py::MonitorCloneVMScenarios::test_monitor_clone_vm_metric_alerts_scenario 
[gw0] [ 34%] FAILED src/azure-cli/azure/cli/command_modules/deploymentmanager/tests/latest/test_deploymentmanager_scenario.py::DeploymentManagerTests::test_deploymentmanager_scenario 
src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_cluster_commands.py::EHNamespaceCURDScenarioTest::test_eh_cluster 
[gw0] [ 34%] FAILED src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_cluster_commands.py::EHNamespaceCURDScenarioTest::test_eh_cluster 
src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_namespace_byok_test.py::EHNamespaceBYOKCURDScenarioTest::test_eh_namespace_byok 
[gw0] [ 34%] FAILED src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_namespace_byok_test.py::EHNamespaceBYOKCURDScenarioTest::test_eh_namespace_byok 
src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_network_test.py::EHNetworkCURDScenarioTest::test_eh_network 
[gw1] [ 34%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_resource_throughput_autoscale 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_table 
[gw2] [ 34%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_general_operations.py::MonitorCloneVMScenarios::test_monitor_clone_vm_metric_alerts_scenario 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_general_operations.py::MonitorClonePublicIpScenarios::test_monitor_clone_public_ip_metric_alerts_scenario 
[gw2] [ 35%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_general_operations.py::MonitorClonePublicIpScenarios::test_monitor_clone_public_ip_metric_alerts_scenario 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_cluster.py::TestClusterScenarios::test_monitor_log_analytics_cluster_default 
[gw2] [ 35%] SKIPPED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_cluster.py::TestClusterScenarios::test_monitor_log_analytics_cluster_default 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_data_export 
[gw0] [ 35%] PASSED src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_network_test.py::EHNetworkCURDScenarioTest::test_eh_network 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_application 
[gw1] [ 35%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_cassandra_table 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_collection 
[gw2] [ 35%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_data_export 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_default 
[gw2] [ 35%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_default 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_linked_storage 
[gw1] [ 36%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_collection 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_database 
[gw2] [ 36%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_linked_storage 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_public_access 
[gw1] [ 36%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_database 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_database 
[gw2] [ 36%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_public_access 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_recover 
[gw2] [ 36%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_recover 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_saved_search 
[gw2] [ 37%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_saved_search 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_dynamic_metric_alert_multiple_scopes 
[gw2] [ 37%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_dynamic_metric_alert_multiple_scopes 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_condition_create 
[gw2] [ 37%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_condition_create 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_for_rg_and_sub 
[gw2] [ 37%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_for_rg_and_sub 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_multiple_scopes 
[gw2] [ 37%] FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_multiple_scopes 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_special_char_scenario 
[gw1] [ 37%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_database 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_graph 
[gw0] [ 38%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_application 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_autoscale_operation 
[gw1] [ 38%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_graph 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_resource_throughput 
[gw0] [ 38%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_autoscale_operation 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka 
[gw1] [ 38%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_resource_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_resource_throughput_autoscale 
[gw1] [ 38%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_gremlin_resource_throughput_autoscale 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_key_vault_key_uri 
[gw0] [ 39%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_optional_disk_args 
[gw1] [ 39%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_key_vault_key_uri 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_collection 
[gw2] [ 39%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_special_char_scenario 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_v2_scenario 
[gw2] [ 39%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_v2_scenario 
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_subscription_diagnostic_settings.py::TestDiagnosticSettingsSubscriptionScenarios::test_monitor_diagnostic_settings_subscription 
[gw2] [ 39%] PASSED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_subscription_diagnostic_settings.py::TestDiagnosticSettingsSubscriptionScenarios::test_monitor_diagnostic_settings_subscription 
src/azure-cli/azure/cli/command_modules/netappfiles/tests/latest/test_volume_commands.py::AzureNetAppFilesVolumeServiceScenarioTest::test_create_volume_with_subnet_in_different_rg 
[gw2] [ 39%] FAILED src/azure-cli/azure/cli/command_modules/netappfiles/tests/latest/test_volume_commands.py::AzureNetAppFilesVolumeServiceScenarioTest::test_create_volume_with_subnet_in_different_rg 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkAppGatewayDefaultScenarioTest::test_network_appgw_creation_with_public_and_private_ip 
[gw1] [ 40%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_collection 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_database 
[gw2] [ 40%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkAppGatewayDefaultScenarioTest::test_network_appgw_creation_with_public_and_private_ip 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkRouteFilterScenarioTest::test_network_route_filter 
[gw2] [ 40%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkRouteFilterScenarioTest::test_network_route_filter 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteScenarioTest::test_network_express_route 
[gw2] [ 40%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteScenarioTest::test_network_express_route 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteIPv6PeeringScenarioTest::test_network_express_route_ipv6_peering 
[gw2] [ 40%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteIPv6PeeringScenarioTest::test_network_express_route_ipv6_peering 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_global_reach 
[gw2] [ 41%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_global_reach 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_peer_connection 
[gw2] [ 41%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_peer_connection 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkNicConvenienceCommandsScenarioTest::test_network_nic_convenience_commands 
[gw2] [ 41%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkNicConvenienceCommandsScenarioTest::test_network_nic_convenience_commands 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkVNetPeeringScenarioTest::test_network_vnet_peering 
[gw1] [ 41%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_database 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_resource_throughput 
[gw0] [ 41%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_optional_disk_args 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_rest_proxy 
[gw1] [ 41%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_resource_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_resource_throughput_autoscale 
[gw1] [ 42%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_mongodb_resource_throughput_autoscale 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_add 
[gw1] [ 42%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_add 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_list 
[gw0] [ 42%] PASSED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_rest_proxy 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_min_args 
[gw1] [ 42%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_list 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_remove 
[gw1] [ 42%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_network_rule_remove 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_private_endpoint 
[gw0] [ 43%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_min_args 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_resize 
[gw3] [ 43%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_disk_exclusion 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_item 
[gw3] [ 43%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_item 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_job 
[gw0] [ 43%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_resize 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_rserver 
[gw1] [ 43%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_private_endpoint 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_private_link_resource 
[gw2] [ 43%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkVNetPeeringScenarioTest::test_network_vnet_peering 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_packet_capture 
[gw2] [ 44%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_packet_capture 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_vm 
[gw2] [ 44%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_vm 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkBastionHostScenarioTest::test_network_batsion_host_create 
[gw2] [ 44%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkBastionHostScenarioTest::test_network_batsion_host_create 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_nw_connection_monitor.py::NWConnectionMonitorScenarioTest::test_nw_connection_monitor_v1 
[gw2] [ 44%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_nw_connection_monitor.py::NWConnectionMonitorScenarioTest::test_nw_connection_monitor_v1 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkRDBMSScenarioTest::test_postgres_private_link_scenario 
[gw1] [ 44%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_private_link_resource 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_container 
[gw2] [ 45%] PASSED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkRDBMSScenarioTest::test_postgres_private_link_scenario 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkWebappScenarioTest::test_private_endpoint_connection_webapp 
[gw1] [ 45%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_container 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_container_analytical_ttl 
[gw1] [ 45%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_container_analytical_ttl 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_database 
[gw2] [ 45%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkWebappScenarioTest::test_private_endpoint_connection_webapp 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_default 
[gw2] [ 45%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_default 
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_overwrite_default 
[gw1] [ 45%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_database 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_max_throughput 
[gw2] [ 46%] FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_overwrite_default 
src/azure-cli/azure/cli/command_modules/policyinsights/tests/latest/test_policyinsights_scenario.py::PolicyInsightsTests::test_policy_insights_remediation_management_group 
[gw2] [ 46%] SKIPPED src/azure-cli/azure/cli/command_modules/policyinsights/tests/latest/test_policyinsights_scenario.py::PolicyInsightsTests::test_policy_insights_remediation_management_group 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_DeleteLink_LinkExists_ExpectLinkDeleted 
[gw2] [ 46%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_DeleteLink_LinkExists_ExpectLinkDeleted 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_GetLink_LinkExists_ExpectLinkRetrieved 
[gw1] [ 46%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_max_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_throughput 
[gw2] [ 46%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_GetLink_LinkExists_ExpectLinkRetrieved 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_ListLinks_MultipleLinksPresent_ExpectMultipleLinksRetrieved 
[gw2] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_ListLinks_MultipleLinksPresent_ExpectMultipleLinksRetrieved 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkExistsIfNoneMatchFailure_ExpectError 
[gw1] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_throughput_autoscale 
[gw2] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkExistsIfNoneMatchFailure_ExpectError 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkNotExistsWithRegistration_ExpectLinkCreated 
[gw2] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkNotExistsWithRegistration_ExpectLinkCreated 
src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkNotExistsWithoutRegistration_ExpectLinkCreated 
[gw2] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/privatedns/tests/latest/test_privatedns_commands.py::PrivateDnsLinksTests::test_PutLink_LinkNotExistsWithoutRegistration_ExpectLinkCreated 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_mariadb_server_mgmt 
[gw0] [ 47%] PASSED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_rserver 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_cluster_config 
[gw1] [ 48%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_resource_throughput_autoscale 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_stored_procedure 
[gw1] [ 48%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_stored_procedure 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_trigger 
[gw0] [ 48%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_cluster_config 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_component_version 
[gw1] [ 48%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_trigger 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_user_defined_function 
[gw2] [ 48%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_mariadb_server_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_mysql_server_mgmt 
[gw1] [ 49%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_sql_user_defined_function 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table 
[gw1] [ 49%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table_resource_throughput 
[gw1] [ 49%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table_resource_throughput 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table_resource_throughput_autoscale 
[gw1] [ 49%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_cosmosdb_table_resource_throughput_autoscale 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_create_database_account 
[gw1] [ 49%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_create_database_account 
src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_delete_database_account 
[gw0] [ 50%] PASSED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_component_version 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_at_host 
[gw0] [ 50%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_at_host 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_in_transit 
[gw1] [ 50%] PASSED src/azure-cli/azure/cli/command_modules/cosmosdb/tests/latest/test_cosmosdb_commands.py::CosmosDBTests::test_delete_database_account 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationPostgreSqlMgmtScenarioTest::test_postgrsql_basic_replica_mgmt 
[gw0] [ 50%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_in_transit 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_loadbased_autoscale 
[gw2] [ 50%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_mysql_server_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_postgres_server_mgmt 
[gw1] [ 50%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationPostgreSqlMgmtScenarioTest::test_postgrsql_basic_replica_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationPostgreSqlMgmtScenarioTest::test_postgrsql_general_purpose_replica_mgmt 
[gw3] [ 51%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_job 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_policy 
[gw0] [ 51%] PASSED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_loadbased_autoscale 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_minimal_tls_version 
[gw2] [ 51%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ServerMgmtScenarioTest::test_postgres_server_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_mariadb_proxy_resources_mgmt 
[gw3] [ 51%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_policy 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_protection 
[gw0] [ 51%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_minimal_tls_version 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_relay_and_privatelink 
[gw1] [ 52%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationPostgreSqlMgmtScenarioTest::test_postgrsql_general_purpose_replica_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_flexible_commands.py::FlexibleServerMgmtScenarioTest::test_mysql_flexible_server_mgmt 
[gw0] [ 52%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_relay_and_privatelink 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_schedulebased_autoscale 
[gw2] [ 52%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_mariadb_proxy_resources_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_mysql_proxy_resources_mgmt 
[gw3] [ 52%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_protection 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_restore 
[gw0] [ 52%] PASSED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_schedulebased_autoscale 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_ssh_creds 
[gw0] [ 52%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_ssh_creds 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_monitor 
[gw0] [ 53%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_monitor 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_script_action 
[gw0] [ 53%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_script_action 
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_virtual_machine 
[gw1] [ 53%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_flexible_commands.py::FlexibleServerMgmtScenarioTest::test_mysql_flexible_server_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_flexible_commands.py::FlexibleServerMgmtScenarioTest::test_postgres_flexible_server_mgmt 
[gw0] [ 53%] FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_virtual_machine 
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_central_commands.py::IoTCentralTest::test_iot_central_app 
[gw0] [ 53%] PASSED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_central_commands.py::IoTCentralTest::test_iot_central_app 
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_certificate_commands.py::IotHubCertificateTest::test_certificate_lifecycle 
[gw0] [ 54%] PASSED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_certificate_commands.py::IotHubCertificateTest::test_certificate_lifecycle 
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_identity_hub 
[gw0] [ 54%] FAILED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_identity_hub 
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_iot_hub 
[gw0] [ 54%] PASSED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_iot_hub 
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_dps_commands.py::IoTDpsTest::test_dps_lifecycle 
[gw2] [ 54%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_mysql_proxy_resources_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_postgres_proxy_resources_mgmt 
[gw0] [ 54%] PASSED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_dps_commands.py::IoTDpsTest::test_dps_lifecycle 
src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMSelectiveKeyRestoreScenarioTest::test_keyvault_hsm_selective_key_restore 
[gw0] [ 54%] SKIPPED src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMSelectiveKeyRestoreScenarioTest::test_keyvault_hsm_selective_key_restore 
src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMFullBackupRestoreScenarioTest::test_keyvault_hsm_full_backup_restore 
[gw0] [ 55%] SKIPPED src/azure-cli/azure/cli/command_modules/keyvault/tests/latest/test_keyvault_commands.py::KeyVaultHSMFullBackupRestoreScenarioTest::test_keyvault_hsm_full_backup_restore 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_multi_replica 
[gw1] [ 55%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_flexible_commands.py::FlexibleServerMgmtScenarioTest::test_postgres_flexible_server_mgmt 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_delete_group_managementgroup 
[gw1] [ 55%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_delete_group_managementgroup 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup 
[gw1] [ 55%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_displayname 
[gw1] [ 55%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_displayname 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_displayname_and_parentid 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_displayname_and_parentid 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_parentid 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_create_managementgroup_with_parentid 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_list_managementgroups 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_list_managementgroups 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup_with_expand 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup_with_expand 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup_with_expand_and_recurse 
[gw1] [ 56%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_show_managementgroup_with_expand_and_recurse 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_displayname 
[gw1] [ 57%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_displayname 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_displayname_and_parentid 
[gw1] [ 57%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_displayname_and_parentid 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_parentid 
[gw1] [ 57%] SKIPPED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_managmentgroups.py::AzureManagementGroupsScenarioTest::test_update_managementgroup_with_parentid 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::DeploymentTestAtResourceGroup::test_resource_group_deployment 
[gw1] [ 57%] PASSED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::DeploymentTestAtResourceGroup::test_resource_group_deployment 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::DeploymentTestAtManagementGroup::test_management_group_deployment 
[gw1] [ 57%] FAILED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::DeploymentTestAtManagementGroup::test_management_group_deployment 
src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::PolicyScenarioTest::test_show_built_in_policy 
[gw1] [ 58%] PASSED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::PolicyScenarioTest::test_show_built_in_policy 
src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_e2e 
[gw1] [ 58%] FAILED src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_e2e 
src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_handle_conflicted_assignments 
[gw1] [ 58%] FAILED src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_handle_conflicted_assignments 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_admin_key.py::AzureSearchAdminKeysTests::test_admin_key_show_renew 
[gw0] [ 58%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_multi_replica 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_skus 
[gw0] [ 58%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_skus 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_update 
[gw1] [ 58%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_admin_key.py::AzureSearchAdminKeysTests::test_admin_key_show_renew 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_query_key.py::AzureSearchQueryKeysTests::test_query_key_create_delete_list 
[gw3] [ 59%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_restore 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_rp 
[gw1] [ 59%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_query_key.py::AzureSearchQueryKeysTests::test_query_key_create_delete_list 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_delete_list 
[gw1] [ 59%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_delete_list 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_delete_show 
[gw1] [ 59%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_delete_show 
src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_multi_partition 
[gw2] [ 59%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ProxyResourcesMgmtScenarioTest::test_postgres_proxy_resources_mgmt 
src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationMgmtScenarioTest::test_mysql_replica_mgmt 
[gw1] [ 60%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_create_multi_partition 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMinimalTlsVersionScenarioTest::test_sql_server_minimal_tls_version 
[gw1] [ 60%] PASSED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMinimalTlsVersionScenarioTest::test_sql_server_minimal_tls_version 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlManagedDatabaseLogReplayScenarionTest::test_sql_midb_logreplay_mgmt 
[gw1] [ 60%] FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlManagedDatabaseLogReplayScenarionTest::test_sql_midb_logreplay_mgmt 
src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_create_and_delete 
[gw1] [ 60%] FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_create_and_delete 
src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_mgmt 
[gw1] [ 60%] FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_mgmt 
src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_update_license_and_sku 
[gw1] [ 60%] FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_update_license_and_sku 
src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmAndGroupScenarioTest::test_sqlvm_add_and_remove 
[gw1] [ 61%] FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmAndGroupScenarioTest::test_sqlvm_add_and_remove 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account 
[gw1] [ 61%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_assigned_identity 
[gw1] [ 61%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_assigned_identity 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_double_encryption 
[gw1] [ 61%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_double_encryption 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds 
[gw1] [ 61%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds_false 
[gw1] [ 62%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds_false 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds_true 
[gw1] [ 62%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds_true 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_customer_managed_key 
[gw1] [ 62%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_customer_managed_key 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_management_policy 
[gw1] [ 62%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_management_policy 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_account_service_endpoints 
[gw2] [ 62%] PASSED src/azure-cli/azure/cli/command_modules/rdbms/tests/latest/test_rdbms_commands.py::ReplicationMgmtScenarioTest::test_mysql_replica_mgmt 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns_false 
[gw2] [ 62%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns_false 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns_true 
[gw1] [ 63%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_account_service_endpoints 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_account_with_routing_preference 
[gw2] [ 63%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns_true 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_min_tls 
[gw2] [ 63%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_min_tls 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_public_access 
[gw2] [ 63%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_public_access 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_assigned_identity 
[gw2] [ 63%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_assigned_identity 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds 
[gw1] [ 64%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_account_with_routing_preference 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_default_kind 
[gw2] [ 64%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds_false 
[gw1] [ 64%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_default_kind 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_default_sku 
[gw2] [ 64%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds_false 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds_true 
[gw1] [ 64%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_default_sku 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_encryption_key_type 
[gw1] [ 64%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_encryption_key_type 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns 
[gw2] [ 65%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds_true 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountSkuScenarioTest::test_storage_account_sku 
[gw1] [ 65%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_hns 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_sql_pool_audit_policy 
[gw1] [ 65%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_sql_pool_audit_policy 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_sql_pool_threat_policy 
[gw1] [ 65%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_sql_pool_threat_policy 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_trigger 
[gw1] [ 65%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_trigger 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_defer_only_commands 
[gw2] [ 66%] FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountSkuScenarioTest::test_storage_account_sku 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountLocalContextScenarioTest::test_storage_account_local_context 
[gw1] [ 66%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_defer_only_commands 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_managed_image 
[gw2] [ 66%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountLocalContextScenarioTest::test_storage_account_local_context 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_blob_scenarios.py::StorageBlobUploadTests::test_storage_blob_update_service_properties 
[gw2] [ 66%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_blob_scenarios.py::StorageBlobUploadTests::test_storage_blob_update_service_properties 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_container_legal_hold.py::StorageLegalHold::test_legal_hold 
[gw2] [ 66%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_container_legal_hold.py::StorageLegalHold::test_legal_hold 
src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_encryption_scope_scenarios.py::StorageAccountEncryptionTests::test_storage_account_encryption_scope 
[gw0] [ 66%] PASSED src/azure-cli/azure/cli/command_modules/search/tests/latest/test_service.py::AzureSearchServicesTests::test_service_update 
src/azure-cli/azure/cli/command_modules/security/tests/latest/test_iot_scenario.py::SecurityCenterIotTests::test_security_iot 
[gw2] [ 67%] PASSED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_encryption_scope_scenarios.py::StorageAccountEncryptionTests::test_storage_account_encryption_scope 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_data_flow 
[gw2] [ 67%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_data_flow 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_linked_service 
[gw2] [ 67%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_linked_service 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_notebook 
[gw2] [ 67%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_notebook 
src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_pipeline 
[gw2] [ 67%] SKIPPED src/azure-cli/azure/cli/command_modules/synapse/tests/latest/test_synapse_scenario.py::SynapseScenarioTests::test_pipeline 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMWindowsLicenseTest::test_vm_windows_license_type 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMWindowsLicenseTest::test_vm_windows_license_type 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image_name_conflict 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image_name_conflict 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateFromUnmanagedDiskTest::test_vm_create_from_unmanaged_disk 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateFromUnmanagedDiskTest::test_vm_create_from_unmanaged_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_specialized_unmanaged_disk 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_specialized_unmanaged_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_unmanaged_data_disks 
[gw2] [ 68%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_unmanaged_data_disks 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_os_and_data_disks 
[gw2] [ 69%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_os_and_data_disks 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_unmanaged_os_and_data_disks 
[gw2] [ 69%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_unmanaged_os_and_data_disks 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOSDiskSize::test_vm_set_os_disk_size 
[gw2] [ 69%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOSDiskSize::test_vm_set_os_disk_size 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_disk_max_shares_etc 
[gw1] [ 69%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_managed_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_shared_image 
[gw0] [ 69%] PASSED src/azure-cli/azure/cli/command_modules/security/tests/latest/test_iot_scenario.py::SecurityCenterIotTests::test_security_iot 
src/azure-cli/azure/cli/command_modules/security/tests/latest/test_workspace_settings_scenario.py::SecurityCenterWorkspaceSettingsTests::test_security_workspace_settings 
[gw2] [ 70%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_disk_max_shares_etc 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_disk_upload 
[gw2] [ 70%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_disk_upload 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_managed_disk 
[gw0] [ 70%] PASSED src/azure-cli/azure/cli/command_modules/security/tests/latest/test_workspace_settings_scenario.py::SecurityCenterWorkspaceSettingsTests::test_security_workspace_settings 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_namespace_commands.py::SBNamespaceCRUDScenarioTest::test_sb_namespace 
[gw1] [ 70%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_shared_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_basic 
[gw2] [ 70%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_managed_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateAndStateModificationsScenarioTest::test_vm_create_state_modifications 
[gw0] [ 70%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_namespace_commands.py::SBNamespaceCRUDScenarioTest::test_sb_namespace 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_network_commands.py::SBNetworkrulesetCRUDScenarioTest::test_sb_network 
[gw1] [ 71%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_basic 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_basic_sig 
[gw1] [ 71%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_basic_sig 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_cancel 
[gw1] [ 71%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_cancel 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_customizers 
[gw0] [ 71%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_network_commands.py::SBNetworkrulesetCRUDScenarioTest::test_sb_network 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_queue_commands.py::SBQueueScenarioTest::test_sb_queue 
[gw2] [ 71%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateAndStateModificationsScenarioTest::test_vm_create_state_modifications 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSimulateEvictionScenarioTest::test_vm_simulate_eviction 
[gw0] [ 72%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_queue_commands.py::SBQueueScenarioTest::test_sb_queue 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_rules_commands.py::SBRulesCRUDScenarioTest::test_sb_rules 
[gw1] [ 72%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_builder_customizers 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_template_outputs 
[gw0] [ 72%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_rules_commands.py::SBRulesCRUDScenarioTest::test_sb_rules 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_subscription_commands.py::SBSubscriptionCRUDScenarioTest::test_sb_subscription 
[gw1] [ 72%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_template_outputs 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOpenPortTest::test_vm_open_port 
[gw1] [ 72%] SKIPPED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOpenPortTest::test_vm_open_port 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMShowListSizesListIPAddressesScenarioTest::test_vm_show_list_sizes_list_ip_addresses 
[gw0] [ 72%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_subscription_commands.py::SBSubscriptionCRUDScenarioTest::test_sb_subscription 
src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_topic_commands.py::SBTopicsCRUDScenarioTest::test_sb_topic 
[gw1] [ 73%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMShowListSizesListIPAddressesScenarioTest::test_vm_show_list_sizes_list_ip_addresses 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGeneralizeScenarioTest::test_vm_capture_zone_resilient_image 
[gw0] [ 73%] PASSED src/azure-cli/azure/cli/command_modules/servicebus/tests/latest/test_servicebus_topic_commands.py::SBTopicsCRUDScenarioTest::test_sb_topic 
src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_application.py::ServiceFabricApplicationTests::test_application 
[gw0] [ 73%] FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_application.py::ServiceFabricApplicationTests::test_application 
src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_basic_cluster 
[gw1] [ 73%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGeneralizeScenarioTest::test_vm_capture_zone_resilient_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGeneralizeScenarioTest::test_vm_generalize 
[gw1] [ 73%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGeneralizeScenarioTest::test_vm_generalize 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateNoneOptionsTest::test_vm_create_none_options 
[gw1] [ 74%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateNoneOptionsTest::test_vm_create_none_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestDefault::test_vm_create_with_monitor 
[gw0] [ 74%] FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_basic_cluster 
src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_cert_and_ext 
[gw1] [ 74%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestDefault::test_vm_create_with_monitor 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestDefault::test_vm_metric_tail 
[gw2] [ 74%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSimulateEvictionScenarioTest::test_vm_simulate_eviction 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMNoWaitScenarioTest::test_vm_create_no_wait 
[gw2] [ 74%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMNoWaitScenarioTest::test_vm_create_no_wait 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAvailSetScenarioTest::test_vm_availset 
[gw1] [ 75%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestDefault::test_vm_metric_tail 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestCreateLinux::test_vm_create_with_workspace_linux 
[gw2] [ 75%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAvailSetScenarioTest::test_vm_availset 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAvailSetLiveScenarioTest::test_vm_availset_convert 
[gw0] [ 75%] FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_cert_and_ext 
src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_node_type_operation 
[gw2] [ 75%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAvailSetLiveScenarioTest::test_vm_availset_convert 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension 
[gw2] [ 75%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_instance_name 
[gw2] [ 75%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_instance_name 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_with_id 
[gw2] [ 76%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_with_id 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateUbuntuScenarioTest::test_vm_create_ubuntu 
[gw2] [ 76%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateUbuntuScenarioTest::test_vm_create_ubuntu 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateEphemeralOsDisk::test_vm_create_ephemeral_os_disk 
[gw2] [ 76%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateEphemeralOsDisk::test_vm_create_ephemeral_os_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMultiNicScenarioTest::test_vm_create_multi_nics 
[gw1] [ 76%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestCreateLinux::test_vm_create_with_workspace_linux 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestCreateWindows::test_vm_create_with_workspace_windows 
[gw2] [ 76%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMultiNicScenarioTest::test_vm_create_multi_nics 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension_instance_name 
[gw2] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension_instance_name 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiagnosticsExtensionInstallTest::test_diagnostics_extension_install 
[gw0] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_node_type_operation 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_mgmt 
[gw2] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiagnosticsExtensionInstallTest::test_diagnostics_extension_install 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_auth 
[gw2] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_auth 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_existing_options 
[gw2] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_existing_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_provision_vm_agent 
[gw2] [ 77%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_provision_vm_agent 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingIdsOptions::test_vm_create_existing_ids_options 
[gw1] [ 78%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestCreateWindows::test_vm_create_with_workspace_windows 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestUpdateLinux::test_vm_update_with_workspace_linux 
[gw2] [ 78%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingIdsOptions::test_vm_create_existing_ids_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomIP::test_vm_create_custom_ip 
[gw2] [ 78%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomIP::test_vm_create_custom_ip 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_attach_detach 
[gw2] [ 78%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_attach_detach 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_create_with_standard_zrs_sku 
[gw2] [ 78%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_create_with_standard_zrs_sku 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_storage_sku 
[gw0] [ 79%] PASSED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_mgmt 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_public_network_access_create_mgmt 
[gw2] [ 79%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_storage_sku 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_ultra_ssd_disk_update 
[gw1] [ 79%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMonitorTestUpdateLinux::test_vm_update_with_workspace_linux 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMBootDiagnostics::test_vm_boot_diagnostics 
[gw2] [ 79%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_ultra_ssd_disk_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_ultra_ssd_storage_sku 
[gw0] [ 79%] PASSED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_public_network_access_create_mgmt 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_public_network_access_update_mgmt 
[gw1] [ 79%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMBootDiagnostics::test_vm_boot_diagnostics 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension 
[gw1] [ 80%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_scale_in_policy 
[gw1] [ 80%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_scale_in_policy 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_auth 
[gw1] [ 80%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_auth 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_ephemeral_os_disk 
[gw0] [ 80%] FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_public_network_access_update_mgmt 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerDbSecurityScenarioTest::test_sql_db_security_mgmt 
[gw1] [ 80%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_ephemeral_os_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_options 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_update_instance_disks 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_update_instance_disks 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_default_app_gateway 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_default_app_gateway 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_none_options 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_none_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_with_app_gateway 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_with_app_gateway 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_existing_lb 
[gw1] [ 81%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_existing_lb 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_single_placement_group_default_to_std_lb 
[gw1] [ 82%] SKIPPED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_single_placement_group_default_to_std_lb 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreatePublicIpPerVm::test_vmss_public_ip_per_vm_custom_domain_name 
[gw1] [ 82%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreatePublicIpPerVm::test_vmss_public_ip_per_vm_custom_domain_name 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update 
[gw1] [ 82%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update_image 
[gw1] [ 82%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vm_accelerated_networking 
[gw1] [ 82%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vm_accelerated_networking 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vmss_accelerated_networking 
[gw1] [ 83%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vmss_accelerated_networking 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ApplicationSecurityGroup::test_vmss_asg 
[gw1] [ 83%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ApplicationSecurityGroup::test_vmss_asg 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_linux_secrets 
[gw1] [ 83%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_linux_secrets 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_windows_secrets 
[gw0] [ 83%] FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerDbSecurityScenarioTest::test_sql_db_security_mgmt 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerSecurityScenarioTest::test_sql_server_security_mgmt 
[gw2] [ 83%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_ultra_ssd_storage_sku 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_vmss_update_ultra_ssd_enabled 
[gw1] [ 83%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_windows_secrets 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateLinuxSecretsScenarioTest::test_vmss_create_linux_secrets 
[gw1] [ 84%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateLinuxSecretsScenarioTest::test_vmss_create_linux_secrets 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingOptions::test_vmss_create_existing_options 
[gw1] [ 84%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingOptions::test_vmss_create_existing_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingIdsOptions::test_vmss_create_existing_ids_options 
[gw1] [ 84%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingIdsOptions::test_vmss_create_existing_ids_options 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSVMsScenarioTest::test_vmss_vms 
[gw1] [ 84%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSVMsScenarioTest::test_vmss_vms 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSimulateEvictionScenarioTest::test_vmss_simulate_eviction 
[gw0] [ 84%] FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerSecurityScenarioTest::test_sql_server_security_mgmt 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlTransparentDataEncryptionScenarioTest::test_sql_tdebyok 
[gw2] [ 85%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_vmss_update_ultra_ssd_enabled 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vmss_ultra_ssd_storage_sku 
[gw0] [ 85%] PASSED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlTransparentDataEncryptionScenarioTest::test_sql_tdebyok 
src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerVnetMgmtScenarioTest::test_sql_vnet_mgmt 
[gw2] [ 85%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vmss_ultra_ssd_storage_sku 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMUnmanagedDataDiskTest::test_vm_data_unmanaged_disk 
[gw2] [ 85%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMUnmanagedDataDiskTest::test_vm_data_unmanaged_disk 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomDataScenarioTest::test_vm_create_custom_data 
[gw2] [ 85%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomDataScenarioTest::test_vm_create_custom_data 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_create_and_modify 
[gw2] [ 85%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_create_and_modify 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi 
[gw2] [ 86%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi_no_scope 
[gw2] [ 86%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi_no_scope 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_explicit_msi 
[gw0] [ 86%] PASSED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerVnetMgmtScenarioTest::test_sql_vnet_mgmt 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSNicScenarioTest::test_vmss_nics 
[gw2] [ 86%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_explicit_msi 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_msi 
[gw0] [ 86%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSNicScenarioTest::test_vmss_nics 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateIdempotentTest::test_vmss_create_idempotent 
[gw2] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_msi 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_create_zones 
[gw0] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateIdempotentTest::test_vmss_create_idempotent 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSILBTest::test_vmss_with_ilb 
[gw0] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSILBTest::test_vmss_with_ilb 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_explicit_msi 
[gw0] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_explicit_msi 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMRunCommandScenarioTest::test_vm_run_command_with_parameters 
[gw0] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMRunCommandScenarioTest::test_vm_run_command_with_parameters 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSRunCommandScenarioTest::test_vmss_run_command_with_parameters 
[gw0] [ 87%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSRunCommandScenarioTest::test_vmss_run_command_with_parameters 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_disk_encryption_e2e 
[gw0] [ 88%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_disk_encryption_e2e 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_encryption_at_host 
[gw0] [ 88%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_encryption_at_host 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vmss_disk_encryption_e2e 
[gw2] [ 88%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_create_zones 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_disk_create_zones 
[gw2] [ 88%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_disk_create_zones 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_error_on_zone_unavailable 
[gw2] [ 88%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMZoneScenarioTest::test_vm_error_on_zone_unavailable 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOsDiskSwap::test_vm_os_disk_swap 
[gw2] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOsDiskSwap::test_vm_os_disk_swap 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGenericUpdate::test_vm_generic_update 
[gw2] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGenericUpdate::test_vm_generic_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_e2e 
[gw0] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vmss_disk_encryption_e2e 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithExistingNic::test_vm_create_existing_nic 
[gw0] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithExistingNic::test_vm_create_existing_nic 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSecretTest::test_vm_secret_e2e_test 
[gw1] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSimulateEvictionScenarioTest::test_vmss_simulate_eviction 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCustomDataScenarioTest::test_vmss_create_custom_data 
[gw1] [ 89%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCustomDataScenarioTest::test_vmss_create_custom_data 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_update 
[gw1] [ 90%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_with_related_resources 
[gw1] [ 90%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_with_related_resources 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_proximity_placement_group 
[gw1] [ 90%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_proximity_placement_group 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DedicatedHostScenarioTest::test_dedicated_host_e2e 
[gw0] [ 90%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSecretTest::test_vm_secret_e2e_test 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_specialized_image 
[gw0] [ 90%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_specialized_image 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMPriorityEvictionBillingTest::test_vm_priority_eviction_billing 
[gw0] [ 91%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMPriorityEvictionBillingTest::test_vm_priority_eviction_billing 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateSpecialName::test_vm_create_special_name 
[gw0] [ 91%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateSpecialName::test_vm_create_special_name 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set 
[gw0] [ 91%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_disk_update 
[gw0] [ 91%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_disk_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_snapshot 
[gw1] [ 91%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DedicatedHostScenarioTest::test_dedicated_host_e2e 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSTerminateNotificationScenarioTest::test_vmss_terminate_notification 
[gw1] [ 91%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSTerminateNotificationScenarioTest::test_vmss_terminate_notification 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskAccessTest::test_disk_access 
[gw1] [ 92%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskAccessTest::test_disk_access 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateDiskOptionTest::test_vmss_create_disk_iops_mbps 
[gw0] [ 92%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_snapshot 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_update 
[gw1] [ 92%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateDiskOptionTest::test_vmss_create_disk_iops_mbps 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateAutoCreateSubnetScenarioTest::test_vm_create_auto_create_subnet 
[gw0] [ 92%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_create_automatic_repairs_with_health_probe 
[gw1] [ 92%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateAutoCreateSubnetScenarioTest::test_vm_create_auto_create_subnet 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_extension 
[gw1] [ 93%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_extension 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateNSGRule::test_vm_create_nsg_rule 
[gw1] [ 93%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateNSGRule::test_vm_create_nsg_rule 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSetOrchestrationServiceStateScenarioTest::test_vmss_set_orchestration_service_state 
[gw0] [ 93%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_create_automatic_repairs_with_health_probe 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_probe 
[gw0] [ 93%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_probe 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoUpdateScenarioTest::test_vm_auto_update 
[gw0] [ 93%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoUpdateScenarioTest::test_vm_auto_update 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskLogicalSectorSize::test_vm_disk_logical_sector_size 
[gw0] [ 93%] PASSED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskLogicalSectorSize::test_vm_disk_logical_sector_size 
[gw1] [ 94%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSetOrchestrationServiceStateScenarioTest::test_vmss_set_orchestration_service_state 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoShutdownScenarioTest::test_vm_auto_shutdown 
[gw1] [ 94%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoShutdownScenarioTest::test_vm_auto_shutdown 
[gw3] [ 94%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_rp 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_scenario 
[gw2] [ 94%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_e2e 
src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_specialized 
[gw2] [ 94%] FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_specialized 
[gw3] [ 95%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_scenario 
src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_softdelete 
[gw3] [ 95%] PASSED src/azure-cli/azure/cli/command_modules/backup/tests/latest/test_backup_commands.py::BackupTests::test_backup_softdelete 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_auto_scale_scenario 
[gw3] [ 95%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_auto_scale_scenario 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_auto_storage 
[gw3] [ 95%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_auto_storage 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_file_systems 
[gw3] [ 95%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_file_systems 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_setup_command 
[gw3] [ 95%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_setup_command 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_config_less_cluster_with_file_systems 
[gw3] [ 96%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_config_less_cluster_with_file_systems 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_job_level_mounting_scenario 
[gw3] [ 96%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_job_level_mounting_scenario 
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_manual_scale_scenario 
[gw3] [ 96%] FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_manual_scale_scenario 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_csharp_echo_webapp_bot 
[gw3] [ 96%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_csharp_echo_webapp_bot 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_js_echo_webapp_bot 
[gw3] [ 96%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_js_echo_webapp_bot 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_js_empty_webapp_for_webapp_bot 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_create_v4_js_empty_webapp_for_webapp_bot 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_download_should_create_appsettings_for_v4_csharp_webapp_echo_bots_no_bot_file 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_download_should_create_appsettings_for_v4_csharp_webapp_echo_bots_no_bot_file 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_download_should_create_env_file_for_v4_node_webapp_echo_bots_no_bot_file 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_download_should_create_env_file_for_v4_node_webapp_echo_bots_no_bot_file 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_keep_node_modules_should_not_empty_node_modules_or_install_dependencies 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_keep_node_modules_should_not_empty_node_modules_or_install_dependencies 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_publish_remove_node_iis_files_if_not_already_local 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_publish_remove_node_iis_files_if_not_already_local 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_show_on_v4_csharp_webapp_bot 
[gw3] [ 97%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_show_on_v4_csharp_webapp_bot 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_show_on_v4_js_webapp_bot 
[gw3] [ 98%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_botservice_show_on_v4_js_webapp_bot 
src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_create_v4_webapp_bot_should_succeed_with_ending_hyphen 
[gw3] [ 98%] PASSED src/azure-cli/azure/cli/command_modules/botservice/tests/latest/test_bot_commands.py::BotTests::test_create_v4_webapp_bot_should_succeed_with_ending_hyphen 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_byoc_latest 
[gw3] [ 98%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_byoc_latest 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_crud 
[gw3] [ 98%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_crud 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_errors 
[gw3] [ 98%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_errors 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_akamai 
[gw3] [ 99%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_akamai 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_msft 
[gw3] [ 99%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_msft 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_verizon 
[gw3] [ 99%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_custom_domain_scenarios.py::CdnCustomDomainScenarioTest::test_cdn_custom_domain_https_verizon 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_crud 
[gw3] [ 99%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_crud 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_different_profiles 
[gw3] [ 99%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_different_profiles 
src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_load_and_purge 
[gw3] [100%] PASSED src/azure-cli/azure/cli/command_modules/cdn/tests/latest/test_endpoint_scenarios.py::CdnEndpointScenarioTest::test_endpoint_load_and_purge 

================================== FAILURES ===================================
_ AzureKubernetesServiceScenarioTest.test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi _
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F11BCB8E0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F11A3CDF0>
command = 'aks update -g clitestzkwy6adrxt -n cliakstestgdwock --load-balancer-managed-outbound-ip-count 2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F11A3CDF0>
args = ['aks', 'update', '-g', 'clitestzkwy6adrxt', '-n', 'cliakstestgdwock', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F11BC0DC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F11A3CDF0>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi>
resource_group = 'clitestzkwy6adrxt', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --no-wait'
    
        self.cmd(create_cmd, checks=[self.is_empty()])
    
        # wait
        self.cmd('aks wait -g {resource_group} -n {name} --created', checks=[self.is_empty()])
    
        # list
        self.cmd('aks list -g {resource_group}', checks=[
            self.check('[0].type', '{resource_type}'),
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # list in tabular format
        self.cmd('aks list -g {resource_group} -o table', checks=[
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # show
        self.cmd('aks show -g {resource_group} -n {name}', checks=[
            self.check('type', '{resource_type}'),
            self.check('name', '{name}'),
            self.exists('nodeResourceGroup'),
            self.check('resourceGroup', '{resource_group}'),
            self.check('agentPoolProfiles[0].count', 1),
            self.check('agentPoolProfiles[0].osType', 'Linux'),
            self.check('agentPoolProfiles[0].vmSize', 'Standard_DS2_v2'),
            self.check('agentPoolProfiles[0].type', 'VirtualMachineScaleSets'),
            self.check('dnsPrefix', '{dns_name_prefix}'),
            self.exists('kubernetesVersion'),
            self.check('networkProfile.loadBalancerSku', 'Standard'),
            self.check('networkProfile.loadBalancerProfile.managedOutboundIps.count', 1),
            self.exists('networkProfile.loadBalancerProfile.effectiveOutboundIps')
        ])
    
        # get-credentials
        fd, temp_path = tempfile.mkstemp()
        self.kwargs.update({'file': temp_path})
        try:
            self.cmd('aks get-credentials -g {resource_group} -n {name} --file "{file}"')
            self.assertGreater(os.path.getsize(temp_path), 0)
        finally:
            os.close(fd)
            os.remove(temp_path)
    
        # update managed outbound IP
>       self.cmd('aks update -g {resource_group} -n {name} --load-balancer-managed-outbound-ip-count 2', checks=[
            self.check('networkProfile.loadBalancerProfile.managedOutboundIps.count', 2),
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3109: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1504: in aks_update
    return _put_managed_cluster_ensuring_permission(cmd,
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000020F11CBBFD0>
resource_group_name = 'clitestzkwy6adrxt', resource_name = 'cliakstestgdwock'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000020F11CC5BE0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestzkwy6adrxt/providers/Microsoft.ContainerService/managedClusters/cliakstestgdwock'
path_format_arguments = {'resourceGroupName': 'clitestzkwy6adrxt', 'resourceName': 'cliakstestgdwock', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {'KubeDashboard': {'enabled': False}}, 'agentPoolProfiles': [{...tem', ...}], 'autoUpgradeProfile': {}, 'dnsPrefix': 'cliaksdnsn5nfnty', ...}, 'sku': {'name': 'Basic', 'tier': 'Free'}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestzkwy6adrxt/providers/Microsoft.ContainerService/managedClusters/cliakstestgdwock?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stdout call -----------------------------
Merged "cliakstestgdwock" as current context in C:\Users\daetienn\AppData\Local\Temp\tmpgy072awp
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestzkwy6adrxt --tag product=azurecli cause=automation date=2020-12-18T05:43:21Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks create --resource-group=clitestzkwy6adrxt --name=cliakstestgdwock --location=westus2 --dns-name-prefix=cliaksdnsn5nfnty --node-count=1 --ssh-key-value=C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmpo0kcg932 --load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --no-wait" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks wait -g clitestzkwy6adrxt -n cliakstestgdwock --created" => 0. 

Command "aks list -g clitestzkwy6adrxt" => 0. 

Command "aks list -g clitestzkwy6adrxt -o table" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks show -g clitestzkwy6adrxt -n cliakstestgdwock" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks get-credentials -g clitestzkwy6adrxt -n cliakstestgdwock --file "C:\Users\daetienn\AppData\Local\Temp\tmpgy072awp"" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestzkwy6adrxt --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_create_aadv1_and_update_with_managed_aad_msi _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C717B6850>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C71905100>
command = 'aks create --resource-group=clitesthtd3mxabz3 --name=cliakstesttx4ck3 --vm-set-type VirtualMachineScaleSets --node-co... --aad-client-app-id 00000000-0000-0000-0000-000000000002 --aad-tenant-id d5b55040-0c14-48cc-a028-91457fc190d9 -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71905100>
args = ['aks', 'create', '--resource-group=clitesthtd3mxabz3', '--name=cliakstesttx4ck3', '--vm-set-type', 'VirtualMachineScaleSets', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C718FD820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71905100>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_aadv1_and_update_with_managed_aad_msi>
resource_group = 'clitesthtd3mxabz3', resource_group_location = 'eastus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='eastus2')
    def test_aks_create_aadv1_and_update_with_managed_aad_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--aad-server-app-id 00000000-0000-0000-0000-000000000001 ' \
                     '--aad-server-app-secret fake-secret ' \
                     '--aad-client-app-id 00000000-0000-0000-0000-000000000002 ' \
                     '--aad-tenant-id d5b55040-0c14-48cc-a028-91457fc190d9 ' \
                     '-o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('aadProfile.managed', None),
            self.check('aadProfile.serverAppId', '00000000-0000-0000-0000-000000000001'),
            self.check('aadProfile.clientAppId', '00000000-0000-0000-0000-000000000002'),
            self.check('aadProfile.tenantId', 'd5b55040-0c14-48cc-a028-91457fc190d9')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3759: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000019C71551220>
resource_group_name = 'clitesthtd3mxabz3', resource_name = 'cliakstesttx4ck3'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000019C712A86A0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitesthtd3mxabz3/providers/Microsoft.ContainerService/managedClusters/cliakstesttx4ck3'
path_format_arguments = {'resourceGroupName': 'clitesthtd3mxabz3', 'resourceName': 'cliakstesttx4ck3', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus2', 'properties': {'aadProfile': {'clientAppID': '00000000-0000-0000-0000-000000000002', 'serverAp...ublicIP': False, 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliakstest-clitesthtd3mxabz-a1bfa6', ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitesthtd3mxabz3/providers/Microsoft.ContainerService/managedClusters/cliakstesttx4ck3?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name clitesthtd3mxabz3 --tag product=azurecli cause=automation date=2020-12-18T05:43:33Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitesthtd3mxabz3 --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_create_slb_vmss_with_outbound_ip_then_update_msi _
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F0F7F6250>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1008D1C0>
command = 'aks create --resource-group=clitestfzc257lwcq --name=cliakstestrnbvfc --location=westus2 --dns-name-prefix=cliaksdnsn...42f1-86b5-848c674fc321/resourceGroups/clitestfzc257lwcq/providers/Microsoft.Network/publicIPAddresses/cliaksslbip1f3eu'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1008D1C0>
args = ['aks', 'create', '--resource-group=clitestfzc257lwcq', '--name=cliakstestrnbvfc', '--location=westus2', '--dns-name-prefix=cliaksdnsnzh2sqs', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F0FB1F790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1008D1C0>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_slb_vmss_with_outbound_ip_then_update_msi>
resource_group = 'clitestfzc257lwcq', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_slb_vmss_with_outbound_ip_then_update_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        ip1_name = self.create_random_name('cliaksslbip1', 16)
        ip2_name = self.create_random_name('cliaksslbip2', 16)
    
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'ip1_name': ip1_name,
            'ip2_name': ip2_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create public ip address
        ip1_id = self.cmd('az network public-ip create -g {rg} -n {ip1_name} --location {location} --sku Standard '). \
            get_output_in_json().get("publicIp").get("id")
        ip2_id = self.cmd('az network public-ip create -g {rg} -n {ip2_name} --location {location} --sku Standard '). \
            get_output_in_json().get("publicIp").get("id")
    
        self.kwargs.update({
            'ip1_id': ip1_id,
            'ip2_id': ip2_id
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --load-balancer-outbound-ips {ip1_id}'
    
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3168: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000020F0F7B20D0>
resource_group_name = 'clitestfzc257lwcq', resource_name = 'cliakstestrnbvfc'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000020F0F80C520>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestfzc257lwcq/providers/Microsoft.ContainerService/managedClusters/cliakstestrnbvfc'
path_format_arguments = {'resourceGroupName': 'clitestfzc257lwcq', 'resourceName': 'cliakstestrnbvfc', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliaksdnsnzh2sqs', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestfzc257lwcq/providers/Microsoft.ContainerService/managedClusters/cliakstestrnbvfc?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestfzc257lwcq --tag product=azurecli cause=automation date=2020-12-18T05:46:11Z" => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "az network public-ip create -g clitestfzc257lwcq -n cliaksslbip1f3eu --location westus2 --sku Standard " => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "az network public-ip create -g clitestfzc257lwcq -n cliaksslbip26vfb --location westus2 --sku Standard " => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestfzc257lwcq --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C70F7F3D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C71D8CCD0>
command = 'aks create --resource-group=clitestmc3vepkvp2 --name=cliakstesth4i5wz --location=westus2 --dns-name-prefix=cliaksdnsc...oad-balancer-sku=standard --vm-set-type=virtualmachinescalesets --api-server-authorized-ip-ranges=1.2.3.4/32 --no-wait'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71D8CCD0>
args = ['aks', 'create', '--resource-group=clitestmc3vepkvp2', '--name=cliakstesth4i5wz', '--location=westus2', '--dns-name-prefix=cliaksdnscbg7mpy', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C70E84A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71D8CCD0>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi>
resource_group = 'clitestmc3vepkvp2', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets ' \
                     '--api-server-authorized-ip-ranges=1.2.3.4/32 --no-wait'
    
>       self.cmd(create_cmd, checks=[self.is_empty()])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2977: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000019C70B8EAF0>
resource_group_name = 'clitestmc3vepkvp2', resource_name = 'cliakstesth4i5wz'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000019C70C683A0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestmc3vepkvp2/providers/Microsoft.ContainerService/managedClusters/cliakstesth4i5wz'
path_format_arguments = {'resourceGroupName': 'clitestmc3vepkvp2', 'resourceName': 'cliakstesth4i5wz', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F...pool1', ...}], 'apiServerAccessProfile': {'authorizedIPRanges': ['1.2.3.4/32']}, 'dnsPrefix': 'cliaksdnscbg7mpy', ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestmc3vepkvp2/providers/Microsoft.ContainerService/managedClusters/cliakstesth4i5wz?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestmc3vepkvp2 --tag product=azurecli cause=automation date=2020-12-18T05:46:39Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestmc3vepkvp2 --yes --no-wait" => 0. 

___ AzureKubernetesServiceScenarioTest.test_aks_create_with_ephemeral_disk ____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F10D80910>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1243B310>
command = 'aks create --resource-group=clitestj4gplva5gh --name=cliakstestanqynp --generate-ssh-keys --vm-set-type VirtualMachineScaleSets -c 1 --node-osdisk-type=Ephemeral --node-osdisk-size 60'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1243B310>
args = ['aks', 'create', '--resource-group=clitestj4gplva5gh', '--name=cliakstestanqynp', '--generate-ssh-keys', '--vm-set-type', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F0F4448B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1243B310>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_with_ephemeral_disk>
resource_group = 'clitestj4gplva5gh', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_with_ephemeral_disk(self, resource_group, resource_group_location):
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--generate-ssh-keys ' \
                     '--vm-set-type VirtualMachineScaleSets -c 1 ' \
                     '--node-osdisk-type=Ephemeral --node-osdisk-size 60'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('agentPoolProfiles[0].osDiskType', 'Ephemeral'),
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2106: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000020F11F4D460>
resource_group_name = 'clitestj4gplva5gh', resource_name = 'cliakstestanqynp'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000020F11A36190>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestj4gplva5gh/providers/Microsoft.ContainerService/managedClusters/cliakstestanqynp'
path_format_arguments = {'resourceGroupName': 'clitestj4gplva5gh', 'resourceName': 'cliakstestanqynp', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliakstest-clitestj4gplva5g-a1bfa6', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestj4gplva5gh/providers/Microsoft.ContainerService/managedClusters/cliakstestanqynp?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestj4gplva5gh --tag product=azurecli cause=automation date=2020-12-18T05:49:39Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestj4gplva5gh --yes --no-wait" => 0. 

___ AzureKubernetesServiceScenarioTest.test_aks_create_default_setting_msi ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C70F0BF40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C70E48C10>
command = 'aks create --resource-group=clitestnuwa7vfzkb --name=cliakstestpga7n3 --location=westus2 --dns-name-prefix=cliaksdnsn4u4vmw --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmpgg2k1jgm --no-wait'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C70E48C10>
args = ['aks', 'create', '--resource-group=clitestnuwa7vfzkb', '--name=cliakstestpga7n3', '--location=westus2', '--dns-name-prefix=cliaksdnsn4u4vmw', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C71121550>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C70E48C10>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestifx2h4w72q...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_default_setting_msi>
resource_group = 'clitestnuwa7vfzkb', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_default_setting_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--no-wait'
    
>       self.cmd(create_cmd, checks=[self.is_empty()])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2811: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000019C7182CF10>
resource_group_name = 'clitestnuwa7vfzkb', resource_name = 'cliakstestpga7n3'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000019C71AC64C0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestnuwa7vfzkb/providers/Microsoft.ContainerService/managedClusters/cliakstestpga7n3'
path_format_arguments = {'resourceGroupName': 'clitestnuwa7vfzkb', 'resourceName': 'cliakstestpga7n3', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliaksdnsn4u4vmw', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestnuwa7vfzkb/providers/Microsoft.ContainerService/managedClusters/cliakstestpga7n3?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestnuwa7vfzkb --tag product=azurecli cause=automation date=2020-12-18T05:49:56Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestnuwa7vfzkb --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_create_private_cluster_then_update_msi _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71D773D0>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Private cluster cannot be enabled with AuthorizedIPRanges.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Private cluster cannot be enabled with AuthorizedIPRanges.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_private_cluster_then_update_msi>
resource_group = 'clitestthmfe2wabt', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_private_cluster_then_update_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets ' \
                     '--enable-private-cluster --no-wait'
    
        self.cmd(create_cmd, checks=[self.is_empty()])
    
        # wait
        self.cmd('aks wait -g {resource_group} -n {name} --created', checks=[self.is_empty()])
    
        # list
        self.cmd('aks list -g {resource_group}', checks=[
            self.check('[0].type', '{resource_type}'),
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # list in tabular format
        self.cmd('aks list -g {resource_group} -o table', checks=[
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # show
        self.cmd('aks show -g {resource_group} -n {name}', checks=[
            self.check('type', '{resource_type}'),
            self.check('name', '{name}'),
            self.exists('nodeResourceGroup'),
            self.check('resourceGroup', '{resource_group}'),
            self.check('agentPoolProfiles[0].count', 1),
            self.check('agentPoolProfiles[0].osType', 'Linux'),
            self.check('agentPoolProfiles[0].vmSize', 'Standard_DS2_v2'),
            self.check('agentPoolProfiles[0].type', 'VirtualMachineScaleSets'),
            self.check('dnsPrefix', '{dns_name_prefix}'),
            self.exists('kubernetesVersion'),
            self.check('networkProfile.loadBalancerSku', 'Standard'),
            self.check('apiServerAccessProfile.enablePrivateCluster', True),
            self.check('networkProfile.loadBalancerProfile.managedOutboundIps.count', 1),
            self.exists('networkProfile.loadBalancerProfile.effectiveOutboundIps')
        ])
    
        # get-credentials
        fd, temp_path = tempfile.mkstemp()
        self.kwargs.update({'file': temp_path})
        try:
            self.cmd('aks get-credentials -g {resource_group} -n {name} --file "{file}"')
            self.assertGreater(os.path.getsize(temp_path), 0)
        finally:
            os.close(fd)
            os.remove(temp_path)
    
        # update api-server-authorized-ip-ranges is not supported
        with self.assertRaises(CLIError) as err:
>           self.cmd('aks update -g {resource_group} -n {name} --api-server-authorized-ip-ranges=1.2.3.4/32')

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2940: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1504: in aks_update
    return _put_managed_cluster_ensuring_permission(cmd,
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestthmfe2wabt/providers/Microsoft.ContainerService/managedClusters/cliakstestkjvklx?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stdout call -----------------------------
Merged "cliakstestkjvklx" as current context in C:\Users\daetienn\AppData\Local\Temp\tmpoc73syzm
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestthmfe2wabt --tag product=azurecli cause=automation date=2020-12-18T05:53:06Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks create --resource-group=clitestthmfe2wabt --name=cliakstestkjvklx --location=westus2 --dns-name-prefix=cliaksdnsncybe4j --node-count=1 --ssh-key-value=C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmpoxrqnf3m --load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --enable-private-cluster --no-wait" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks wait -g clitestthmfe2wabt -n cliakstestkjvklx --created" => 0. 

Command "aks list -g clitestthmfe2wabt" => 0. 

Command "aks list -g clitestthmfe2wabt -o table" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks show -g clitestthmfe2wabt -n cliakstestkjvklx" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks get-credentials -g clitestthmfe2wabt -n cliakstestkjvklx --file "C:\Users\daetienn\AppData\Local\Temp\tmpoc73syzm"" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestthmfe2wabt --yes --no-wait" => 0. 

___________ AzureKubernetesServiceScenarioTest.test_aks_managed_aad ___________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F125D2C40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F0FDCF160>
command = 'aks update --resource-group=clitestbup4jzybj2 --name=cliakstestjpwv66 --aad-admin-group-object-ids 00000000-0000-0000-0000-000000000002 --aad-tenant-id 00000000-0000-0000-0000-000000000003 -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F0FDCF160>
args = ['aks', 'update', '--resource-group=clitestbup4jzybj2', '--name=cliakstestjpwv66', '--aad-admin-group-object-ids', '00000000-0000-0000-0000-000000000002', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F0F512670>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F0FDCF160>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestnq2amshlru...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestnq2amshlru...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_managed_aad>
resource_group = 'clitestbup4jzybj2', resource_group_location = 'eastus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='eastus2')
    @RoleBasedServicePrincipalPreparer()
    def test_aks_managed_aad(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--enable-aad --aad-admin-group-object-ids 00000000-0000-0000-0000-000000000001 -o json'
        self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('aadProfile.managed', True),
            self.check('aadProfile.adminGroupObjectIds[0]', '00000000-0000-0000-0000-000000000001')
        ])
    
        update_cmd = 'aks update --resource-group={resource_group} --name={name} ' \
                     '--aad-admin-group-object-ids 00000000-0000-0000-0000-000000000002 ' \
                     '--aad-tenant-id 00000000-0000-0000-0000-000000000003 -o json'
>       self.cmd(update_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('aadProfile.managed', True),
            self.check('aadProfile.adminGroupObjectIds[0]', '00000000-0000-0000-0000-000000000002'),
            self.check('aadProfile.tenantId', '00000000-0000-0000-0000-000000000003')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:1834: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1504: in aks_update
    return _put_managed_cluster_ensuring_permission(cmd,
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000020F11BBFC10>
resource_group_name = 'clitestbup4jzybj2', resource_name = 'cliakstestjpwv66'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x0000020F0FB7EFA0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestbup4jzybj2/providers/Microsoft.ContainerService/managedClusters/cliakstestjpwv66'
path_format_arguments = {'resourceGroupName': 'clitestbup4jzybj2', 'resourceName': 'cliakstestjpwv66', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus2', 'properties': {'aadProfile': {'adminGroupObjectIDs': ['00000000-0000-0000-0000-000000000002'],...lse, 'maxPods': 110, 'mode': 'System', ...}], 'autoUpgradeProfile': {}, ...}, 'sku': {'name': 'Basic', 'tier': 'Free'}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestbup4jzybj2/providers/Microsoft.ContainerService/managedClusters/cliakstestjpwv66?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name clitestbup4jzybj2 --tag product=azurecli cause=automation date=2020-12-18T06:00:09Z" => 0. 

Changing "clitestzapf47d3utljzd3m3" to a valid URI of "http://clitestzapf47d3utljzd3m3", which is the required format used for service principal names
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
Command "az ad sp create-for-rbac -n clitestzapf47d3utljzd3m3 --skip-assignment" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks create --resource-group=clitestbup4jzybj2 --name=cliakstestjpwv66 --vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value=C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmpo_hcqzbk --enable-aad --aad-admin-group-object-ids 00000000-0000-0000-0000-000000000001 -o json" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az ad sp delete --id 63e2004b-72b1-43b8-9799-94f03eb35d6e" => 0. 

Command "az group delete --name clitestbup4jzybj2 --yes --no-wait" => 0. 

___ AcsCustomCommandTest.test_k8s_install_kubelogin_with_custom_source_url ____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

src = 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmp90zziu58\\bin\\windows_amd64\\kubelogin.exe'
dst = 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmppypgn1xn\\foo\\kubelogin'
copy_function = <function copy2 at 0x0000020F7E58D790>

    def move(src, dst, copy_function=copy2):
        """Recursively move a file or directory to another location. This is
        similar to the Unix "mv" command. Return the file or directory's
        destination.
    
        If the destination is a directory or a symlink to a directory, the source
        is moved inside the directory. The destination path must not already
        exist.
    
        If the destination already exists but is not a directory, it may be
        overwritten depending on os.rename() semantics.
    
        If the destination is on our current filesystem, then rename() is used.
        Otherwise, src is copied to the destination and then removed. Symlinks are
        recreated under the new name if os.rename() fails because of cross
        filesystem renames.
    
        The optional `copy_function` argument is a callable that will be used
        to copy the source or it will be delegated to `copytree`.
        By default, copy2() is used, but any function that supports the same
        signature (like copy()) can be used.
    
        A lot more could be done here...  A look at a mv.c shows a lot of
        the issues this implementation glosses over.
    
        """
        sys.audit("shutil.move", src, dst)
        real_dst = dst
        if os.path.isdir(dst):
            if _samefile(src, dst):
                # We might be on a case insensitive filesystem,
                # perform the rename anyway.
                os.rename(src, dst)
                return
    
            real_dst = os.path.join(dst, _basename(src))
            if os.path.exists(real_dst):
                raise Error("Destination path '%s' already exists" % real_dst)
        try:
>           os.rename(src, real_dst)
E           FileNotFoundError: [WinError 2] The system cannot find the file specified: 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmp90zziu58\\bin\\windows_amd64\\kubelogin.exe' -> 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmppypgn1xn\\foo\\kubelogin'

C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.8_3.8.1776.0_x64__qbz5n2kfra8p0\lib\shutil.py:788: FileNotFoundError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_custom.AcsCustomCommandTest testMethod=test_k8s_install_kubelogin_with_custom_source_url>
logger_mock = <MagicMock name='logger' id='2263752933872'>
mock_url_retrieve = <MagicMock name='_urlretrieve' id='2263753247712'>

    @mock.patch('azure.cli.command_modules.acs.custom._urlretrieve')
    @mock.patch('azure.cli.command_modules.acs.custom.logger')
    def test_k8s_install_kubelogin_with_custom_source_url(self, logger_mock, mock_url_retrieve):
        mock_url_retrieve.side_effect = create_kubelogin_zip
        try:
            temp_dir = tempfile.mkdtemp()
            test_location = os.path.join(temp_dir, 'foo', 'kubelogin')
            test_ver = '1.2.6'
            test_source_url = 'http://url2'
>           k8s_install_kubelogin(mock.MagicMock(), client_version=test_ver, install_location=test_location, source_url=test_source_url)

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_custom.py:820: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\acs\custom.py:463: in k8s_install_kubelogin
    shutil.move(download_path, install_location)
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.8_3.8.1776.0_x64__qbz5n2kfra8p0\lib\shutil.py:802: in move
    copy_function(src, real_dst)
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.8_3.8.1776.0_x64__qbz5n2kfra8p0\lib\shutil.py:432: in copy2
    copyfile(src, dst, follow_symlinks=follow_symlinks)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

src = 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmp90zziu58\\bin\\windows_amd64\\kubelogin.exe'
dst = 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmppypgn1xn\\foo\\kubelogin'

    def copyfile(src, dst, *, follow_symlinks=True):
        """Copy data from src to dst in the most efficient way possible.
    
        If follow_symlinks is not set and src is a symbolic link, a new
        symlink will be created instead of copying the file it points to.
    
        """
        sys.audit("shutil.copyfile", src, dst)
    
        if _samefile(src, dst):
            raise SameFileError("{!r} and {!r} are the same file".format(src, dst))
    
        file_size = 0
        for i, fn in enumerate([src, dst]):
            try:
                st = _stat(fn)
            except OSError:
                # File most likely does not exist
                pass
            else:
                # XXX What about other special files? (sockets, devices...)
                if stat.S_ISFIFO(st.st_mode):
                    fn = fn.path if isinstance(fn, os.DirEntry) else fn
                    raise SpecialFileError("`%s` is a named pipe" % fn)
                if _WINDOWS and i == 0:
                    file_size = st.st_size
    
        if not follow_symlinks and _islink(src):
            os.symlink(os.readlink(src), dst)
        else:
>           with open(src, 'rb') as fsrc, open(dst, 'wb') as fdst:
E           FileNotFoundError: [Errno 2] No such file or directory: 'C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmp90zziu58\\bin\\windows_amd64\\kubelogin.exe'

C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.8_3.8.1776.0_x64__qbz5n2kfra8p0\lib\shutil.py:261: FileNotFoundError
_ AzureKubernetesServiceScenarioTest.test_aks_create_private_cluster_then_update _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023812E5E400>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Private cluster cannot be enabled with AuthorizedIPRanges.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Private cluster cannot be enabled with AuthorizedIPRanges.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_private_cluster_then_update>
resource_group = 'clitestuzto2cfx4e', resource_group_location = 'westus2'
sp_name = 'clitest6dmj76vvq43oifywf'
sp_password = 'rAVRjZjMJbX6RMWn098Zi-woVQpvs7-2xE'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    @RoleBasedServicePrincipalPreparer()
    def test_aks_create_private_cluster_then_update(self, resource_group, resource_group_location, sp_name, sp_password):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'service_principal': _process_sp_name(sp_name),
            'client_secret': sp_password,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--service-principal={service_principal} --client-secret={client_secret} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets ' \
                     '--enable-private-cluster --no-wait'
    
        self.cmd(create_cmd, checks=[self.is_empty()])
    
        # wait
        self.cmd('aks wait -g {resource_group} -n {name} --created', checks=[self.is_empty()])
    
        # list
        self.cmd('aks list -g {resource_group}', checks=[
            self.check('[0].type', '{resource_type}'),
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # list in tabular format
        self.cmd('aks list -g {resource_group} -o table', checks=[
            StringContainCheck(aks_name),
            StringContainCheck(resource_group)
        ])
    
        # show
        self.cmd('aks show -g {resource_group} -n {name}', checks=[
            self.check('type', '{resource_type}'),
            self.check('name', '{name}'),
            self.exists('nodeResourceGroup'),
            self.check('resourceGroup', '{resource_group}'),
            self.check('agentPoolProfiles[0].count', 1),
            self.check('agentPoolProfiles[0].osType', 'Linux'),
            self.check('agentPoolProfiles[0].vmSize', 'Standard_DS2_v2'),
            self.check('agentPoolProfiles[0].type', 'VirtualMachineScaleSets'),
            self.check('dnsPrefix', '{dns_name_prefix}'),
            self.exists('kubernetesVersion'),
            self.check('networkProfile.loadBalancerSku', 'Standard'),
            self.check('apiServerAccessProfile.enablePrivateCluster', True),
            self.check('networkProfile.loadBalancerProfile.managedOutboundIps.count', 1),
            self.exists('networkProfile.loadBalancerProfile.effectiveOutboundIps')
        ])
    
        # get-credentials
        fd, temp_path = tempfile.mkstemp()
        self.kwargs.update({'file': temp_path})
        try:
            self.cmd('aks get-credentials -g {resource_group} -n {name} --file "{file}"')
            self.assertGreater(os.path.getsize(temp_path), 0)
        finally:
            os.close(fd)
            os.remove(temp_path)
    
        # update api-server-authorized-ip-ranges is not supported
        with self.assertRaises(CLIError) as err:
>           self.cmd('aks update -g {resource_group} -n {name} --api-server-authorized-ip-ranges=1.2.3.4/32')

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:780: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1504: in aks_update
    return _put_managed_cluster_ensuring_permission(cmd,
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestuzto2cfx4e/providers/Microsoft.ContainerService/managedClusters/cliakstestkvio5l?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stdout call -----------------------------
Merged "cliakstestkvio5l" as current context in C:\Users\daetienn\AppData\Local\Temp\tmpwp7brqbn
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestuzto2cfx4e --tag product=azurecli cause=automation date=2020-12-18T06:17:27Z" => 0. 

Changing "clitest6dmj76vvq43oifywf" to a valid URI of "http://clitest6dmj76vvq43oifywf", which is the required format used for service principal names
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
Command "az ad sp create-for-rbac -n clitest6dmj76vvq43oifywf --skip-assignment" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks create --resource-group=clitestuzto2cfx4e --name=cliakstestkvio5l --location=westus2 --dns-name-prefix=cliaksdnstu3turl --node-count=1 --ssh-key-value=C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmpvyvla559 --service-principal=http://clitest6dmj76vvq43oifywf --client-secret=rAVRjZjMJbX6RMWn098Zi-woVQpvs7-2xE --load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --enable-private-cluster --no-wait" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks wait -g clitestuzto2cfx4e -n cliakstestkvio5l --created" => 0. 

Command "aks list -g clitestuzto2cfx4e" => 0. 

Command "aks list -g clitestuzto2cfx4e -o table" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks show -g clitestuzto2cfx4e -n cliakstestkvio5l" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks get-credentials -g clitestuzto2cfx4e -n cliakstestkvio5l --file "C:\Users\daetienn\AppData\Local\Temp\tmpwp7brqbn"" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Removing role assignments
Command "az ad sp delete --id ce30f97f-2087-4b59-a29b-9b9cea041317" => 0. 

Command "az group delete --name clitestuzto2cfx4e --yes --no-wait" => 0. 

______ AzureKubernetesServiceScenarioTest.test_aks_create_spot_node_pool ______
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023814519A30>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023813E2DBB0>
command = 'aks create --resource-group=clitestgeedergpyz --name=cliakstestqa63j2 --vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmplctjf2mn -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023813E2DBB0>
args = ['aks', 'create', '--resource-group=clitestgeedergpyz', '--name=cliakstestqa63j2', '--vm-set-type', 'VirtualMachineScaleSets', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023813FE3F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023813E2DBB0>
ex = CLIError('Deployment failed. Correlation ID: d17b7ee6-c62e-492d-b684-84081eadbb70. Service Principal http://clitestoze...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: d17b7ee6-c62e-492d-b684-84081eadbb70. Service Principal http://clitestoze...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_spot_node_pool>
resource_group = 'clitestgeedergpyz', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    @RoleBasedServicePrincipalPreparer()
    def test_aks_create_spot_node_pool(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        spot_node_pool_name = self.create_random_name('s', 6)
        spot_max_price = 88.88888  # Good number with large value.
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'spot_node_pool_name': spot_node_pool_name,
            'spot_max_price': spot_max_price,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 ' \
                     '--ssh-key-value={ssh_key_value} ' \
                     '-o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2011: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Service Principal http://clitestozegzfd22my3libql is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: d17b7ee6-c62e-492d-b684-84081eadbb70. Service Principal http://clitestozegzfd22my3libql is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestgeedergpyz --tag product=azurecli cause=automation date=2020-12-18T06:29:09Z" => 0. 

Changing "clitestmcix6v5nvt62stx4m" to a valid URI of "http://clitestmcix6v5nvt62stx4m", which is the required format used for service principal names
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
Command "az ad sp create-for-rbac -n clitestmcix6v5nvt62stx4m --skip-assignment" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az ad sp delete --id 9ae5cbdc-00b4-41d3-aa6a-62f79a575915" => 0. 

Command "az group delete --name clitestgeedergpyz --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_managed_identity_with_service_principal _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_managed_identity_with_service_principal>
resource_group = 'clitestxtaz4iak4q', resource_group_location = 'westus2'
sp_name = 'clitesta3avqhv35w7rg6prr'
sp_password = 'zzBu_qb22q-o~QhnGwAZ_Xcdhmi0Y105Z4'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    @RoleBasedServicePrincipalPreparer()
    def test_aks_managed_identity_with_service_principal(self, resource_group, resource_group_location, sp_name, sp_password):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'service_principal': _process_sp_name(sp_name),
            'client_secret': sp_password,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--service-principal={service_principal} --client-secret={client_secret} --enable-managed-identity'
    
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.exists('servicePrincipalProfile'),
            self.not_exists('identity'),
            self.check('provisioningState', 'Succeeded'),
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:1518: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheckNotExists object at 0x0000019C72513730>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C724EA130>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = jmespath.search(self._query, json_value,
                                        jmespath.Options(collections.OrderedDict))
        if actual_result:
>           raise JMESPathCheckAssertionError(self._query, 'some value', actual_result,
                                              execution_result.output)
E           azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'identity' doesn't yield expected value 'some value', instead the actual value is '{'principalId': '6c48c582-b511-4e5f-ae74-4f847eb71113', 'tenantId': '72f988bf-86f1-41af-91ab-2d7cd011db47', 'type': 'SystemAssigned', 'userAssignedIdentities': None}'. Data: 
E           {
E             "aadProfile": null,
E             "addonProfiles": {
E               "KubeDashboard": {
E                 "config": null,
E                 "enabled": false,
E                 "identity": null
E               }
E             },
E             "agentPoolProfiles": [
E               {
E                 "availabilityZones": null,
E                 "count": 1,
E                 "enableAutoScaling": null,
E                 "enableNodePublicIp": false,
E                 "kubeletConfig": null,
E                 "linuxOsConfig": null,
E                 "maxCount": null,
E                 "maxPods": 110,
E                 "minCount": null,
E                 "mode": "System",
E                 "name": "nodepool1",
E                 "nodeImageVersion": "AKSUbuntu-1804-2020.12.01",
E                 "nodeLabels": {},
E                 "nodeTaints": null,
E                 "orchestratorVersion": "1.18.10",
E                 "osDiskSizeGb": 128,
E                 "osDiskType": "Managed",
E                 "osType": "Linux",
E                 "podSubnetId": null,
E                 "powerState": {
E                   "code": "Running"
E                 },
E                 "provisioningState": "Succeeded",
E                 "proximityPlacementGroupId": null,
E                 "scaleSetEvictionPolicy": null,
E                 "scaleSetPriority": null,
E                 "spotMaxPrice": null,
E                 "tags": null,
E                 "type": "VirtualMachineScaleSets",
E                 "upgradeSettings": null,
E                 "vmSize": "Standard_DS2_v2",
E                 "vnetSubnetId": null
E               }
E             ],
E             "apiServerAccessProfile": null,
E             "autoScalerProfile": null,
E             "autoUpgradeProfile": null,
E             "diskEncryptionSetId": null,
E             "dnsPrefix": "cliaksdnsjxpdvd5",
E             "enablePodSecurityPolicy": false,
E             "enableRbac": true,
E             "fqdn": "cliaksdnsjxpdvd5-ecff2074.hcp.westus2.azmk8s.io",
E             "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/clitestxtaz4iak4q/providers/Microsoft.ContainerService/managedClusters/cliakstestq4dzhi",
E             "identity": {
E               "principalId": "6c48c582-b511-4e5f-ae74-4f847eb71113",
E               "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
E               "type": "SystemAssigned",
E               "userAssignedIdentities": null
E             },
E             "identityProfile": {
E               "kubeletidentity": {
E                 "clientId": "6eb15213-cb19-49cc-8152-86a4b4b90417",
E                 "objectId": "c2b6d573-436e-47d6-9144-c58a6ad7dbe7",
E                 "resourceId": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/MC_clitestxtaz4iak4q_cliakstestq4dzhi_westus2/providers/Microsoft.ManagedIdentity/userAssignedIdentities/cliakstestq4dzhi-agentpool"
E               }
E             },
E             "kubernetesVersion": "1.18.10",
E             "linuxProfile": {
E               "adminUsername": "azureuser",
E               "ssh": {
E                 "publicKeys": [
E                   {
E                     "keyData": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCbIg1guRHbI0lV11wWDt1r2cUdcNd27CJsg+SfgC7miZeubtwUhbsPdhMQsfDyhOWHq1+ZL0M+nJZV63d/1dhmhtgyOqejUwrPlzKhydsbrsdUor+JmNJDdW01v7BXHyuymT8G4s09jCasNOwiufbP/qp72ruu0bIA1nySsvlf9pCQAuFkAnVnf/rFhUlOkhtRpwcq8SUNY2zRHR/EKb/4NWY1JzR4sa3q2fWIJdrrX0DvLoa5g9bIEd4Df79ba7v+yiUBOS0zT2ll+z4g9izHK3EO5d8hL4jYxcjKs+wcslSYRWrascfscLgMlMGh0CdKeNTDjHpGPncaf3Z+FwwwjWeuiNBxv7bJo13/8B/098KlVDl4GZqsoBCEjPyJfV6hO0y/LkRGkk7oHWKgeWAfKtfLItRp00eZ4fcJNK9kCaSMmEugoZWcI7NGbZXzqFWqbpRI7NcDP9+WIQ+i9U5vqWsqd/zng4kbuAJ6UuKqIzB0upYrLShfQE3SAck8oaLhJqqq56VfDuASNpJKidV+zq27HfSBmbXnkR/5AK337dc3MXKJypoK/QPMLKUAP5XLPbs+NddJQV7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n"
E                   }
E                 ]
E               }
E             },
E             "location": "westus2",
E             "maxAgentPools": 10,
E             "name": "cliakstestq4dzhi",
E             "networkProfile": {
E               "dnsServiceIp": "10.0.0.10",
E               "dockerBridgeCidr": "172.17.0.1/16",
E               "loadBalancerProfile": {
E                 "allocatedOutboundPorts": null,
E                 "effectiveOutboundIps": [
E                   {
E                     "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/MC_clitestxtaz4iak4q_cliakstestq4dzhi_westus2/providers/Microsoft.Network/publicIPAddresses/fdc2cb67-740c-4d3e-a275-8ddb9a61eeaa",
E                     "resourceGroup": "MC_clitestxtaz4iak4q_cliakstestq4dzhi_westus2"
E                   }
E                 ],
E                 "idleTimeoutInMinutes": null,
E                 "managedOutboundIps": {
E                   "count": 1
E                 },
E                 "outboundIpPrefixes": null,
E                 "outboundIps": null
E               },
E               "loadBalancerSku": "Standard",
E               "networkMode": null,
E               "networkPlugin": "kubenet",
E               "networkPolicy": null,
E               "outboundType": "loadBalancer",
E               "podCidr": "10.244.0.0/16",
E               "serviceCidr": "10.0.0.0/16"
E             },
E             "nodeResourceGroup": "MC_clitestxtaz4iak4q_cliakstestq4dzhi_westus2",
E             "podIdentityProfile": null,
E             "powerState": {
E               "code": "Running"
E             },
E             "privateFqdn": null,
E             "provisioningState": "Succeeded",
E             "resourceGroup": "clitestxtaz4iak4q",
E             "servicePrincipalProfile": {
E               "clientId": "msi",
E               "secret": null
E             },
E             "sku": {
E               "name": "Basic",
E               "tier": "Free"
E             },
E             "tags": null,
E             "type": "Microsoft.ContainerService/ManagedClusters",
E             "windowsProfile": null
E           }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:62: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestxtaz4iak4q --tag product=azurecli cause=automation date=2020-12-18T06:32:10Z" => 0. 

Changing "clitesta3avqhv35w7rg6prr" to a valid URI of "http://clitesta3avqhv35w7rg6prr", which is the required format used for service principal names
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
Command "az ad sp create-for-rbac -n clitesta3avqhv35w7rg6prr --skip-assignment" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "aks create --resource-group=clitestxtaz4iak4q --name=cliakstestq4dzhi --location=westus2 --dns-name-prefix=cliaksdnsjxpdvd5 --node-count=1 --ssh-key-value=C:\\Users\\daetienn\\AppData\\Local\\Temp\\tmp04wyiq8i --service-principal=http://clitesta3avqhv35w7rg6prr --client-secret=zzBu_qb22q-o~QhnGwAZ_Xcdhmi0Y105Z4 --enable-managed-identity" => 0. 

Command "az ad sp delete --id aa9323b0-fe45-4fc2-a4a8-08b55e7d51f8" => 0. 

Command "az group delete --name clitestxtaz4iak4q --yes --no-wait" => 0. 

____ AzureKubernetesServiceScenarioTest.test_aks_create_with_managed_disk _____
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238143BFA00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238141CEE50>
command = 'aks create --resource-group=clitestxxtojntbdt --name=cliakstestidcwfr --generate-ssh-keys --vm-set-type VirtualMachineScaleSets -c 1 --node-osdisk-type=Managed'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238141CEE50>
args = ['aks', 'create', '--resource-group=clitestxxtojntbdt', '--name=cliakstestidcwfr', '--generate-ssh-keys', '--vm-set-type', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023813D5BDC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238141CEE50>
ex = CLIError('Deployment failed. Correlation ID: b1cc9647-35fc-4c82-9997-5960d3d1baa1. Service Principal http://clitesta3a...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: b1cc9647-35fc-4c82-9997-5960d3d1baa1. Service Principal http://clitesta3a...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_with_managed_disk>
resource_group = 'clitestxxtojntbdt', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_with_managed_disk(self, resource_group, resource_group_location):
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--generate-ssh-keys ' \
                     '--vm-set-type VirtualMachineScaleSets -c 1 ' \
                     '--node-osdisk-type=Managed'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('agentPoolProfiles[0].osDiskType', 'Managed'),
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:2088: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Service Principal http://clitesta3avqhv35w7rg6prr is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: b1cc9647-35fc-4c82-9997-5960d3d1baa1. Service Principal http://clitesta3avqhv35w7rg6prr is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestxxtojntbdt --tag product=azurecli cause=automation date=2020-12-18T06:35:03Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestxxtojntbdt --yes --no-wait" => 0. 

____ AzureKubernetesServiceScenarioTest.test_aks_create_with_paid_sku_msi _____
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C930AD6D00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C92E8C8C10>
command = 'aks create --resource-group=clitest4j2kcvriy3 --name=cliakstestbyiizg --location=westus2 --dns-name-prefix=cliaksdns5r7urvn --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmpga4m33ai --uptime-sla '
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C92E8C8C10>
args = ['aks', 'create', '--resource-group=clitest4j2kcvriy3', '--name=cliakstestbyiizg', '--location=westus2', '--dns-name-prefix=cliaksdns5r7urvn', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C930DCD8B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C92E8C8C10>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_with_paid_sku_msi>
resource_group = 'clitest4j2kcvriy3', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_with_paid_sku_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters'
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--uptime-sla '
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.check('provisioningState', 'Succeeded'),
            self.check('sku.tier', 'Paid')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3647: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x000001C930DFDD00>
resource_group_name = 'clitest4j2kcvriy3', resource_name = 'cliakstestbyiizg'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x000001C930EFCF40>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest4j2kcvriy3/providers/Microsoft.ContainerService/managedClusters/cliakstestbyiizg'
path_format_arguments = {'resourceGroupName': 'clitest4j2kcvriy3', 'resourceName': 'cliakstestbyiizg', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F....}], 'dnsPrefix': 'cliaksdns5r7urvn', 'enablePodSecurityPolicy': False, ...}, 'sku': {'name': 'Basic', 'tier': 'Paid'}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest4j2kcvriy3/providers/Microsoft.ContainerService/managedClusters/cliakstestbyiizg?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitest4j2kcvriy3 --tag product=azurecli cause=automation date=2020-12-18T06:45:20Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitest4j2kcvriy3 --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_upgrade_node_image_only_nodepool _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C716382B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C71CB1460>
command = 'aks create --resource-group=clitestysq76w5vun --name=cliakstestc6oh52 --nodepool-name coiqhx --vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmp2humhf9z -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71CB1460>
args = ['aks', 'create', '--resource-group=clitestysq76w5vun', '--name=cliakstestc6oh52', '--nodepool-name', 'coiqhx', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C70B291F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C71CB1460>
ex = CLIError('Deployment failed. Correlation ID: 9f321df4-d449-4d82-96c4-ddf0f2c2b2d6. Service Principal http://clitestbd7...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 9f321df4-d449-4d82-96c4-ddf0f2c2b2d6. Service Principal http://clitestbd7...n tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_upgrade_node_image_only_nodepool>
resource_group = 'clitestysq76w5vun', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    @RoleBasedServicePrincipalPreparer()
    def test_aks_upgrade_node_image_only_nodepool(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        node_pool_name = self.create_random_name('c', 6)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'node_pool_name': node_pool_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--nodepool-name {node_pool_name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 ' \
                     '--ssh-key-value={ssh_key_value} ' \
                     '-o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:1969: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Service Principal http://clitestbd7et4yeu5swfosth is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 9f321df4-d449-4d82-96c4-ddf0f2c2b2d6. Service Principal http://clitestbd7et4yeu5swfosth is not found in tenant ID 72f988bf-86f1-41af-91ab-2d7cd011db47, if the service principal has just been created, please retry later.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestysq76w5vun --tag product=azurecli cause=automation date=2020-12-18T06:43:49Z" => 0. 

Changing "clitestogtx2svcug4odoinz" to a valid URI of "http://clitestogtx2svcug4odoinz", which is the required format used for service principal names
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
Command "az ad sp create-for-rbac -n clitestogtx2svcug4odoinz --skip-assignment" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az ad sp delete --id ec5c466c-3a9c-4e11-809f-763ac915e99a" => 0. 

Command "az group delete --name clitestysq76w5vun --yes --no-wait" => 0. 

_________ AzureKubernetesServiceScenarioTest.test_aks_managed_aad_msi _________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238140DDC10>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023812E88190>
command = 'aks create --resource-group=clitest45m43ozdbw --name=cliakstest3xpoqf --vm-set-type VirtualMachineScaleSets --node-co...\\\Local\\\\Temp\\\\tmp2e7pl6ip --enable-aad --aad-admin-group-object-ids 00000000-0000-0000-0000-000000000001 -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023812E88190>
args = ['aks', 'create', '--resource-group=clitest45m43ozdbw', '--name=cliakstest3xpoqf', '--vm-set-type', 'VirtualMachineScaleSets', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023813D13310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023812E88190>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_managed_aad_msi>
resource_group = 'clitest45m43ozdbw', resource_group_location = 'eastus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='eastus2')
    def test_aks_managed_aad_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--enable-aad --aad-admin-group-object-ids 00000000-0000-0000-0000-000000000001 -o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('aadProfile.managed', True),
            self.check('aadProfile.adminGroupObjectIds[0]', '00000000-0000-0000-0000-000000000001')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3723: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000023813371C40>
resource_group_name = 'clitest45m43ozdbw', resource_name = 'cliakstest3xpoqf'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x00000238146A84F0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest45m43ozdbw/providers/Microsoft.ContainerService/managedClusters/cliakstest3xpoqf'
path_format_arguments = {'resourceGroupName': 'clitest45m43ozdbw', 'resourceName': 'cliakstest3xpoqf', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus2', 'properties': {'aadProfile': {'adminGroupObjectIDs': ['00000000-0000-0000-0000-000000000001'],...ublicIP': False, 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliakstest-clitest45m43ozdb-a1bfa6', ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest45m43ozdbw/providers/Microsoft.ContainerService/managedClusters/cliakstest3xpoqf?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name clitest45m43ozdbw --tag product=azurecli cause=automation date=2020-12-18T06:47:16Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitest45m43ozdbw --yes --no-wait" => 0. 

_______ WebappWindowsContainerBasicE2ETest.test_webapp_create_with_msi ________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F12B20970>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F11C3A190>
command = 'role assignment list -g rgmap7 --assignee 1c05c943-598d-4ea9-ac13-b44936b7f56e'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F11C3A190>
args = ['role', 'assignment', 'list', '-g', 'rgmap7', '--assignee', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F174FC310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F11C3A190>
ex = CLIError("Cannot find user or service principal in graph database for '1c05c943-598d-4ea9-ac13-b44936b7f56e'. If the a...sure the corresponding service principal is created with 'az ad sp create --id 1c05c943-598d-4ea9-ac13-b44936b7f56e'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError("Cannot find user or service principal in graph database for '1c05c943-598d-4ea9-ac13-b44936b7f56e'. If the a...sure the corresponding service principal is created with 'az ad sp create --id 1c05c943-598d-4ea9-ac13-b44936b7f56e'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.appservice.tests.latest.test_webapp_commands.WebappWindowsContainerBasicE2ETest testMethod=test_webapp_create_with_msi>
resource_group = 'rgmap7'

    @AllowLargeResponse()
    @ResourceGroupPreparer(name_prefix='rg', random_name_length=6)
    def test_webapp_create_with_msi(self, resource_group):
        scope = '/subscriptions/{}/resourcegroups/{}'.format(
            self.get_subscription_id(), resource_group)
        role = 'Reader'
        webapp_name = self.create_random_name('webapp-with-msi', 26)
        plan = self.create_random_name('plan-create-with-msi', 26)
        identity_name = self.create_random_name('app-create', 16)
    
        msi_result = self.cmd('identity create -g {} -n {}'.format(
            resource_group, identity_name)).get_output_in_json()
        self.cmd('appservice plan create -g {} -n {}'.format(resource_group, plan))
        with mock.patch('azure.cli.core.commands.arm._gen_guid', side_effect=self.create_guid):
            result = self.cmd('webapp create -g {} -n {} --plan {} --assign-identity [system] {} --role {} --scope {}'.format(
                resource_group, webapp_name, plan, msi_result['id'], role, scope)).get_output_in_json()
    
        self.cmd('webapp identity show -g {} -n {}'.format(resource_group, webapp_name), checks=[
            self.check('principalId', result['identity']['principalId']),
            self.check('userAssignedIdentities."{}".clientId'.format(msi_result['id']), msi_result['clientId']),
        ])
>       self.cmd('role assignment list -g {} --assignee {}'.format(resource_group, result['identity']['principalId']), checks=[
            self.check('length([])', 1),
            self.check('[0].roleDefinitionName', role)
        ])

src\azure-cli\azure\cli\command_modules\appservice\tests\latest\test_webapp_commands.py:2958: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\role\custom.py:203: in list_role_assignments
    assignments = _search_role_assignments(cmd.cli_ctx, assignments_client, definitions_client,
src\azure-cli\azure\cli\command_modules\role\custom.py:519: in _search_role_assignments
    assignee_object_id = _resolve_object_id(cli_ctx, assignee, fallback_to_object_id=True)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F15CBA850>
assignee = '1c05c943-598d-4ea9-ac13-b44936b7f56e', fallback_to_object_id = True

    def _resolve_object_id(cli_ctx, assignee, fallback_to_object_id=False):
        client = _graph_client_factory(cli_ctx)
        result = None
        try:
            if assignee.find('@') >= 0:  # looks like a user principal name
                result = list(client.users.list(filter="userPrincipalName eq '{}'".format(assignee)))
            if not result:
                result = list(client.service_principals.list(
                    filter="servicePrincipalNames/any(c:c eq '{}')".format(assignee)))
            if not result and is_guid(assignee):  # assume an object id, let us verify it
                result = _get_object_stubs(client, [assignee])
    
            # 2+ matches should never happen, so we only check 'no match' here
            if not result:
>               raise CLIError("Cannot find user or service principal in graph database for '{assignee}'. "
                               "If the assignee is an appId, make sure the corresponding service principal is created "
                               "with 'az ad sp create --id {assignee}'.".format(assignee=assignee))
E                              knack.util.CLIError: Cannot find user or service principal in graph database for '1c05c943-598d-4ea9-ac13-b44936b7f56e'. If the assignee is an appId, make sure the corresponding service principal is created with 'az ad sp create --id 1c05c943-598d-4ea9-ac13-b44936b7f56e'.

src\azure-cli\azure\cli\command_modules\role\custom.py:1805: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name rgmap7 --tag product=azurecli cause=automation date=2020-12-18T06:49:16Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -g rgmap7 -n app-createygsdtq" => 0. 

Command "appservice plan create -g rgmap7 -n plan-create-with-msigjenhn" => 0. 

Retrying role assignment creation: 1/36
Retrying role assignment creation: 2/36
Retrying role assignment creation: 3/36
Command "webapp create -g rgmap7 -n webapp-with-msip5j77eihcbp --plan plan-create-with-msigjenhn --assign-identity [system] /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/rgmap7/providers/Microsoft.ManagedIdentity/userAssignedIdentities/app-createygsdtq --role Reader --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/rgmap7" => 0. 

Command "webapp identity show -g rgmap7 -n webapp-with-msip5j77eihcbp" => 0. 

Command "az group delete --name rgmap7 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.web.v2019_08_01.models._models_py3.AppServicePlan'>
_____ AzureKubernetesServiceScenarioTest.test_aks_create_with_windows_msi _____
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C931576CD0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93477CF10>
command = 'aks create --resource-group=clitestbdlpqt5vkz --name=cliakstestqnlxv6 --location=westus2 --dns-name-prefix=cliaksdns2...assword=replacePassword1234$ --load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --network-plugin=azure'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93477CF10>
args = ['aks', 'create', '--resource-group=clitestbdlpqt5vkz', '--name=cliakstestqnlxv6', '--location=westus2', '--dns-name-prefix=cliaksdns2rinauv', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C931687A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93477CF10>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_create_with_windows_msi>
resource_group = 'clitestbdlpqt5vkz', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_create_with_windows_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters',
            'windows_admin_username': 'azureuser1',
            'windows_admin_password': 'replacePassword1234$',
            'nodepool2_name': 'npwin',
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} ' \
                     '--windows-admin-username={windows_admin_username} --windows-admin-password={windows_admin_password} ' \
                     '--load-balancer-sku=standard --vm-set-type=virtualmachinescalesets --network-plugin=azure'
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.check('provisioningState', 'Succeeded'),
            self.check('windowsProfile.adminUsername', 'azureuser1')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3682: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x000001C931413A60>
resource_group_name = 'clitestbdlpqt5vkz', resource_name = 'cliakstestqnlxv6'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x000001C92E387AC0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestbdlpqt5vkz/providers/Microsoft.ContainerService/managedClusters/cliakstestqnlxv6'
path_format_arguments = {'resourceGroupName': 'clitestbdlpqt5vkz', 'resourceName': 'cliakstestqnlxv6', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliaksdns2rinauv', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestbdlpqt5vkz/providers/Microsoft.ContainerService/managedClusters/cliakstestqnlxv6?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestbdlpqt5vkz --tag product=azurecli cause=automation date=2020-12-18T06:48:36Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestbdlpqt5vkz --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_nodepool_create_scale_delete_msi _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381284E9D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381499CA00>
command = 'aks create --resource-group=clitestm2ndnme5lx --name=cliakstestqubltm --location=westus2 --dns-name-prefix=cliaksdnsmc6rtye --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmpfu9qr8kg '
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381499CA00>
args = ['aks', 'create', '--resource-group=clitestm2ndnme5lx', '--name=cliakstestqubltm', '--location=westus2', '--dns-name-prefix=cliaksdnsmc6rtye', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023813B811F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381499CA00>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_nodepool_create_scale_delete_msi>
resource_group = 'clitestm2ndnme5lx', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_nodepool_create_scale_delete_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        nodepool1_name = "nodepool1"
        nodepool2_name = "nodepool2"
        tags = "key1=value1"
        new_tags = "key2=value2"
        labels="label1=value1"
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters',
            'tags': tags,
            'new_tags': new_tags,
            'labels': labels,
            'nodepool1_name': nodepool1_name,
            'nodepool2_name': nodepool2_name
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} '
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3359: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x0000023812672220>
resource_group_name = 'clitestm2ndnme5lx', resource_name = 'cliakstestqubltm'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x000002381268FEE0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestm2ndnme5lx/providers/Microsoft.ContainerService/managedClusters/cliakstestqubltm'
path_format_arguments = {'resourceGroupName': 'clitestm2ndnme5lx', 'resourceName': 'cliakstestqubltm', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliaksdnsmc6rtye', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestm2ndnme5lx/providers/Microsoft.ContainerService/managedClusters/cliakstestqubltm?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestm2ndnme5lx --tag product=azurecli cause=automation date=2020-12-18T06:50:15Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestm2ndnme5lx --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_upgrade_node_image_only_cluster_msi _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023813AEC4F0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023814824370>
command = 'aks create --resource-group=clitestuf2y7nadbg --name=cliakstestu2f7on --nodepool-name c6yzuq --vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmpmf1nq28c -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023814824370>
args = ['aks', 'create', '--resource-group=clitestuf2y7nadbg', '--name=cliakstestu2f7on', '--nodepool-name', 'c6yzuq', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238145C54C0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023814824370>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_upgrade_node_image_only_cluster_msi>
resource_group = 'clitestuf2y7nadbg', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_upgrade_node_image_only_cluster_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        node_pool_name = self.create_random_name('c', 6)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'node_pool_name': node_pool_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--nodepool-name {node_pool_name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 ' \
                     '--ssh-key-value={ssh_key_value} ' \
                     '-o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3830: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x00000238137102E0>
resource_group_name = 'clitestuf2y7nadbg', resource_name = 'cliakstestu2f7on'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x00000238130110D0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestuf2y7nadbg/providers/Microsoft.ContainerService/managedClusters/cliakstestu2f7on'
path_format_arguments = {'resourceGroupName': 'clitestuf2y7nadbg', 'resourceName': 'cliakstestu2f7on', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F...m', 'name': 'c6yzuq', ...}], 'dnsPrefix': 'cliakstest-clitestuf2y7nadb-a1bfa6', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestuf2y7nadbg/providers/Microsoft.ContainerService/managedClusters/cliakstestu2f7on?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestuf2y7nadbg --tag product=azurecli cause=automation date=2020-12-18T06:53:24Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestuf2y7nadbg --yes --no-wait" => 0. 

____ AzureKubernetesServiceScenarioTest.test_aks_nodepool_system_pool_msi _____
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C930E4D1C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C932F632E0>
command = 'aks create --resource-group=clitestmh2laq46b7 --name=cliakstestnixy33 --location=westus2 --dns-name-prefix=cliaksdnsfh3kxnw --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmp2o3gn06y '
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C932F632E0>
args = ['aks', 'create', '--resource-group=clitestmh2laq46b7', '--name=cliakstestnixy33', '--location=westus2', '--dns-name-prefix=cliaksdnsfh3kxnw', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9320879D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C932F632E0>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_nodepool_system_pool_msi>
resource_group = 'clitestmh2laq46b7', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_nodepool_system_pool_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        nodepool1_name = "nodepool1"
        nodepool2_name = "nodepool2"
        nodepool3_name = "nodepool3"
        tags = "key1=value1"
        new_tags = "key2=value2"
        labels="label1=value1"
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'dns_name_prefix': self.create_random_name('cliaksdns', 16),
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\'),
            'location': resource_group_location,
            'resource_type': 'Microsoft.ContainerService/ManagedClusters',
            'tags': tags,
            'new_tags': new_tags,
            'labels': labels,
            'nodepool1_name': nodepool1_name,
            'nodepool2_name': nodepool2_name,
            'nodepool3_name': nodepool3_name
        })
    
        # create
        create_cmd = 'aks create --resource-group={resource_group} --name={name} --location={location} ' \
                     '--dns-name-prefix={dns_name_prefix} --node-count=1 --ssh-key-value={ssh_key_value} '
>       self.cmd(create_cmd, checks=[
            self.exists('fqdn'),
            self.exists('nodeResourceGroup'),
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3476: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x000001C92E3787C0>
resource_group_name = 'clitestmh2laq46b7', resource_name = 'cliakstestnixy33'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x000001C930A85D60>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestmh2laq46b7/providers/Microsoft.ContainerService/managedClusters/cliakstestnixy33'
path_format_arguments = {'resourceGroupName': 'clitestmh2laq46b7', 'resourceName': 'cliakstestnixy33', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F... 'mode': 'System', 'name': 'nodepool1', ...}], 'dnsPrefix': 'cliaksdnsfh3kxnw', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestmh2laq46b7/providers/Microsoft.ContainerService/managedClusters/cliakstestnixy33?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestmh2laq46b7 --tag product=azurecli cause=automation date=2020-12-18T06:57:20Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestmh2laq46b7 --yes --no-wait" => 0. 

_ AzureKubernetesServiceScenarioTest.test_aks_upgrade_node_image_only_nodepool_msi _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C931AF0700>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C934853580>
command = 'aks create --resource-group=clitestl2cef6i4gf --name=cliakstestbqm74d --nodepool-name cumubd --vm-set-type VirtualMachineScaleSets --node-count=1 --ssh-key-value=C:\\\\Users\\\\daetienn\\\\AppData\\\\Local\\\\Temp\\\\tmpsg06ltds -o json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C934853580>
args = ['aks', 'create', '--resource-group=clitestl2cef6i4gf', '--name=cliakstestbqm74d', '--nodepool-name', 'cumubd', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9316A5F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C934853580>
ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Operation failed with status: 'Bad Request'. Details: Service principal clientID: http://clitestbd7et4yeu5...Active Directory tenant 72f988bf-86f1-41af-91ab-2d7cd011db47, Please see https://aka.ms/aks-sp-help for more details.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.acs.tests.latest.test_aks_commands.AzureKubernetesServiceScenarioTest testMethod=test_aks_upgrade_node_image_only_nodepool_msi>
resource_group = 'clitestl2cef6i4gf', resource_group_location = 'westus2'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=17, name_prefix='clitest', location='westus2')
    def test_aks_upgrade_node_image_only_nodepool_msi(self, resource_group, resource_group_location):
        # reset the count so in replay mode the random names will start with 0
        self.test_resources_count = 0
        # kwargs for string formatting
        aks_name = self.create_random_name('cliakstest', 16)
        node_pool_name = self.create_random_name('c', 6)
        self.kwargs.update({
            'resource_group': resource_group,
            'name': aks_name,
            'node_pool_name': node_pool_name,
            'ssh_key_value': self.generate_ssh_keys().replace('\\', '\\\\')
        })
    
        create_cmd = 'aks create --resource-group={resource_group} --name={name} ' \
                     '--nodepool-name {node_pool_name} ' \
                     '--vm-set-type VirtualMachineScaleSets --node-count=1 ' \
                     '--ssh-key-value={ssh_key_value} ' \
                     '-o json'
>       self.cmd(create_cmd, checks=[
            self.check('provisioningState', 'Succeeded')
        ])

src\azure-cli\azure\cli\command_modules\acs\tests\latest\test_aks_commands.py:3863: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1227: in aks_create
    raise retry_exception
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:1207: in aks_create
    created_cluster = _put_managed_cluster_ensuring_permission(
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\custom.py:3130: in _put_managed_cluster_ensuring_permission
    cluster = sdk_no_wait(no_wait, client.create_or_update,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:664: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.operations._managed_clusters_operations.ManagedClustersOperations object at 0x000001C932275340>
resource_group_name = 'clitestl2cef6i4gf', resource_name = 'cliakstestbqm74d'
parameters = <azext_aks_preview.vendored_sdks.azure_mgmt_preview_aks.v2020_11_01.models._models_py3.ManagedCluster object at 0x000001C9323A21F0>
custom_headers = {}, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestl2cef6i4gf/providers/Microsoft.ContainerService/managedClusters/cliakstestbqm74d'
path_format_arguments = {'resourceGroupName': 'clitestl2cef6i4gf', 'resourceName': 'cliakstestbqm74d', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-11-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westus2', 'properties': {'addonProfiles': {}, 'agentPoolProfiles': [{'count': 1, 'enableNodePublicIP': F...m', 'name': 'cumubd', ...}], 'dnsPrefix': 'cliakstest-clitestl2cef6i4g-a1bfa6', 'enablePodSecurityPolicy': False, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', min_length=1),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str', max_length=63, min_length=1, pattern=r'^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ManagedCluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: 400 Client Error: Bad Request for url: https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitestl2cef6i4gf/providers/Microsoft.ContainerService/managedClusters/cliakstestbqm74d?api-version=2020-11-01

..\..\.azure\cliextensions\aks-preview\azext_aks_preview\vendored_sdks\azure_mgmt_preview_aks\v2020_11_01\operations\_managed_clusters_operations.py:621: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitestl2cef6i4gf --tag product=azurecli cause=automation date=2020-12-18T07:00:31Z" => 0. 

The behavior of this command has been altered by the following extension: aks-preview
Command "az group delete --name clitestl2cef6i4gf --yes --no-wait" => 0. 

______________________ AroScenarioTests.test_aro_create _______________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F17DC5F40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1840D7C0>
command = 'aro create -g cli_test_aro_createvrz3wibj6 -n aroxwrlmg2b6nd --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...virtualNetworks/dev-vnet/subnets/dev_worker2wnm --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=create'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1840D7C0>
args = ['aro', 'create', '-g', 'cli_test_aro_createvrz3wibj6', '-n', 'aroxwrlmg2b6nd', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1750C670>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1840D7C0>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_create>
resource_group = 'cli_test_aro_createvrz3wibj6'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_create', location='eastus')
    def test_aro_create(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        self.kwargs.update({
            'name': self.create_random_name('aro', 14),
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=create', checks=[
                self.check('tags.test', 'create'),
                self.check('name', '{name}'),
                self.check('masterProfile.subnetId', '{master_subnet_resource}'),
                self.check('workerProfiles[0].subnetId', '{worker_subnet_resource}'),
                self.check('provisioningState', 'Succeeded')
            ])

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F17DE3EB0>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F17DCB1C0>
resource_group_name = 'cli_test_aro_createvrz3wibj6'
resource_name = 'aroxwrlmg2b6nd'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_createvrz3wibj6/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_masterjv3z'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_createvrz3wibj6/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_worker2wnm'
vnet = None, vnet_resource_group_name = 'cli_test_aro_createvrz3wibj6'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None
tags = {'test': 'create'}, no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_createvrz3wibj6 --tag product=azurecli cause=automation date=2020-12-18T07:05:59Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_createvrz3wibj6 -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_createvrz3wibj6 --vnet-name dev-vnet -n dev_masterjv3z --address-prefixes 10.97.229.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_createvrz3wibj6 --vnet-name dev-vnet -n dev_worker2wnm --address-prefixes 10.35.111.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_createvrz3wibj6 --vnet-name dev-vnet -n dev_masterjv3z --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_createvrz3wibj6 --yes --no-wait" => 0. 

______________________ AroScenarioTests.test_aro_delete _______________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F12B745B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F17EF6E80>
command = 'aro create -g cli_test_aro_deletesl73ajej7 -n aromdjxxc2ji37 --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...virtualNetworks/dev-vnet/subnets/dev_workerf3jh --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=delete'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F17EF6E80>
args = ['aro', 'create', '-g', 'cli_test_aro_deletesl73ajej7', '-n', 'aromdjxxc2ji37', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F16E97DC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F17EF6E80>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_delete>
resource_group = 'cli_test_aro_deletesl73ajej7'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_delete', location='eastus')
    def test_aro_delete(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        self.kwargs.update({
            'name': self.create_random_name('aro', 14),
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=delete')

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:192: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F1805F070>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F16FDD100>
resource_group_name = 'cli_test_aro_deletesl73ajej7'
resource_name = 'aromdjxxc2ji37'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_deletesl73ajej7/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_master57s3'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_deletesl73ajej7/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_workerf3jh'
vnet = None, vnet_resource_group_name = 'cli_test_aro_deletesl73ajej7'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None
tags = {'test': 'delete'}, no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_deletesl73ajej7 --tag product=azurecli cause=automation date=2020-12-18T07:06:25Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_deletesl73ajej7 -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_deletesl73ajej7 --vnet-name dev-vnet -n dev_master57s3 --address-prefixes 10.60.221.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_deletesl73ajej7 --vnet-name dev-vnet -n dev_workerf3jh --address-prefixes 10.11.250.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_deletesl73ajej7 --vnet-name dev-vnet -n dev_master57s3 --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_deletesl73ajej7 --yes --no-wait" => 0. 

_______________________ AroScenarioTests.test_aro_list ________________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F187B4700>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F12BE3E50>
command = 'aro create -g cli_test_aro_listsr5nj5qqksy -n aroseyxwfcxnvh --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...k/virtualNetworks/dev-vnet/subnets/dev_workerixpy --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=list'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F12BE3E50>
args = ['aro', 'create', '-g', 'cli_test_aro_listsr5nj5qqksy', '-n', 'aroseyxwfcxnvh', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F18A38550>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F12BE3E50>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_list>
resource_group = 'cli_test_aro_listsr5nj5qqksy'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_list', location='eastus')
    def test_aro_list(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        self.kwargs.update({
            'name': self.create_random_name('aro', 14),
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=list')

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:156: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F1856E040>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F18A34880>
resource_group_name = 'cli_test_aro_listsr5nj5qqksy'
resource_name = 'aroseyxwfcxnvh'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_listsr5nj5qqksy/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_masteripoy'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_listsr5nj5qqksy/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_workerixpy'
vnet = None, vnet_resource_group_name = 'cli_test_aro_listsr5nj5qqksy'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None, tags = {'test': 'list'}
no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_listsr5nj5qqksy --tag product=azurecli cause=automation date=2020-12-18T07:06:52Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_listsr5nj5qqksy -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_listsr5nj5qqksy --vnet-name dev-vnet -n dev_masteripoy --address-prefixes 10.46.181.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_listsr5nj5qqksy --vnet-name dev-vnet -n dev_workerixpy --address-prefixes 10.25.165.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_listsr5nj5qqksy --vnet-name dev-vnet -n dev_masteripoy --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_listsr5nj5qqksy --yes --no-wait" => 0. 

_________________ AroScenarioTests.test_aro_list_credentials __________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F187058B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F17701040>
command = 'aro create -g cli_test_aro_list_credu3oqig -n arovynlsz3c5ue --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...tualNetworks/dev-vnet/subnets/dev_workerwcoz --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=list-cred'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F17701040>
args = ['aro', 'create', '-g', 'cli_test_aro_list_credu3oqig', '-n', 'arovynlsz3c5ue', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F14596F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F17701040>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_list_credentials>
resource_group = 'cli_test_aro_list_credu3oqig'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_list_cred', location='eastus')
    def test_aro_list_credentials(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        self.kwargs.update({
            'name': self.create_random_name('aro', 14),
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=list-cred')

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F18718760>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F15001040>
resource_group_name = 'cli_test_aro_list_credu3oqig'
resource_name = 'arovynlsz3c5ue'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_list_credu3oqig/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_masterr6x3'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_list_credu3oqig/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_workerwcoz'
vnet = None, vnet_resource_group_name = 'cli_test_aro_list_credu3oqig'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None
tags = {'test': 'list-cred'}, no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_list_credu3oqig --tag product=azurecli cause=automation date=2020-12-18T07:07:21Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_list_credu3oqig -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_list_credu3oqig --vnet-name dev-vnet -n dev_masterr6x3 --address-prefixes 10.93.26.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_list_credu3oqig --vnet-name dev-vnet -n dev_workerwcoz --address-prefixes 10.62.35.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_list_credu3oqig --vnet-name dev-vnet -n dev_masterr6x3 --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_list_credu3oqig --yes --no-wait" => 0. 

_______________________ AroScenarioTests.test_aro_show ________________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F17C1E670>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F175DFE80>
command = 'aro create -g cli_test_aro_show5i6jhhaaf7y -n aro7rlpztvthhs --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...k/virtualNetworks/dev-vnet/subnets/dev_workeriw5i --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=show'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F175DFE80>
args = ['aro', 'create', '-g', 'cli_test_aro_show5i6jhhaaf7y', '-n', 'aro7rlpztvthhs', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F17A08310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F175DFE80>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_show>
resource_group = 'cli_test_aro_show5i6jhhaaf7y'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_show', location='eastus')
    def test_aro_show(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        name = self.create_random_name('aro', 14)
        self.kwargs.update({
            'name': name,
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=show')

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F16F2D610>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F16F2D580>
resource_group_name = 'cli_test_aro_show5i6jhhaaf7y'
resource_name = 'aro7rlpztvthhs'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_show5i6jhhaaf7y/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_masterd5a7'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_show5i6jhhaaf7y/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_workeriw5i'
vnet = None, vnet_resource_group_name = 'cli_test_aro_show5i6jhhaaf7y'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None, tags = {'test': 'show'}
no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_show5i6jhhaaf7y --tag product=azurecli cause=automation date=2020-12-18T07:07:47Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_show5i6jhhaaf7y -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_show5i6jhhaaf7y --vnet-name dev-vnet -n dev_masterd5a7 --address-prefixes 10.12.246.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_show5i6jhhaaf7y --vnet-name dev-vnet -n dev_workeriw5i --address-prefixes 10.69.65.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_show5i6jhhaaf7y --vnet-name dev-vnet -n dev_masterd5a7 --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_show5i6jhhaaf7y --yes --no-wait" => 0. 

______________________ AroScenarioTests.test_aro_update _______________________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F167A92B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F175324C0>
command = 'aro create -g cli_test_aro_updatecw32nb3f7 -n aro2cet6e4praj --master-subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-8...virtualNetworks/dev-vnet/subnets/dev_worker45ot --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 --tags test=update'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F175324C0>
args = ['aro', 'create', '-g', 'cli_test_aro_updatecw32nb3f7', '-n', 'aro2cet6e4praj', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F18884940>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F175324C0>
ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception UnauthorizedError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.aro.tests.latest.test_aro_commands.AroScenarioTests testMethod=test_aro_update>
resource_group = 'cli_test_aro_updatecw32nb3f7'

    @AllowLargeResponse()
    @ResourceGroupPreparer(random_name_length=28, name_prefix='cli_test_aro_update', location='eastus')
    def test_aro_update(self, resource_group):
        from msrestazure.tools import resource_id
    
        subscription = self.get_subscription_id()
    
        master_subnet = self.create_random_name('dev_master', 14)
        worker_subnet = self.create_random_name('dev_worker', 14)
    
        self.kwargs.update({
            'name': self.create_random_name('aro', 14),
            'resource_group': resource_group,
            'subscription': subscription,
            'master_subnet': master_subnet,
            'worker_subnet': worker_subnet,
            'master_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'worker_ip_range': '10.{}.{}.0/24'.format(randint(0, 127), randint(0, 255)),
            'master_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=master_subnet),
            'worker_subnet_resource': resource_id(subscription=subscription, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name='dev-vnet', child_name_1=worker_subnet),
        })
    
        self.cmd('network vnet create -g {rg} -n dev-vnet --address-prefixes 10.0.0.0/9')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {master_subnet} --address-prefixes {master_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet create -g {rg} --vnet-name dev-vnet -n {worker_subnet} --address-prefixes {worker_ip_range} --service-endpoints Microsoft.ContainerRegistry')
        self.cmd('network vnet subnet update -g {rg} --vnet-name dev-vnet -n {master_subnet} --disable-private-link-service-network-policies true')
    
        with mock.patch('azure.cli.command_modules.aro._rbac._gen_uuid', side_effect=self.create_guid):
>           self.cmd('aro create -g {rg} -n {name} --master-subnet {master_subnet_resource} --worker-subnet {worker_subnet_resource} --subscription {subscription} --tags test=update')

src\azure-cli\azure\cli\command_modules\aro\tests\latest\test_aro_commands.py:224: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000020F16794DF0>
client = <azure.mgmt.redhatopenshift.v2020_04_30.operations._open_shift_clusters_operations.OpenShiftClustersOperations object at 0x0000020F16791FD0>
resource_group_name = 'cli_test_aro_updatecw32nb3f7'
resource_name = 'aro2cet6e4praj'
master_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_updatecw32nb3f7/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_mastereo6z'
worker_subnet = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_aro_updatecw32nb3f7/providers/Microsoft.Network/virtualNetworks/dev-vnet/subnets/dev_worker45ot'
vnet = None, vnet_resource_group_name = 'cli_test_aro_updatecw32nb3f7'
location = 'eastus', pull_secret = None, domain = None
cluster_resource_group = None, client_id = None, client_secret = None
pod_cidr = None, service_cidr = None, master_vm_size = None
worker_vm_size = None, worker_vm_disk_size_gb = None, worker_count = None
apiserver_visibility = None, ingress_visibility = None
tags = {'test': 'update'}, no_wait = False

    def aro_create(cmd,  # pylint: disable=too-many-locals
                   client,
                   resource_group_name,
                   resource_name,
                   master_subnet,
                   worker_subnet,
                   vnet=None,
                   vnet_resource_group_name=None,  # pylint: disable=unused-argument
                   location=None,
                   pull_secret=None,
                   domain=None,
                   cluster_resource_group=None,
                   client_id=None,
                   client_secret=None,
                   pod_cidr=None,
                   service_cidr=None,
                   master_vm_size=None,
                   worker_vm_size=None,
                   worker_vm_disk_size_gb=None,
                   worker_count=None,
                   apiserver_visibility=None,
                   ingress_visibility=None,
                   tags=None,
                   no_wait=False):
    
        resource_client = get_mgmt_service_client(
            cmd.cli_ctx, ResourceType.MGMT_RESOURCE_RESOURCES)
        provider = resource_client.providers.get('Microsoft.RedHatOpenShift')
        if provider.registration_state != 'Registered':
>           raise UnauthorizedError('Microsoft.RedHatOpenShift provider is not registered.',
                                    'Run `az provider register -n Microsoft.RedHatOpenShift --wait`.')
E           azure.cli.core.azclierror.UnauthorizedError: Microsoft.RedHatOpenShift provider is not registered.

src\azure-cli\azure\cli\command_modules\aro\custom.py:61: UnauthorizedError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_aro_updatecw32nb3f7 --tag product=azurecli cause=automation date=2020-12-18T07:08:14Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -g cli_test_aro_updatecw32nb3f7 -n dev-vnet --address-prefixes 10.0.0.0/9" => 0. 

Command "network vnet subnet create -g cli_test_aro_updatecw32nb3f7 --vnet-name dev-vnet -n dev_mastereo6z --address-prefixes 10.44.237.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet create -g cli_test_aro_updatecw32nb3f7 --vnet-name dev-vnet -n dev_worker45ot --address-prefixes 10.54.174.0/24 --service-endpoints Microsoft.ContainerRegistry" => 0. 

Command "network vnet subnet update -g cli_test_aro_updatecw32nb3f7 --vnet-name dev-vnet -n dev_mastereo6z --disable-private-link-service-network-policies true" => 0. 

No --pull-secret provided: cluster will not include samples or operators from Red Hat or from certified partners.
Command "az group delete --name cli_test_aro_updatecw32nb3f7 --yes --no-wait" => 0. 

____________ FunctionAppServicePlan.test_functionapp_elastic_plan _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.appservice.tests.latest.test_webapp_commands.FunctionAppServicePlan testMethod=test_functionapp_elastic_plan>
resource_group = 'clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo'

    @ResourceGroupPreparer(location=WINDOWS_ASP_LOCATION_FUNCTIONAPP)
    def test_functionapp_elastic_plan(self, resource_group):
        plan = self.create_random_name(prefix='funcappplan', length=24)
        self.cmd('functionapp plan create -g {} -n {} --sku EP1 --min-instances 4 --max-burst 12' .format(resource_group, plan), checks=[
            JMESPathCheck('maximumElasticWorkerCount', 12),
            JMESPathCheck('sku.name', 'EP1'),
            JMESPathCheck('sku.capacity', 4)
        ])
>       self.cmd('functionapp plan update -g {} -n {} --min-instances 5 --max-burst 11' .format(resource_group, plan), checks=[
            JMESPathCheck('maximumElasticWorkerCount', 11),
            JMESPathCheck('sku.name', 'EP1'),
            JMESPathCheck('sku.capacity', 5)
        ])

src\azure-cli\azure\cli\command_modules\appservice\tests\latest\test_webapp_commands.py:2029: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x0000019C766BC7C0>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C766BA2E0>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'sku.capacity' doesn't yield expected value '5', instead the actual value is '1'. Data: 
E               {
E                 "freeOfferExpirationTime": null,
E                 "geoRegion": "France Central",
E                 "hostingEnvironmentProfile": null,
E                 "hyperV": false,
E                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo/providers/Microsoft.Web/serverfarms/funcappplandwctcvhdils4n",
E                 "isSpot": false,
E                 "isXenon": false,
E                 "kind": "elastic",
E                 "location": "France Central",
E                 "maximumElasticWorkerCount": 11,
E                 "maximumNumberOfWorkers": 20,
E                 "name": "funcappplandwctcvhdils4n",
E                 "numberOfSites": 0,
E                 "perSiteScaling": false,
E                 "provisioningState": "Succeeded",
E                 "reserved": false,
E                 "resourceGroup": "clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo",
E                 "sku": {
E                   "capabilities": null,
E                   "capacity": 1,
E                   "family": "EP",
E                   "locations": null,
E                   "name": "EP1",
E                   "size": "EP1",
E                   "skuCapacity": null,
E                   "tier": "ElasticPremium"
E                 },
E                 "spotExpirationTime": null,
E                 "status": "Ready",
E                 "subscription": "a1bfa635-f2bf-42f1-86b5-848c674fc321",
E                 "tags": null,
E                 "targetWorkerCount": 0,
E                 "targetWorkerSizeId": 0,
E                 "type": "Microsoft.Web/serverfarms",
E                 "workerTierName": null
E               }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location francecentral --name clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo --tag product=azurecli cause=automation date=2020-12-18T07:14:12Z" => 0. 

Command "functionapp plan create -g clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo -n funcappplandwctcvhdils4n --sku EP1 --min-instances 4 --max-burst 12" => 0. 

Command "functionapp plan update -g clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo -n funcappplandwctcvhdils4n --min-instances 5 --max-burst 11" => 0. 

Command "az group delete --name clitest.rg4xtymlb5dttkslu3bwsqoqiyipkkgioymd4uare636wiu7qmj35zw4jymjm25t2vo --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.web.v2019_08_01.models._models_py3.AppServicePlan'>
__________ TestMonitorAutoscaleScenario.test_monitor_autoscale_basic __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C937F13340>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C937E95FD0>
command = 'vmss create -g cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay -n vmss1 --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937E95FD0>
args = ['vmss', 'create', '-g', 'cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C937FF1C10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937E95FD0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_autoscale.TestMonitorAutoscaleScenario testMethod=test_monitor_autoscale_basic>
resource_group = 'cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_autoscale')
    def test_monitor_autoscale_basic(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_autoscale.py:17: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay --tag product=azurecli cause=automation date=2020-12-18T07:39:22Z" => 0. 

Command "az group delete --name cli_test_monitor_autoscale24j7e4no64xiig6m2zopeftpl6haidnuo2tlrixp2vpd4siay --yes --no-wait" => 0. 

__________ TestMonitorAutoscaleScenario.test_monitor_autoscale_fixed __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C936A63160>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C930A96F10>
command = 'vmss create -g cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7 -n vmss1 --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C930A96F10>
args = ['vmss', 'create', '-g', 'cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C937E220D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C930A96F10>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_autoscale.TestMonitorAutoscaleScenario testMethod=test_monitor_autoscale_fixed>
resource_group = 'cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_autoscale_fixed')
    def test_monitor_autoscale_fixed(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'sched': 'Christmas'
        })
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_autoscale.py:224: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7 --tag product=azurecli cause=automation date=2020-12-18T07:39:30Z" => 0. 

Command "az group delete --name cli_test_monitor_autoscale_fixed6joznwq2bn64nd7cqj2qzuz5kydtoozxuihxvhvyoh7 --yes --no-wait" => 0. 

________ TestMonitorAutoscaleScenario.test_monitor_autoscale_recurring ________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C936C76F70>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9370923D0>
command = 'vmss create -g cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh -n vmss1 --image UbuntuLTS --admin-username testname --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9370923D0>
args = ['vmss', 'create', '-g', 'cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C937E9F9D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9370923D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_autoscale.TestMonitorAutoscaleScenario testMethod=test_monitor_autoscale_recurring>
resource_group = 'cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_autoscale_recurring')
    def test_monitor_autoscale_recurring(self, resource_group):
        import json
        import time
    
        sleep_time = 3
    
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username testname --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_autoscale.py:255: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh --tag product=azurecli cause=automation date=2020-12-18T07:39:36Z" => 0. 

Command "az group delete --name cli_test_monitor_autoscale_recurringmjtfy7ypttmmaf43elye2iy4nbbbg6m7m2jo4hh --yes --no-wait" => 0. 

__ TestMonitorAutoscaleScenario.test_monitor_autoscale_rule_with_dimensions ___
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9348F9760>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C937788DC0>
command = 'vmss create -g cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki -n vmss1 --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$ --instance-count 2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937788DC0>
args = ['vmss', 'create', '-g', 'cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C935C06A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937788DC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_autoscale.TestMonitorAutoscaleScenario testMethod=test_monitor_autoscale_rule_with_dimensions>
resource_group = 'cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_autoscale_rule_with_dimensions')
    def test_monitor_autoscale_rule_with_dimensions(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd(
            'vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$ --instance-count 2')

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_autoscale.py:143: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki --tag product=azurecli cause=automation date=2020-12-18T07:39:43Z" => 0. 

Command "az group delete --name cli_test_monitor_autoscale_rule_with_dimensionsvncvujdxmuogxnemoep4gjs6puki --yes --no-wait" => 0. 

__________ TestMonitorAutoscaleScenario.test_monitor_autoscale_rules __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9375CA070>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9368D0280>
command = 'vmss create -g cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn -n vmss1 --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9368D0280>
args = ['vmss', 'create', '-g', 'cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C934AC7CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9368D0280>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_autoscale.TestMonitorAutoscaleScenario testMethod=test_monitor_autoscale_rules>
resource_group = 'cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_autoscale_rules')
    def test_monitor_autoscale_rules(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username testadmin --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_autoscale.py:52: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn --tag product=azurecli cause=automation date=2020-12-18T07:39:49Z" => 0. 

Command "az group delete --name cli_test_monitor_autoscale_rulesdwewfhhdbgnt23fzusqlr2tdopnjjpfzz3jrupx3ycn --yes --no-wait" => 0. 

___________ DeploymentManagerTests.test_deploymentmanager_scenario ____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381906EBE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023818970C40>
command = 'deploymentmanager service-unit create -g cliadmhm3gdz --service-topology-name cliadmhm3gdzServiceTopology --service-n...dmhm3gdz --deployment-mode Incremental --parameters-path storage.parameters.json --template-path storage.template.json'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818970C40>
args = ['deploymentmanager', 'service-unit', 'create', '-g', 'cliadmhm3gdz', '--service-topology-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238190718B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818970C40>
ex = CLIError('Deployment failed. Correlation ID: 8a0966ab-49fc-4fae-b6d8-e3ff173aee17. Operation failed with status: "Unknown Operation \'0918efb6-221d-4423-bf40-de9da16f9a8c\'.". Details: ""')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 8a0966ab-49fc-4fae-b6d8-e3ff173aee17. Operation failed with status: "Unknown Operation \'0918efb6-221d-4423-bf40-de9da16f9a8c\'.". Details: ""')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.deploymentmanager.tests.latest.test_deploymentmanager_scenario.DeploymentManagerTests testMethod=test_deploymentmanager_scenario>
resource_group = 'cliadmhm3gdz', storage_account = 'cliadmadea6dgpvtni6xfvn3'

    @ResourceGroupPreparer(name_prefix=name_prefix, random_name_length=12, location=resource_location)
    @StorageAccountPreparer(name_prefix=name_prefix, location=resource_location)
    @AllowLargeResponse()
    def test_deploymentmanager_scenario(self, resource_group, storage_account):
    
        subscription_id = self.get_subscription_id()
        artifact_source_name = resource_group + "ArtifactSource"
        updated_artifact_source_name = resource_group + "ArtifactSourceUpdated"
        location = resource_location
    
        self.assertFalse(location is None)
    
        self.set_managed_identity(subscription_id, resource_group)
    
        artifact_source_id = self.new_artifact_source(
            resource_group,
            storage_account,
            artifact_source_name,
            location,
            True)
    
>       self.service_topology_validations(
            subscription_id,
            resource_group,
            location,
            artifact_source_id,
            updated_artifact_source_name,
            storage_account)

src\azure-cli\azure\cli\command_modules\deploymentmanager\tests\latest\test_deploymentmanager_scenario.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\deploymentmanager\tests\latest\test_deploymentmanager_scenario.py:108: in service_topology_validations
    self.services_validations(
src\azure-cli\azure\cli\command_modules\deploymentmanager\tests\latest\test_deploymentmanager_scenario.py:198: in services_validations
    self.service_units_validations(
src\azure-cli\azure\cli\command_modules\deploymentmanager\tests\latest\test_deploymentmanager_scenario.py:268: in service_units_validations
    self.cmd('deploymentmanager service-unit create -g {rg} --service-topology-name {st_name} --service-name {s_name} -n {su_name} -l \"{location}\" --target-resource-group {rg} --deployment-mode {d_mode} --parameters-path {p_path} --template-path {t_path}', checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Operation failed with status: "Unknown Operation \'0918efb6-221d-4423-bf40-de9da16f9a8c\'.". Details: ""')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 8a0966ab-49fc-4fae-b6d8-e3ff173aee17. Operation failed with status: "Unknown Operation '0918efb6-221d-4423-bf40-de9da16f9a8c'.". Details: ""

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location centralus --name cliadmhm3gdz --tag product=azurecli cause=automation date=2020-12-18T07:46:56Z" => 0. 

Command "az storage account create -n cliadmadea6dgpvtni6xfvn3 -g cliadmhm3gdz -l centralus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n cliadmadea6dgpvtni6xfvn3 -g cliadmhm3gdz --query "[0].value" -otsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -n cliadmhm3gdzIdentity -g cliadmhm3gdz" => 0. 

Command "role assignment create --assignee 7640fece-05d4-44e3-aed7-05a879a174bf --role Contributor --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321" => 0. 

Command "storage account keys list -n cliadmadea6dgpvtni6xfvn3 -g cliadmhm3gdz --query "[0].value" -otsv" => 0. 

Command "storage container create -n artifacts --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

Alive[################################################################]  100.0000%Finished[#############################################################]  100.0000%
Command "storage blob upload -c artifacts -n artifactroot/storage.parameters.json -f "C:\\Users\\daetienn\\Desktop\\azure-cli\\src\\azure-cli\\azure\\cli\\command_modules\\deploymentmanager\\tests\\latest\\artifactroot\\storage.parameters.json" -t block --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

Alive[################################################################]  100.0000%Finished[#############################################################]  100.0000%
Command "storage blob upload -c artifacts -n artifactroot/storage.copy.parameters.json -f "C:\\Users\\daetienn\\Desktop\\azure-cli\\src\\azure-cli\\azure\\cli\\command_modules\\deploymentmanager\\tests\\latest\\artifactroot\\storage.copy.parameters.json" -t block --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

Alive[################################################################]  100.0000%Finished[#############################################################]  100.0000%
Command "storage blob upload -c artifacts -n artifactroot/storage.template.json -f "C:\\Users\\daetienn\\Desktop\\azure-cli\\src\\azure-cli\\azure\\cli\\command_modules\\deploymentmanager\\tests\\latest\\artifactroot\\storage.template.json" -t block --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

Alive[################################################################]  100.0000%Finished[#############################################################]  100.0000%
Command "storage blob upload -c artifacts -n artifactroot/storage.copy.template.json -f "C:\\Users\\daetienn\\Desktop\\azure-cli\\src\\azure-cli\\azure\\cli\\command_modules\\deploymentmanager\\tests\\latest\\artifactroot\\storage.copy.template.json" -t block --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

Alive[################################################################]  100.0000%Finished[#############################################################]  100.0000%
Command "storage blob upload -c artifacts -n artifactroot/storage_invalid.parameters.json -f "C:\\Users\\daetienn\\Desktop\\azure-cli\\src\\azure-cli\\azure\\cli\\command_modules\\deploymentmanager\\tests\\latest\\artifactroot\\storage_invalid.parameters.json" -t block --account-name cliadmadea6dgpvtni6xfvn3 --account-key YgQdQN4157lPECxY5WV/UQ/Cm6ofwsSOmBjmLfhFk1JRm2QgFj1KyTd64Y2/mBmLTqCupTt1R9bf7U49St6M1g==
" => 0. 

There are no credentials provided in your command and environment, we will query for the account key inside your storage account. 
Please provide --connection-string, --account-key or --sas-token as credentials, or use `--auth-mode login` if you have required RBAC roles in your command. For more information about RBAC roles in storage, visit https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad-rbac-cli. 
Setting the corresponding environment variables can avoid inputting credentials in your command. Please use --help to get more information.
Command "storage container generate-sas -n artifacts --account-name cliadmadea6dgpvtni6xfvn3 --permissions rl --start 2020-12-18T06:49Z --expiry 2020-12-18T17:49Z -otsv" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "deploymentmanager artifact-source create -g cliadmhm3gdz -n cliadmhm3gdzArtifactSource -l "centralus" --sas-uri "https://cliadmadea6dgpvtni6xfvn3.blob.core.windows.net/artifacts?st=2020-12-18T06%3A49Z&se=2020-12-18T17%3A49Z&sp=rl&sv=2018-11-09&sr=c&sig=g3W%2BrNZWYcR%2BZjwBabOVX44noPowNc4W0nsvPM6IRds%3D" --artifact-root artifactroot" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "deploymentmanager artifact-source show -g cliadmhm3gdz -n cliadmhm3gdzArtifactSource" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "deploymentmanager service-topology create -g cliadmhm3gdz -n cliadmhm3gdzServiceTopology -l "centralus" --artifact-source /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/cliadmhm3gdz/providers/Microsoft.DeploymentManager/artifactSources/cliadmhm3gdzArtifactSource" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "deploymentmanager service-topology show -g cliadmhm3gdz -n cliadmhm3gdzServiceTopology" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "deploymentmanager service create -g cliadmhm3gdz --service-topology-name cliadmhm3gdzServiceTopology -n cliadmhm3gdzService -l "centralus" --target-location "centralus" --target-subscription-id a1bfa635-f2bf-42f1-86b5-848c674fc321" => 0. 

Command group 'deploymentmanager' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cliadmhm3gdz --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrestazure.tools:tools.py:92 Resource provider 'Microsoft.DeploymentManager' used by this operation is not registered. We are registering for you.
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrestazure.tools:tools.py:103 Registration succeeded.
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_________________ EHNamespaceCURDScenarioTest.test_eh_cluster _________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023819171FA0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238193ACFD0>
command = 'eventhubs cluster create --resource-group rgehcluster-cli-test --name eventhubs-clus1-sjlx --location southcentralus --tags tag1=value1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238193ACFD0>
args = ['eventhubs', 'cluster', 'create', '--resource-group', 'rgehcluster-cli-test', '--name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238190D4F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238193ACFD0>
ex = ErrorResponseException("Operation returned an invalid status code 'Bad Request'")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ErrorResponseException("Operation returned an invalid status code 'Bad Request'")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ErrorResponseException during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.eventhubs.tests.latest.test_cluster_commands.EHNamespaceCURDScenarioTest testMethod=test_eh_cluster>

    @AllowLargeResponse()
    def test_eh_cluster(self):
        self.kwargs.update({
            'loc': 'southcentralus',
            'rg': 'rgehcluster-cli-test',
            'clustername': self.create_random_name(prefix='eventhubs-clus1-', length=20),
            'namespacename': self.create_random_name(prefix='eventhubs-nscli', length=20),
            'tags': {'tag1=value1'},
            'tags2': {'tag2=value2'},
            'capacity': 1,
            'sku': 'Standard',
            'tier': 'Standard'
        })
    
        # create Resource group
        self.cmd('az group create --resource-group {rg} --location {loc}')
    
        # Create Cluster
>       self.cmd('eventhubs cluster create --resource-group {rg} --name {clustername} --location {loc} --tags tag1=value1',
                 checks=[self.check('name', self.kwargs['clustername'])])

src\azure-cli\azure\cli\command_modules\eventhubs\tests\latest\test_cluster_commands.py:38: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\eventhubs\custom.py:118: in cli_cluster_create
    cluster_result = client.create_or_update(
env\lib\site-packages\azure\mgmt\eventhub\v2018_01_01_preview\operations\_clusters_operations.py:306: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.eventhub.v2018_01_01_preview.operations._clusters_operations.ClustersOperations object at 0x0000023819488E20>
resource_group_name = 'rgehcluster-cli-test'
cluster_name = 'eventhubs-clus1-sjlx'
parameters = <azure.mgmt.eventhub.v2018_01_01_preview.models._models_py3.Cluster object at 0x0000023819488970>
custom_headers = None, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/rgehcluster-cli-test/providers/Microsoft.EventHub/clusters/eventhubs-clus1-sjlx'
path_format_arguments = {'clusterName': 'eventhubs-clus1-sjlx', 'resourceGroupName': 'rgehcluster-cli-test', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2018-01-01-preview'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'southcentralus', 'sku': {'capacity': 1, 'name': 'Dedicated'}, 'tags': {'tag1': 'value1'}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, cluster_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1),
            'clusterName': self._serialize.url("cluster_name", cluster_name, 'str', max_length=50, min_length=6)
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'Cluster')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201, 202]:
>           raise models.ErrorResponseException(self._deserialize, response)
E           azure.mgmt.eventhub.v2018_01_01_preview.models._models_py3.ErrorResponseException: Operation returned an invalid status code 'Bad Request'

env\lib\site-packages\azure\mgmt\eventhub\v2018_01_01_preview\operations\_clusters_operations.py:264: ErrorResponseException
---------------------------- Captured stderr call -----------------------------
Command "az group create --resource-group rgehcluster-cli-test --location southcentralus" => 0. 

___________ EHNamespaceBYOKCURDScenarioTest.test_eh_namespace_byok ____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238191E3A30>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238195F1AC0>
command = 'eventhubs namespace create --resource-group cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqv...075374f62b6e/resourceGroups/prod-by3-533-rg/providers/Microsoft.EventHub/clusters/PMTestCluster --assign-identity True'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238195F1AC0>
args = ['eventhubs', 'namespace', 'create', '--resource-group', 'cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz', '--name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238191E0CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238195F1AC0>
ex = ErrorResponseException("Operation returned an invalid status code 'Forbidden'")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ErrorResponseException("Operation returned an invalid status code 'Forbidden'")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ErrorResponseException during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.eventhubs.tests.latest.test_eventhub_commands_namespace_byok_test.EHNamespaceBYOKCURDScenarioTest testMethod=test_eh_namespace_byok>
resource_group = 'cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz'

    @AllowLargeResponse()
    @ResourceGroupPreparer(name_prefix='cli_test_eh_namespace')
    def test_eh_namespace_byok(self, resource_group):
        self.kwargs.update({
            'loc': 'westus',
            'rg': resource_group,
            'namespacename': self.create_random_name(prefix='eventhubs-nscli', length=20),
            'namespacename1': self.create_random_name(prefix='eventhubs-nscli', length=20),
            'namespacename2': self.create_random_name(prefix='eventhubs-nscli', length=20),
            'namespacenamekafka': self.create_random_name(prefix='eventhubs-nscli1', length=20),
            'tags': {'tag1=value1'},
            'tags2': {'tag2=value2'},
            'sku': 'Standard',
            'tier': 'Standard',
            'clusterarmid': '/subscriptions/326100e2-f69d-4268-8503-075374f62b6e/resourceGroups/prod-by3-533-rg/providers/Microsoft.EventHub/clusters/PMTestCluster',
            'authoname': self.create_random_name(prefix='cliAutho', length=20),
            'defaultauthorizationrule': 'RootManageSharedAccessKey',
            'accessrights': 'Send',
            'accessrights1': 'Listen',
            'primary': 'PrimaryKey',
            'secondary': 'SecondaryKey',
            'isautoinflateenabled': 'True',
            'enableidentity': 'True',
            'maximumthroughputunits': 4,
            'maximumthroughputunits_update': 5
    
        })
    
        kv_name = self.create_random_name(prefix='cli', length=15)
        key_name = self.create_random_name(prefix='cli', length=15)
        key_uri = "https://{}.vault.azure.net/".format(kv_name)
        self.kwargs.update({
            'kv_name': kv_name,
            'key_name': key_name,
            'key_uri': key_uri
        })
    
        # Check for the NameSpace name Availability
        self.cmd('eventhubs namespace exists --name {namespacename}', checks=[self.check('nameAvailable', True)])
    
        # Create Namespace
>       self.cmd('eventhubs namespace create --resource-group {rg} --name {namespacename} --location {loc} --tags {tags} --sku {sku} --enable-auto-inflate {isautoinflateenabled} --maximum-throughput-units {maximumthroughputunits} --cluster-arm-id {clusterarmid} --assign-identity {enableidentity}')

src\azure-cli\azure\cli\command_modules\eventhubs\tests\latest\test_eventhub_commands_namespace_byok_test.py:61: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\eventhubs\custom.py:35: in cli_namespace_create
    client.create_or_update(
env\lib\site-packages\azure\mgmt\eventhub\v2018_01_01_preview\operations\_namespaces_operations.py:530: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.eventhub.v2018_01_01_preview.operations._namespaces_operations.NamespacesOperations object at 0x000002381927EA60>
resource_group_name = 'cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz'
namespace_name = 'eventhubs-nscliqlmaz'
parameters = <azure.mgmt.eventhub.v2018_01_01_preview.models._models_py3.EHNamespace object at 0x00000238189F14F0>
custom_headers = None, raw = True, operation_config = {}
api_version = '2018-01-01-preview'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz/providers/Microsoft.EventHub/namespaces/eventhubs-nscliqlmaz'
path_format_arguments = {'namespaceName': 'eventhubs-nscliqlmaz', 'resourceGroupName': 'cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2018-01-01-preview'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'identity': {'type': 'SystemAssigned'}, 'location': 'westus', 'properties': {'clusterArmId': '/subscriptions/326100e2...ter', 'isAutoInflateEnabled': True, 'maximumThroughputUnits': 4}, 'sku': {'name': 'Standard', 'tier': 'Standard'}, ...}
request = <ClientRequest [PUT]>

    def _create_or_update_initial(
            self, resource_group_name, namespace_name, parameters, custom_headers=None, raw=False, **operation_config):
        api_version = "2018-01-01-preview"
    
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1),
            'namespaceName': self._serialize.url("namespace_name", namespace_name, 'str', max_length=50, min_length=6),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'EHNamespace')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201, 202]:
>           raise models.ErrorResponseException(self._deserialize, response)
E           azure.mgmt.eventhub.v2018_01_01_preview.models._models_py3.ErrorResponseException: Operation returned an invalid status code 'Forbidden'

env\lib\site-packages\azure\mgmt\eventhub\v2018_01_01_preview\operations\_namespaces_operations.py:488: ErrorResponseException
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz --tag product=azurecli cause=automation date=2020-12-18T07:51:17Z" => 0. 

Command "eventhubs namespace exists --name eventhubs-nscliqlmaz" => 0. 

Argument '--cluster-arm-id' is in preview. It may be changed/removed in a future release.
Argument '--assign-identity' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_eh_namespacedyemmgvie76rk57lepapjldkn33jsdz332fvfvafalflmq4oadqvnz --yes --no-wait" => 0. 

__ TestLogProfileScenarios.test_monitor_log_analytics_workspace_data_export ___
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93716C670>
ex = DataExportErrorResponseException("Operation returned an invalid status code 'Bad Request'")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = DataExportErrorResponseException("Operation returned an invalid status code 'Bad Request'")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception DataExportErrorResponseException during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "c:\users\daetienn\desktop\azure-cli\src\azure-cli-testsdk\azure\cli\testsdk\base.py", line 289, in _in_process_execute
    self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0
  File "C:\Users\daetienn\Desktop\azure-cli\env\lib\site-packages\knack\cli.py", line 226, in invoke
    exit_code = self.exception_handler(ex)
  File "c:\users\daetienn\desktop\azure-cli\src\azure-cli-core\azure\cli\core\__init__.py", line 119, in exception_handler
    return handle_exception(ex)
  File "c:\users\daetienn\desktop\azure-cli\src\azure-cli-testsdk\azure\cli\testsdk\patches.py", line 35, in _handle_main_exception
    raise CliExecutionError(ex)
azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception DataExportErrorResponseException during execution and fails the command.

During handling of the above exception, another exception occurred:

azure.mgmt.loganalytics.models._models_py3.DataExportErrorResponseException: You have exceeded the number of allowed export rules in your workspace, or a table was defined in export to StorageAccount already. Two export rules are allowed per workspace  one to each destination and tables can be exported once to each destination. See http://aka.ms/LADataExport

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_log_analytics_workspace.TestLogProfileScenarios testMethod=test_monitor_log_analytics_workspace_data_export>
resource_group = 'cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht'
account_1 = 'saws1mbkghyqwecpm6z4ibqo'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_workspace_data_export', location='eastus')
    @StorageAccountPreparer(name_prefix='saws1', kind='StorageV2', sku='Standard_LRS', parameter_name='account_1',
                            location='eastus')
    def test_monitor_log_analytics_workspace_data_export(self, resource_group, account_1):
        from msrestazure.tools import resource_id
        self.kwargs.update({
            'workspace_name': self.create_random_name('clitest', 20),
            'data_export_name': 'clitest',
            'data_export_name_2': 'clitest2',
            'sa_1': account_1,
            'sa_id_1': resource_id(
                resource_group=resource_group,
                subscription=self.get_subscription_id(),
                name=account_1,
                namespace='Microsoft.Storage',
                type='storageAccounts'),
            'namespacename': self.create_random_name(prefix='eventhubs-nscli', length=20),
            'eventhubname': "hub_name",
            'rg': resource_group
        })
    
        self.cmd(
            "monitor log-analytics workspace create -g {rg} -n {workspace_name} --quota 1 --level 100 --sku CapacityReservation",
            checks=[
                self.check('provisioningState', 'Succeeded'),
                self.check('retentionInDays', 30),
                self.check('sku.name', 'capacityreservation'),
                self.check('sku.capacityReservationLevel', 100),
                self.check('workspaceCapping.dailyQuotaGb', 1.0)
            ])
        self.kwargs.update({
            'table_name': 'Syslog'
        })
    
        self.cmd('monitor log-analytics workspace data-export create -g {rg} --workspace-name {workspace_name} -n {data_export_name} '
                 '--destination {sa_id_1} --enable -t {table_name}',
                 checks=[
                 ])
        with self.assertRaisesRegexp(HttpOperationError, 'Table SecurityEvent Heartbeat does not exist in the workspace'):
            self.cmd('monitor log-analytics workspace data-export create -g {rg} --workspace-name {workspace_name} -n {data_export_name_2} '
                     '--destination {sa_id_1} --enable -t "SecurityEvent Heartbeat"',
                     checks=[
                     ])
        with self.assertRaisesRegexp(HttpOperationError, 'You have exceeded the allowed export rules for the provided table'):
>           self.cmd('monitor log-analytics workspace data-export create -g {rg} --workspace-name {workspace_name} -n {data_export_name_2} '
                     '--destination {sa_id_1} --enable -t {table_name}',
                     checks=[
                     ])
E           AssertionError: "You have exceeded the allowed export rules for the provided table" does not match "You have exceeded the number of allowed export rules in your workspace, or a table was defined in export to StorageAccount already. Two export rules are allowed per workspace  one to each destination and tables can be exported once to each destination. See http://aka.ms/LADataExport"

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_log_analytics_workspace.py:423: AssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht --tag product=azurecli cause=automation date=2020-12-18T07:55:26Z" => 0. 

Command "az storage account create -n saws1mbkghyqwecpm6z4ibqo -g cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht -l eastus --sku Standard_LRS --kind StorageV2 --https-only " => 0. 

Command "storage account keys list -n saws1mbkghyqwecpm6z4ibqo -g cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht --query "[0].value" -otsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "monitor log-analytics workspace create -g cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht -n clitestwauivtobrrswm --quota 1 --level 100 --sku CapacityReservation" => 0. 

Command "monitor log-analytics workspace data-export create -g cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht --workspace-name clitestwauivtobrrswm -n clitest --destination /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht/providers/Microsoft.Storage/storageAccounts/saws1mbkghyqwecpm6z4ibqo --enable -t Syslog" => 0. 

Command "az group delete --name cli_test_monitor_workspace_data_exportdzbiyso6pszuwhn6uuezd3pfasihjrcytcaht --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute data_export_type will be ignored in class <class 'azure.mgmt.loganalytics.models._models_py3.DataExport'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute data_export_type will be ignored in class <class 'azure.mgmt.loganalytics.models._models_py3.DataExport'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute data_export_type will be ignored in class <class 'azure.mgmt.loganalytics.models._models_py3.DataExport'>
____ TestLogProfileScenarios.test_monitor_log_analytics_workspace_recover _____
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.monitor.tests.latest.test_monitor_log_analytics_workspace.TestLogProfileScenarios testMethod=test_monitor_log_analytics_workspace_recover>
resource_group = 'cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6'

    @ResourceGroupPreparer(name_prefix='cli_test_monitor_workspace_recover', location='westus')
    @AllowLargeResponse()
    def test_monitor_log_analytics_workspace_recover(self, resource_group):
        workspace_name = self.create_random_name('clitest', 20)
        self.kwargs.update({
            'name': workspace_name
        })
    
        self.cmd("monitor log-analytics workspace create -g {rg} -n {name} --quota 1 --level 100 --sku CapacityReservation", checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('retentionInDays', 30),
            self.check('sku.name', 'capacityreservation'),
            self.check('sku.capacityReservationLevel', 100),
            self.check('workspaceCapping.dailyQuotaGb', 1.0)
        ])
    
        self.cmd("monitor log-analytics workspace update -g {rg} -n {name} --quota 2 --level 200", checks=[
            self.check('provisioningState', 'Succeeded'),
            self.check('sku.capacityReservationLevel', 200),
            self.check('workspaceCapping.dailyQuotaGb', 2.0)
        ])
    
        self.cmd("monitor log-analytics workspace table list -g {rg} --workspace-name {name}", checks=[
            # self.check('length(@)', 0)
        ])
    
        self.kwargs.update({
            'table_name': 'Syslog'
        })
>       self.cmd("monitor log-analytics workspace table update -g {rg} --workspace-name {name} -n {table_name} --retention-time 30 --debug", checks=[
            self.check('retentionInDays', 30)
        ])

src\azure-cli\azure\cli\command_modules\monitor\tests\latest\test_monitor_log_analytics_workspace.py:277: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x000001C936F30B50>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9374ECDF0>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
                raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
>           raise JMESPathCheckAssertionError(self._query, self._expected_result, 'None',
                                              execution_result.output)
E           azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'retentionInDays' doesn't yield expected value '30', instead the actual value is 'None'. Data: 
E           {
E             "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6/providers/microsoft.operationalinsights/workspaces/clitestu65vquwtn5se3/tables/syslog",
E             "name": "Syslog",
E             "resourceGroup": "cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6",
E             "retentionInDays": null,
E             "type": null
E           }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:36: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 --tag product=azurecli cause=automation date=2020-12-18T08:01:23Z" => 0. 

Command "monitor log-analytics workspace create -g cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 -n clitestu65vquwtn5se3 --quota 1 --level 100 --sku CapacityReservation" => 0. 

Command "monitor log-analytics workspace update -g cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 -n clitestu65vquwtn5se3 --quota 2 --level 200" => 0. 

Command "monitor log-analytics workspace table list -g cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 --workspace-name clitestu65vquwtn5se3" => 0. 

Command "monitor log-analytics workspace table update -g cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 --workspace-name clitestu65vquwtn5se3 -n Syslog --retention-time 30 --debug" => 0. 

Command "az group delete --name cli_test_monitor_workspace_recover2kz6v323gmwhlptv36s4xk2d36pzgktjb6aej6mk6 --yes --no-wait" => 0. 

___________ MonitorTests.test_dynamic_metric_alert_multiple_scopes ____________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93967B370>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C929EA4310>
command = 'vm create -n clitest-vmlzmdi -g cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv --image W...ssword %j^VYw9Q3Z@Cu$*h --tags MabUsed=Yes Owner=sisi Purpose=CLITest DeleteBy=12-2099 AutoShutdown=No --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EA4310>
args = ['vm', 'create', '-n', 'clitest-vmlzmdi', '-g', 'cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C939B7DEE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EA4310>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:50: in _preparer_wrapper
    fn(test_class_instance, **kwargs)
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:39: in _preparer_wrapper
    parameter_update = self.create_resource(
src\azure-cli\azure\cli\command_modules\backup\tests\latest\preparers.py:106: in create_resource
    execute(self.cli_ctx, cmd)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv/providers/Microsoft.Compute/virtualMachines/clitest-vmlzmdi' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv/providers/Microsoft.Compute/virtualMachines/clitest-vmlzmdi' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv --tag product=azurecli cause=automation date=2020-12-18T08:02:55Z" => 0. 

Command "az group delete --name cli_test_dynamic_metric_alert_v2bg67ngrfamcfbqkb6ydpfuhnvwruqm3254bhi3jwmzv --yes --no-wait" => 0. 

_______________ MonitorTests.test_metric_alert_condition_create _______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C938F181C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C929EB3D90>
command = 'vm create -n clitest-vmujo7s -g cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6 --image W...ssword %j^VYw9Q3Z@Cu$*h --tags MabUsed=Yes Owner=sisi Purpose=CLITest DeleteBy=12-2099 AutoShutdown=No --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EB3D90>
args = ['vm', 'create', '-n', 'clitest-vmujo7s', '-g', 'cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C938CC01F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EB3D90>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:50: in _preparer_wrapper
    fn(test_class_instance, **kwargs)
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:39: in _preparer_wrapper
    parameter_update = self.create_resource(
src\azure-cli\azure\cli\command_modules\backup\tests\latest\preparers.py:106: in create_resource
    execute(self.cli_ctx, cmd)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6/providers/Microsoft.Compute/virtualMachines/clitest-vmujo7s' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6/providers/Microsoft.Compute/virtualMachines/clitest-vmujo7s' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6 --tag product=azurecli cause=automation date=2020-12-18T08:03:01Z" => 0. 

Command "az group delete --name cli_test_metric_alert_condition_createivd3vmqxf44uqhqgomz6dmeatd6n5brpvafn6 --yes --no-wait" => 0. 

________________ MonitorTests.test_metric_alert_for_rg_and_sub ________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93A210670>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C929EC1A90>
command = 'vm create -n clitest-vmeux4r -g cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt --image W...ssword %j^VYw9Q3Z@Cu$*h --tags MabUsed=Yes Owner=sisi Purpose=CLITest DeleteBy=12-2099 AutoShutdown=No --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EC1A90>
args = ['vm', 'create', '-n', 'clitest-vmeux4r', '-g', 'cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93A1FF9D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929EC1A90>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:50: in _preparer_wrapper
    fn(test_class_instance, **kwargs)
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:50: in _preparer_wrapper
    fn(test_class_instance, **kwargs)
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:39: in _preparer_wrapper
    parameter_update = self.create_resource(
src\azure-cli\azure\cli\command_modules\backup\tests\latest\preparers.py:106: in create_resource
    execute(self.cli_ctx, cmd)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt/providers/Microsoft.Compute/virtualMachines/clitest-vmeux4r' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt/providers/Microsoft.Compute/virtualMachines/clitest-vmeux4r' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt --tag product=azurecli cause=automation date=2020-12-18T08:03:07Z" => 0. 

Command "az group create --location westus --name cli_test_metric_alert_v2ey4dokehg4xi25b7lqyqvimx56s4mvawzh5tn54vmfnfur5denv --tag product=azurecli cause=automation date=2020-12-18T08:03:09Z" => 0. 

Command "az group delete --name cli_test_metric_alert_v2ey4dokehg4xi25b7lqyqvimx56s4mvawzh5tn54vmfnfur5denv --yes --no-wait" => 0. 

Command "az group delete --name cli_test_metric_alert_v2ienzxpd5faoij4rzhz4rgvp6tmrecenuja5yrhxwmg4gow35lnt --yes --no-wait" => 0. 

_______________ MonitorTests.test_metric_alert_multiple_scopes ________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93A1486A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C929E88FA0>
command = 'vm create -n clitest-vmklr2o -g cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46 --image W...ssword %j^VYw9Q3Z@Cu$*h --tags MabUsed=Yes Owner=sisi Purpose=CLITest DeleteBy=12-2099 AutoShutdown=No --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929E88FA0>
args = ['vm', 'create', '-n', 'clitest-vmklr2o', '-g', 'cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9389250D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C929E88FA0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:50: in _preparer_wrapper
    fn(test_class_instance, **kwargs)
env\lib\site-packages\azure_devtools\scenario_tests\preparers.py:39: in _preparer_wrapper
    parameter_update = self.create_resource(
src\azure-cli\azure\cli\command_modules\backup\tests\latest\preparers.py:106: in create_resource
    execute(self.cli_ctx, cmd)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46/providers/Microsoft.Compute/virtualMachines/clitest-vmklr2o' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46/providers/Microsoft.Compute/virtualMachines/clitest-vmklr2o' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46 --tag product=azurecli cause=automation date=2020-12-18T08:03:17Z" => 0. 

Command "az group delete --name cli_test_metric_alert_v27kmcdnmny7xjqfdngh34kqiyygbtft6ru5hlaxnfukslcpomv46 --yes --no-wait" => 0. 

______________ HDInsightClusterTests.test_hdinsight_application _______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023817D48D00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238174DC2B0>
command = 'hdinsight create -n hdicli-4e5hfp34z -g hdicli-q2olv -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclizwts6z2cgdy4hgezfy --storage-container default --ssh-user sshuser --ssh-password Password1!'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238174DC2B0>
args = ['hdinsight', 'create', '-n', 'hdicli-4e5hfp34z', '-g', 'hdicli-q2olv', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238187C55E0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238174DC2B0>
ex = CLIError('Deployment failed. Correlation ID: 6efe30c4-4eb1-405f-be31-59dee36ceb5f. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 6efe30c4-4eb1-405f-be31-59dee36ceb5f. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_application>
storage_account_info = ('hdiclizwts6z2cgdy4hgezfy', 't1CmwKrsKny4GG/HIj5z9e98tOSqe3FAC8rDE/VYtNRBAKJTJTVureQLqJDS5LbgImVlcb0Kuy+8a8+uG2t/Gw==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_application(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_explicit_ssh_creds()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:192: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 6efe30c4-4eb1-405f-be31-59dee36ceb5f. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-q2olv --tag product=azurecli cause=automation date=2020-12-18T07:56:21Z" => 0. 

Command "az storage account create -n hdiclizwts6z2cgdy4hgezfy -g hdicli-q2olv -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclizwts6z2cgdy4hgezfy -g hdicli-q2olv --query "[0].value" -otsv" => 0. 

Command "az group delete --name hdicli-q2olv --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrestazure.tools:tools.py:92 Resource provider 'Microsoft.HDInsight' used by this operation is not registered. We are registering for you.
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrestazure.tools:tools.py:103 Registration succeeded.
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
__________ HDInsightClusterTests.test_hdinsight_autoscale_operation ___________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023818F0B8B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023818A14070>
command = 'hdinsight create -n hdicli-sxni7cyw6 -g hdicli-do2ev -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclij6pyh4xyghhibxtx7w --storage-container default'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818A14070>
args = ['hdinsight', 'create', '-n', 'hdicli-sxni7cyw6', '-g', 'hdicli-do2ev', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023819305DC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818A14070>
ex = CLIError('Deployment failed. Correlation ID: 6342ef4b-9834-46d4-a0f9-9520a79d707a. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 6342ef4b-9834-46d4-a0f9-9520a79d707a. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_autoscale_operation>
storage_account_info = ('hdiclij6pyh4xyghhibxtx7w', 'Vyv6HorPsU25j3NOujl3qzH838rc7n76gR9nChGD54o9p9hGI81Qy10pLuRuVRtZO3ADQ/Ywj4RSIzuNJo+VnQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_autoscale_operation(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info)
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:408: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 6342ef4b-9834-46d4-a0f9-9520a79d707a. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-do2ev --tag product=azurecli cause=automation date=2020-12-18T08:06:46Z" => 0. 

Command "az storage account create -n hdiclij6pyh4xyghhibxtx7w -g hdicli-do2ev -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclij6pyh4xyghhibxtx7w -g hdicli-do2ev --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-do2ev --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____________ HDInsightClusterTests.test_hdinsight_cluster_kafka ______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381481AD90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381751D670>
command = 'hdinsight create -n hdicli-gqo6gdbsj -g hdicli-i73u6 -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclisjlbiee5ar5ximupwq --storage-container default -t kafka --workernode-data-disks-per-node 4'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381751D670>
args = ['hdinsight', 'create', '-n', 'hdicli-gqo6gdbsj', '-g', 'hdicli-i73u6', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238194B2790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381751D670>
ex = CLIError('Deployment failed. Correlation ID: 01bd360b-53b5-453e-bd4a-41760e33dd3e. Internal server error occurred while processing the request. Please retry the request or contact support.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 01bd360b-53b5-453e-bd4a-41760e33dd3e. Internal server error occurred while processing the request. Please retry the request or contact support.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_kafka>
storage_account_info = ('hdiclisjlbiee5ar5ximupwq', 'TtI7lqcjb4QRVRtpK+CwwMr/dxI1vnE4y79ms0cPuUgDq2GGsVh7LLjw64K96rZvexTko5PgaYF4s1z8O7y7+w==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_kafka(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._kafka_arguments()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:45: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Internal server error occurred while processing the request. Please retry the request or contact support.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 01bd360b-53b5-453e-bd4a-41760e33dd3e. Internal server error occurred while processing the request. Please retry the request or contact support.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-i73u6 --tag product=azurecli cause=automation date=2020-12-18T08:13:55Z" => 0. 

Command "az storage account create -n hdiclisjlbiee5ar5ximupwq -g hdicli-i73u6 -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclisjlbiee5ar5ximupwq -g hdicli-i73u6 --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-i73u6 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute storage_account_type will be ignored in class <class 'azure.mgmt.hdinsight.models._models_py3.DataDisksGroups'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute disk_size_gb will be ignored in class <class 'azure.mgmt.hdinsight.models._models_py3.DataDisksGroups'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_ AzureNetAppFilesVolumeServiceScenarioTest.test_create_volume_with_subnet_in_different_rg _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93ABDC640>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93A2CAD30>
command = 'netappfiles account create -g cli_netappfiles_test_volume_2lvkm4wzdmw4bgw6rddk2aklra2za5zswikcog6ofocogl4 -a cli-acc-kjjumc5qn5h3i64i -l centralus'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A2CAD30>
args = ['netappfiles', 'account', 'create', '-g', 'cli_netappfiles_test_volume_2lvkm4wzdmw4bgw6rddk2aklra2za5zswikcog6ofocogl4', '-a', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93AD06A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A2CAD30>
ex = CLIError(CloudError("The resource type could not be found in the namespace 'Microsoft.NetApp' for api version '2020-07-01'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The resource type could not be found in the namespace 'Microsoft.NetApp' for api version '2020-07-01'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.netappfiles.tests.latest.test_volume_commands.AzureNetAppFilesVolumeServiceScenarioTest testMethod=test_create_volume_with_subnet_in_different_rg>

    @ResourceGroupPreparer(name_prefix='cli_netappfiles_test_volume_')
    def test_create_volume_with_subnet_in_different_rg(self):
        account_name = self.create_random_name(prefix='cli-acc-', length=24)
        pool_name = self.create_random_name(prefix='cli-pool-', length=24)
        volume_name = self.create_random_name(prefix='cli-vol-', length=24)
    
        vnet_name = self.create_random_name(prefix='cli-vnet-', length=24)
        file_path = volume_name  # creation_token
        subnet_name = self.create_random_name(prefix='cli-subnet-', length=16)
    
        subnet_rg = self.create_random_name(prefix='cli-rg-subnet', length=24)
        subs_id = self.current_subscription()
        self.cmd("az group create -n %s --subscription %s -l %s" % (subnet_rg, subs_id, RG_LOCATION)).get_output_in_json()
    
        rg = '{rg}'
        self.setup_vnet(subnet_rg, vnet_name, subnet_name, '10.0.0.0', RG_LOCATION)
>       self.cmd("az netappfiles account create -g %s -a %s -l %s" % (rg, account_name, RG_LOCATION)).get_output_in_json()

src\azure-cli\azure\cli\command_modules\netappfiles\tests\latest\test_volume_commands.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The resource type could not be found in the namespace 'Microsoft.NetApp' for api version '2020-07-01'.")

    def netappfiles_exception_handler(ex):
        if isinstance(ex, (CloudError, ValidationError, ValueError)):
            message = ex
>           raise CLIError(message)
E           knack.util.CLIError: Azure Error: InvalidResourceType
E           Message: The resource type could not be found in the namespace 'Microsoft.NetApp' for api version '2020-07-01'.

src\azure-cli\azure\cli\command_modules\netappfiles\_exception_handler.py:14: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_netappfiles_test_volume_2lvkm4wzdmw4bgw6rddk2aklra2za5zswikcog6ofocogl4 --tag product=azurecli cause=automation date=2020-12-18T08:25:03Z" => 0. 

Command "az account show" => 0. 

Command "az group create -n cli-rg-subnetkm6oqt6mho7 --subscription a1bfa635-f2bf-42f1-86b5-848c674fc321 -l centralus" => 0. 

Command "az network vnet create -n cli-vnet-w3re33o74zfcoaa --resource-group cli-rg-subnetkm6oqt6mho7 -l centralus --address-prefix 10.0.0.0/16" => 0. 

Command "az network vnet subnet create -n cli-subnet-2ejav -g cli-rg-subnetkm6oqt6mho7 --vnet-name cli-vnet-w3re33o74zfcoaa --address-prefixes '10.0.0.0/24' --delegations 'Microsoft.Netapp/volumes'" => 0. 

Command group 'netappfiles' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_netappfiles_test_volume_2lvkm4wzdmw4bgw6rddk2aklra2za5zswikcog6ofocogl4 --yes --no-wait" => 0. 

_ NetworkAppGatewayDefaultScenarioTest.test_network_appgw_creation_with_public_and_private_ip _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93B376280>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93B508040>
command = 'network application-gateway create -g test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3 -n applicationGateway --sku Standard_v2 --enable-private-link --private-ip-address 10.0.0.17 --public-ip-address publicIP'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93B508040>
args = ['network', 'application-gateway', 'create', '-g', 'test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93B2F68B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93B508040>
ex = CLIError(CLIError('Deployment failed. Correlation ID: b69f5469-e326-4966-aa12-c8b763754b19. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CLIError('Deployment failed. Correlation ID: b69f5469-e326-4966-aa12-c8b763754b19. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkAppGatewayDefaultScenarioTest testMethod=test_network_appgw_creation_with_public_and_private_ip>
resource_group = 'test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3'

    @ResourceGroupPreparer(name_prefix='test_network_appgw_creation_with_public_and_private_ip')
    def test_network_appgw_creation_with_public_and_private_ip(self, resource_group):
        self.kwargs.update({
            "appgw": "applicationGateway",
            "ip": "publicIP",
        })
    
        self.cmd('network public-ip create -g {rg} -n {ip} --sku Standard')
    
>       self.cmd("network application-gateway create -g {rg} -n {appgw} "
                 "--sku Standard_v2 "
                 "--enable-private-link "
                 "--private-ip-address 10.0.0.17 "
                 "--public-ip-address {ip}")

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:480: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: b69f5469-e326-4966-aa12-c8b763754b19. {\r\n  "error": {\r\n    "code": "S...r feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}')

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Deployment failed. Correlation ID: b69f5469-e326-4966-aa12-c8b763754b19. {
E             "error": {
E               "code": "SubscriptionNotRegisteredForFeature",
E               "message": "Subscription /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups//providers/Microsoft.Network/subscriptions/ is not registered for feature PrivateLinkConfigurations required to carry out the requested operation.",
E               "details": []
E             }
E           }

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3 --tag product=azurecli cause=automation date=2020-12-18T08:25:18Z" => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "network public-ip create -g test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3 -n publicIP --sku Standard" => 0. 

Command "az group delete --name test_network_appgw_creation_with_public_and_private_ipbqfowsoer5numbhyvxwm3 --yes --no-wait" => 0. 

__________ NetworkRouteFilterScenarioTest.test_network_route_filter ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9368D0310>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C939290BB0>
command = 'network route-filter rule create -g cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no --filter-name filter1 -n rule1 --communities 12076:5040 12076:5030 --access allow'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939290BB0>
args = ['network', 'route-filter', 'rule', 'create', '-g', 'cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C936482CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939290BB0>
ex = CLIError('Deployment failed. Correlation ID: 06bbb579-de2a-482d-bc2e-fe0be21a9b39. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for given communities')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 06bbb579-de2a-482d-bc2e-fe0be21a9b39. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for given communities')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkRouteFilterScenarioTest testMethod=test_network_route_filter>
resource_group = 'cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no'

    @AllowLargeResponse()
    @ResourceGroupPreparer(name_prefix='cli_test_network_route_filter')
    def test_network_route_filter(self, resource_group):
        self.kwargs['filter'] = 'filter1'
        self.kwargs['rg'] = resource_group
        self.cmd('network route-filter create -g {rg} -n {filter} --tags foo=doo')
        self.cmd('network route-filter update -g {rg} -n {filter}')
        self.cmd('network route-filter show -g {rg} -n {filter}')
        self.cmd('network route-filter list -g {rg}')
    
        # temporalily disable this test
        # self.cmd('network route-filter rule list-service-communities')
>       self.cmd('network route-filter rule create -g {rg} --filter-name {filter} -n rule1 --communities 12076:5040 12076:5030 --access allow')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:1833: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for given communities')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 06bbb579-de2a-482d-bc2e-fe0be21a9b39. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for given communities

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no --tag product=azurecli cause=automation date=2020-12-18T08:26:05Z" => 0. 

Command group 'network route-filter' is in preview. It may be changed/removed in a future release.
Command "network route-filter create -g cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no -n filter1 --tags foo=doo" => 0. 

Command group 'network route-filter' is in preview. It may be changed/removed in a future release.
Command "network route-filter update -g cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no -n filter1" => 0. 

Command group 'network route-filter' is in preview. It may be changed/removed in a future release.
Command "network route-filter show -g cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no -n filter1" => 0. 

Command group 'network route-filter' is in preview. It may be changed/removed in a future release.
Command "network route-filter list -g cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no" => 0. 

Command group 'network route-filter' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_network_route_filterxjbzbsn3fxcevoixwmkgbuslqecybozteobdof7uuti2no --yes --no-wait" => 0. 

_________ NetworkExpressRouteScenarioTest.test_network_express_route __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93A36EBE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93A468430>
command = 'network express-route list-service-providers', expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A468430>
args = ['network', 'express-route', 'list-service-providers']
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93979E3A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A468430>
ex = ValueError("The json response body exceeds the default limit of 128kb. Use '@AllowLargeResponse' on your test method to increase the limit or update test logics to avoid big payloads")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ValueError("The json response body exceeds the default limit of 128kb. Use '@AllowLargeResponse' on your test method to increase the limit or update test logics to avoid big payloads")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ValueError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkExpressRouteScenarioTest testMethod=test_network_express_route>
resource_group = 'cli_test_express_routek5x4qnaovyrmrxbhssbuoq3l2vwudlqdlo7l57tvswpvqcpmwpdek'

    @ResourceGroupPreparer(name_prefix='cli_test_express_route')
    def test_network_express_route(self, resource_group):
    
        self.kwargs = {
            'rg': resource_group,
            'er': 'circuit1',
            'rt': 'Microsoft.Network/expressRouteCircuits'
        }
    
>       self.cmd('network express-route list-service-providers', checks=[
            self.check('type(@)', 'array'),
            self.check("length([?type == 'Microsoft.Network/expressRouteServiceProviders']) == length(@)", True)
        ])

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:1898: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:701: in _run_job
    result = list(result)
env\lib\site-packages\msrest\paging.py:143: in __next__
    self.advance_page()
env\lib\site-packages\msrest\paging.py:129: in advance_page
    self._response = self._get_next(self.next_link)
env\lib\site-packages\azure\mgmt\network\v2020_07_01\operations\_express_route_service_providers_operations.py:90: in internal_paging
    response = self._client.send(request, stream=False, **operation_config)
env\lib\site-packages\msrest\service_client.py:336: in send
    pipeline_response = self.config.pipeline.run(request, **kwargs)
env\lib\site-packages\msrest\pipeline\__init__.py:197: in run
    return first_node.send(pipeline_request, **kwargs)  # type: ignore
env\lib\site-packages\msrest\pipeline\__init__.py:150: in send
    response = self.next.send(request, **kwargs)
env\lib\site-packages\msrest\pipeline\requests.py:72: in send
    return self.next.send(request, **kwargs)
env\lib\site-packages\msrest\pipeline\requests.py:137: in send
    return self.next.send(request, **kwargs)
env\lib\site-packages\msrest\pipeline\__init__.py:150: in send
    response = self.next.send(request, **kwargs)
env\lib\site-packages\msrest\pipeline\requests.py:193: in send
    self.driver.send(request.http_request, **kwargs)
env\lib\site-packages\msrest\universal_http\requests.py:333: in send
    return super(RequestsHTTPSender, self).send(request, **requests_kwargs)
env\lib\site-packages\msrest\universal_http\requests.py:139: in send
    response = session.request(
env\lib\site-packages\requests\sessions.py:533: in request
    resp = self.send(prep, **send_kwargs)
env\lib\site-packages\requests\sessions.py:646: in send
    r = adapter.send(request, **kwargs)
env\lib\site-packages\requests\adapters.py:439: in send
    resp = conn.urlopen(
env\lib\site-packages\urllib3\connectionpool.py:600: in urlopen
    httplib_response = self._make_request(conn, method, url,
env\lib\site-packages\urllib3\connectionpool.py:379: in _make_request
    httplib_response = conn.getresponse(buffering=True)
env\lib\site-packages\vcr\stubs\__init__.py:260: in getresponse
    self.cassette.append(self._vcr_request, response)
env\lib\site-packages\vcr\cassette.py:235: in append
    response = self._before_record_response(response)
env\lib\site-packages\vcr\config.py:176: in before_record_response
    response = function(response)
env\lib\site-packages\azure_devtools\scenario_tests\base.py:189: in _process_response_recording
    response = processor.process_response(response)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure_devtools.scenario_tests.recording_processors.LargeResponseBodyProcessor object at 0x000001C93AA008E0>
response = {'body': {'string': '{\r\n  "value": [\r\n    {\r\n      "name": "AARNet",\r\n      "id": "/subscriptions//resourceGro...ation/json; charset=utf-8'], 'date': ['Fri, 18 Dec 2020 08:27:09 GMT'], ...}, 'status': {'code': 200, 'message': 'OK'}}

    def process_response(self, response):
        if is_text_payload(response):
            length = len(response['body']['string'] or '')
            if length > self._max_response_body * 1024:
    
                if is_json_payload(response):
                    from .decorators import AllowLargeResponse  # pylint: disable=cyclic-import
>                   raise ValueError("The json response body exceeds the default limit of {}kb. Use '@{}' "
                                     "on your test method to increase the limit or update test logics to avoid "
                                     "big payloads".format(self._max_response_body, AllowLargeResponse.__name__))
E                   ValueError: The json response body exceeds the default limit of 128kb. Use '@AllowLargeResponse' on your test method to increase the limit or update test logics to avoid big payloads

env\lib\site-packages\azure_devtools\scenario_tests\recording_processors.py:98: ValueError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_express_routek5x4qnaovyrmrxbhssbuoq3l2vwudlqdlo7l57tvswpvqcpmwpdek --tag product=azurecli cause=automation date=2020-12-18T08:27:07Z" => 0. 

Command "az group delete --name cli_test_express_routek5x4qnaovyrmrxbhssbuoq3l2vwudlqdlo7l57tvswpvqcpmwpdek --yes --no-wait" => 0. 

_ NetworkExpressRouteIPv6PeeringScenarioTest.test_network_express_route_ipv6_peering _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93A81E340>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C937880A00>
command = 'network express-route create -g cli_test_express_route_ipv6_peeringk246aucxq6yudhalxw3da5vw6jo7f6dr4bntcoth -n circuit1 --bandwidth 50 --provider "Ibiza Test Provider" --peering-location Area51 --sku-tier Premium'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937880A00>
args = ['network', 'express-route', 'create', '-g', 'cli_test_express_route_ipv6_peeringk246aucxq6yudhalxw3da5vw6jo7f6dr4bntcoth', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93B47C040>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C937880A00>
ex = CLIError('Deployment failed. Correlation ID: 68a62b38-e2c8-4861-84a5-a396e22456a0. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 68a62b38-e2c8-4861-84a5-a396e22456a0. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkExpressRouteIPv6PeeringScenarioTest testMethod=test_network_express_route_ipv6_peering>
resource_group = 'cli_test_express_route_ipv6_peeringk246aucxq6yudhalxw3da5vw6jo7f6dr4bntcoth'

    @ResourceGroupPreparer(name_prefix='cli_test_express_route_ipv6_peering')
    def test_network_express_route_ipv6_peering(self, resource_group):
    
        self.kwargs['er'] = 'circuit1'
    
        # Premium SKU required to create MicrosoftPeering settings
>       self.cmd('network express-route create -g {rg} -n {er} --bandwidth 50 --provider "Ibiza Test Provider" --peering-location Area51 --sku-tier Premium')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:2045: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 68a62b38-e2c8-4861-84a5-a396e22456a0. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_express_route_ipv6_peeringk246aucxq6yudhalxw3da5vw6jo7f6dr4bntcoth --tag product=azurecli cause=automation date=2020-12-18T08:27:12Z" => 0. 

interpretting --bandwidth as mbps. Consider being explicit: Mbps, Gbps
Command "az group delete --name cli_test_express_route_ipv6_peeringk246aucxq6yudhalxw3da5vw6jo7f6dr4bntcoth --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 allow_global_reach is not a known attribute of class <class 'azure.mgmt.network.v2020_07_01.models._models_py3.ExpressRouteCircuit'> and will be ignored
_ NetworkExpressRouteGlobalReachScenarioTest.test_network_express_route_global_reach _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93ADF6520>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C939FCD040>
command = 'network express-route create -g cli_test_express_route_global_reachyoflfyupv2kbnlsvpqgkytuclqetpgoo52laavvj -n er1 --allow-global-reach --bandwidth 50 --peering-location Area51 --provider "Microsoft ER Test" --sku-tier Premium'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939FCD040>
args = ['network', 'express-route', 'create', '-g', 'cli_test_express_route_global_reachyoflfyupv2kbnlsvpqgkytuclqetpgoo52laavvj', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93B47C4C0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939FCD040>
ex = CLIError('Deployment failed. Correlation ID: eea344ee-26b8-4900-8199-6fecec1d4d8e. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: eea344ee-26b8-4900-8199-6fecec1d4d8e. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkExpressRouteGlobalReachScenarioTest testMethod=test_network_express_route_global_reach>
resource_group = 'cli_test_express_route_global_reachyoflfyupv2kbnlsvpqgkytuclqetpgoo52laavvj'

    @ResourceGroupPreparer(name_prefix='cli_test_express_route_global_reach')
    def test_network_express_route_global_reach(self, resource_group):
    
        self.kwargs.update({
            'er1': 'er1',
            'er2': 'er2',
            'conn12': 'conn12',
        })
    
>       self.cmd('network express-route create -g {rg} -n {er1} --allow-global-reach --bandwidth 50 --peering-location Area51 --provider "Microsoft ER Test" --sku-tier Premium')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:2069: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: eea344ee-26b8-4900-8199-6fecec1d4d8e. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_express_route_global_reachyoflfyupv2kbnlsvpqgkytuclqetpgoo52laavvj --tag product=azurecli cause=automation date=2020-12-18T08:27:30Z" => 0. 

interpretting --bandwidth as mbps. Consider being explicit: Mbps, Gbps
Command "az group delete --name cli_test_express_route_global_reachyoflfyupv2kbnlsvpqgkytuclqetpgoo52laavvj --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 allow_global_reach is not a known attribute of class <class 'azure.mgmt.network.v2020_07_01.models._models_py3.ExpressRouteCircuit'> and will be ignored
_ NetworkExpressRouteGlobalReachScenarioTest.test_network_express_route_peer_connection _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93B3BCE20>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C939FFC640>
command = 'network express-route create -g cli_test_express_route_peer_connectionizh7rkrbm55bbwpi2m3d6timueelcfbab776r -n er1 --allow-global-reach --bandwidth 50 --peering-location Area51 --provider "Microsoft ER Test" --sku-tier Premium'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939FFC640>
args = ['network', 'express-route', 'create', '-g', 'cli_test_express_route_peer_connectionizh7rkrbm55bbwpi2m3d6timueelcfbab776r', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93B007F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C939FFC640>
ex = CLIError('Deployment failed. Correlation ID: 15346a11-19b9-4249-ae51-93b422d9e7ca. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 15346a11-19b9-4249-ae51-93b422d9e7ca. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkExpressRouteGlobalReachScenarioTest testMethod=test_network_express_route_peer_connection>
resource_group = 'cli_test_express_route_peer_connectionizh7rkrbm55bbwpi2m3d6timueelcfbab776r'

    @ResourceGroupPreparer(name_prefix='cli_test_express_route_peer_connection')
    def test_network_express_route_peer_connection(self, resource_group):
        from msrestazure.azure_exceptions import CloudError
    
        self.kwargs.update({
            'er1': 'er1',
            'er2': 'er2',
            'peconn12': 'peconn12',
        })
    
>       self.cmd('network express-route create -g {rg} -n {er1} --allow-global-reach --bandwidth 50 --peering-location Area51 --provider "Microsoft ER Test" --sku-tier Premium')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:2091: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 15346a11-19b9-4249-ae51-93b422d9e7ca. This subscriptionId:a1bfa635-f2bf-42f1-86b5-848c674fc321 is not enabled for this feature

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_express_route_peer_connectionizh7rkrbm55bbwpi2m3d6timueelcfbab776r --tag product=azurecli cause=automation date=2020-12-18T08:27:47Z" => 0. 

interpretting --bandwidth as mbps. Consider being explicit: Mbps, Gbps
Command "az group delete --name cli_test_express_route_peer_connectionizh7rkrbm55bbwpi2m3d6timueelcfbab776r --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 allow_global_reach is not a known attribute of class <class 'azure.mgmt.network.v2020_07_01.models._models_py3.ExpressRouteCircuit'> and will be ignored
_ NetworkNicConvenienceCommandsScenarioTest.test_network_nic_convenience_commands _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93AAA5B20>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93A797460>
command = 'vm create -g cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li -n conveniencevm1 --image UbuntuLTS --admin-username myusername --admin-password aBcD1234!@#$ --authentication-type password --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A797460>
args = ['vm', 'create', '-g', 'cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li', '-n', 'conveniencevm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93AB70F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93A797460>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkNicConvenienceCommandsScenarioTest testMethod=test_network_nic_convenience_commands>
resource_group = 'cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li'

    @ResourceGroupPreparer(name_prefix='cli_nic_convenience_test')
    def test_network_nic_convenience_commands(self, resource_group):
    
        self.kwargs['vm'] = 'conveniencevm1'
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --admin-username myusername --admin-password aBcD1234!@#$ --authentication-type password --nsg-rule None')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:2978: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li/providers/Microsoft.Compute/virtualMachines/conveniencevm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li/providers/Microsoft.Compute/virtualMachines/conveniencevm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li --tag product=azurecli cause=automation date=2020-12-18T08:28:04Z" => 0. 

Command "az group delete --name cli_nic_convenience_testoheqqfuh5ecd4wxyiozzkdpmofrauj6kosx5lxsnfjqnpygj3li --yes --no-wait" => 0. 

_ HDInsightClusterTests.test_hdinsight_cluster_kafka_with_optional_disk_args __
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023816B2DA60>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238182B8490>
command = 'hdinsight create -n hdicli-jly4d6cbk -g hdicli-a4bho -l eastus2 -p Password1! -t spark --no-validation-timeout --stor...ernode-data-disks-per-node 4 --workernode-data-disk-storage-account-type Standard_LRS --workernode-data-disk-size 1023'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238182B8490>
args = ['hdinsight', 'create', '-n', 'hdicli-jly4d6cbk', '-g', 'hdicli-a4bho', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238184A9F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238182B8490>
ex = CLIError('Deployment failed. Correlation ID: 60126af2-d91b-4cdd-afc8-7738eacf32c9. Internal server error occurred while processing the request. Please retry the request or contact support.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 60126af2-d91b-4cdd-afc8-7738eacf32c9. Internal server error occurred while processing the request. Please retry the request or contact support.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_kafka_with_optional_disk_args>
storage_account_info = ('hdiclint2w2caaneb5nmtn42', 'fQ8iWqCHp72I1Jqy1qVywPWQB/P3e8WxkAYtnOh5ESB17T0qbMFXHsos7WFEeSf5twVa5ZZYVdOrNvgcqCEPSA==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_kafka_with_optional_disk_args(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._kafka_arguments(),
            HDInsightClusterTests._optional_data_disk_arguments()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:65: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Internal server error occurred while processing the request. Please retry the request or contact support.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 60126af2-d91b-4cdd-afc8-7738eacf32c9. Internal server error occurred while processing the request. Please retry the request or contact support.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-a4bho --tag product=azurecli cause=automation date=2020-12-18T08:21:33Z" => 0. 

Command "az storage account create -n hdiclint2w2caaneb5nmtn42 -g hdicli-a4bho -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclint2w2caaneb5nmtn42 -g hdicli-a4bho --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-a4bho --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute storage_account_type will be ignored in class <class 'azure.mgmt.hdinsight.models._models_py3.DataDisksGroups'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute disk_size_gb will be ignored in class <class 'azure.mgmt.hdinsight.models._models_py3.DataDisksGroups'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____________ HDInsightClusterTests.test_hdinsight_cluster_min_args ____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238198CBA60>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023818A17EE0>
command = 'hdinsight create -n hdicli-gy7q6whcx -g hdicli-2gr7y -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdicliyzmrjvo7qbc3e6hpu2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818A17EE0>
args = ['hdinsight', 'create', '-n', 'hdicli-gy7q6whcx', '-g', 'hdicli-2gr7y', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381969F280>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023818A17EE0>
ex = CLIError('Deployment failed. Correlation ID: 113cd570-3f2b-495e-813f-22bd7fdd6f84. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 113cd570-3f2b-495e-813f-22bd7fdd6f84. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_min_args>
storage_account_info = ('hdicliyzmrjvo7qbc3e6hpu2', 'rBusW7M5wI8kgOJfHLuEYLGb3zyi4gPbDGBb5AFOTYHEXamqBWnb55m8UGe+FFoTvC01wXK0S6bN9gN95QSiLA==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_min_args(self, storage_account_info):
>       self._create_hdinsight_cluster(self._wasb_arguments(storage_account_info,
                                                            specify_key=False, specify_container=False))

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:21: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 113cd570-3f2b-495e-813f-22bd7fdd6f84. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-2gr7y --tag product=azurecli cause=automation date=2020-12-18T08:44:01Z" => 0. 

Command "az storage account create -n hdicliyzmrjvo7qbc3e6hpu2 -g hdicli-2gr7y -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicliyzmrjvo7qbc3e6hpu2 -g hdicli-2gr7y --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Default WASB container not specified, using "hdicli-gy7q6whcx".
Command "az group delete --name hdicli-2gr7y --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____________ HDInsightClusterTests.test_hdinsight_cluster_resize _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381718F820>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023819DAFA00>
command = 'hdinsight create -n hdicli-glrgh5rv2 -g hdicli-dopdw -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdicliadjn4mniewapzym3mj --storage-container default'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819DAFA00>
args = ['hdinsight', 'create', '-n', 'hdicli-glrgh5rv2', '-g', 'hdicli-dopdw', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023819DE8430>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819DAFA00>
ex = CLIError('Deployment failed. Correlation ID: e70595cc-27e2-4e69-be2c-cf88aef824d5. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: e70595cc-27e2-4e69-be2c-cf88aef824d5. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_resize>
storage_account_info = ('hdicliadjn4mniewapzym3mj', '7nj+sqRxZQ4gAFiYX7sWEGW11M8fdwqQh0k6cmCdy+ine90HRy0UOBKB63Et+RHP0vW2qhvPgbYV/mViv1R9xA==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_resize(self, storage_account_info):
>       self._create_hdinsight_cluster(
            self._wasb_arguments(storage_account_info))

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: e70595cc-27e2-4e69-be2c-cf88aef824d5. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-dopdw --tag product=azurecli cause=automation date=2020-12-18T08:51:42Z" => 0. 

Command "az storage account create -n hdicliadjn4mniewapzym3mj -g hdicli-dopdw -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicliadjn4mniewapzym3mj -g hdicli-dopdw --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-dopdw --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
__________ NetworkVNetPeeringScenarioTest.test_network_vnet_peering ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93B809820>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93AA0D9D0>
command = 'network vnet peering create -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n peering...rb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac/providers/Microsoft.Network/virtualNetworks/vnet1 --allow-gateway-transit'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93AA0D9D0>
args = ['network', 'vnet', 'peering', 'create', '-g', 'cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93B885790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93AA0D9D0>
ex = CloudError('Cannot parse the request.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Cannot parse the request.'), args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkVNetPeeringScenarioTest testMethod=test_network_vnet_peering>
resource_group = 'cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac'

    @ResourceGroupPreparer(name_prefix='cli_test_vnet_peering')
    def test_network_vnet_peering(self, resource_group):
    
        # create two vnets with non-overlapping prefixes
        self.cmd('network vnet create -g {rg} -n vnet1')
        self.cmd('network vnet create -g {rg} -n vnet2 --subnet-name GatewaySubnet --address-prefix 11.0.0.0/16 --subnet-prefix 11.0.0.0/24')
        # create supporting resources for gateway
        self.cmd('network public-ip create -g {rg} -n ip1')
        ip_id = self.cmd('network public-ip show -g {rg} -n ip1 --query id').get_output_in_json()
        vnet_id = self.cmd('network vnet show -g {rg} -n vnet2 --query id').get_output_in_json()
    
        self.kwargs.update({
            'ip_id': ip_id,
            'vnet_id': vnet_id
        })
        # create the gateway on vnet2
        self.cmd('network vnet-gateway create -g {rg} -n gateway1 --public-ip-address {ip_id} --vnet {vnet_id} --tags foo=doo')
    
        vnet1_id = self.cmd('network vnet show -g {rg} -n vnet1 --query id').get_output_in_json()
        vnet2_id = self.cmd('network vnet show -g {rg} -n vnet2 --query id').get_output_in_json()
    
        self.kwargs.update({
            'vnet1_id': vnet1_id,
            'vnet2_id': vnet2_id
        })
        # set up gateway sharing from vnet1 to vnet2. test that remote-vnet indeed accepts name or id.
>       self.cmd('network vnet peering create -g {rg} -n peering2 --vnet-name vnet2 --remote-vnet {vnet1_id} --allow-gateway-transit', checks=[
            self.check('allowGatewayTransit', True),
            self.check('remoteVirtualNetwork.id', '{vnet1_id}'),
            self.check('peeringState', 'Initiated')
        ])

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:3351: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\network\custom.py:6011: in create_vnet_peering
    return ncf.virtual_network_peerings.create_or_update(
env\lib\site-packages\azure\mgmt\network\v2020_07_01\operations\_virtual_network_peerings_operations.py:273: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.network.v2020_07_01.operations._virtual_network_peerings_operations.VirtualNetworkPeeringsOperations object at 0x000001C93B9F0DF0>
resource_group_name = 'cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac'
virtual_network_name = 'vnet2', virtual_network_peering_name = 'peering2'
virtual_network_peering_parameters = <azure.mgmt.network.v2020_07_01.models._models_py3.VirtualNetworkPeering object at 0x000001C93B9E6FA0>
custom_headers = None, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vnet_peeringb...xicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac/providers/Microsoft.Network/virtualNetworks/vnet2/virtualNetworkPeerings/peering2'
path_format_arguments = {'resourceGroupName': 'cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321', 'virtualNetworkName': 'vnet2', 'virtualNetworkPeeringName': 'peering2'}
query_parameters = {'api-version': '2020-07-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'id': '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vnet_peeringbojgyctzpgrb7dbadnxicw...eeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac/providers/Microsoft.Network/virtualNetworks/vnet1'}, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, virtual_network_name, virtual_network_peering_name, virtual_network_peering_parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'virtualNetworkName': self._serialize.url("virtual_network_name", virtual_network_name, 'str'),
            'virtualNetworkPeeringName': self._serialize.url("virtual_network_peering_name", virtual_network_peering_name, 'str'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(virtual_network_peering_parameters, 'VirtualNetworkPeering')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: InvalidRequestFormat
E           Message: Cannot parse the request.
E           Exception Details:
E           	Error Code: InvalidJson
E           	Message: Could not find member 'syncRemoteAddressSpace' on object of type 'VirtualNetworkPeeringProperties'. Path 'properties.syncRemoteAddressSpace', line 1, position 596.

env\lib\site-packages\azure\mgmt\network\v2020_07_01\operations\_virtual_network_peerings_operations.py:231: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac --tag product=azurecli cause=automation date=2020-12-18T08:28:10Z" => 0. 

Command "network vnet create -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n vnet1" => 0. 

Command "network vnet create -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n vnet2 --subnet-name GatewaySubnet --address-prefix 11.0.0.0/16 --subnet-prefix 11.0.0.0/24" => 0. 

Command "network public-ip create -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n ip1" => 0. 

Command "network public-ip show -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n ip1 --query id" => 0. 

Command "network vnet show -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n vnet2 --query id" => 0. 

Command "network vnet-gateway create -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n gateway1 --public-ip-address /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac/providers/Microsoft.Network/publicIPAddresses/ip1 --vnet /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac/providers/Microsoft.Network/virtualNetworks/vnet2 --tags foo=doo" => 0. 

Command "network vnet show -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n vnet1 --query id" => 0. 

Command "network vnet show -g cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac -n vnet2 --query id" => 0. 

Command "az group delete --name cli_test_vnet_peeringbojgyctzpgrb7dbadnxicwoe552ufunedbvvrhgd7tx5zxwrtdi5ac --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m urllib3.connectionpool:connectionpool.py:664 Retrying (Retry(total=3, connect=4, read=3, redirect=None, status=None)) after connection broken by 'ProtocolError('Connection aborted.', OSError("(10054, 'WSAECONNRESET')"))': /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/providers/Microsoft.Network/locations/westus/operations/81df513d-b22a-4290-90c1-281f88702242?api-version=2020-07-01
_______ NetworkWatcherScenarioTest.test_network_watcher_packet_capture ________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93BE2CB50>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93BF84A00>
command = 'vm create -g cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u -n vm1 --image UbuntuLTS --authentication-type password --admin-username deploy --admin-password PassPass10!) --nsg vm1 --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93BF84A00>
args = ['vm', 'create', '-g', 'cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93C0ADC10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93BF84A00>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkWatcherScenarioTest testMethod=test_network_watcher_packet_capture>
resource_group = 'cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u'
resource_group_location = 'westus'

    @mock.patch('azure.cli.command_modules.vm._actions._get_thread_count', _mock_thread_count)
    @ResourceGroupPreparer(name_prefix='cli_test_nw_packet_capture', location='westus')
    @AllowLargeResponse()
    def test_network_watcher_packet_capture(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'loc': resource_group_location,
            'vm': 'vm1',
            'capture': 'capture1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --authentication-type password --admin-username deploy --admin-password PassPass10!) --nsg {vm} --nsg-rule None')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:4124: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u --tag product=azurecli cause=automation date=2020-12-18T09:03:26Z" => 0. 

Command "az group delete --name cli_test_nw_packet_capturece36ay3gakhouagv3tidt5kkvvpgrnaedrwlfzga4ktxd6z7u --yes --no-wait" => 0. 

_____________ NetworkWatcherScenarioTest.test_network_watcher_vm ______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93C26F760>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93BEEA880>
command = 'vm create -g cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja -n vm1 --image UbuntuLTS --a...assword --admin-username deploy --admin-password PassPass10!) --nsg nsg1 --nsg-rule None --private-ip-address 10.0.0.9'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93BEEA880>
args = ['vm', 'create', '-g', 'cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93C29BE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93BEEA880>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkWatcherScenarioTest testMethod=test_network_watcher_vm>
resource_group = 'cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja'
resource_group_location = 'westus'

    @mock.patch('azure.cli.command_modules.vm._actions._get_thread_count', _mock_thread_count)
    @ResourceGroupPreparer(name_prefix='cli_test_nw_vm', location='westus')
    @AllowLargeResponse()
    def test_network_watcher_vm(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'loc': 'westcentralus',
            'vm': 'vm1',
            'nsg': 'nsg1',
            'capture': 'capture1',
            'private-ip': '10.0.0.9'
        })
    
>       vm = self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --authentication-type password --admin-username deploy --admin-password PassPass10!) --nsg {nsg} --nsg-rule None --private-ip-address {private-ip}').get_output_in_json()

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:4038: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja --tag product=azurecli cause=automation date=2020-12-18T09:03:33Z" => 0. 

Command "az group delete --name cli_test_nw_vmdo6lay77zo3rzleuqaplcorz6kskyhj7bnj32z7if2l5emxnmdi6yxhvkneja --yes --no-wait" => 0. 

_______ NetworkBastionHostScenarioTest.test_network_batsion_host_create _______
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93BE256A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9379AAB20>
command = 'vm create -g test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk -n clivm --image UbuntuLTS -...t vmSubnet --admin-password TestPassword11!! --admin-username testadmin --authentication-type password --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9379AAB20>
args = ['vm', 'create', '-g', 'test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk', '-n', 'clivm', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93C29E3A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9379AAB20>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_network_commands.NetworkBastionHostScenarioTest testMethod=test_network_batsion_host_create>
resource_group = 'test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk'

    @ResourceGroupPreparer(name_prefix='test_network_bastion_host')
    def test_network_batsion_host_create(self, resource_group):
        self.kwargs.update({
            'rg': resource_group,
            'vm': 'clivm',
            'vnet': 'vnet',
            'subnet1': 'AzureBastionSubnet',
            'subnet2': 'vmSubnet',
            'ip1': 'ip1',
            'bastion': 'clibastion'
        })
        self.cmd('network vnet create -g {rg} -n {vnet} --subnet-name {subnet1}')
        self.cmd('network vnet subnet create -g {rg} -n {subnet2} --vnet-name {vnet} --address-prefixes 10.0.2.0/24')
        self.cmd('network public-ip create -g {rg} -n {ip1} --sku Standard')
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --vnet-name {vnet} --subnet {subnet2} '
                 '--admin-password TestPassword11!! --admin-username testadmin --authentication-type password --nsg-rule None')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_network_commands.py:4252: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk/providers/Microsoft.Compute/virtualMachines/clivm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk/providers/Microsoft.Compute/virtualMachines/clivm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk --tag product=azurecli cause=automation date=2020-12-18T09:03:41Z" => 0. 

Command "network vnet create -g test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk -n vnet --subnet-name AzureBastionSubnet" => 0. 

Command "network vnet subnet create -g test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk -n vmSubnet --vnet-name vnet --address-prefixes 10.0.2.0/24" => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "network public-ip create -g test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk -n ip1 --sku Standard" => 0. 

Command "az group delete --name test_network_bastion_hostrisxuea6cbh2kfiqa2ly3fepsbpov4psvypv42skbig5jbklyk --yes --no-wait" => 0. 

________ NWConnectionMonitorScenarioTest.test_nw_connection_monitor_v1 ________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93B5AB760>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93B10A040>
command = 'vm create -g cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y -n vm2 --image UbuntuLTS --authentication-type password --admin-username deploy --admin-password PassPass10!) --nsg vm2 --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93B10A040>
args = ['vm', 'create', '-g', 'cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y', '-n', 'vm2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93A3D5E50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93B10A040>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_nw_connection_monitor.NWConnectionMonitorScenarioTest testMethod=test_nw_connection_monitor_v1>
resource_group = 'cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y'
resource_group_location = 'westcentralus'

    @ResourceGroupPreparer(name_prefix='cli_test_nw_connection_monitor', location='westcentralus')
    @AllowLargeResponse()
    def test_nw_connection_monitor_v1(self, resource_group, resource_group_location):
        """
        This is copied from Azure/azure-cli,
        src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py,
        test_network_watcher_connection_monitor()
        """
        import time
        self.kwargs.update({
            'loc': resource_group_location,
            'vm2': 'vm2',
            'vm3': 'vm3',
            'cm': 'cm1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm2} '
                 '--image UbuntuLTS '
                 '--authentication-type password '
                 '--admin-username deploy '
                 '--admin-password PassPass10!) '
                 '--nsg {vm2} '
                 '--nsg-rule None')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_nw_connection_monitor.py:76: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y/providers/Microsoft.Compute/virtualMachines/vm2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y/providers/Microsoft.Compute/virtualMachines/vm2' is currently not available in location 'westcentralus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westcentralus --name cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y --tag product=azurecli cause=automation date=2020-12-18T09:04:05Z" => 0. 

Command "az group delete --name cli_test_nw_connection_monitorpvvg34t6fgng4umlnhfujjuv24z4chrrx4s5f64hywj4y --yes --no-wait" => 0. 

_ NetworkPrivateLinkWebappScenarioTest.test_private_endpoint_connection_webapp _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.network.tests.latest.test_private_endpoint_commands.NetworkPrivateLinkWebappScenarioTest testMethod=test_private_endpoint_connection_webapp>
resource_group = 'clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa'

    @ResourceGroupPreparer(location='westus2')
    def test_private_endpoint_connection_webapp(self, resource_group):
        self.kwargs.update({
            'resource_group': resource_group,
            'webapp_name': self.create_random_name('webapp-privatelink-webapp', 40),
            'plan_name': self.create_random_name('webapp-privatelink-asp', 40),
            'vnet_name': self.create_random_name('webapp-privatelink-vnet', 40),
            'subnet_name': self.create_random_name('webapp-privatelink-subnet', 40),
            'endpoint_name': self.create_random_name('webapp-privatelink-endpoint', 40),
            'endpoint_conn_name': self.create_random_name('webapp-privatelink-endpointconn', 40),
            'second_endpoint_name': self.create_random_name('webapp-privatelink-endpoint2', 40),
            'second_endpoint_conn_name': self.create_random_name('webapp-privatelink-endpointconn2', 40),
            'description_msg': 'somedescription'
        })
    
        # Prepare network
        self.cmd('network vnet create -n {vnet_name} -g {resource_group} --subnet-name {subnet_name}',
                 checks=self.check('length(newVNet.subnets)', 1))
        self.cmd('network vnet subnet update -n {subnet_name} --vnet-name {vnet_name} -g {resource_group} '
                 '--disable-private-endpoint-network-policies true',
                 checks=self.check('privateEndpointNetworkPolicies', 'Disabled'))
    
        # Create appService
        self.cmd('appservice plan create -g {resource_group} -n {plan_name} --sku P1V2')
        webapp = self.cmd('webapp create -g {resource_group} -n {webapp_name} --plan {plan_name}').get_output_in_json()
        self.kwargs['webapp_id'] = webapp['id']
    
        # Create endpoint
        result = self.cmd('network private-endpoint create -g {resource_group} -n {endpoint_name} --vnet-name {vnet_name} --subnet {subnet_name} '
                          '--connection-name {endpoint_conn_name} --private-connection-resource-id {webapp_id} '
                          '--group-id sites --manual-request').get_output_in_json()
        self.assertTrue(self.kwargs['endpoint_name'].lower() in result['name'].lower())
    
        result = self.cmd('network private-endpoint-connection list -g {resource_group} -n {webapp_name} --type Microsoft.Web/sites', checks=[
            self.check('length(@)', 1),
        ]).get_output_in_json()
        self.kwargs['endpoint_request'] = result[0]['name']
    
>       self.cmd('network private-endpoint-connection approve -g {resource_group} --resource-name {webapp_name} -n {endpoint_request} --type Microsoft.Web/sites',
                 checks=[self.check('properties.privateLinkServiceConnectionState.status', 'Approved')])

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_private_endpoint_commands.py:808: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x000001C93C7D8760>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93D7CEDC0>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'properties.privateLinkServiceConnectionState.status' doesn't yield expected value 'Approved', instead the actual value is 'Approving'. Data: 
E               {
E                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa/providers/Microsoft.Web/sites/webapp-privatelink-webappz4k2pmq6muv3nt4/privateEndpointConnections/webapp-privatelink-endpointconnspvkf4vcc-3112b5cd-2494-4760-b75e-31bbb0e9c88e",
E                 "name": "webapp-privatelink-endpointconnspvkf4vcc-3112b5cd-2494-4760-b75e-31bbb0e9c88e",
E                 "properties": {
E                   "ipAddresses": [],
E                   "privateEndpoint": {
E                     "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa/providers/Microsoft.Network/privateEndpoints/webapp-privatelink-endpointffwl5ledn2t6n",
E                     "resourceGroup": "clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa"
E                   },
E                   "privateLinkServiceConnectionState": {
E                     "actionsRequired": "None",
E                     "description": "",
E                     "status": "Approving"
E                   },
E                   "provisioningState": "Pending"
E                 },
E                 "resourceGroup": "clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa",
E                 "type": "Microsoft.Web/sites/privateEndpointConnections"
E               }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa --tag product=azurecli cause=automation date=2020-12-18T09:08:07Z" => 0. 

Command "network vnet create -n webapp-privatelink-vnetgbnrjq3jhxyniobxc -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa --subnet-name webapp-privatelink-subnetirvbn4piow3c2x2" => 0. 

Command "network vnet subnet update -n webapp-privatelink-subnetirvbn4piow3c2x2 --vnet-name webapp-privatelink-vnetgbnrjq3jhxyniobxc -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa --disable-private-endpoint-network-policies true" => 0. 

Command "appservice plan create -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa -n webapp-privatelink-asptkctujhsfwnfb5kqxt --sku P1V2" => 0. 

Command "webapp create -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa -n webapp-privatelink-webappz4k2pmq6muv3nt4 --plan webapp-privatelink-asptkctujhsfwnfb5kqxt" => 0. 

Command "network private-endpoint create -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa -n webapp-privatelink-endpointffwl5ledn2t6n --vnet-name webapp-privatelink-vnetgbnrjq3jhxyniobxc --subnet webapp-privatelink-subnetirvbn4piow3c2x2 --connection-name webapp-privatelink-endpointconnspvkf4vcc --private-connection-resource-id /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa/providers/Microsoft.Web/sites/webapp-privatelink-webappz4k2pmq6muv3nt4 --group-id sites --manual-request" => 0. 

Resource ID will be ignored since other three arguments have been provided.
Command "network private-endpoint-connection list -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa -n webapp-privatelink-webappz4k2pmq6muv3nt4 --type Microsoft.Web/sites" => 0. 

Resource ID will be ignored since other three arguments have been provided.
Cannot query the state of private endpoint connection. Please use `az network private-endpoint-connection show` command to check the status.
Command "network private-endpoint-connection approve -g clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa --resource-name webapp-privatelink-webappz4k2pmq6muv3nt4 -n webapp-privatelink-endpointconnspvkf4vcc-3112b5cd-2494-4760-b75e-31bbb0e9c88e --type Microsoft.Web/sites" => 0. 

Command "az group delete --name clitest.rgqyv2sn5vlv4bp2auuv5twfqtpanpsxij3bleg7ojdq3qi6skvuq26i4ty25xo5ypa --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.web.v2019_08_01.models._models_py3.AppServicePlan'>
_ NetworkPrivateLinkAppGwScenarioTest.test_appgw_private_endpoint_with_default _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93C7F8280>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93D6B3550>
command = 'network application-gateway create -g test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd -n appgw --sku Standard_v2 --public-ip-address appgw_ip --enable-private-link'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D6B3550>
args = ['network', 'application-gateway', 'create', '-g', 'test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93D080C10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D6B3550>
ex = CLIError(CLIError('Deployment failed. Correlation ID: 15d69263-e165-4f19-8443-a1c9f506dbb8. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CLIError('Deployment failed. Correlation ID: 15d69263-e165-4f19-8443-a1c9f506dbb8. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_private_endpoint_commands.NetworkPrivateLinkAppGwScenarioTest testMethod=test_appgw_private_endpoint_with_default>
resource_group = 'test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd'

    @ResourceGroupPreparer(name_prefix='test_appgw_private_endpoint_with_default')
    def test_appgw_private_endpoint_with_default(self, resource_group):
        self.kwargs.update({
            'appgw': 'appgw',
            'appgw_pe_vnet': 'appgw_private_endpoint_vnet',
            'appgw_pe_subnet': 'appgw_private_endpoint_subnet',
            'appgw_ip': 'appgw_ip',
            'appgw_pe': 'appgw_private_endpoint',
            'appgw_pec': 'appgw_private_endpoint_connection'
        })
    
        # Enable private link feature on Application Gateway would require a public IP with Standard tier
        self.cmd('network public-ip create -g {rg} -n {appgw_ip} --sku Standard')
    
        # Prepare the vnet to be connected to
        self.cmd('network vnet create -g {rg} -n {appgw_pe_vnet} --subnet-name {appgw_pe_subnet}')
        # Enable private endpoint on a vnet would require --disable-private-endpoint-network-policies=true
        self.cmd('network vnet subnet update -g {rg} -n {appgw_pe_subnet} '
                 '--vnet-name {appgw_pe_vnet} '
                 '--disable-private-endpoint-network-policies true')
    
        # Enable private link feature on Application Gateway would require Standard_v2,WAF_v2 SKU tiers
        # --enable-private-link would enable private link feature with default settings
>       self.cmd('network application-gateway create -g {rg} -n {appgw} '
                 '--sku Standard_v2 '
                 '--public-ip-address {appgw_ip} '
                 '--enable-private-link')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_private_endpoint_commands.py:1056: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 15d69263-e165-4f19-8443-a1c9f506dbb8. {\r\n  "error": {\r\n    "code": "S...r feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}')

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Deployment failed. Correlation ID: 15d69263-e165-4f19-8443-a1c9f506dbb8. {
E             "error": {
E               "code": "SubscriptionNotRegisteredForFeature",
E               "message": "Subscription /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups//providers/Microsoft.Network/subscriptions/ is not registered for feature PrivateLinkConfigurations required to carry out the requested operation.",
E               "details": []
E             }
E           }

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd --tag product=azurecli cause=automation date=2020-12-18T09:12:46Z" => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "network public-ip create -g test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd -n appgw_ip --sku Standard" => 0. 

Command "network vnet create -g test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd -n appgw_private_endpoint_vnet --subnet-name appgw_private_endpoint_subnet" => 0. 

Command "network vnet subnet update -g test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd -n appgw_private_endpoint_subnet --vnet-name appgw_private_endpoint_vnet --disable-private-endpoint-network-policies true" => 0. 

Command "az group delete --name test_appgw_private_endpoint_with_defaultwq37alr2koeeygwzoscyu7ajjs6qp5sa2dd --yes --no-wait" => 0. 

_ NetworkPrivateLinkAppGwScenarioTest.test_appgw_private_endpoint_with_overwrite_default _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93D7A37C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93ECB1E50>
command = 'network application-gateway create -g test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph -n ...e-link --private-link-subnet YetAnotherSubnetName --private-link-primary true --private-link-subnet-prefix 10.0.2.0/24'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93ECB1E50>
args = ['network', 'application-gateway', 'create', '-g', 'test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93D6D4B80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93ECB1E50>
ex = CLIError(CLIError('Deployment failed. Correlation ID: 598086dd-7f32-40b9-97aa-c86c9eedfbb3. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CLIError('Deployment failed. Correlation ID: 598086dd-7f32-40b9-97aa-c86c9eedfbb3. {\r\n  "error": {\r\n    "... feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}'))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.network.tests.latest.test_private_endpoint_commands.NetworkPrivateLinkAppGwScenarioTest testMethod=test_appgw_private_endpoint_with_overwrite_default>
resource_group = 'test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph'

    @ResourceGroupPreparer(name_prefix='test_appgw_private_endpoint_with_overwrite_default')
    def test_appgw_private_endpoint_with_overwrite_default(self, resource_group):
        self.kwargs.update({
            'appgw': 'appgw',
            'appgw_pe_vnet': 'appgw_private_endpoint_vnet',
            'appgw_pe_subnet': 'appgw_private_endpoint_subnet',
            'appgw_ip': 'appgw_ip',
            'appgw_pe': 'appgw_private_endpoint',
            'appgw_pec': 'appgw_private_endpoint_connection'
        })
    
        # Enable private link feature on Application Gateway would require a public IP with Standard tier
        self.cmd('network public-ip create -g {rg} -n {appgw_ip} --sku Standard')
    
        # Prepare the vnet to be connected to
        self.cmd('network vnet create -g {rg} -n {appgw_pe_vnet} --subnet-name {appgw_pe_subnet}')
        # Enable private endpoint on a vnet would require --disable-private-endpoint-network-policies=true
        self.cmd('network vnet subnet update -g {rg} -n {appgw_pe_subnet} '
                 '--vnet-name {appgw_pe_vnet} '
                 '--disable-private-endpoint-network-policies true')
    
        # Enable private link feature on Application Gateway would require Standard_v2,WAF_v2 SKU tiers
        # --enable-private-link would enable private link feature with default settings
>       self.cmd('network application-gateway create -g {rg} -n {appgw} '
                 '--sku Standard_v2 '
                 '--public-ip-address {appgw_ip} '
                 '--enable-private-link '
                 '--private-link-subnet YetAnotherSubnetName '
                 '--private-link-primary true '
                 '--private-link-subnet-prefix 10.0.2.0/24')

src\azure-cli\azure\cli\command_modules\network\tests\latest\test_private_endpoint_commands.py:1142: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 598086dd-7f32-40b9-97aa-c86c9eedfbb3. {\r\n  "error": {\r\n    "code": "S...r feature PrivateLinkConfigurations required to carry out the requested operation.",\r\n    "details": []\r\n  }\r\n}')

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Deployment failed. Correlation ID: 598086dd-7f32-40b9-97aa-c86c9eedfbb3. {
E             "error": {
E               "code": "SubscriptionNotRegisteredForFeature",
E               "message": "Subscription /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups//providers/Microsoft.Network/subscriptions/ is not registered for feature PrivateLinkConfigurations required to carry out the requested operation.",
E               "details": []
E             }
E           }

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph --tag product=azurecli cause=automation date=2020-12-18T09:13:41Z" => 0. 

[Coming breaking change] In the coming release, the default behavior will be changed as follows when sku is Standard and zone is not provided: For zonal regions, you will get a zone-redundant IP indicated by zones:["1","2","3"]; For non-zonal regions, you will get a non zone-redundant IP indicated by zones:[].
Command "network public-ip create -g test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph -n appgw_ip --sku Standard" => 0. 

Command "network vnet create -g test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph -n appgw_private_endpoint_vnet --subnet-name appgw_private_endpoint_subnet" => 0. 

Command "network vnet subnet update -g test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph -n appgw_private_endpoint_subnet --vnet-name appgw_private_endpoint_vnet --disable-private-endpoint-network-policies true" => 0. 

Command "az group delete --name test_appgw_private_endpoint_with_overwrite_defaultuejiscduyu2xe35z3phfngfph --yes --no-wait" => 0. 

______ HDInsightClusterTests.test_hdinsight_cluster_with_cluster_config _______
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023819CDD430>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x00000238185E09A0>
command = 'hdinsight create -n hdicli-kqvrm5fco -g hdicli-5xdjn -l eastus2 -p Password1! -t spark --no-validation-timeout --stor...v --storage-container default --cluster-configurations {\\"gateway\\":{\\"restAuthCredential.username\\":\\"admin\\"}}'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238185E09A0>
args = ['hdinsight', 'create', '-n', 'hdicli-kqvrm5fco', '-g', 'hdicli-5xdjn', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023819B30DC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x00000238185E09A0>
ex = CLIError('Deployment failed. Correlation ID: b5c0c333-df67-45f6-9d4d-365bc9faecb0. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: b5c0c333-df67-45f6-9d4d-365bc9faecb0. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_cluster_config>
storage_account_info = ('hdiclieq7u634muwafvgsrcv', 'KKklUR4aI2Pm9cPh3CCl/9jyIJuBaoiM1/zn7gIH9rb9osRrzaN66Lc2UWPwP2ByI8RjR2dt0lEdP7uThxSVTQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_cluster_config(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_cluster_config()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:93: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: b5c0c333-df67-45f6-9d4d-365bc9faecb0. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-5xdjn --tag product=azurecli cause=automation date=2020-12-18T09:27:00Z" => 0. 

Command "az storage account create -n hdiclieq7u634muwafvgsrcv -g hdicli-5xdjn -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclieq7u634muwafvgsrcv -g hdicli-5xdjn --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-5xdjn --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____ HDInsightClusterTests.test_hdinsight_cluster_with_encryption_at_host _____
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381A6972E0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381A128580>
command = 'hdinsight create -n hdicli-nol3xrhld -g hdicli-nazp7 -l eastus2 -p Password1! -t spark --no-validation-timeout --stor...size Standard_DS14_V2 --headnode-size Standard_DS14_V2 --zookeepernode-size Standard_DS14_V2 --encryption-at-host true'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A128580>
args = ['hdinsight', 'create', '-n', 'hdicli-nol3xrhld', '-g', 'hdicli-nazp7', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381A526CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A128580>
ex = CLIError('Deployment failed. Correlation ID: fd7bf7df-2e3d-41e9-be95-841c4a246953. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: fd7bf7df-2e3d-41e9-be95-841c4a246953. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_encryption_at_host>
storage_account_info = ('hdicliohkuxxakdyl7jwi5am', 'BqCEu8Q+9MGGX/xgsmMx7s/9/6WoHKIhLCShp4wJ9nEqRAf+vW6aHBoMXaWbq5J32YWS8jvi5dfiL747E4QARg==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_encryption_at_host(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_encryption_at_host()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: fd7bf7df-2e3d-41e9-be95-841c4a246953. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-nazp7 --tag product=azurecli cause=automation date=2020-12-18T09:54:02Z" => 0. 

Command "az storage account create -n hdicliohkuxxakdyl7jwi5am -g hdicli-nazp7 -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicliohkuxxakdyl7jwi5am -g hdicli-nazp7 --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-nazp7 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
___ HDInsightClusterTests.test_hdinsight_cluster_with_encryption_in_transit ___
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381AB03400>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381A9BE0D0>
command = 'hdinsight create -n hdicli-xgfoe4q7m -g hdicli-kqpbq -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclijhxl54wn4t4hesaus5 --storage-container default --encryption-in-transit true'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A9BE0D0>
args = ['hdinsight', 'create', '-n', 'hdicli-xgfoe4q7m', '-g', 'hdicli-kqpbq', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381A88EDC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A9BE0D0>
ex = CLIError("Deployment failed. Correlation ID: ef41ecf4-79b5-44bd-879e-cb0c0a2d8845. [{'errorSource': '$', 'messageArgum...he chosen HDI image version: 3.6.1000.3.1806251927. Please try with a newer HDI image version 2006290000 or later.'}]")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError("Deployment failed. Correlation ID: ef41ecf4-79b5-44bd-879e-cb0c0a2d8845. [{'errorSource': '$', 'messageArgum...he chosen HDI image version: 3.6.1000.3.1806251927. Please try with a newer HDI image version 2006290000 or later.'}]")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_encryption_in_transit>
storage_account_info = ('hdiclijhxl54wn4t4hesaus5', '0tNznUrFZUhx4h3mho/ZdK8LCF7Ry9MKxC+mErynQBkRnFGZSgMduHg8T4IfGG/SBqBznopJpE1fxs2w3WrAIQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_encryption_in_transit(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_encryption_in_transit()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:123: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError([{'errorSource': '$', 'messageArguments': ['3.6.1000.3.1806251927', '2006290000'], 'code': 'EncryptionInTra...the chosen HDI image version: 3.6.1000.3.1806251927. Please try with a newer HDI image version 2006290000 or later.'}])

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: ef41ecf4-79b5-44bd-879e-cb0c0a2d8845. [{'errorSource': '$', 'messageArguments': ['3.6.1000.3.1806251927', '2006290000'], 'code': 'EncryptionInTransitNotSupportedForImageVersion', 'message': 'Encryption-in-Transit is not supported for the chosen HDI image version: 3.6.1000.3.1806251927. Please try with a newer HDI image version 2006290000 or later.'}]

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-kqpbq --tag product=azurecli cause=automation date=2020-12-18T10:02:41Z" => 0. 

Command "az storage account create -n hdiclijhxl54wn4t4hesaus5 -g hdicli-kqpbq -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclijhxl54wn4t4hesaus5 -g hdicli-kqpbq --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-kqpbq --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____ HDInsightClusterTests.test_hdinsight_cluster_with_minimal_tls_version ____
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023819EC7CA0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023819F3A250>
command = 'hdinsight create -n hdicli-gv5hwvbfk -g hdicli-ak3df -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdicli55gdbqbdvmqpwumfh7 --storage-container default --minimal-tls-version 1.2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819F3A250>
args = ['hdinsight', 'create', '-n', 'hdicli-gv5hwvbfk', '-g', 'hdicli-ak3df', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381A99F820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819F3A250>
ex = CLIError('Deployment failed. Correlation ID: faf505d7-cd0a-4798-bace-10d1eace21e5. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: faf505d7-cd0a-4798-bace-10d1eace21e5. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_minimal_tls_version>
storage_account_info = ('hdicli55gdbqbdvmqpwumfh7', 'SQdeqHSLFV8A/IkEb1K2DM7/bVLKjr15EZwqAUnUnyK+8RF85opZV0MLZ3KDF7NF++LHlQ+0E7OlQQuVqs8Ycw==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_minimal_tls_version(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_minimal_tls_version('1.2')
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: faf505d7-cd0a-4798-bace-10d1eace21e5. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-ak3df --tag product=azurecli cause=automation date=2020-12-18T10:29:09Z" => 0. 

Command "az storage account create -n hdicli55gdbqbdvmqpwumfh7 -g hdicli-ak3df -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicli55gdbqbdvmqpwumfh7 -g hdicli-ak3df --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-ak3df --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
___ HDInsightClusterTests.test_hdinsight_cluster_with_relay_and_privatelink ___
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381AB962E0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381A48D0D0>
command = 'hdinsight create -n hdicli-d5une57dy -g hdicli-7ff5t -l eastus2 -p Password1! -t spark --no-validation-timeout --stor...crosoft.Network/virtualNetworks/fakevnet/subnets/default --resource-provider-connection Outbound --enable-private-link'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A48D0D0>
args = ['hdinsight', 'create', '-n', 'hdicli-d5une57dy', '-g', 'hdicli-7ff5t', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381A4A2A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381A48D0D0>
ex = ErrorResponseException("Virtual Network '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg/provide...ge account 'hdicliq5gfpxh2py63f3vely' is not co-located with the cluster. Please select account from the same region.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ErrorResponseException("Virtual Network '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg/provide...ge account 'hdicliq5gfpxh2py63f3vely' is not co-located with the cluster. Please select account from the same region.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ErrorResponseException during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_relay_and_privatelink>
storage_account_info = ('hdicliq5gfpxh2py63f3vely', 'nUz4QvoEDOKPfd5bA8GSDvm1jchMZOCZVgijN81ex5T9O9ttHW1ItbqsnA5fxCzyJ+groQfb+pi5o7Q/exzdLQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_relay_and_privatelink(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_relay_outbound_and_private_link()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:178: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\hdinsight\custom.py:384: in create_cluster
    return client.create(resource_group_name, cluster_name, create_params)
env\lib\site-packages\azure\mgmt\hdinsight\operations\_clusters_operations.py:118: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.hdinsight.operations._clusters_operations.ClustersOperations object at 0x000002381ABC57F0>
resource_group_name = 'hdicli-7ff5t', cluster_name = 'hdicli-d5une57dy'
parameters = <azure.mgmt.hdinsight.models._models_py3.ClusterCreateParametersExtended object at 0x000002381ABDCB20>
custom_headers = None, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/hdicli-7ff5t/providers/Microsoft.HDInsight/clusters/hdicli-d5une57dy'
path_format_arguments = {'clusterName': 'hdicli-d5une57dy', 'resourceGroupName': 'hdicli-7ff5t', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2018-06-01-preview'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'southcentralus', 'properties': {'clusterDefinition': {'configurations': {'gateway': {'restAuthCredential...anceCount': 3, ...}]}, 'networkProperties': {'privateLink': 'Enabled', 'resourceProviderConnection': 'Outbound'}, ...}}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_initial(
            self, resource_group_name, cluster_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'clusterName': self._serialize.url("cluster_name", cluster_name, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'ClusterCreateParametersExtended')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200]:
>           raise models.ErrorResponseException(self._deserialize, response)
E           azure.mgmt.hdinsight.models._models_py3.ErrorResponseException: Virtual Network '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg/providers/Microsoft.Network/virtualNetworks/fakevnet' or Subnet '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/rg/providers/Microsoft.Network/virtualNetworks/fakevnet/subnets/default' is not in user subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321',Provided storage account 'hdicliq5gfpxh2py63f3vely' is not co-located with the cluster. Please select account from the same region.

env\lib\site-packages\azure\mgmt\hdinsight\operations\_clusters_operations.py:80: ErrorResponseException
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-7ff5t --tag product=azurecli cause=automation date=2020-12-18T10:37:23Z" => 0. 

Command "az storage account create -n hdicliq5gfpxh2py63f3vely -g hdicli-7ff5t -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicliq5gfpxh2py63f3vely -g hdicli-7ff5t --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-7ff5t --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_________ HDInsightClusterTests.test_hdinsight_cluster_with_ssh_creds _________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381B55E370>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381AFC79A0>
command = 'hdinsight create -n hdicli-ifi3fnlwd -g hdicli-z4vzh -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclir7oux55tpefkn2s2g4 --storage-container default --ssh-user sshuser --ssh-password Password1!'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381AFC79A0>
args = ['hdinsight', 'create', '-n', 'hdicli-ifi3fnlwd', '-g', 'hdicli-z4vzh', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381B3E6310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381AFC79A0>
ex = CLIError('Deployment failed. Correlation ID: b6761da8-2b03-4040-80cd-3ef8923940a9. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: b6761da8-2b03-4040-80cd-3ef8923940a9. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_cluster_with_ssh_creds>
storage_account_info = ('hdiclir7oux55tpefkn2s2g4', 'DMqSw0Td94k7eNtTspi7GeQQvVJvcVnv9xIdU449+kKNZvryVeu8/seVB2pXH+v2CYfsPHRuJOJuyTzZSnP3/A==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_cluster_with_ssh_creds(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_explicit_ssh_creds()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:102: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: b6761da8-2b03-4040-80cd-3ef8923940a9. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-z4vzh --tag product=azurecli cause=automation date=2020-12-18T11:00:20Z" => 0. 

Command "az storage account create -n hdiclir7oux55tpefkn2s2g4 -g hdicli-z4vzh -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclir7oux55tpefkn2s2g4 -g hdicli-z4vzh --query "[0].value" -otsv" => 0. 

Command "az group delete --name hdicli-z4vzh --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
________________ HDInsightClusterTests.test_hdinsight_monitor _________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381AA986A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023819CDDA60>
command = 'hdinsight create -n hdicli-3ieneho62 -g hdicli-ynfpf -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclik2owak6bc3trpdwe72 --storage-container default --ssh-user sshuser --ssh-password Password1!'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819CDDA60>
args = ['hdinsight', 'create', '-n', 'hdicli-3ieneho62', '-g', 'hdicli-ynfpf', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381B3DDEE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023819CDDA60>
ex = CLIError('Deployment failed. Correlation ID: 06ac0188-202a-43a5-a2f7-188fe37bf5ed. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 06ac0188-202a-43a5-a2f7-188fe37bf5ed. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_monitor>
storage_account_info = ('hdiclik2owak6bc3trpdwe72', 'DcEWOwMWVbOxCu5/eD/Z2SExMecGaz5d0F0SnbS00eTkrOedR5sAENmPbMOIIRm+BeZhu+fXT5jeMFo5m/sTfQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_monitor(self, storage_account_info):
        self.kwargs.update({
            'ws': self.create_random_name('testws', 20),
            'la_prop_path': os.path.join(TEST_DIR, 'loganalytics.json')
        })
    
        ws_response = self.cmd('resource create -g {rg} -n {ws} '
                               '--resource-type Microsoft.OperationalInsights/workspaces -p @"{la_prop_path}"') \
            .get_output_in_json()
        ws_customer_id = ws_response['properties']['customerId']
    
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_explicit_ssh_creds()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:250: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 06ac0188-202a-43a5-a2f7-188fe37bf5ed. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-ynfpf --tag product=azurecli cause=automation date=2020-12-18T11:08:00Z" => 0. 

Command "az storage account create -n hdiclik2owak6bc3trpdwe72 -g hdicli-ynfpf -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclik2owak6bc3trpdwe72 -g hdicli-ynfpf --query "[0].value" -otsv" => 0. 

Command "resource create -g hdicli-ynfpf -n testwsqexd5gqgdyr23i --resource-type Microsoft.OperationalInsights/workspaces -p @"c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\loganalytics.json"" => 0. 

Command "az group delete --name hdicli-ynfpf --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____________ HDInsightClusterTests.test_hdinsight_script_action ______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238192A0910>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381B00E5E0>
command = 'hdinsight create -n hdicli-lbseob7kj -g hdicli-xtk4p -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdicliasuzwnzgra6n5znzrl --storage-container default --ssh-user sshuser --ssh-password Password1!'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B00E5E0>
args = ['hdinsight', 'create', '-n', 'hdicli-lbseob7kj', '-g', 'hdicli-xtk4p', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381A7DDDC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B00E5E0>
ex = CLIError('Deployment failed. Correlation ID: 8b3781d8-7fcb-4038-91dc-e07362edfde0. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 8b3781d8-7fcb-4038-91dc-e07362edfde0. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_script_action>
storage_account_info = ('hdicliasuzwnzgra6n5znzrl', 'v8dlo23zb81/SyJZyjPWNI9xrkuhMW/wqvlgdV6d/UmRaWvagtRtKU3CRqyA0QSFjhUL1t+wc4D7puGeTNW9ZQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_script_action(self, storage_account_info):
        self.kwargs.update({
            'script_uri': 'https://hdiconfigactions.blob.core.windows.net/linuxgiraphconfigactionv01/giraph-installer-v01.sh',
            'script_action': 'InstallGiraph',
            'script_action_1': 'InstallGiraph1',
            'head_node': 'headnode',
            'worker_node': 'workernode'
        })
    
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info),
            HDInsightClusterTests._with_explicit_ssh_creds()
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:291: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 8b3781d8-7fcb-4038-91dc-e07362edfde0. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-xtk4p --tag product=azurecli cause=automation date=2020-12-18T11:15:44Z" => 0. 

Command "az storage account create -n hdicliasuzwnzgra6n5znzrl -g hdicli-xtk4p -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdicliasuzwnzgra6n5znzrl -g hdicli-xtk4p --query "[0].value" -otsv" => 0. 

Command "az group delete --name hdicli-xtk4p --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____________ HDInsightClusterTests.test_hdinsight_virtual_machine _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381B751880>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381B9E6AC0>
command = 'hdinsight create -n hdicli-d72hsw3l7 -g hdicli-3qrm4 -l eastus2 -p Password1! -t spark --no-validation-timeout --storage-account hdiclipsejczwsnvvxaz3jmr --storage-container default'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B9E6AC0>
args = ['hdinsight', 'create', '-n', 'hdicli-d72hsw3l7', '-g', 'hdicli-3qrm4', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381AD54B80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B9E6AC0>
ex = CLIError('Deployment failed. Correlation ID: 23d6c842-1d9b-4427-82bf-04cb8c907350. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 23d6c842-1d9b-4427-82bf-04cb8c907350. DeploymentDocument \'AmbariConfigur...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.hdinsight.tests.latest.test_hdinsight_commands.HDInsightClusterTests testMethod=test_hdinsight_virtual_machine>
storage_account_info = ('hdiclipsejczwsnvvxaz3jmr', 'jbkk/ASwtYTizd9aXI9sH21tDaPsbESohDmz/06nSGUrunrvmMgvNnlySy5eJ4EtNv+cUlh3vgbEv/+YjSzisQ==\n')

    @ResourceGroupPreparer(name_prefix='hdicli-', location=location, random_name_length=12)
    @StorageAccountPreparer(name_prefix='hdicli', location=location, parameter_name='storage_account')
    def test_hdinsight_virtual_machine(self, storage_account_info):
>       self._create_hdinsight_cluster(
            HDInsightClusterTests._wasb_arguments(storage_account_info)
        )

src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\hdinsight\tests\latest\test_hdinsight_commands.py:503: in _create_hdinsight_cluster
    self.cmd(create_cluster_format, checks=[
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('DeploymentDocument \'AmbariConfiguration\' failed the validation. Error: \'{\n  "status" : 400,\n  "messag...re not defined in the stack: [livy2-client-conf] "\n}. Please use only the valid configuration types and try again.\'')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 23d6c842-1d9b-4427-82bf-04cb8c907350. DeploymentDocument 'AmbariConfiguration' failed the validation. Error: '{
E         "status" : 400,
E         "message" : "Topology validation failed: org.apache.ambari.server.topology.InvalidTopologyException: The following config types are not defined in the stack: [livy2-client-conf] "
E       }. Please use only the valid configuration types and try again.'

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name hdicli-3qrm4 --tag product=azurecli cause=automation date=2020-12-18T11:23:24Z" => 0. 

Command "az storage account create -n hdiclipsejczwsnvvxaz3jmr -g hdicli-3qrm4 -l eastus2 --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n hdiclipsejczwsnvvxaz3jmr -g hdicli-3qrm4 --query "[0].value" -otsv" => 0. 

SSH credentials not specified. Using the HTTP password as the SSH password.
Command "az group delete --name hdicli-3qrm4 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
________________________ IoTHubTest.test_identity_hub _________________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381C364370>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381BAA91F0>
command = 'iot hub update -n identity-test-hub-cli --fsa identityBased --fcs DefaultEndpointsProtocol=https;EndpointSuffix=core....nJC86D3toxX7t9nO5w== --fc iothubcontainer --fn true --fnt 32 --fnd 80 --rd 4 --ct 34 --cdd 46 --ft 43 --fld 10 --fd 76'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BAA91F0>
args = ['iot', 'hub', 'update', '-n', 'identity-test-hub-cli', '--fsa', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381543DE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BAA91F0>
ex = ErrorDetailsException('Storage endpoint property containerName or connectionString is invalid. If you contact a suppor...s correlation identifier: 0b6425ad-e47b-4170-af0b-83c2a1fa240c, timestamp: 2020-12-18 11:40:08Z, errorcode: IH400029.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ErrorDetailsException('Storage endpoint property containerName or connectionString is invalid. If you contact a suppor...s correlation identifier: 0b6425ad-e47b-4170-af0b-83c2a1fa240c, timestamp: 2020-12-18 11:40:08Z, errorcode: IH400029.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ErrorDetailsException during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.iot.tests.latest.test_iot_commands.IoTHubTest testMethod=test_identity_hub>
resource_group = 'clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle'
resource_group_location = 'westus2'
storage_account = 'clitestbii4gs3fe3paz5wq5'

    @AllowLargeResponse()
    @ResourceGroupPreparer(location='westus2')
    @StorageAccountPreparer()
    def test_identity_hub(self, resource_group, resource_group_location, storage_account):
        # Test IoT Hub create with identity
        subscription_id = self.get_subscription_id()
        rg = resource_group
        location = resource_group_location
    
        private_endpoint_type = 'Microsoft.Devices/IoTHubs'
        identity_hub = 'identity-test-hub-cli'
        identity_based_auth = 'identityBased'
        event_hub_identity_endpoint_name = 'EventHubIdentityEndpoint'
    
        containerName = 'iothubcontainer'
        storageConnectionString = self._get_azurestorage_connectionstring(rg, containerName, storage_account)
        endpoint_name = 'Event1'
        endpoint_type = 'EventHub'
        eventhub_endpoint_uri = 'eh://test'
        storage_cs_pattern = 'DefaultEndpointsProtocol=https;EndpointSuffix=core.windows.net;AccountName='
        entity_path = 'entity'
    
        # identity hub creation
        import os
        templateFile = os.path.join(os.path.dirname(os.path.abspath(__file__)), os.path.pardir, 'templates', 'identity.json')
        self.cmd('deployment group create --name {0} -g {1} --template-file "{2}" --parameters name={3} --parameters location={4}'
                 .format("identity-hub-deployment", resource_group, templateFile, identity_hub, location))
        self.cmd('iot hub show --name {0}'.format(identity_hub), checks=[
                 self.check('properties.minTlsVersion', '1.2'),
                 self.check('identity.type', 'SystemAssigned')])
    
        # Test 'az iot hub update' with Identity-based fileUpload
>       updated_hub = self.cmd('iot hub update -n {0} --fsa {1} --fcs {2} --fc {3} --fn true --fnt 32 --fnd 80 --rd 4 '
                               '--ct 34 --cdd 46 --ft 43 --fld 10 --fd 76'
                               .format(identity_hub, identity_based_auth, storageConnectionString, containerName)).get_output_in_json()

src\azure-cli\azure\cli\command_modules\iot\tests\latest\test_iot_commands.py:427: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:567: in handler
    result = cached_put(cmd, setter, **setterargs)
src\azure-cli-core\azure\cli\core\commands\__init__.py:444: in cached_put
    return _put_operation()
src\azure-cli-core\azure\cli\core\commands\__init__.py:438: in _put_operation
    result = operation(**kwargs)
src\azure-cli\azure\cli\command_modules\iot\custom.py:532: in iot_hub_update
    return client.iot_hub_resource.create_or_update(resource_group_name, hub_name, parameters, {'IF-MATCH': parameters.etag})
env\lib\site-packages\azure\mgmt\iothub\v2020_03_01\operations\_iot_hub_resource_operations.py:193: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.iothub.v2020_03_01.operations._iot_hub_resource_operations.IotHubResourceOperations object at 0x000002381C6503D0>
resource_group_name = 'clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle'
resource_name = 'identity-test-hub-cli'
iot_hub_description = <azure.mgmt.iothub.v2020_03_01.models._models_py3.IotHubDescription object at 0x000002381C6570D0>
if_match = {'IF-MATCH': 'AAAABo2qp/o='}, custom_headers = None, raw = True
operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle/providers/Microsoft.Devices/IotHubs/identity-test-hub-cli'
path_format_arguments = {'resourceGroupName': 'clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle', 'resourceName': 'identity-test-hub-cli', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2020-03-01'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'If-Match': "{'IF-MATCH': 'AAAABo2qp/o='}", 'accept-language': 'en-US'}
body_content = {'etag': 'AAAABo2qp/o=', 'location': 'westus2', 'properties': {'cloudToDevice': {'defaultTtlAsIso8601': 'P1DT10H', 'fe... {'partitionCount': 4, 'retentionTimeInDays': 4}}, 'features': 'None', ...}, 'sku': {'capacity': 1, 'name': 'S1'}, ...}
request = <ClientRequest [PUT]>, response = <Response [400]>

    def _create_or_update_initial(
            self, resource_group_name, resource_name, iot_hub_description, if_match=None, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'resourceName': self._serialize.url("resource_name", resource_name, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if if_match is not None:
            header_parameters['If-Match'] = self._serialize.header("if_match", if_match, 'str')
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(iot_hub_description, 'IotHubDescription')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201]:
>           raise models.ErrorDetailsException(self._deserialize, response)
E           azure.mgmt.iothub.v2020_03_01.models._models_py3.ErrorDetailsException: Storage endpoint property containerName or connectionString is invalid. If you contact a support representative please include this correlation identifier: 0b6425ad-e47b-4170-af0b-83c2a1fa240c, timestamp: 2020-12-18 11:40:08Z, errorcode: IH400029.

env\lib\site-packages\azure\mgmt\iothub\v2020_03_01\operations\_iot_hub_resource_operations.py:144: ErrorDetailsException
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus2 --name clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle --tag product=azurecli cause=automation date=2020-12-18T11:36:05Z" => 0. 

Command "az storage account create -n clitestbii4gs3fe3paz5wq5 -g clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestbii4gs3fe3paz5wq5 -g clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle --query "[0].value" -otsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

There are no credentials provided in your command and environment, we will query for the account key inside your storage account. 
Please provide --connection-string, --account-key or --sas-token as credentials, or use `--auth-mode login` if you have required RBAC roles in your command. For more information about RBAC roles in storage, visit https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad-rbac-cli. 
Setting the corresponding environment variables can avoid inputting credentials in your command. Please use --help to get more information.
Command "storage container create --name iothubcontainer --account-name clitestbii4gs3fe3paz5wq5" => 0. 

Command "storage account show-connection-string --resource-group clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle --name clitestbii4gs3fe3paz5wq5" => 0. 

Command "deployment group create --name identity-hub-deployment -g clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle --template-file "c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\iot\tests\latest\..\templates\identity.json" --parameters name=identity-test-hub-cli --parameters location=westus2" => 0. 

Command "iot hub show --name identity-test-hub-cli" => 0. 

Command "az group delete --name clitest.rgpajm3gjwnfyef5pchsad3g6jfa5tio26pzp6fzsqabzimq2l6phoz5zd52ic3mlle --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
______ DeploymentTestAtManagementGroup.test_management_group_deployment _______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C744FEDF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C78431BE0>
command = 'deployment mg validate --management-group-id azure-cli-managementxrdk7z3dvp --location WestUS --template-file "C:\\\\...="azure-cli-sub-resource-groupqacfxvmgoivvkdsmmro6rj6ch3so7ttf" --parameters storageAccountName="armbuilddemow7mw7dtt"'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C78431BE0>
args = ['deployment', 'mg', 'validate', '--management-group-id', 'azure-cli-managementxrdk7z3dvp', '--location', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7C5B8AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C78431BE0>
ex = CLIError(ClientRequestError("Error occurred in request., RetryError: HTTPSConnectionPool(host='management.azure.com', ...ement_group_level_template/validate?api-version=2020-10-01 (Caused by ResponseError('too many 500 error responses'))"))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(ClientRequestError("Error occurred in request., RetryError: HTTPSConnectionPool(host='management.azure.com', ...ement_group_level_template/validate?api-version=2020-10-01 (Caused by ResponseError('too many 500 error responses'))"))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.resource.tests.latest.test_resource.DeploymentTestAtManagementGroup testMethod=test_management_group_deployment>

    def test_management_group_deployment(self):
        curr_dir = os.path.dirname(os.path.realpath(__file__))
        self.kwargs.update({
            'tf': os.path.join(curr_dir, 'management_group_level_template.json').replace('\\', '\\\\'),
            'params': os.path.join(curr_dir, 'management_group_level_parameters.json').replace('\\', '\\\\'),
            'dn': self.create_random_name('azure-cli-management-group-deployment', 60),
            'mg': self.create_random_name('azure-cli-management', 30),
            'sub-rg': self.create_random_name('azure-cli-sub-resource-group', 60),
            'dn2': self.create_random_name('azure-cli-resource-group-deployment', 60),
            'storage-account-name': self.create_random_name('armbuilddemo', 20)
        })
    
        self.cmd('account management-group create --name {mg}', checks=[])
    
>       self.cmd('deployment mg validate --management-group-id {mg} --location WestUS --template-file "{tf}" '
                 '--parameters @"{params}" --parameters targetMG="{mg}" --parameters nestedRG="{sub-rg}" '
                 '--parameters storageAccountName="{storage-account-name}"',
                 checks=[self.check('properties.provisioningState', 'Succeeded'), ])

src\azure-cli\azure\cli\command_modules\resource\tests\latest\test_resource.py:1218: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ClientRequestError("Error occurred in request., RetryError: HTTPSConnectionPool(host='management.azure.com', port=443)...gement_group_level_template/validate?api-version=2020-10-01 (Caused by ResponseError('too many 500 error responses'))")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Error occurred in request., RetryError: HTTPSConnectionPool(host='management.azure.com', port=443): Max retries exceeded with url: /providers/Microsoft.Management/managementGroups/azure-cli-managementxrdk7z3dvp/providers/Microsoft.Resources/deployments/management_group_level_template/validate?api-version=2020-10-01 (Caused by ResponseError('too many 500 error responses'))

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "account management-group create --name azure-cli-managementxrdk7z3dvp" => 0. 

_____________ RoleAssignmentScenarioTest.test_role_assignment_e2e _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7EA27520>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7EA2F730>
command = 'ad user create --display-name tester123 --password Test123456789 --user-principal-name testuser2lv2fjf@azuresdkteam.onmicrosoft.com'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7EA2F730>
args = ['ad', 'user', 'create', '--display-name', 'tester123', '--password', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C038F69D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7EA2F730>
ex = CLIError('Insufficient privileges to complete the operation.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Insufficient privileges to complete the operation.'), args = ()
kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.role.tests.latest.test_role.RoleAssignmentScenarioTest testMethod=test_role_assignment_e2e>
resource_group = 'cli_role_assign5nlfzv2eddto7vxvclbmloalid5w43vnzxsfk6py4yodjhvvwcuet6qckihq'

    @ResourceGroupPreparer(name_prefix='cli_role_assign')
    @AllowLargeResponse()
    def test_role_assignment_e2e(self, resource_group):
        if self.run_under_service_principal():
            return  # this test delete users which are beyond a SP's capacity, so quit...
    
        with mock.patch('azure.cli.command_modules.role.custom._gen_guid', side_effect=self.create_guid):
            user = self.create_random_name('testuser', 15)
            self.kwargs.update({
                'upn': user + '@azuresdkteam.onmicrosoft.com',
                'nsg': 'nsg1'
            })
    
>           result = self.cmd('ad user create --display-name tester123 --password Test123456789'
                              ' --user-principal-name {upn}').get_output_in_json()

src\azure-cli\azure\cli\command_modules\role\tests\latest\test_role.py:277: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = GraphErrorException('Insufficient privileges to complete the operation.')

    def graph_err_handler(ex):
        from azure.graphrbac.models import GraphErrorException
        if isinstance(ex, GraphErrorException):
            from knack.util import CLIError
>           raise CLIError(ex.message)
E           knack.util.CLIError: Insufficient privileges to complete the operation.

src\azure-cli\azure\cli\command_modules\role\commands.py:68: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_role_assign5nlfzv2eddto7vxvclbmloalid5w43vnzxsfk6py4yodjhvvwcuet6qckihq --tag product=azurecli cause=automation date=2020-12-18T12:26:56Z" => 0. 

Command "account show" => 0. 

Command "az group delete --name cli_role_assign5nlfzv2eddto7vxvclbmloalid5w43vnzxsfk6py4yodjhvvwcuet6qckihq --yes --no-wait" => 0. 

_ RoleAssignmentScenarioTest.test_role_assignment_handle_conflicted_assignments _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7853B7F0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7B3661F0>
command = 'ad user create --display-name tester123 --password Test123456789 --user-principal-name testuserdb6qgxo@azuresdkteam.onmicrosoft.com'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7B3661F0>
args = ['ad', 'user', 'create', '--display-name', 'tester123', '--password', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7B763A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7B3661F0>
ex = CLIError('Insufficient privileges to complete the operation.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Insufficient privileges to complete the operation.'), args = ()
kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.role.tests.latest.test_role.RoleAssignmentScenarioTest testMethod=test_role_assignment_handle_conflicted_assignments>
resource_group = 'cli_role_assignrrlvhheb4vssxhyp4kqontyrurtyxbvxlrcdg4gxsvnjwgitubppm2yjangk'

    @ResourceGroupPreparer(name_prefix='cli_role_assign')
    @AllowLargeResponse()
    def test_role_assignment_handle_conflicted_assignments(self, resource_group):
        if self.run_under_service_principal():
            return  # this test delete users which are beyond a SP's capacity, so quit...
    
        with mock.patch('azure.cli.command_modules.role.custom._gen_guid', side_effect=self.create_guid):
            user = self.create_random_name('testuser', 15)
            self.kwargs.update({
                'upn': user + '@azuresdkteam.onmicrosoft.com',
                'nsg': 'nsg1'
            })
    
>           self.cmd('ad user create --display-name tester123 --password Test123456789 --user-principal-name {upn}')

src\azure-cli\azure\cli\command_modules\role\tests\latest\test_role.py:462: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = GraphErrorException('Insufficient privileges to complete the operation.')

    def graph_err_handler(ex):
        from azure.graphrbac.models import GraphErrorException
        if isinstance(ex, GraphErrorException):
            from knack.util import CLIError
>           raise CLIError(ex.message)
E           knack.util.CLIError: Insufficient privileges to complete the operation.

src\azure-cli\azure\cli\command_modules\role\commands.py:68: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_role_assignrrlvhheb4vssxhyp4kqontyrurtyxbvxlrcdg4gxsvnjwgitubppm2yjangk --tag product=azurecli cause=automation date=2020-12-18T12:27:00Z" => 0. 

Command "account show" => 0. 

Command "az group delete --name cli_role_assignrrlvhheb4vssxhyp4kqontyrurtyxbvxlrcdg4gxsvnjwgitubppm2yjangk --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m urllib3.connectionpool:connectionpool.py:664 Retrying (Retry(total=3, connect=3, read=4, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.VerifiedHTTPSConnection object at 0x0000019C76B02160>: Failed to establish a new connection: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond')': /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/cli_role_assignrrlvhheb4vssxhyp4kqontyrurtyxbvxlrcdg4gxsvnjwgitubppm2yjangk?api-version=2020-10-01
____ SqlManagedDatabaseLogReplayScenarionTest.test_sql_midb_logreplay_mgmt ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

args = {'cmd': <azure.cli.core.commands.AzCliCommand object at 0x0000019C7C97AA60>, 'name': 'SDOStdPolicyNetwork', 'resource_group_name': None, 'scope': None}

    def handler(args):
        from azure.cli.core.commands.client_factory import resolve_client_arg_name
        context_copy = copy.copy(context)
        getter_args = dict(extract_args_from_signature(
            context_copy.get_op_handler(getter_op, operation_group=kwargs.get('operation_group')),
            excluded_params=EXCLUDED_NON_CLIENT_PARAMS))
        cmd = args.get('cmd') if 'cmd' in getter_args else args.pop('cmd')
        context_copy.cli_ctx = cmd.cli_ctx
        operations_tmpl = _get_operations_tmpl(cmd, custom_command=custom_command)
        client_arg_name = resolve_client_arg_name(operations_tmpl, kwargs)
        try:
            client = factory(context_copy.cli_ctx) if factory else None
        except TypeError:
            client = factory(context_copy.cli_ctx, args) if factory else None
    
        if client and (client_arg_name in getter_args):
            args[client_arg_name] = client
    
        getter = context_copy.get_op_handler(getter_op, operation_group=kwargs.get('operation_group'))
        try:
>           return getter(**args)

src\azure-cli-core\azure\cli\core\commands\arm.py:754: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

cmd = <azure.cli.core.commands.AzCliCommand object at 0x0000019C7C97AA60>
name = 'SDOStdPolicyNetwork', resource_group_name = None
scope = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321'

    def show_policy_assignment(cmd, name, resource_group_name=None, scope=None):
        policy_client = _resource_policy_client_factory(cmd.cli_ctx)
        scope = _build_policy_scope(policy_client.config.subscription_id,
                                    resource_group_name, scope)
>       return policy_client.policy_assignments.get(scope, name)

src\azure-cli\azure\cli\command_modules\resource\custom.py:2127: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.resource.policy.v2019_09_01.operations._policy_assignments_operations.PolicyAssignmentsOperations object at 0x0000019C7C7B7790>
scope = '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321'
policy_assignment_name = 'SDOStdPolicyNetwork', custom_headers = None
raw = False, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/providers/Microsoft.Authorization/policyAssignments/SDOStdPolicyNetwork'
path_format_arguments = {'policyAssignmentName': 'SDOStdPolicyNetwork', 'scope': '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321'}
query_parameters = {'api-version': '2019-09-01'}
header_parameters = {'Accept': 'application/json', 'accept-language': 'en-US'}
request = <ClientRequest [GET]>, response = <Response [404]>
exp = CloudError("The policy assignment 'SDOStdPolicyNetwork' is not found.")

    def get(
            self, scope, policy_assignment_name, custom_headers=None, raw=False, **operation_config):
        """Retrieves a policy assignment.
    
        This operation retrieves a single policy assignment, given its name and
        the scope it was created at.
    
        :param scope: The scope of the policy assignment. Valid scopes are:
         management group (format:
         '/providers/Microsoft.Management/managementGroups/{managementGroup}'),
         subscription (format: '/subscriptions/{subscriptionId}'), resource
         group (format:
         '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}',
         or resource (format:
         '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/[{parentResourcePath}/]{resourceType}/{resourceName}'
        :type scope: str
        :param policy_assignment_name: The name of the policy assignment to
         get.
        :type policy_assignment_name: str
        :param dict custom_headers: headers that will be added to the request
        :param bool raw: returns the direct response alongside the
         deserialized response
        :param operation_config: :ref:`Operation configuration
         overrides<msrest:optionsforoperations>`.
        :return: PolicyAssignment or ClientRawResponse if raw=true
        :rtype:
         ~azure.mgmt.resource.policy.v2019_09_01.models.PolicyAssignment or
         ~msrest.pipeline.ClientRawResponse
        :raises: :class:`CloudError<msrestazure.azure_exceptions.CloudError>`
        """
        # Construct URL
        url = self.get.metadata['url']
        path_format_arguments = {
            'scope': self._serialize.url("scope", scope, 'str', skip_quote=True),
            'policyAssignmentName': self._serialize.url("policy_assignment_name", policy_assignment_name, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct and send request
        request = self._client.get(url, query_parameters, header_parameters)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: PolicyAssignmentNotFound
E           Message: The policy assignment 'SDOStdPolicyNetwork' is not found.

env\lib\site-packages\azure\mgmt\resource\policy\v2019_09_01\operations\_policy_assignments_operations.py:255: CloudError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sql.tests.latest.test_sql_commands.SqlManagedDatabaseLogReplayScenarionTest testMethod=test_sql_midb_logreplay_mgmt>
resource_group = 'clitest-logreplayebtibly6sl5'
resource_group_location = 'westcentralus'

    @ResourceGroupPreparer(random_name_length=28, name_prefix='clitest-logreplay', location='westcentralus')
    def test_sql_midb_logreplay_mgmt(self, resource_group, resource_group_location):
    
        managed_instance_name = self.create_random_name(managed_instance_name_prefix, managed_instance_name_max_length)
    
        self.kwargs.update({
            'loc': resource_group_location,
            'resource_group': resource_group,
            'vnet_name': 'vcCliTestLogReplayVnet',
            'subnet_name': 'vcCliTestLogReplaySubnet',
            'route_table_name': 'vcCliTestLogReplayRouteTable',
            'route_name_default': 'default',
            'nsg': 'test-vnet-nsg',
            'route_name_subnet_to_vnet_local': 'subnet_to_vnet_local',
            'managed_instance_name': managed_instance_name,
            'admin_login': 'admin123',
            'admin_password': 'SecretPassword123',
            'license_type': 'LicenseIncluded',
            'v_cores': 8,
            'storage_size_in_gb': '128',
            'edition': 'GeneralPurpose',
            'family': 'Gen5',
            'collation': "Serbian_Cyrillic_100_CS_AS",
            'proxy_override': "Proxy"
        })
    
        rg = self.cmd('group show --name {resource_group}').get_output_in_json()
    
        self.kwargs.update({
            'rg_id': rg['id'],
            'policy_name': 'SDOStdPolicyNetwork'
        })
    
>       policyAssignment = self.cmd('az policy assignment show -n {policy_name}').get_output_in_json()

src\azure-cli\azure\cli\command_modules\sql\tests\latest\test_sql_commands.py:5166: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: in _in_process_execute
    self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0
env\lib\site-packages\knack\cli.py:231: in invoke
    raise ex
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:756: in handler
    show_exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The policy assignment 'SDOStdPolicyNetwork' is not found.")

    def show_exception_handler(ex):
        if getattr(getattr(ex, 'response', ex), 'status_code', None) == 404:
            import sys
            from azure.cli.core.azlogging import CommandLoggerContext
            from azure.cli.core.azclierror import ResourceNotFoundError
            with CommandLoggerContext(logger):
                az_error = ResourceNotFoundError(getattr(ex, 'message', ex))
                az_error.print_error()
                az_error.send_telemetry()
>               sys.exit(3)
E               SystemExit: 3

src\azure-cli-core\azure\cli\core\commands\arm.py:770: SystemExit
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westcentralus --name clitest-logreplayebtibly6sl5 --tag product=azurecli cause=automation date=2020-12-18T14:01:57Z" => 0. 

Command "group show --name clitest-logreplayebtibly6sl5" => 0. 

ResourceNotFoundError: The policy assignment 'SDOStdPolicyNetwork' is not found.
Command "az group delete --name clitest-logreplayebtibly6sl5 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[1m[31mERROR   [0m cli.azure.cli.core.azclierror:azclierror.py:55 ResourceNotFoundError: The policy assignment 'SDOStdPolicyNetwork' is not found.
_______________ SqlVmScenarioTest.test_sqlvm_create_and_delete ________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7E418910>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7B97AC70>
command = 'vm create -l westus -g sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7 -n clisqlvmjwlzqdo... --admin-password SecretPassword123 --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7B97AC70>
args = ['vm', 'create', '-l', 'westus', '-g', 'sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7DA17820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7B97AC70>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sqlvm.tests.latest.test_sqlvm_commands.SqlVirtualMachinePreparer object at 0x0000019C6BB68F70>
name = 'clisqlvmjwlzqdo'
kwargs = {'resource_group': 'sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7', 'resource_group_location': 'westus'}
group = 'sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7'
template = 'az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'

    def create_resource(self, name, **kwargs):
        group = self._get_resource_group(**kwargs)
        template = ('az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest'
                    ' --size Standard_DS2_v2')
>       execute(DummyCli(), template.format(self.location, group, name, self.vm_user, self.vm_password))

src\azure-cli\azure\cli\command_modules\sqlvm\tests\latest\test_sqlvm_commands.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7/providers/Microsoft.Compute/virtualMachines/clisqlvmjwlzqdo' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7/providers/Microsoft.Compute/virtualMachines/clisqlvmjwlzqdo' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7 --tag product=azurecli cause=automation date=2020-12-18T14:02:01Z" => 0. 

Command "az group delete --name sqlvm_cli_test_createwmdsolu4xei7uopupykrpsdwo77okj7ybxv2cscnksoeuvtrsqy7w7 --yes --no-wait" => 0. 

______________________ SqlVmScenarioTest.test_sqlvm_mgmt ______________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C765F61C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7BE89E80>
command = 'vm create -l westus -g clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp -n clisqlvm2u6s2m7... --admin-password SecretPassword123 --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7BE89E80>
args = ['vm', 'create', '-l', 'westus', '-g', 'clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7C9768B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7BE89E80>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sqlvm.tests.latest.test_sqlvm_commands.SqlVirtualMachinePreparer object at 0x0000019C6BB574C0>
name = 'clisqlvm2u6s2m7'
kwargs = {'resource_group': 'clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp', 'resource_group_location': 'westus'}
group = 'clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp'
template = 'az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'

    def create_resource(self, name, **kwargs):
        group = self._get_resource_group(**kwargs)
        template = ('az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest'
                    ' --size Standard_DS2_v2')
>       execute(DummyCli(), template.format(self.location, group, name, self.vm_user, self.vm_password))

src\azure-cli\azure\cli\command_modules\sqlvm\tests\latest\test_sqlvm_commands.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp/providers/Microsoft.Compute/virtualMachines/clisqlvm2u6s2m7' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp/providers/Microsoft.Compute/virtualMachines/clisqlvm2u6s2m7' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp --tag product=azurecli cause=automation date=2020-12-18T14:02:07Z" => 0. 

Command "az group delete --name clitest.rghexvyjyo63cvprtgmnkstg2m3iqrn4pw2ywx3w3pqksnbmg4awce3r5d3yl5o5ryp --yes --no-wait" => 0. 

_____________ SqlVmScenarioTest.test_sqlvm_update_license_and_sku _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7C0C4640>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7C18BA30>
command = 'vm create -l westus -g sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4 -n clisqlvmhxup2xe... --admin-password SecretPassword123 --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7C18BA30>
args = ['vm', 'create', '-l', 'westus', '-g', 'sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C71E118B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7C18BA30>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sqlvm.tests.latest.test_sqlvm_commands.SqlVirtualMachinePreparer object at 0x0000019C6BA3C460>
name = 'clisqlvmhxup2xe'
kwargs = {'resource_group': 'sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4', 'resource_group_location': 'westus'}
group = 'sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4'
template = 'az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest --size Standard_DS2_v2'

    def create_resource(self, name, **kwargs):
        group = self._get_resource_group(**kwargs)
        template = ('az vm create -l {} -g {} -n {} --admin-username {} --admin-password {} --image MicrosoftSQLServer:SQL2017-WS2016:Enterprise:latest'
                    ' --size Standard_DS2_v2')
>       execute(DummyCli(), template.format(self.location, group, name, self.vm_user, self.vm_password))

src\azure-cli\azure\cli\command_modules\sqlvm\tests\latest\test_sqlvm_commands.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4/providers/Microsoft.Compute/virtualMachines/clisqlvmhxup2xe' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4/providers/Microsoft.Compute/virtualMachines/clisqlvmhxup2xe' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4 --tag product=azurecli cause=automation date=2020-12-18T14:02:14Z" => 0. 

Command "az group delete --name sqlvm_cli_test_licenselp5unvhq2tj72fhayhii4wgqabxngifkjroigcs4hqgeaaybhnse4 --yes --no-wait" => 0. 

_____________ SqlVmAndGroupScenarioTest.test_sqlvm_add_and_remove _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7C6D38B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7AF9BC70>
command = 'group deployment create --name domaintemplate -g clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeu...rameters adminUsername=admin123 adminPassword=SecretPassword123 location=westus domainName=domain.com dnsPrefix=bhnccj'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7AF9BC70>
args = ['group', 'deployment', 'create', '--name', 'domaintemplate', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C78C059D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7AF9BC70>
ex = CLIError(InvalidTemplateError('{"error":{"code":"InvalidTemplateDeployment","message":"The template deployment failed ...other size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.\'.\'."}}'))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(InvalidTemplateError('{"error":{"code":"InvalidTemplateDeployment","message":"The template deployment failed ...other size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.\'.\'."}}'))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sqlvm.tests.latest.test_sqlvm_commands.DomainPreparer object at 0x0000019C6BA61190>
name = 'domainvmfk7co76'
kwargs = {'resource_group': 'clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6', 'resource_group_location': 'westus'}
group = 'clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6'
dns_name = 'bhnccj'
parameters = 'adminUsername=admin123 adminPassword=SecretPassword123 location=westus domainName=domain.com dnsPrefix=bhnccj'
template = 'az group deployment create --name {} -g {} --template-uri {} --parameters {}'

    def create_resource(self, name, **kwargs):
        group = self._get_resource_group(**kwargs)
        dns_name = self.id_generator()
        parameters = ('adminUsername=admin123 adminPassword=SecretPassword123 location=westus '
                      'domainName=domain.com dnsPrefix={}').format(dns_name)
        template = 'az group deployment create --name {} -g {} --template-uri {} --parameters {}'
>       execute(DummyCli(), template.format('domaintemplate', group,
                                            'https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/active-directory-new-domain/azuredeploy.json',
                                            parameters))

src\azure-cli\azure\cli\command_modules\sqlvm\tests\latest\test_sqlvm_commands.py:98: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = InvalidTemplateError('{"error":{"code":"InvalidTemplateDeployment","message":"The template deployment failed with erro...nother size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.\'.\'."}}')

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: {"error":{"code":"InvalidTemplateDeployment","message":"The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6/providers/Microsoft.Compute/virtualMachines/adVM' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6/providers/Microsoft.Compute/virtualMachines/adVM' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."}}

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6 --tag product=azurecli cause=automation date=2020-12-18T14:02:21Z" => 0. 

This command is implicitly deprecated because command group 'group deployment' is deprecated and will be removed in a future release. Use 'deployment group' instead.
Command "az group delete --name clitest.rgh6ebvpnzblr43wg57w6fupqolepmaqq4v5zhr5vz4nnn5nod4yzl6yveeufepu2k6 --yes --no-wait" => 0. 

___ StorageAccountTests.test_create_storage_account_with_double_encryption ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7E7820A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7E26D1C0>
command = 'storage account create -n clilipiam52rzwtn42o4jaoo -g clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh --require-infrastructure-encryption'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E26D1C0>
args = ['storage', 'account', 'create', '-n', 'clilipiam52rzwtn42o4jaoo', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7E56C3A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E26D1C0>
ex = HttpResponseError('(FeatureNotSupportedForAccount) Infrastructure encryption is not supported for the account.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError('(FeatureNotSupportedForAccount) Infrastructure encryption is not supported for the account.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_create_storage_account_with_double_encryption>
resource_group = 'clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-06-01')
    @ResourceGroupPreparer(location='eastus2euap')
    def test_create_storage_account_with_double_encryption(self, resource_group):
        name = self.create_random_name(prefix='cli', length=24)
>       self.cmd('az storage account create -n {} -g {} --require-infrastructure-encryption'.format(
            name, resource_group), checks=[
            JMESPathCheck('name', name),
            JMESPathCheck('encryption.requireInfrastructureEncryption', True)
        ])

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\storage\operations\account.py:143: in create_storage_account
    return scf.storage_accounts.begin_create(resource_group_name, account_name, params)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:207: in begin_create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.storage.v2019_06_01.operations._storage_accounts_operations.StorageAccountsOperations object at 0x0000019C7E8279D0>
resource_group_name = 'clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh'
account_name = 'clilipiam52rzwtn42o4jaoo'
parameters = <azure.mgmt.storage.v2019_06_01.models._models_py3.StorageAccountCreateParameters object at 0x0000019C7E8278B0>
kwargs = {}
cls = <function StorageAccountsOperations.begin_create.<locals>.<lambda> at 0x0000019C7E83DA60>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2019-06-01', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgdakhz2yi6bqk...ixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh/providers/Microsoft.Storage/storageAccounts/clilipiam52rzwtn42o4jaoo'
path_format_arguments = {'accountName': 'clilipiam52rzwtn42o4jaoo', 'resourceGroupName': 'clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}

    def _create_initial(
        self,
        resource_group_name,  # type: str
        account_name,  # type: str
        parameters,  # type: "models.StorageAccountCreateParameters"
        **kwargs  # type: Any
    ):
        # type: (...) -> Optional["models.StorageAccount"]
        cls = kwargs.pop('cls', None)  # type: ClsType[Optional["models.StorageAccount"]]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2019-06-01"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self._create_initial.metadata['url']  # type: ignore
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1, pattern=r'^[-\w\._\(\)]+$'),
            'accountName': self._serialize.url("account_name", account_name, 'str', max_length=24, min_length=3),
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str', min_length=1),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(parameters, 'StorageAccountCreateParameters')
        body_content_kwargs['content'] = body_content
        request = self._client.put(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200, 202]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (FeatureNotSupportedForAccount) Infrastructure encryption is not supported for the account.

env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:155: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2euap --name clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh --tag product=azurecli cause=automation date=2020-12-18T14:03:53Z" => 0. 

Command "az group delete --name clitest.rgdakhz2yi6bqktlkgixykcj3bjvph7ccsspsgvofpljt3bkw5ieo364itq3umgqioh --yes --no-wait" => 0. 

______ StorageAccountTests.test_create_storage_account_with_files_aadds _______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7E280A90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C022C9D90>
command = 'storage account create -n climugdgy3bvz5ogu72iykty -g clitest.rgemo76lvmmbib4fxcp2jmuhtbu3u25npfjcvw3g5joejnz4w2m7eqvxd2bbmvixowl --enable-files-aadds'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C022C9D90>
args = ['storage', 'account', 'create', '-n', 'climugdgy3bvz5ogu72iykty', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C01FAD310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C022C9D90>
ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ResourceExistsError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_create_storage_account_with_files_aadds>
resource_group = 'clitest.rgemo76lvmmbib4fxcp2jmuhtbu3u25npfjcvw3g5joejnz4w2m7eqvxd2bbmvixowl'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-04-01')
    @ResourceGroupPreparer()
    def test_create_storage_account_with_files_aadds(self, resource_group):
        name = self.create_random_name(prefix='cli', length=24)
        create_cmd = 'az storage account create -n {} -g {} --enable-files-aadds'.format(name, resource_group)
>       result = self.cmd(create_cmd).get_output_in_json()

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:689: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\storage\operations\account.py:143: in create_storage_account
    return scf.storage_accounts.begin_create(resource_group_name, account_name, params)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:207: in begin_create
    raw_result = self._create_initial(
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:154: in _create_initial
    map_error(status_code=response.status_code, response=response, error_map=error_map)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

status_code = 409
response = <azure.core.pipeline.transport._requests_basic.RequestsTransportResponse object at 0x0000019C022FA520>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}

    def map_error(status_code, response, error_map):
        if not error_map:
            return
        error_type = error_map.get(status_code)
        if not error_type:
            return
        error = error_type(response=response)
>       raise error
E       azure.core.exceptions.ResourceExistsError: (AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad

env\lib\site-packages\azure\core\exceptions.py:102: ResourceExistsError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgemo76lvmmbib4fxcp2jmuhtbu3u25npfjcvw3g5joejnz4w2m7eqvxd2bbmvixowl --tag product=azurecli cause=automation date=2020-12-18T14:03:58Z" => 0. 

Command "az group delete --name clitest.rgemo76lvmmbib4fxcp2jmuhtbu3u25npfjcvw3g5joejnz4w2m7eqvxd2bbmvixowl --yes --no-wait" => 0. 

____ StorageAccountTests.test_create_storage_account_with_files_aadds_true ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7D0B0520>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C759EE310>
command = 'storage account create -n cliaienfu5hll4h2775umlke -g clitest.rgpi7vzepzzkvzbxuyksg7o23whzkrg3qq3rf6dn5axyv7lpiclsjpcw4lyvvmhwiqu --enable-files-aadds true'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C759EE310>
args = ['storage', 'account', 'create', '-n', 'cliaienfu5hll4h2775umlke', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7BBBF550>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C759EE310>
ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ResourceExistsError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_create_storage_account_with_files_aadds_true>
resource_group = 'clitest.rgpi7vzepzzkvzbxuyksg7o23whzkrg3qq3rf6dn5axyv7lpiclsjpcw4lyvvmhwiqu'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-04-01')
    @ResourceGroupPreparer()
    def test_create_storage_account_with_files_aadds_true(self, resource_group):
        name = self.create_random_name(prefix='cli', length=24)
        create_cmd = 'az storage account create -n {} -g {} --enable-files-aadds true'.format(name, resource_group)
>       result = self.cmd(create_cmd).get_output_in_json()

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:709: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\storage\operations\account.py:143: in create_storage_account
    return scf.storage_accounts.begin_create(resource_group_name, account_name, params)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:207: in begin_create
    raw_result = self._create_initial(
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:154: in _create_initial
    map_error(status_code=response.status_code, response=response, error_map=error_map)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

status_code = 409
response = <azure.core.pipeline.transport._requests_basic.RequestsTransportResponse object at 0x0000019C7CAFD190>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}

    def map_error(status_code, response, error_map):
        if not error_map:
            return
        error_type = error_map.get(status_code)
        if not error_type:
            return
        error = error_type(response=response)
>       raise error
E       azure.core.exceptions.ResourceExistsError: (AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad

env\lib\site-packages\azure\core\exceptions.py:102: ResourceExistsError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgpi7vzepzzkvzbxuyksg7o23whzkrg3qq3rf6dn5axyv7lpiclsjpcw4lyvvmhwiqu --tag product=azurecli cause=automation date=2020-12-18T14:04:30Z" => 0. 

Command "az group delete --name clitest.rgpi7vzepzzkvzbxuyksg7o23whzkrg3qq3rf6dn5axyv7lpiclsjpcw4lyvvmhwiqu --yes --no-wait" => 0. 

______ StorageAccountTests.test_update_storage_account_with_files_aadds _______
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C944AB1CD0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93DD1BEB0>
command = 'storage account update -n clits74aziogouqqnpm26xp6 -g clitest.rg4q5v5t3x4l5g67s3blwlngrknp43tiymcsgahfip7k24344n45mmy7cxq2hrydi35 --enable-files-aadds'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93DD1BEB0>
args = ['storage', 'account', 'update', '-n', 'clits74aziogouqqnpm26xp6', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C944AAFE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93DD1BEB0>
ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ResourceExistsError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_update_storage_account_with_files_aadds>
resource_group = 'clitest.rg4q5v5t3x4l5g67s3blwlngrknp43tiymcsgahfip7k24344n45mmy7cxq2hrydi35'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-04-01')
    @ResourceGroupPreparer()
    def test_update_storage_account_with_files_aadds(self, resource_group):
        name = self.create_random_name(prefix='cli', length=24)
        create_cmd = 'az storage account create -n {} -g {}'.format(name, resource_group)
        self.cmd(create_cmd, checks=[JMESPathCheck('azureFilesIdentityBasedAuthentication', None)])
    
        update_cmd = 'az storage account update -n {} -g {} --enable-files-aadds'.format(name, resource_group)
>       result = self.cmd(update_cmd).get_output_in_json()

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:653: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:567: in handler
    result = cached_put(cmd, setter, **setterargs)
src\azure-cli-core\azure\cli\core\commands\__init__.py:444: in cached_put
    return _put_operation()
src\azure-cli-core\azure\cli\core\commands\__init__.py:438: in _put_operation
    result = operation(**kwargs)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:433: in update
    map_error(status_code=response.status_code, response=response, error_map=error_map)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

status_code = 409
response = <azure.core.pipeline.transport._requests_basic.RequestsTransportResponse object at 0x000001C944A5D3A0>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}

    def map_error(status_code, response, error_map):
        if not error_map:
            return
        error_type = error_map.get(status_code)
        if not error_type:
            return
        error = error_type(response=response)
>       raise error
E       azure.core.exceptions.ResourceExistsError: (AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad

env\lib\site-packages\azure\core\exceptions.py:102: ResourceExistsError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rg4q5v5t3x4l5g67s3blwlngrknp43tiymcsgahfip7k24344n45mmy7cxq2hrydi35 --tag product=azurecli cause=automation date=2020-12-18T14:11:11Z" => 0. 

Command "az storage account create -n clits74aziogouqqnpm26xp6 -g clitest.rg4q5v5t3x4l5g67s3blwlngrknp43tiymcsgahfip7k24344n45mmy7cxq2hrydi35" => 0. 

Command "az group delete --name clitest.rg4q5v5t3x4l5g67s3blwlngrknp43tiymcsgahfip7k24344n45mmy7cxq2hrydi35 --yes --no-wait" => 0. 

______ StorageAccountTests.test_storage_create_with_encryption_key_type _______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C175249A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C02375970>
command = 'storage account create -n cliencryption2tilnvfpzwo -g cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4 --kind StorageV2 -t Account -q Service'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C02375970>
args = ['storage', 'account', 'create', '-n', 'cliencryption2tilnvfpzwo', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C17418790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C02375970>
ex = HttpResponseError("(InvalidEncryptionServiceKeyType) The specified key type is not supported for 'table' encryption service.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError("(InvalidEncryptionServiceKeyType) The specified key type is not supported for 'table' encryption service.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_storage_create_with_encryption_key_type>
resource_group = 'cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-06-01')
    @ResourceGroupPreparer(location='eastus2euap', name_prefix='cli_storage_account_encryption')
    def test_storage_create_with_encryption_key_type(self, resource_group):
        name = self.create_random_name(prefix='cliencryption', length=24)
        create_cmd = 'az storage account create -n {} -g {} --kind StorageV2 -t Account -q Service'.format(
            name, resource_group)
>       self.cmd(create_cmd, checks=[
            JMESPathCheck('encryption.services.queue', None),
            JMESPathCheck('encryption.services.table.enabled', True),
            JMESPathCheck('encryption.services.table.keyType', 'Account'),
        ])

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:232: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\storage\operations\account.py:143: in create_storage_account
    return scf.storage_accounts.begin_create(resource_group_name, account_name, params)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:207: in begin_create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.storage.v2019_06_01.operations._storage_accounts_operations.StorageAccountsOperations object at 0x0000019C1C5B6A90>
resource_group_name = 'cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4'
account_name = 'cliencryption2tilnvfpzwo'
parameters = <azure.mgmt.storage.v2019_06_01.models._models_py3.StorageAccountCreateParameters object at 0x0000019C1C5B6880>
kwargs = {}
cls = <function StorageAccountsOperations.begin_create.<locals>.<lambda> at 0x0000019C1C5A0160>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2019-06-01', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_storage_account_en...tionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4/providers/Microsoft.Storage/storageAccounts/cliencryption2tilnvfpzwo'
path_format_arguments = {'accountName': 'cliencryption2tilnvfpzwo', 'resourceGroupName': 'cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}

    def _create_initial(
        self,
        resource_group_name,  # type: str
        account_name,  # type: str
        parameters,  # type: "models.StorageAccountCreateParameters"
        **kwargs  # type: Any
    ):
        # type: (...) -> Optional["models.StorageAccount"]
        cls = kwargs.pop('cls', None)  # type: ClsType[Optional["models.StorageAccount"]]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2019-06-01"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self._create_initial.metadata['url']  # type: ignore
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1, pattern=r'^[-\w\._\(\)]+$'),
            'accountName': self._serialize.url("account_name", account_name, 'str', max_length=24, min_length=3),
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str', min_length=1),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(parameters, 'StorageAccountCreateParameters')
        body_content_kwargs['content'] = body_content
        request = self._client.put(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200, 202]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (InvalidEncryptionServiceKeyType) The specified key type is not supported for 'table' encryption service.

env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:155: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2euap --name cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4 --tag product=azurecli cause=automation date=2020-12-18T14:12:23Z" => 0. 

Command "az group delete --name cli_storage_account_encryptionbdry422k65hb53k3zbdulqbquae7iidekt34zdctoyvh4 --yes --no-wait" => 0. 

____ StorageAccountTests.test_update_storage_account_with_files_aadds_true ____
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C944AB4880>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C944CC4CA0>
command = 'storage account update -n cli4ssvuckqia3pngbamdlp7 -g clitest.rgiylg6lty5new5sgk25nkcfsscjn7cxz6rqxmzmypyn45bc3wuoeqvptsgh7bbi4zg --enable-files-aadds true'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C944CC4CA0>
args = ['storage', 'account', 'update', '-n', 'cli4ssvuckqia3pngbamdlp7', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93D6868B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C944CC4CA0>
ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = ResourceExistsError('(AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception ResourceExistsError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountTests testMethod=test_update_storage_account_with_files_aadds_true>
resource_group = 'clitest.rgiylg6lty5new5sgk25nkcfsscjn7cxz6rqxmzmypyn45bc3wuoeqvptsgh7bbi4zg'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-04-01')
    @ResourceGroupPreparer()
    def test_update_storage_account_with_files_aadds_true(self, resource_group):
        name = self.create_random_name(prefix='cli', length=24)
        create_cmd = 'az storage account create -n {} -g {}'.format(name, resource_group)
        self.cmd(create_cmd, checks=[JMESPathCheck('azureFilesIdentityBasedAuthentication', None)])
    
        update_cmd = 'az storage account update -n {} -g {} --enable-files-aadds true'.format(name, resource_group)
>       result = self.cmd(update_cmd).get_output_in_json()

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:679: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:567: in handler
    result = cached_put(cmd, setter, **setterargs)
src\azure-cli-core\azure\cli\core\commands\__init__.py:444: in cached_put
    return _put_operation()
src\azure-cli-core\azure\cli\core\commands\__init__.py:438: in _put_operation
    result = operation(**kwargs)
env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:433: in update
    map_error(status_code=response.status_code, response=response, error_map=error_map)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

status_code = 409
response = <azure.core.pipeline.transport._requests_basic.RequestsTransportResponse object at 0x000001C93D615130>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}

    def map_error(status_code, response, error_map):
        if not error_map:
            return
        error_type = error_map.get(status_code)
        if not error_type:
            return
        error = error_type(response=response)
>       raise error
E       azure.core.exceptions.ResourceExistsError: (AadDsTenantNotFound) Unable to locate active AAD DS for AAD tenant Id 72f988bf-86f1-41af-91ab-2d7cd011db47 associated with the storage account. For more information, see - https://aka.ms/storagefilesaad

env\lib\site-packages\azure\core\exceptions.py:102: ResourceExistsError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgiylg6lty5new5sgk25nkcfsscjn7cxz6rqxmzmypyn45bc3wuoeqvptsgh7bbi4zg --tag product=azurecli cause=automation date=2020-12-18T14:12:09Z" => 0. 

Command "az storage account create -n cli4ssvuckqia3pngbamdlp7 -g clitest.rgiylg6lty5new5sgk25nkcfsscjn7cxz6rqxmzmypyn45bc3wuoeqvptsgh7bbi4zg" => 0. 

Command "az group delete --name clitest.rgiylg6lty5new5sgk25nkcfsscjn7cxz6rqxmzmypyn45bc3wuoeqvptsgh7bbi4zg --yes --no-wait" => 0. 

___________ StorageAccountSkuScenarioTest.test_storage_account_sku ____________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93C6C6E80>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93CF98160>
command = 'storage account update -n clistorageskuwr7ftwhrofy -g clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq --sku Standard_GZRS'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93CF98160>
args = ['storage', 'account', 'update', '-n', 'clistorageskuwr7ftwhrofy', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C942E3FE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93CF98160>
ex = HttpResponseError('(StorageAccountTypeConversionNotAllowed) Storage account type Standard_ZRS cannot be changed to Standard_GZRS.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError('(StorageAccountTypeConversionNotAllowed) Storage account type Standard_ZRS cannot be changed to Standard_GZRS.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.storage.tests.latest.test_storage_account_scenarios.StorageAccountSkuScenarioTest testMethod=test_storage_account_sku>
resource_group = 'clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq'
storage_account = 'clistorageskuwr7ftwhrofy'

    @api_version_constraint(ResourceType.MGMT_STORAGE, min_api='2019-04-01')
    @ResourceGroupPreparer(name_prefix='clistorage', location='eastus2euap')
    @StorageAccountPreparer(name_prefix='clistoragesku', location='eastus2euap', kind='StorageV2', sku='Standard_ZRS')
    def test_storage_account_sku(self, resource_group, storage_account):
        self.kwargs = {
            'gzrs_sa': self.create_random_name(prefix='cligzrs', length=24),
            'GZRS': 'Standard_GZRS',
            'rg': resource_group,
            'sa': storage_account
        }
    
        # Create storage account with GZRS
        self.cmd('az storage account create -n {gzrs_sa} -g {rg} --sku {GZRS} --https-only --kind StorageV2', checks=[
            self.check('sku.name', '{GZRS}'),
            self.check('name', '{gzrs_sa}')
        ])
    
        # Convert ZRS to GZRS
        self.cmd('az storage account show -n {sa} -g {rg}', checks=[
            self.check('sku.name', 'Standard_ZRS'),
            self.check('name', '{sa}')
        ])
    
>       self.cmd('az storage account update -n {sa} -g {rg} --sku {GZRS}', checks=[
            self.check('sku.name', '{GZRS}'),
            self.check('name', '{sa}'),
        ])

src\azure-cli\azure\cli\command_modules\storage\tests\latest\test_storage_account_scenarios.py:1183: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:567: in handler
    result = cached_put(cmd, setter, **setterargs)
src\azure-cli-core\azure\cli\core\commands\__init__.py:444: in cached_put
    return _put_operation()
src\azure-cli-core\azure\cli\core\commands\__init__.py:438: in _put_operation
    result = operation(**kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.storage.v2019_06_01.operations._storage_accounts_operations.StorageAccountsOperations object at 0x000001C93ED05E50>
resource_group_name = 'clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq'
account_name = 'clistorageskuwr7ftwhrofy'
parameters = <azure.mgmt.storage.v2019_06_01.models._models_py3.StorageAccountUpdateParameters object at 0x000001C93ED3BA90>
kwargs = {}, cls = None
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2019-06-01', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clistorageypbrnzqb6fgf...elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq/providers/Microsoft.Storage/storageAccounts/clistorageskuwr7ftwhrofy'
path_format_arguments = {'accountName': 'clistorageskuwr7ftwhrofy', 'resourceGroupName': 'clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}

    def update(
        self,
        resource_group_name,  # type: str
        account_name,  # type: str
        parameters,  # type: "models.StorageAccountUpdateParameters"
        **kwargs  # type: Any
    ):
        # type: (...) -> "models.StorageAccount"
        """The update operation can be used to update the SKU, encryption, access tier, or tags for a
        storage account. It can also be used to map the account to a custom domain. Only one custom
        domain is supported per storage account; the replacement/change of custom domain is not
        supported. In order to replace an old custom domain, the old value must be cleared/unregistered
        before a new value can be set. The update of multiple properties is supported. This call does
        not change the storage keys for the account. If you want to change the storage account keys,
        use the regenerate keys operation. The location and name of the storage account cannot be
        changed after creation.
    
        :param resource_group_name: The name of the resource group within the user's subscription. The
         name is case insensitive.
        :type resource_group_name: str
        :param account_name: The name of the storage account within the specified resource group.
         Storage account names must be between 3 and 24 characters in length and use numbers and lower-
         case letters only.
        :type account_name: str
        :param parameters: The parameters to provide for the updated account.
        :type parameters: ~azure.mgmt.storage.v2019_06_01.models.StorageAccountUpdateParameters
        :keyword callable cls: A custom type or function that will be passed the direct response
        :return: StorageAccount, or the result of cls(response)
        :rtype: ~azure.mgmt.storage.v2019_06_01.models.StorageAccount
        :raises: ~azure.core.exceptions.HttpResponseError
        """
        cls = kwargs.pop('cls', None)  # type: ClsType["models.StorageAccount"]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2019-06-01"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self.update.metadata['url']  # type: ignore
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1, pattern=r'^[-\w\._\(\)]+$'),
            'accountName': self._serialize.url("account_name", account_name, 'str', max_length=24, min_length=3),
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str', min_length=1),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(parameters, 'StorageAccountUpdateParameters')
        body_content_kwargs['content'] = body_content
        request = self._client.patch(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (StorageAccountTypeConversionNotAllowed) Storage account type Standard_ZRS cannot be changed to Standard_GZRS.

env\lib\site-packages\azure\mgmt\storage\v2019_06_01\operations\_storage_accounts_operations.py:434: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2euap --name clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq --tag product=azurecli cause=automation date=2020-12-18T14:12:37Z" => 0. 

Command "az storage account create -n clistorageskuwr7ftwhrofy -g clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq -l eastus2euap --sku Standard_ZRS --kind StorageV2 --https-only " => 0. 

Command "storage account keys list -n clistorageskuwr7ftwhrofy -g clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq --query "[0].value" -otsv" => 0. 

Command "az storage account create -n cligzrs5ligd7xtcxefngrr3 -g clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq --sku Standard_GZRS --https-only --kind StorageV2" => 0. 

Command "az storage account show -n clistorageskuwr7ftwhrofy -g clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq" => 0. 

Command "az group delete --name clistorageypbrnzqb6fgfl7m7elvxbm6dmdai2uvczwy65x65rkyvc4knzsmfiieuqaezwqiwq --yes --no-wait" => 0. 

______________ VMWindowsLicenseTest.test_vm_windows_license_type ______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C943798A30>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94048F580>
command = 'vm create -g cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44 -n winvm --image Win2012R2Datacenter --admin-username clitest1234 --admin-password Test123456789# --license-type Windows_Server --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94048F580>
args = ['vm', 'create', '-g', 'cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44', '-n', 'winvm', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93CA7D280>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94048F580>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMWindowsLicenseTest testMethod=test_vm_windows_license_type>
resource_group = 'cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44'

    @ResourceGroupPreparer(name_prefix='cli_test_windows_license_type')
    def test_vm_windows_license_type(self, resource_group):
        self.kwargs.update({
            'vm': 'winvm'
        })
>       self.cmd('vm create -g {rg} -n {vm} --image Win2012R2Datacenter --admin-username clitest1234 --admin-password Test123456789# --license-type Windows_Server --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:273: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44/providers/Microsoft.Compute/virtualMachines/winvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44/providers/Microsoft.Compute/virtualMachines/winvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44 --tag product=azurecli cause=automation date=2020-12-18T14:16:35Z" => 0. 

Command "az group delete --name cli_test_windows_license_typev2ndsfph7dgef7zikb7s2ewhwiktayocazp6pilkg7rb44 --yes --no-wait" => 0. 

___________________ VMCustomImageTest.test_vm_custom_image ____________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C945744A00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C946A050A0>
command = 'vm create -g cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp -n vm-unmanaged-disk --image ubuntults --use-unmanaged-disk --admin-username sdk-test-admin --admin-password testPassword0 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946A050A0>
args = ['vm', 'create', '-g', 'cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp', '-n', 'vm-unmanaged-disk', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C944F60040>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946A050A0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCustomImageTest testMethod=test_vm_custom_image>
resource_group = 'cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_custom_image')
    def test_vm_custom_image(self, resource_group):
        self.kwargs.update({
            'vm1': 'vm-unmanaged-disk',
            'vm2': 'vm-managed-disk',
            'newvm1': 'fromimage1',
            'newvm2': 'fromimage2',
            'image1': 'img-from-unmanaged',
            'image2': 'img-from-managed',
        })
    
>       self.cmd('vm create -g {rg} -n {vm1} --image ubuntults --use-unmanaged-disk --admin-username sdk-test-admin --admin-password testPassword0 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:295: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp/providers/Microsoft.Compute/virtualMachines/vm-unmanaged-disk' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp/providers/Microsoft.Compute/virtualMachines/vm-unmanaged-disk' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp --tag product=azurecli cause=automation date=2020-12-18T14:16:41Z" => 0. 

Command "az group delete --name cli_test_vm_custom_imagev7nhcsefgol7toeg447tygnotvbyc44wmn3qthtzn7luotlf7bp --yes --no-wait" => 0. 

____________ VMCustomImageTest.test_vm_custom_image_name_conflict _____________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9481AA5B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C946B94EE0>
command = 'vm create -g cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7 -n test-vm --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946B94EE0>
args = ['vm', 'create', '-g', 'cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7', '-n', 'test-vm', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9481A8CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946B94EE0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCustomImageTest testMethod=test_vm_custom_image_name_conflict>
resource_group = 'cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_custom_image_conflict')
    def test_vm_custom_image_name_conflict(self, resource_group):
        self.kwargs.update({
            'vm': 'test-vm',
            'image1': 'img-from-vm',
            'image2': 'img-from-vm-id',
            'image3': 'img-from-disk-id',
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:374: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7/providers/Microsoft.Compute/virtualMachines/test-vm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7/providers/Microsoft.Compute/virtualMachines/test-vm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7 --tag product=azurecli cause=automation date=2020-12-18T14:16:48Z" => 0. 

Command "az group delete --name cli_test_vm_custom_image_conflictqf4fupja4kqgw5elyo5ijita75zkldel4jlp6efke7 --yes --no-wait" => 0. 

______ VMCreateFromUnmanagedDiskTest.test_vm_create_from_unmanaged_disk _______
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9481B3DC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C945656DC0>
command = 'vm create -g cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2 -n vm1 --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C945656DC0>
args = ['vm', 'create', '-g', 'cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93F5E1F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C945656DC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateFromUnmanagedDiskTest testMethod=test_vm_create_from_unmanaged_disk>
resource_group = 'cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_from_unmanaged_disk')
    def test_vm_create_from_unmanaged_disk(self, resource_group):
        # create a vm with unmanaged os disk
        self.kwargs.update({
            'loc': 'westus',
            'vm': 'vm1'
        })
>       self.cmd('vm create -g {rg} -n {vm} --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:464: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2 --tag product=azurecli cause=automation date=2020-12-18T14:16:55Z" => 0. 

Command "az group delete --name cli_test_vm_from_unmanaged_diskkf6dbzkjdycxilzhzzd44qxwytg6pbe3gvgg3cndrmh2 --yes --no-wait" => 0. 

_ VMCreateWithSpecializedUnmanagedDiskTest.test_vm_create_with_specialized_unmanaged_disk _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93D7833A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93D74E460>
command = 'vm create -g cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os -n vm1 --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D74E460>
args = ['vm', 'create', '-g', 'cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93F8D1430>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D74E460>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateWithSpecializedUnmanagedDiskTest testMethod=test_vm_create_with_specialized_unmanaged_disk>
resource_group = 'cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_with_specialized_unmanaged_disk')
    def test_vm_create_with_specialized_unmanaged_disk(self, resource_group):
    
        self.kwargs.update({
            'loc': 'westus'
        })
    
        # create a vm with unmanaged os disk
>       self.cmd('vm create -g {rg} -n vm1 --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:494: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os --tag product=azurecli cause=automation date=2020-12-18T14:17:01Z" => 0. 

Command "az group delete --name cli_test_vm_with_specialized_unmanaged_diskm3mqymd5keiq53fantvgvpdv2rsra3os --yes --no-wait" => 0. 

_ VMCreateWithSpecializedUnmanagedDiskTest.test_vm_create_with_unmanaged_data_disks _
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C946627BE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93DC5FBB0>
command = 'vm create -g cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e -n vm1 --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93DC5FBB0>
args = ['vm', 'create', '-g', 'cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93F19A940>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93DC5FBB0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateWithSpecializedUnmanagedDiskTest testMethod=test_vm_create_with_unmanaged_data_disks>
resource_group = 'cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_with_specialized_unmanaged_disk')
    def test_vm_create_with_unmanaged_data_disks(self, resource_group):
    
        self.kwargs.update({
            'vm': 'vm1',
            'vm2': 'vm2'
        })
    
        # create a unmanaged bm with 2 unmanaged disks
        vm_create_cmd = 'vm create -g {rg} -n vm1 --image debian --use-unmanaged-disk --admin-username ubuntu --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
>       self.cmd(vm_create_cmd)

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:514: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e --tag product=azurecli cause=automation date=2020-12-18T14:17:08Z" => 0. 

Command "az group delete --name cli_test_vm_with_specialized_unmanaged_disksko3l7yk2drb6pfisdvevfeol3hvfv3e --yes --no-wait" => 0. 

______ VMAttachDisksOnCreate.test_vm_create_by_attach_os_and_data_disks _______
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C943950E20>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9340C54F0>
command = 'vm create -g clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq -n vm1 --image centos --admi...rname centosadmin --admin-password testPassword0 --authentication-type password --data-disk-sizes-gb 2 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9340C54F0>
args = ['vm', 'create', '-g', 'clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93EE40B80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9340C54F0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMAttachDisksOnCreate testMethod=test_vm_create_by_attach_os_and_data_disks>
resource_group = 'clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq'

    @ResourceGroupPreparer()
    def test_vm_create_by_attach_os_and_data_disks(self, resource_group):
        # the testing below follow a real custom's workflow requiring the support of attaching data disks on create
    
        # creating a vm
>       self.cmd('vm create -g {rg} -n vm1 --image centos --admin-username centosadmin --admin-password testPassword0 --authentication-type password --data-disk-sizes-gb 2 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:543: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq --tag product=azurecli cause=automation date=2020-12-18T14:17:14Z" => 0. 

Command "az group delete --name clitest.rglnm2ohxwrcnf2otlf2zaz6naze5stobiuc6v5j6kdf3fnfsomrwsen6rmhpayczpq --yes --no-wait" => 0. 

_ VMAttachDisksOnCreate.test_vm_create_by_attach_unmanaged_os_and_data_disks __
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9439CEA90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C943528DC0>
command = 'vm create -g clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon -n vm1 --use-unmanaged-disk --image centos --admin-username centosadmin --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C943528DC0>
args = ['vm', 'create', '-g', 'clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93C5F6F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C943528DC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMAttachDisksOnCreate testMethod=test_vm_create_by_attach_unmanaged_os_and_data_disks>
resource_group = 'clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon'

    @ResourceGroupPreparer()
    def test_vm_create_by_attach_unmanaged_os_and_data_disks(self, resource_group):
        # creating a vm
>       self.cmd('vm create -g {rg} -n vm1 --use-unmanaged-disk --image centos --admin-username centosadmin --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:574: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon --tag product=azurecli cause=automation date=2020-12-18T14:17:19Z" => 0. 

Command "az group delete --name clitest.rgu322zmnhzqfvzxfvf472bqatxnmqloqwmsttonqv5pm5h6gpuniof5kmx6ak5izon --yes --no-wait" => 0. 

____________________ VMOSDiskSize.test_vm_set_os_disk_size ____________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93F537A00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C934A79820>
command = 'vm create -g cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij -n vm --image centos --admin...-authentication-type password --os-disk-size-gb 75 --use-unmanaged-disk --storage-account clibc4ze23l3 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C934A79820>
args = ['vm', 'create', '-g', 'cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij', '-n', 'vm', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C939826280>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C934A79820>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMOSDiskSize testMethod=test_vm_set_os_disk_size>
resource_group = 'cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij'

    @AllowLargeResponse(99999)
    @ResourceGroupPreparer(name_prefix='cli_test_os_disk_size')
    def test_vm_set_os_disk_size(self, resource_group):
        # test unmanaged disk
        self.kwargs.update({'sa': self.create_random_name(prefix='cli', length=12)})
>       self.cmd('vm create -g {rg} -n vm --image centos --admin-username centosadmin --admin-password testPassword0 --authentication-type password --os-disk-size-gb 75 --use-unmanaged-disk --storage-account {sa} --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:596: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij/providers/Microsoft.Compute/virtualMachines/vm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij/providers/Microsoft.Compute/virtualMachines/vm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij --tag product=azurecli cause=automation date=2020-12-18T14:17:28Z" => 0. 

Command "az group delete --name cli_test_os_disk_sizedy4pjyfojcqmdk3aodkogd6ftb6s4hbimlozxywhlzypixbiby6mij --yes --no-wait" => 0. 

______________ ImageTemplateTest.test_image_build_managed_image _______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C01A447F0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9E1DF0>
command = 'image builder run -n template01 -g img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9E1DF0>
args = ['image', 'builder', 'run', '-n', 'template01', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C0015D310>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9E1DF0>
ex = CLIError('Deployment failed. Correlation ID: 54a7776f-9d41-45b7-bfde-0472036ca46b. During the image build a failure ha...093/customization.log. OperationId: 8273ef26-785d-4482-a15f-82d4117b79c8. Use this operationId to search packer logs.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 54a7776f-9d41-45b7-bfde-0472036ca46b. During the image build a failure ha...093/customization.log. OperationId: 8273ef26-785d-4482-a15f-82d4117b79c8. Use this operationId to search packer logs.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_image_builder_commands.ImageTemplateTest testMethod=test_image_build_managed_image>
resource_group = 'img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd'
resource_group_location = 'westus'

    @record_only()
    @ResourceGroupPreparer(name_prefix='img_tmpl_managed')
    def test_image_build_managed_image(self, resource_group, resource_group_location):
        self._identity_role(resource_group)
    
        self.kwargs.update({
            'tmpl_1': 'template01',
            'tmpl_2': 'template02',
            'img_src': LINUX_IMAGE_SOURCE,
            'script': TEST_SHELL_SCRIPT_URL,
            'loc': resource_group_location,
            'vm': 'testvm',
            'img_1': 'img_1',
            'img_2': 'img_2'
        })
    
        # create and build image template
        self.cmd('image builder create -n {tmpl_1} -g {rg} --image-source {img_src} --managed-image-destinations '
                 '{img_1}={loc} --scripts {script} --identity {ide}')
>       self.cmd('image builder run -n {tmpl_1} -g {rg}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_image_builder_commands.py:280: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('During the image build a failure has occurred. Please review the build log to identify which build/customi...093/customization.log. OperationId: 8273ef26-785d-4482-a15f-82d4117b79c8. Use this operationId to search packer logs.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 54a7776f-9d41-45b7-bfde-0472036ca46b. During the image build a failure has occurred. Please review the build log to identify which build/customization step failed. For more troubleshooting steps go to https://aka.ms/azvmimagebuilderts. Image build log location: https://lw1htdslo6fj5hppiruoi502.blob.core.windows.net/packerlogs/843e2d58-c28f-4558-b08b-3b625ea22093/customization.log. OperationId: 8273ef26-785d-4482-a15f-82d4117b79c8. Use this operationId to search packer logs.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd --tag product=azurecli cause=automation date=2020-12-18T14:13:49Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -g img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd -n ide1" => 0. 

Command "role assignment create --assignee 3a987a5a-2ca2-4ca9-99bd-67033252080d --role Contributor --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd" => 0. 

Command "image builder create -n template01 -g img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd --image-source Canonical:UbuntuServer:18.04-LTS:18.04.201808140 --managed-image-destinations img_1=westus --scripts https://raw.githubusercontent.com/danielsollondon/azvmimagebuilder/master/quickquickstarts/customizeScript.sh --identity ide1" => 0. 

Command "az group delete --name img_tmpl_managedtky5ypuviy2nsy6luiry464ie2scskx4ezvdejgwuu452q4prudmru3ryrd --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrestazure.tools:tools.py:92 Resource provider 'Microsoft.VirtualMachineImages' used by this operation is not registered. We are registering for you.
[33mWARNING [0m msrestazure.tools:tools.py:103 Registration succeeded.
____________ VMManagedDiskScenarioTest.test_vm_disk_max_shares_etc ____________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C946A36940>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9426084C0>
command = 'sig image-definition create -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg --gallery-...sher1 -f offer1 -s sku1 --features "IsSecureBootSupported=false IsMeasuredBootSupported=false" --hyper-v-generation V2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9426084C0>
args = ['sig', 'image-definition', 'create', '-g', 'cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg', '--gallery-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C940498C10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9426084C0>
ex = HttpResponseError('(InvalidParameter) Gallery Image Features are not supported for this subscription. Please remove the Gallery Image Features from the gallery image object.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError('(InvalidParameter) Gallery Image Features are not supported for this subscription. Please remove the Gallery Image Features from the gallery image object.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMManagedDiskScenarioTest testMethod=test_vm_disk_max_shares_etc>
resource_group = 'cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_disk_max_shares_etc_', location='westus')
    def test_vm_disk_max_shares_etc(self, resource_group):
        # Test disk create: add --disk-iops-read-only, --disk-mbps-read-only, --max-shares, --image-reference, --gallery-image-reference
        subs_id = self.get_subscription_id()
        self.kwargs.update({
            'disk1': 'd1',
            'disk2': 'd2',
            'disk3': 'd3',
            'disk4': 'd4',
            'disk5': 'd5',
            'disk6': 'd6',
            'image': '/Subscriptions/' + subs_id + '/Providers/Microsoft.Compute/Locations/westus/Publishers/Canonical/ArtifactTypes/VMImage/Offers/UbuntuServer/Skus/18.04-LTS/Versions/18.04.202002180',
            'image2': 'image2',
            'g1': self.create_random_name('g1', 20),
            'vm': 'vm1'
        })
    
        self.cmd('disk create -g {rg} -n {disk1} --size-gb 10 --sku UltraSSD_LRS --disk-iops-read-only 200 --disk-mbps-read-only 30', checks=[
            self.check('diskIopsReadOnly', 200),
            self.check('diskMBpsReadOnly', 30)
        ])
    
        self.cmd('disk update -g {rg} -n {disk1} --disk-iops-read-only 250 --disk-mbps-read-only 40', checks=[
            self.check('diskIopsReadOnly', 250),
            self.check('diskMBpsReadOnly', 40)
        ])
    
        self.cmd('disk create -g {rg} -n {disk2} --image-reference {image}', checks=[
            self.check('creationData.imageReference.id', '{image}')
        ])
    
        self.cmd('disk create -g {rg} -n {disk3} --image-reference Canonical:UbuntuServer:18.04-LTS:18.04.202002180', checks=[
            self.check('creationData.imageReference.id', '{image}')
        ])
    
        self.cmd('sig create -g {rg} --gallery-name {g1}')
>       self.cmd('sig image-definition create -g {rg} --gallery-name {g1} --gallery-image-definition image --os-type linux -p publisher1 -f offer1 -s sku1 --features "IsSecureBootSupported=false IsMeasuredBootSupported=false" --hyper-v-generation V2', checks=[
            self.check('features[0].name', 'IsSecureBootSupported'),
            self.check('features[0].value', 'false'),
            self.check('features[1].name', 'IsMeasuredBootSupported'),
            self.check('features[1].value', 'false'),
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:771: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\vm\custom.py:3232: in create_gallery_image
    return client.gallery_images.begin_create_or_update(resource_group_name, gallery_name, gallery_image_name, image)
env\lib\site-packages\azure\mgmt\compute\v2020_09_30\operations\_gallery_images_operations.py:153: in begin_create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.compute.v2020_09_30.operations._gallery_images_operations.GalleryImagesOperations object at 0x000001C9438B52E0>
resource_group_name = 'cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg'
gallery_name = 'g1b5knq6tsbam4e6omgy', gallery_image_name = 'image'
gallery_image = <azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage object at 0x000001C9462EAC10>
kwargs = {}
cls = <function GalleryImagesOperations.begin_create_or_update.<locals>.<lambda> at 0x000001C934C8E040>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2020-09-30', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_disk_max_s...tc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg/providers/Microsoft.Compute/galleries/g1b5knq6tsbam4e6omgy/images/image'
path_format_arguments = {'galleryImageName': 'image', 'galleryName': 'g1b5knq6tsbam4e6omgy', 'resourceGroupName': 'cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}

    def _create_or_update_initial(
        self,
        resource_group_name,  # type: str
        gallery_name,  # type: str
        gallery_image_name,  # type: str
        gallery_image,  # type: "_models.GalleryImage"
        **kwargs  # type: Any
    ):
        # type: (...) -> "_models.GalleryImage"
        cls = kwargs.pop('cls', None)  # type: ClsType["_models.GalleryImage"]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2020-09-30"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self._create_or_update_initial.metadata['url']  # type: ignore
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'galleryName': self._serialize.url("gallery_name", gallery_name, 'str'),
            'galleryImageName': self._serialize.url("gallery_image_name", gallery_image_name, 'str'),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(gallery_image, 'GalleryImage')
        body_content_kwargs['content'] = body_content
        request = self._client.put(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200, 201, 202]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (InvalidParameter) Gallery Image Features are not supported for this subscription. Please remove the Gallery Image Features from the gallery image object.

env\lib\site-packages\azure\mgmt\compute\v2020_09_30\operations\_gallery_images_operations.py:96: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg --tag product=azurecli cause=automation date=2020-12-18T14:17:36Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "disk create -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg -n d1 --size-gb 10 --sku UltraSSD_LRS --disk-iops-read-only 200 --disk-mbps-read-only 30" => 0. 

Command "disk update -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg -n d1 --disk-iops-read-only 250 --disk-mbps-read-only 40" => 0. 

Command "disk create -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg -n d2 --image-reference /Subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/Providers/Microsoft.Compute/Locations/westus/Publishers/Canonical/ArtifactTypes/VMImage/Offers/UbuntuServer/Skus/18.04-LTS/Versions/18.04.202002180" => 0. 

Command "disk create -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg -n d3 --image-reference Canonical:UbuntuServer:18.04-LTS:18.04.202002180" => 0. 

Command "sig create -g cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg --gallery-name g1b5knq6tsbam4e6omgy" => 0. 

Command "az group delete --name cli_test_vm_disk_max_shares_etc_3esbbfxjhn3gwgygnge4iw2igfwqfhf5qlrpk5w5evg --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 hyper_vgeneration is not a known attribute of class <class 'azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage'> and will be ignored
_______________ ImageTemplateTest.test_image_build_shared_image _______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7C631DC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7DEC1D00>
command = 'image builder run -n template01 -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7DEC1D00>
args = ['image', 'builder', 'run', '-n', 'template01', '-g', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C1F4F49D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7DEC1D00>
ex = CLIError('Deployment failed. Correlation ID: c49462d8-f333-4104-86bc-fca11a11791f. During the image build a failure ha...e0a/customization.log. OperationId: 961b2bc3-3a29-4660-b042-4868ad8238f1. Use this operationId to search packer logs.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: c49462d8-f333-4104-86bc-fca11a11791f. During the image build a failure ha...e0a/customization.log. OperationId: 961b2bc3-3a29-4660-b042-4868ad8238f1. Use this operationId to search packer logs.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_image_builder_commands.ImageTemplateTest testMethod=test_image_build_shared_image>
resource_group = 'img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='img_tmpl_sig')
    def test_image_build_shared_image(self, resource_group, resource_group_location):
        self._identity_role(resource_group)
    
        self.kwargs.update({
            'loc': resource_group_location,
            'img_src': LINUX_IMAGE_SOURCE,
            'gallery': self.create_random_name("ib_sig", 10),
            'sig1': 'image1',
            'tmpl': 'template01',
            'tmpl_2': 'template02',
            'script': TEST_SHELL_SCRIPT_URL,
            'vm': 'custom-vm'
        })
    
        self.cmd('sig create -g {rg} --gallery-name {gallery}', checks=self.check('name', self.kwargs['gallery']))
        self.cmd('sig image-definition create -g {rg} --gallery-name {gallery} --gallery-image-definition {sig1} '
                 '--os-type linux -p publisher1 -f offer1 -s sku1')
    
        self.cmd('image builder create -n {tmpl} -g {rg} --scripts {script} --image-source {img_src} --identity {ide} --defer')
        self.cmd('image builder output add -n {tmpl} -g {rg} --gallery-name {gallery} --gallery-image-definition {sig1}'
                 ' --gallery-replication-regions westus --defer',
                 checks=[
                     self.check('properties.distribute[0].replicationRegions[0]', 'westus'),
                     self.check('properties.distribute[0].runOutputName', '{sig1}')
                 ])
    
        # send put request using cached template object
        self.cmd('image builder update -n {tmpl} -g {rg}', checks=[
            self.check('distribute[0].replicationRegions[0]', 'westus'),
            self.check('distribute[0].runOutputName', '{sig1}')
        ])
    
        # Takes a long time to build a SIG based image template.
>       self.cmd('image builder run -n {tmpl} -g {rg}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_image_builder_commands.py:335: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:699: in _run_job
    result = LongRunningOperation(cmd_copy.cli_ctx, 'Starting {}'.format(cmd_copy.name))(result)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('During the image build a failure has occurred. Please review the build log to identify which build/customi...e0a/customization.log. OperationId: 961b2bc3-3a29-4660-b042-4868ad8238f1. Use this operationId to search packer logs.')

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: c49462d8-f333-4104-86bc-fca11a11791f. During the image build a failure has occurred. Please review the build log to identify which build/customization step failed. For more troubleshooting steps go to https://aka.ms/azvmimagebuilderts. Image build log location: https://kfodrnocc2f9gjna6c1hykmt.blob.core.windows.net/packerlogs/03edc59b-65fc-40f9-b704-20e7160fde0a/customization.log. OperationId: 961b2bc3-3a29-4660-b042-4868ad8238f1. Use this operationId to search packer logs.

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --tag product=azurecli cause=automation date=2020-12-18T14:17:40Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 -n ide1" => 0. 

Command "role assignment create --assignee 0a9f07d6-d474-4b0c-9f6a-6168e3d16043 --role Contributor --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32" => 0. 

Command "sig create -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --gallery-name ib_sig6msw" => 0. 

Command "sig image-definition create -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --gallery-name ib_sig6msw --gallery-image-definition image1 --os-type linux -p publisher1 -f offer1 -s sku1" => 0. 

Command "image builder create -n template01 -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --scripts https://raw.githubusercontent.com/danielsollondon/azvmimagebuilder/master/quickquickstarts/customizeScript.sh --image-source Canonical:UbuntuServer:18.04-LTS:18.04.201808140 --identity ide1 --defer" => 0. 

Command "image builder output add -n template01 -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --gallery-name ib_sig6msw --gallery-image-definition image1 --gallery-replication-regions westus --defer" => 0. 

Command "image builder update -n template01 -g img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32" => 0. 

Command "az group delete --name img_tmpl_sigpxr5bsjhunyjxgkb2int7u4ciwcwpk77t5l7dmm2rdw2hryzncu34r7ldvexf32 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 hyper_vgeneration is not a known attribute of class <class 'azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage'> and will be ignored
_______________ ServiceFabricApplicationTests.test_application ________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238292C6040>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382919E100>
command = 'sf cluster create -g clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75 -c sfrp-cli-jlb2kbyn...azure.net/secrets/sfrp-cli-tv4cwknxhdvzrqu/4eeb19c8cb164180a2c3a55b92edde36 --vm-password "Pass@oy2p" --cluster-size 3'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382919E100>
args = ['sf', 'cluster', 'create', '-g', 'clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75', '-c', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238292B7CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382919E100>
ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.servicefabric.tests.latest.test_sf_application.ServiceFabricApplicationTests testMethod=test_application>

    @ResourceGroupPreparer()
    def test_application(self):
        self.kwargs.update({
            'kv_name': self.create_random_name('sfrp-cli-kv-', 24),
            'loc': 'westus',
            'cert_name': self.create_random_name('sfrp-cli-', 24),
            'cluster_name': self.create_random_name('sfrp-cli-', 24),
            'vm_password': self.create_random_name('Pass@', 9),
            'app_type_name': 'CalcServiceApp',
            'v1': '1.0',
            'app_package_v1': 'https://sfrpserviceclienttesting.blob.core.windows.net/test-apps/CalcApp_1.0.sfpkg',
            'v2': '1.2',
            'app_package_v2': 'https://sfrpserviceclienttesting.blob.core.windows.net/test-apps/CalcApp_1.2.sfpkg',
            'app_name': self.create_random_name('testApp', 11),
            'service_type': 'CalcServiceType'
        })
    
>       _create_cluster_with_separate_kv(self, self.kwargs)

src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\test_sf_application.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\test_util.py:39: in _create_cluster_with_separate_kv
    test.cmd('az sf cluster create -g {rg} -c {cluster_name} -l {loc} --secret-identifier {cert_secret_id} --vm-password "{vm_password}" --cluster-size 3')
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\servicefabric\custom.py:250: in new_cluster
    validate_and_deploy_arm_template(cmd, resource_group_name, template, parameters)
src\azure-cli\azure\cli\command_modules\servicefabric\_arm_deployment_utils.py:22: in validate_and_deploy_arm_template
    validate_result = _deploy_arm_template_core(
src\azure-cli\azure\cli\command_modules\servicefabric\_arm_deployment_utils.py:51: in _deploy_arm_template_core
    deploy_poll = sdk_no_wait(no_wait, client.deployments.validate, resource_group_name, deployment_name,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
env\lib\site-packages\azure\mgmt\resource\resources\v2020_10_01\operations\_deployments_operations.py:3261: in validate
    return LROPoller(self._client, raw_result, get_long_running_output, polling_method)
env\lib\site-packages\msrest\polling\poller.py:130: in __init__
    self._polling_method.initialize(self._client, self._response, deserialization_callback)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <msrestazure.polling.arm_polling.ARMPolling object at 0x00000238295C35B0>
client = <msrest.service_client.ServiceClient object at 0x00000238295B1EE0>
initial_response = <Response [400]>
deserialization_callback = <function DeploymentsOperations.validate.<locals>.get_long_running_output at 0x0000023829582700>

    def initialize(self, client, initial_response, deserialization_callback):
        """Set the initial status of this LRO.
    
        :param initial_response: The initial response of the poller
        :raises: CloudError if initial status is incorrect LRO state
        """
        self._client = client
        self._response = initial_response
        self._operation = LongRunningOperation(initial_response, deserialization_callback, self._lro_options)
        try:
            self._operation.set_initial_status(initial_response)
        except BadStatus:
            self._operation.status = 'Failed'
>           raise CloudError(initial_response)
E           msrestazure.azure_exceptions.CloudError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75/providers/Microsoft.Compute/virtualMachineScaleSets/nt1vm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75/providers/Microsoft.Compute/virtualMachineScaleSets/nt1vm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

env\lib\site-packages\msrestazure\polling\arm_polling.py:381: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75 --tag product=azurecli cause=automation date=2020-12-18T14:36:18Z" => 0. 

Command "keyvault create --resource-group clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75 -n sfrp-cli-kv-aujbtua5jvzy -l westus --enabled-for-deployment true --enabled-for-template-deployment true" => 0. 

Command "keyvault certificate create --vault-name sfrp-cli-kv-aujbtua5jvzy -n sfrp-cli-tv4cwknxhdvzrqu -p @"c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\policy.json"" => 0. 

Command "keyvault certificate show --vault-name sfrp-cli-kv-aujbtua5jvzy -n sfrp-cli-tv4cwknxhdvzrqu" => 0. 

Command "az group delete --name clitest.rgskbtcn3phiw2jazihamvtsloy5cxywxl6xczdxssjhwcqivlxibtrxjorcuqqpp75 --yes --no-wait" => 0. 

_________________ VMGeneralizeScenarioTest.test_vm_generalize _________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C1FF59100>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7E384760>
command = 'vm create -g cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat -n vm-generalize --admin-use...u --image UbuntuLTS --admin-password testPassword0 --authentication-type password --use-unmanaged-disk --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E384760>
args = ['vm', 'create', '-g', 'cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat', '-n', 'vm-generalize', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7D357AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E384760>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMGeneralizeScenarioTest testMethod=test_vm_generalize>
resource_group = 'cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat'

    @ResourceGroupPreparer(name_prefix='cli_test_generalize_vm')
    def test_vm_generalize(self, resource_group):
    
        self.kwargs.update({
            'vm': 'vm-generalize'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --admin-username ubuntu --image UbuntuLTS --admin-password testPassword0 --authentication-type password --use-unmanaged-disk --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:228: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat/providers/Microsoft.Compute/virtualMachines/vm-generalize' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat/providers/Microsoft.Compute/virtualMachines/vm-generalize' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat --tag product=azurecli cause=automation date=2020-12-18T14:37:19Z" => 0. 

Command "az group delete --name cli_test_generalize_vmjlb5ighsg7hkoc354r5bttey5mrcuye2ks5n7jnbqdvkeozqo4uat --yes --no-wait" => 0. 

____________ ServiceFabricManagedClustersTests.test_basic_cluster _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238298F1880>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023829FF80D0>
command = 'sf managed-node-type create -g clitest.rgypzfrvyhsikh3vs6umxmzsk24twtdk5d4kcdhozjpbc52rw5wjdmhunr4pnx2fq3l -c sfrp-cli-muazskihwjvjdf6 -n pnt --instance-count 5 --primary'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829FF80D0>
args = ['sf', 'managed-node-type', 'create', '-g', 'clitest.rgypzfrvyhsikh3vs6umxmzsk24twtdk5d4kcdhozjpbc52rw5wjdmhunr4pnx2fq3l', '-c', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023829C20F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829FF80D0>
ex = CLIError("Deployment failed. Correlation ID: c31bc2f4-3684-4126-8e27-78f5d4c98d1e. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError("Deployment failed. Correlation ID: c31bc2f4-3684-4126-8e27-78f5d4c98d1e. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.servicefabric.tests.latest.test_sf_managed_cluster.ServiceFabricManagedClustersTests testMethod=test_basic_cluster>

    @ResourceGroupPreparer()
    def test_basic_cluster(self):
        self.kwargs.update({
            'cert_tp': '123BDACDCDFB2C7B250192C6078E47D1E1DB119B',
            'loc': 'eastasia',
            'cluster_name': self.create_random_name('sfrp-cli-', 24),
            'vm_password': self.create_random_name('Pass@', 9)
        })
    
        self.cmd('az sf managed-cluster create -g {rg} -c {cluster_name} -l {loc} --cert-thumbprint {cert_tp} --cert-is-admin --admin-password {vm_password}',
                 checks=[self.check('provisioningState', 'Succeeded'),
                         self.check('clusterState', 'WaitingForNodes')])
    
>       self.cmd('az sf managed-node-type create -g {rg} -c {cluster_name} -n pnt --instance-count 5 --primary',
                 checks=[self.check('provisioningState', 'Succeeded')])

src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\test_sf_managed_cluster.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\servicefabric\operations\managed_node_types.py:83: in create_node_type
    node_type = LongRunningOperation(cmd.cli_ctx)(poller)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subs...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: c31bc2f4-3684-4126-8e27-78f5d4c98d1e. Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_d8c3fbb3-15f2-498e-a678-9a152b850254/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_d8c3fbb3-15f2-498e-a678-9a152b850254/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' is currently not available in location 'eastasia' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'..

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgypzfrvyhsikh3vs6umxmzsk24twtdk5d4kcdhozjpbc52rw5wjdmhunr4pnx2fq3l --tag product=azurecli cause=automation date=2020-12-18T14:37:19Z" => 0. 

Command group 'sf managed-cluster' is in preview. It may be changed/removed in a future release.
Command "az sf managed-cluster create -g clitest.rgypzfrvyhsikh3vs6umxmzsk24twtdk5d4kcdhozjpbc52rw5wjdmhunr4pnx2fq3l -c sfrp-cli-muazskihwjvjdf6 -l eastasia --cert-thumbprint 123BDACDCDFB2C7B250192C6078E47D1E1DB119B --cert-is-admin --admin-password Pass@uoiq" => 0. 

Command group 'sf managed-node-type' is in preview. It may be changed/removed in a future release.
Command "az group delete --name clitest.rgypzfrvyhsikh3vs6umxmzsk24twtdk5d4kcdhozjpbc52rw5wjdmhunr4pnx2fq3l --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrestazure.tools:tools.py:92 Resource provider 'Microsoft.ServiceFabric' used by this operation is not registered. We are registering for you.
[33mWARNING [0m msrestazure.tools:tools.py:103 Registration succeeded.
__________ VMSimulateEvictionScenarioTest.test_vm_simulate_eviction ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSimulateEvictionScenarioTest testMethod=test_vm_simulate_eviction>
resource_group = 'cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_simulate_eviction')
    def test_vm_simulate_eviction(self, resource_group):
    
        self.kwargs.update({
            'loc': 'eastus',
            'vm1': 'vm-simualte-eviction1',
            'vm2': 'vm-simulate-eviction2',
            'vm3': 'vm-simulate-eviction3'
        })
    
        # simulate-eviction on a Regular VM, expect failure
        self.cmd('vm create --resource-group {rg} --name {vm1} --admin-username azureuser --admin-password testPassword0 --authentication-type password --location {loc} --image Centos --priority Regular --nsg-rule NONE')
        self.cmd('vm simulate-eviction --resource-group {rg} --name {vm1}', expect_failure=True)
    
        # simulate-eviction on a Spot VM with Deallocate policy, expect VM to be deallocated
        self.cmd('vm create --resource-group {rg} --name {vm2} --admin-username azureuser --admin-password testPassword0 --authentication-type password --location {loc} --image Centos --priority Spot --eviction-policy Deallocate --nsg-rule NONE')
        self.cmd('vm simulate-eviction --resource-group {rg} --name {vm2}')
        time.sleep(180)
        self.cmd('vm get-instance-view --resource-group {rg} --name {vm2}', checks=[
            self.check('name', '{vm2}'),
            self.check('resourceGroup', '{rg}'),
            self.check('length(instanceView.statuses)', 2),
            self.check('instanceView.statuses[0].code', 'ProvisioningState/succeeded'),
            self.check('instanceView.statuses[1].code', 'PowerState/deallocated'),
        ])
    
        # simulate-eviction on a Spot VM with Delete policy, expect VM to be deleted
        self.cmd('vm create --resource-group {rg} --name {vm3} --admin-username azureuser --admin-password testPassword0 --authentication-type password --location {loc} --image Centos --priority Spot --eviction-policy Delete --nsg-rule NONE')
        self.cmd('vm simulate-eviction --resource-group {rg} --name {vm3}')
        time.sleep(180)
>       self.cmd('vm list --resource-group {rg}', checks=[self.check('length(@)', 2)])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:926: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x000001C94881D310>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C948AC3EB0>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'length(@)' doesn't yield expected value '2', instead the actual value is '3'. Data: 
E               [
E                 {
E                   "additionalCapabilities": null,
E                   "availabilitySet": null,
E                   "billingProfile": null,
E                   "diagnosticsProfile": null,
E                   "evictionPolicy": null,
E                   "extensionsTimeBudget": null,
E                   "hardwareProfile": {
E                     "vmSize": "Standard_DS1_v2"
E                   },
E                   "host": null,
E                   "hostGroup": null,
E                   "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/virtualMachines/vm-simualte-eviction1",
E                   "identity": null,
E                   "instanceView": null,
E                   "licenseType": null,
E                   "location": "eastus",
E                   "name": "vm-simualte-eviction1",
E                   "networkProfile": {
E                     "networkInterfaces": [
E                       {
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Network/networkInterfaces/vm-simualte-eviction1VMNic",
E                         "primary": null,
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x"
E                       }
E                     ]
E                   },
E                   "osProfile": {
E                     "adminPassword": null,
E                     "adminUsername": "azureuser",
E                     "allowExtensionOperations": true,
E                     "computerName": "vm-simualte-eviction1",
E                     "customData": null,
E                     "linuxConfiguration": {
E                       "disablePasswordAuthentication": false,
E                       "patchSettings": {
E                         "patchMode": "ImageDefault"
E                       },
E                       "provisionVmAgent": true,
E                       "ssh": null
E                     },
E                     "requireGuestProvisionSignal": true,
E                     "secrets": [],
E                     "windowsConfiguration": null
E                   },
E                   "plan": null,
E                   "priority": "Regular",
E                   "provisioningState": "Succeeded",
E                   "proximityPlacementGroup": null,
E                   "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                   "resources": null,
E                   "securityProfile": null,
E                   "storageProfile": {
E                     "dataDisks": [],
E                     "imageReference": {
E                       "exactVersion": "7.5.201808150",
E                       "id": null,
E                       "offer": "CentOS",
E                       "publisher": "OpenLogic",
E                       "sku": "7.5",
E                       "version": "latest"
E                     },
E                     "osDisk": {
E                       "caching": "ReadWrite",
E                       "createOption": "FromImage",
E                       "diffDiskSettings": null,
E                       "diskSizeGb": 30,
E                       "encryptionSettings": null,
E                       "image": null,
E                       "managedDisk": {
E                         "diskEncryptionSet": null,
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/disks/vm-simualte-eviction1_OsDisk_1_75e325f409e04a599bd81d7f29cfe2e6",
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                         "storageAccountType": "Premium_LRS"
E                       },
E                       "name": "vm-simualte-eviction1_OsDisk_1_75e325f409e04a599bd81d7f29cfe2e6",
E                       "osType": "Linux",
E                       "vhd": null,
E                       "writeAcceleratorEnabled": null
E                     }
E                   },
E                   "tags": {},
E                   "type": "Microsoft.Compute/virtualMachines",
E                   "virtualMachineScaleSet": null,
E                   "vmId": "c8995959-5d58-4b54-9f63-fe78a32e4c21",
E                   "zones": null
E                 },
E                 {
E                   "additionalCapabilities": null,
E                   "availabilitySet": null,
E                   "billingProfile": {
E                     "maxPrice": -1.0
E                   },
E                   "diagnosticsProfile": null,
E                   "evictionPolicy": "Deallocate",
E                   "extensionsTimeBudget": null,
E                   "hardwareProfile": {
E                     "vmSize": "Standard_DS1_v2"
E                   },
E                   "host": null,
E                   "hostGroup": null,
E                   "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/virtualMachines/vm-simulate-eviction2",
E                   "identity": null,
E                   "instanceView": null,
E                   "licenseType": null,
E                   "location": "eastus",
E                   "name": "vm-simulate-eviction2",
E                   "networkProfile": {
E                     "networkInterfaces": [
E                       {
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Network/networkInterfaces/vm-simulate-eviction2VMNic",
E                         "primary": null,
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x"
E                       }
E                     ]
E                   },
E                   "osProfile": {
E                     "adminPassword": null,
E                     "adminUsername": "azureuser",
E                     "allowExtensionOperations": true,
E                     "computerName": "vm-simulate-eviction2",
E                     "customData": null,
E                     "linuxConfiguration": {
E                       "disablePasswordAuthentication": false,
E                       "patchSettings": {
E                         "patchMode": "ImageDefault"
E                       },
E                       "provisionVmAgent": true,
E                       "ssh": null
E                     },
E                     "requireGuestProvisionSignal": true,
E                     "secrets": [],
E                     "windowsConfiguration": null
E                   },
E                   "plan": null,
E                   "priority": "Spot",
E                   "provisioningState": "Succeeded",
E                   "proximityPlacementGroup": null,
E                   "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                   "resources": null,
E                   "securityProfile": null,
E                   "storageProfile": {
E                     "dataDisks": [],
E                     "imageReference": {
E                       "exactVersion": "7.5.201808150",
E                       "id": null,
E                       "offer": "CentOS",
E                       "publisher": "OpenLogic",
E                       "sku": "7.5",
E                       "version": "latest"
E                     },
E                     "osDisk": {
E                       "caching": "ReadWrite",
E                       "createOption": "FromImage",
E                       "diffDiskSettings": null,
E                       "diskSizeGb": null,
E                       "encryptionSettings": null,
E                       "image": null,
E                       "managedDisk": {
E                         "diskEncryptionSet": null,
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/disks/vm-simulate-eviction2_OsDisk_1_57586342106d49bd8353b7001650ef80",
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                         "storageAccountType": null
E                       },
E                       "name": "vm-simulate-eviction2_OsDisk_1_57586342106d49bd8353b7001650ef80",
E                       "osType": "Linux",
E                       "vhd": null,
E                       "writeAcceleratorEnabled": null
E                     }
E                   },
E                   "tags": {},
E                   "type": "Microsoft.Compute/virtualMachines",
E                   "virtualMachineScaleSet": null,
E                   "vmId": "624049cc-5032-4234-9938-4e71fa0ee592",
E                   "zones": null
E                 },
E                 {
E                   "additionalCapabilities": null,
E                   "availabilitySet": null,
E                   "billingProfile": {
E                     "maxPrice": -1.0
E                   },
E                   "diagnosticsProfile": null,
E                   "evictionPolicy": "Delete",
E                   "extensionsTimeBudget": null,
E                   "hardwareProfile": {
E                     "vmSize": "Standard_DS1_v2"
E                   },
E                   "host": null,
E                   "hostGroup": null,
E                   "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/virtualMachines/vm-simulate-eviction3",
E                   "identity": null,
E                   "instanceView": null,
E                   "licenseType": null,
E                   "location": "eastus",
E                   "name": "vm-simulate-eviction3",
E                   "networkProfile": {
E                     "networkInterfaces": [
E                       {
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Network/networkInterfaces/vm-simulate-eviction3VMNic",
E                         "primary": null,
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x"
E                       }
E                     ]
E                   },
E                   "osProfile": {
E                     "adminPassword": null,
E                     "adminUsername": "azureuser",
E                     "allowExtensionOperations": true,
E                     "computerName": "vm-simulate-eviction3",
E                     "customData": null,
E                     "linuxConfiguration": {
E                       "disablePasswordAuthentication": false,
E                       "patchSettings": {
E                         "patchMode": "ImageDefault"
E                       },
E                       "provisionVmAgent": true,
E                       "ssh": null
E                     },
E                     "requireGuestProvisionSignal": true,
E                     "secrets": [],
E                     "windowsConfiguration": null
E                   },
E                   "plan": null,
E                   "priority": "Spot",
E                   "provisioningState": "Deleting",
E                   "proximityPlacementGroup": null,
E                   "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                   "resources": null,
E                   "securityProfile": null,
E                   "storageProfile": {
E                     "dataDisks": [],
E                     "imageReference": {
E                       "exactVersion": "7.5.201808150",
E                       "id": null,
E                       "offer": "CentOS",
E                       "publisher": "OpenLogic",
E                       "sku": "7.5",
E                       "version": "latest"
E                     },
E                     "osDisk": {
E                       "caching": "ReadWrite",
E                       "createOption": "FromImage",
E                       "diffDiskSettings": null,
E                       "diskSizeGb": 30,
E                       "encryptionSettings": null,
E                       "image": null,
E                       "managedDisk": {
E                         "diskEncryptionSet": null,
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x/providers/Microsoft.Compute/disks/vm-simulate-eviction3_OsDisk_1_ecbd28cece34441397c0135d976742a2",
E                         "resourceGroup": "cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x",
E                         "storageAccountType": "Premium_LRS"
E                       },
E                       "name": "vm-simulate-eviction3_OsDisk_1_ecbd28cece34441397c0135d976742a2",
E                       "osType": "Linux",
E                       "vhd": null,
E                       "writeAcceleratorEnabled": null
E                     }
E                   },
E                   "tags": {},
E                   "type": "Microsoft.Compute/virtualMachines",
E                   "virtualMachineScaleSet": null,
E                   "vmId": "9c03f4ac-0ce5-4aad-a9d7-3f568982b681",
E                   "zones": null
E                 }
E               ]

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --tag product=azurecli cause=automation date=2020-12-18T14:29:40Z" => 0. 

Command "vm create --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simualte-eviction1 --admin-username azureuser --admin-password testPassword0 --authentication-type password --location eastus --image Centos --priority Regular --nsg-rule NONE" => 0. 

Command "vm simulate-eviction --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simualte-eviction1" => 1. 

Command "vm create --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simulate-eviction2 --admin-username azureuser --admin-password testPassword0 --authentication-type password --location eastus --image Centos --priority Spot --eviction-policy Deallocate --nsg-rule NONE" => 0. 

Command "vm simulate-eviction --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simulate-eviction2" => 0. 

Command "vm get-instance-view --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simulate-eviction2" => 0. 

Command "vm create --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simulate-eviction3 --admin-username azureuser --admin-password testPassword0 --authentication-type password --location eastus --image Centos --priority Spot --eviction-policy Delete --nsg-rule NONE" => 0. 

Command "vm simulate-eviction --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --name vm-simulate-eviction3" => 0. 

Command "vm list --resource-group cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x" => 0. 

Command "az group delete --name cli_test_vm_simulate_evictionyazj5pg4j3h5y2roqjlgla4qx6uu7jpufm2vrm3rulvm3x --yes --no-wait" => 0. 

_________________ VMNoWaitScenarioTest.test_vm_create_no_wait _________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C948AADAF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9487B3220>
command = 'vm create -g cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs -n vmnowait2 --admin-username user12 --admin-password testPassword0 --authentication-type password --image UbuntuLTS --nsg-rule NONE --no-wait'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9487B3220>
args = ['vm', 'create', '-g', 'cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs', '-n', 'vmnowait2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948CE0D30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9487B3220>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMNoWaitScenarioTest testMethod=test_vm_create_no_wait>
resource_group = 'cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_no_wait')
    def test_vm_create_no_wait(self, resource_group):
    
        self.kwargs.update({
            'loc': 'westus',
            'vm': 'vmnowait2'
        })
>       self.cmd('vm create -g {rg} -n {vm} --admin-username user12 --admin-password testPassword0 --authentication-type password --image UbuntuLTS --nsg-rule NONE --no-wait',
                 checks=self.is_empty())

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:939: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs/providers/Microsoft.Compute/virtualMachines/vmnowait2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs/providers/Microsoft.Compute/virtualMachines/vmnowait2' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs --tag product=azurecli cause=automation date=2020-12-18T14:45:40Z" => 0. 

Command "az group delete --name cli_test_vm_no_waitskzz74jh7k56owqkrvsvsb75ib5gk7hfv4rpo5hpmycqv27etmhxikcs --yes --no-wait" => 0. 

_____________ ServiceFabricManagedClustersTests.test_cert_and_ext _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381BFD3460>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381BFD3070>
command = 'sf managed-node-type create -g clitest.rgnhvmg343jlypg7rhj4dubv5ydaaxuuaarxsdccgekuoo5oyntruv2tb7mypl5r2ru -c sfrp-cli-ftvmik72r6abvkk -n pnt --instance-count 5 --primary'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BFD3070>
args = ['sf', 'managed-node-type', 'create', '-g', 'clitest.rgnhvmg343jlypg7rhj4dubv5ydaaxuuaarxsdccgekuoo5oyntruv2tb7mypl5r2ru', '-c', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382925AA60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BFD3070>
ex = CLIError("Deployment failed. Correlation ID: ca2c6bed-6ec5-40d0-b9a6-400958da0174. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError("Deployment failed. Correlation ID: ca2c6bed-6ec5-40d0-b9a6-400958da0174. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.servicefabric.tests.latest.test_sf_managed_cluster.ServiceFabricManagedClustersTests testMethod=test_cert_and_ext>

    @ResourceGroupPreparer()
    def test_cert_and_ext(self):
        self.kwargs.update({
            'cert_tp': '123BDACDCDFB2C7B250192C6078E47D1E1DB119B',
            'cert_tp2': '123BDACDCDFB2C7B250192C6078E47D1E1DB7777',
            'loc': 'eastasia',
            'cluster_name': self.create_random_name('sfrp-cli-', 24),
            'vm_password': self.create_random_name('Pass@', 9),
            'extName': 'csetest',
            'publisher': 'Microsoft.Compute',
            'extType': 'BGInfo',
            'extVer': '2.1',
            'kv_name': self.create_random_name('sfrp-cli-kv-', 24),
            'cert_name': self.create_random_name('sfrp-cli-', 24)
        })
    
        self.cmd('az sf managed-cluster create -g {rg} -c {cluster_name} -l {loc} --cert-thumbprint {cert_tp} --cert-is-admin --admin-password {vm_password}',
                 checks=[self.check('provisioningState', 'Succeeded'),
                         self.check('clusterState', 'WaitingForNodes')])
    
>       self.cmd('az sf managed-node-type create -g {rg} -c {cluster_name} -n pnt --instance-count 5 --primary',
                 checks=[self.check('provisioningState', 'Succeeded')])

src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\test_sf_managed_cluster.py:112: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\servicefabric\operations\managed_node_types.py:83: in create_node_type
    node_type = LongRunningOperation(cmd.cli_ctx)(poller)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subs...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: ca2c6bed-6ec5-40d0-b9a6-400958da0174. Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_3e27b748-00da-4ff0-a1f0-142a3758c18f/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_3e27b748-00da-4ff0-a1f0-142a3758c18f/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' is currently not available in location 'eastasia' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'..

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgnhvmg343jlypg7rhj4dubv5ydaaxuuaarxsdccgekuoo5oyntruv2tb7mypl5r2ru --tag product=azurecli cause=automation date=2020-12-18T14:43:03Z" => 0. 

Command group 'sf managed-cluster' is in preview. It may be changed/removed in a future release.
Command "az sf managed-cluster create -g clitest.rgnhvmg343jlypg7rhj4dubv5ydaaxuuaarxsdccgekuoo5oyntruv2tb7mypl5r2ru -c sfrp-cli-ftvmik72r6abvkk -l eastasia --cert-thumbprint 123BDACDCDFB2C7B250192C6078E47D1E1DB119B --cert-is-admin --admin-password Pass@uesu" => 0. 

Command group 'sf managed-node-type' is in preview. It may be changed/removed in a future release.
Command "az group delete --name clitest.rgnhvmg343jlypg7rhj4dubv5ydaaxuuaarxsdccgekuoo5oyntruv2tb7mypl5r2ru --yes --no-wait" => 0. 

__________________ VMExtensionScenarioTest.test_vm_extension __________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94662BAC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9540D2490>
command = 'vm create -n myvm -g cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7 --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9540D2490>
args = ['vm', 'create', '-n', 'myvm', '-g', 'cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9364731F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9540D2490>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMExtensionScenarioTest testMethod=test_vm_extension>
resource_group = 'cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_extension')
    def test_vm_extension(self, resource_group):
    
        user_name = 'foouser1'
        config_file = _write_config_file(user_name)
    
        self.kwargs.update({
            'vm': 'myvm',
            'pub': 'Microsoft.OSTCExtensions',
            'ext': 'VMAccessForLinux',
            'config': config_file,
            'user': user_name
        })
    
>       self.cmd('vm create -n {vm} -g {rg} --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1065: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7/providers/Microsoft.Compute/virtualMachines/myvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7/providers/Microsoft.Compute/virtualMachines/myvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7 --tag product=azurecli cause=automation date=2020-12-18T14:48:01Z" => 0. 

Command "az group delete --name cli_test_vm_extensionaemmjoazdqddet3kj7r2iqvswndrilujdjdyprfivpx63g7kvi32b7 --yes --no-wait" => 0. 

___________ VMExtensionScenarioTest.test_vm_extension_instance_name ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93C0BC670>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9461D8430>
command = 'vm create -n myvm -g cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9461D8430>
args = ['vm', 'create', '-n', 'myvm', '-g', 'cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948243B80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9461D8430>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMExtensionScenarioTest testMethod=test_vm_extension_instance_name>
resource_group = 'cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_extension_2')
    def test_vm_extension_instance_name(self, resource_group):
    
        user_name = 'foouser1'
        config_file = _write_config_file(user_name)
    
        self.kwargs.update({
            'vm': 'myvm',
            'pub': 'Microsoft.OSTCExtensions',
            'ext_type': 'VMAccessForLinux',
            'config': config_file,
            'user': user_name,
            'ext_name': 'MyAccessExt'
        })
    
>       self.cmd('vm create -n {vm} -g {rg} --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1100: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh/providers/Microsoft.Compute/virtualMachines/myvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh/providers/Microsoft.Compute/virtualMachines/myvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh --tag product=azurecli cause=automation date=2020-12-18T14:48:07Z" => 0. 

Command "az group delete --name cli_test_vm_extension_2b2bskbgdxzcsofcsfn26xmczmp6idj7cijlvi6gzwlo7mhy4vunh --yes --no-wait" => 0. 

______________ VMExtensionScenarioTest.test_vm_extension_with_id ______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C935618AC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93C630280>
command = 'vm create -g cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6 -n vm1 --image UbuntuLTS --generate-ssh-keys --admin-username azureuser --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93C630280>
args = ['vm', 'create', '-g', 'cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C946D12670>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93C630280>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMExtensionScenarioTest testMethod=test_vm_extension_with_id>
resource_group = 'cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6'

    @AllowLargeResponse(size_kb=99999)
    @ResourceGroupPreparer(name_prefix='cli_test_vm_extension_with_id_')
    def test_vm_extension_with_id(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1'
        })
>       vm_id = self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --generate-ssh-keys --admin-username azureuser --nsg-rule NONE').get_output_in_json()['id']

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1116: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6 --tag product=azurecli cause=automation date=2020-12-18T14:48:12Z" => 0. 

Command "az group delete --name cli_test_vm_extension_with_id_uohmvcxh3gyjwgpbd3c2mdafua3vipvn5iqaqdpicrob6 --yes --no-wait" => 0. 

______________ VMCreateUbuntuScenarioTest.test_vm_create_ubuntu _______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C948538EE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93F6509D0>
command = "vm create --resource-group cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb --admin-userna...w2+jdyGNQQ== test@example.com\n' --location westus --data-disk-sizes-gb 1 --data-disk-caching ReadOnly --nsg-rule NONE"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93F6509D0>
args = ['vm', 'create', '--resource-group', 'cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb', '--admin-username', 'ubuntu', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C946D06820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93F6509D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateUbuntuScenarioTest testMethod=test_vm_create_ubuntu>
resource_group = 'cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_ubuntu')
    def test_vm_create_ubuntu(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'username': 'ubuntu',
            'vm': 'cli-test-vm2',
            'comp_name': 'my-computer',
            'image': 'UbuntuLTS',
            'auth': 'ssh',
            'ssh_key': TEST_SSH_KEY_PUB,
            'loc': resource_group_location
        })
>       self.cmd('vm create --resource-group {rg} --admin-username {username} --name {vm} --authentication-type {auth} --computer-name {comp_name} '
                 ' --image {image} --ssh-key-value \'{ssh_key}\' --location {loc} --data-disk-sizes-gb 1 --data-disk-caching ReadOnly --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1183: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb/providers/Microsoft.Compute/virtualMachines/cli-test-vm2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb/providers/Microsoft.Compute/virtualMachines/cli-test-vm2' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb --tag product=azurecli cause=automation date=2020-12-18T14:48:18Z" => 0. 

Command "az group delete --name cli_test_vm_create_ubuntue7m65jbpdc4xytrkmau4zurxw4tx4eycaawciyrd2v5w63mlqb --yes --no-wait" => 0. 

__________ VMCreateEphemeralOsDisk.test_vm_create_ephemeral_os_disk ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C939A2C9A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9431035B0>
command = "vm create --resource-group cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u --name cli-tes...2aBicz5Ew2+jdyGNQQ== test@example.com\n' --location westus --ephemeral-os-disk --admin-username user_1 --nsg-rule NONE"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9431035B0>
args = ['vm', 'create', '--resource-group', 'cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u', '--name', 'cli-test-vm-local-1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93930F670>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9431035B0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateEphemeralOsDisk testMethod=test_vm_create_ephemeral_os_disk>
resource_group = 'cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_ephemeral_os_disk')
    def test_vm_create_ephemeral_os_disk(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'vm': 'cli-test-vm-local-1',
            'vm_2': 'cli-test-vm-local-2',
            'image': 'UbuntuLTS',
            'ssh_key': TEST_SSH_KEY_PUB,
            'loc': resource_group_location,
            'user': 'user_1'
        })
    
        # check that we can create a vm with local / ephemeral os disk.
>       self.cmd('vm create --resource-group {rg} --name {vm} --image {image} --ssh-key-value \'{ssh_key}\' --location {loc} --ephemeral-os-disk --admin-username {user} --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1218: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u/providers/Microsoft.Compute/virtualMachines/cli-test-vm-local-1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u/providers/Microsoft.Compute/virtualMachines/cli-test-vm-local-1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u --tag product=azurecli cause=automation date=2020-12-18T14:48:24Z" => 0. 

Argument '--ephemeral-os-disk' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_vm_create_ephemeral_os_disk3uqtkven4dgmm3tcg7cgrxt2wtwkozp2bn3un2u --yes --no-wait" => 0. 

______________ VMMultiNicScenarioTest.test_vm_create_multi_nics _______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C93D19E3D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9403690A0>
command = "vm create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n multinicvm1 --image Ubunt...7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n'"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9403690A0>
args = ['vm', 'create', '-g', 'cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey', '-n', 'multinicvm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9429E7AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9403690A0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMMultiNicScenarioTest testMethod=test_vm_create_multi_nics>
resource_group = 'cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey'

    @ResourceGroupPreparer(name_prefix='cli_test_multi_nic_vm')
    def test_vm_create_multi_nics(self, resource_group):
    
        self.kwargs.update({
            'vnet': 'myvnet',
            'subnet': 'mysubnet',
            'vm': 'multinicvm1',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.cmd('network vnet create -g {rg} -n {vnet} --subnet-name {subnet}')
        for i in range(1, 5):  # create four NICs
            self.kwargs['nic'] = 'nic{}'.format(i)
            self.cmd('network nic create -g {rg} -n {nic} --subnet {subnet} --vnet-name {vnet}')
    
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --nics nic1 nic2 nic3 nic4 --admin-username user11 --size Standard_DS3 --ssh-key-value \'{ssh_key}\'')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1253: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey/providers/Microsoft.Compute/virtualMachines/multinicvm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey/providers/Microsoft.Compute/virtualMachines/multinicvm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey --tag product=azurecli cause=automation date=2020-12-18T14:48:29Z" => 0. 

Command "network vnet create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n myvnet --subnet-name mysubnet" => 0. 

Command "network nic create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n nic1 --subnet mysubnet --vnet-name myvnet" => 0. 

Command "network nic create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n nic2 --subnet mysubnet --vnet-name myvnet" => 0. 

Command "network nic create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n nic3 --subnet mysubnet --vnet-name myvnet" => 0. 

Command "network nic create -g cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey -n nic4 --subnet mysubnet --vnet-name myvnet" => 0. 

Command "az group delete --name cli_test_multi_nic_vmy2zpa7jynbwckncndvmpk3zvn7nkjrsonhnulis5khgpoj6nlgqdey --yes --no-wait" => 0. 

_________ VMSSExtensionInstallTest.test_vmss_extension_instance_name __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9480BC1F0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C946F70D00>
command = 'vmss create -n vmss1 -g cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password testPassword0 --instance-count 1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946F70D00>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C944FBAD30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946F70D00>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSExtensionInstallTest testMethod=test_vmss_extension_instance_name>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_extension_2')
    def test_vmss_extension_instance_name(self):
        username = 'myadmin'
        config_file = _write_config_file(username)
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'pub': 'Microsoft.Azure.NetworkWatcher',
            'ext_type': 'NetworkWatcherAgentLinux',
            'username': username,
            'config_file': config_file,
            'ext_name': 'MyNetworkWatcher'
        })
    
>       self.cmd('vmss create -n {vmss} -g {rg} --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password testPassword0 --instance-count 1')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1657: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav --tag product=azurecli cause=automation date=2020-12-18T14:50:58Z" => 0. 

Command "az group delete --name cli_test_vmss_extension_26keffuzdvd3dz4fvydqpcjh4pbbfujjykmh4wofifxgarflvav --yes --no-wait" => 0. 

_________ ServiceFabricManagedClustersTests.test_node_type_operation __________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238295905B0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381F7AC820>
command = 'sf managed-node-type create -g clitest.rg3d6idtgoaad3jebuvak7btn4x7c3czqgt2eayi3n42gwo6mdondn5bhrubucghvka -c sfrp-cli-svsjbaxpmnbnyow -n pnt --instance-count 5 --primary'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381F7AC820>
args = ['sf', 'managed-node-type', 'create', '-g', 'clitest.rg3d6idtgoaad3jebuvak7btn4x7c3czqgt2eayi3n42gwo6mdondn5bhrubucghvka', '-c', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238196559D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381F7AC820>
ex = CLIError("Deployment failed. Correlation ID: 1df0df11-fec3-456b-94db-c6a4039f965a. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError("Deployment failed. Correlation ID: 1df0df11-fec3-456b-94db-c6a4039f965a. Deployment failed with exception: T...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.servicefabric.tests.latest.test_sf_managed_cluster.ServiceFabricManagedClustersTests testMethod=test_node_type_operation>

    @ResourceGroupPreparer()
    def test_node_type_operation(self):
        self.kwargs.update({
            'cert_tp': '123BDACDCDFB2C7B250192C6078E47D1E1DB119B',
            'loc': 'eastasia',
            'cluster_name': self.create_random_name('sfrp-cli-', 24),
            'vm_password': self.create_random_name('Pass@', 9)
        })
    
        self.cmd('az sf managed-cluster create -g {rg} -c {cluster_name} -l {loc} --cert-thumbprint {cert_tp} --cert-is-admin --admin-password {vm_password} --sku Standard',
                 checks=[self.check('provisioningState', 'Succeeded'),
                         self.check('clusterState', 'WaitingForNodes')])
    
>       self.cmd('az sf managed-node-type create -g {rg} -c {cluster_name} -n pnt --instance-count 5 --primary',
                 checks=[self.check('provisioningState', 'Succeeded')])

src\azure-cli\azure\cli\command_modules\servicefabric\tests\latest\test_sf_managed_cluster.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\servicefabric\operations\managed_node_types.py:83: in create_node_type
    node_type = LongRunningOperation(cmd.cli_ctx)(poller)
src\azure-cli-core\azure\cli\core\commands\__init__.py:981: in __call__
    handle_long_running_operation_exception(client_exception)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subs...y another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.. ")

    def handle_long_running_operation_exception(ex):
        import azure.cli.core.telemetry as telemetry
    
        telemetry.set_exception(
            ex,
            fault_type='failed-long-running-operation',
            summary='Unexpected client exception in {}.'.format(LongRunningOperation.__name__))
    
        message = getattr(ex, 'message', ex)
        error_message = 'Deployment failed.'
    
        try:
            correlation_id = ex.response.headers['x-ms-correlation-request-id']
            error_message = '{} Correlation ID: {}.'.format(error_message, correlation_id)
        except:  # pylint: disable=bare-except
            pass
    
        try:
            inner_message = json.loads(ex.response.text)['error']['details'][0]['message']
            error_message = '{} {}'.format(error_message, inner_message)
        except:  # pylint: disable=bare-except
            error_message = '{} {}'.format(error_message, message)
    
        cli_error = CLIError(error_message)
        # capture response for downstream commands (webapp) to dig out more details
        setattr(cli_error, 'response', getattr(ex, 'response', None))
>       raise cli_error
E       knack.util.CLIError: Deployment failed. Correlation ID: 1df0df11-fec3-456b-94db-c6a4039f965a. Deployment failed with exception: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_411df7a5-54db-4b38-9424-40d1949f39d5/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/SFC_411df7a5-54db-4b38-9424-40d1949f39d5/providers/Microsoft.Compute/virtualMachineScaleSets/pnt' is currently not available in location 'eastasia' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'..

src\azure-cli-core\azure\cli\core\commands\arm.py:134: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rg3d6idtgoaad3jebuvak7btn4x7c3czqgt2eayi3n42gwo6mdondn5bhrubucghvka --tag product=azurecli cause=automation date=2020-12-18T14:47:24Z" => 0. 

Command group 'sf managed-cluster' is in preview. It may be changed/removed in a future release.
Command "az sf managed-cluster create -g clitest.rg3d6idtgoaad3jebuvak7btn4x7c3czqgt2eayi3n42gwo6mdondn5bhrubucghvka -c sfrp-cli-svsjbaxpmnbnyow -l eastasia --cert-thumbprint 123BDACDCDFB2C7B250192C6078E47D1E1DB119B --cert-is-admin --admin-password Pass@hy7s --sku Standard" => 0. 

Command group 'sf managed-node-type' is in preview. It may be changed/removed in a future release.
Command "az group delete --name clitest.rg3d6idtgoaad3jebuvak7btn4x7c3czqgt2eayi3n42gwo6mdondn5bhrubucghvka --yes --no-wait" => 0. 

_____ DiagnosticsExtensionInstallTest.test_diagnostics_extension_install ______
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C952592310>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94823C460>
command = 'vmss create -g cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda -n testdiagvmss --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94823C460>
args = ['vmss', 'create', '-g', 'cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda', '-n', 'testdiagvmss', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948184F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94823C460>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.DiagnosticsExtensionInstallTest testMethod=test_diagnostics_extension_install>
resource_group = 'cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda'
storage_account = 'clitestchetvh2qksecvpfis'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_vmss_diagnostics_extension')
    @StorageAccountPreparer()
    def test_diagnostics_extension_install(self, resource_group, storage_account):
    
        self.kwargs.update({
            'vm': 'testdiagvm',
            'vmss': 'testdiagvmss'
        })
    
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1680: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda/providers/Microsoft.Compute/virtualMachineScaleSets/testdiagvmss' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda/providers/Microsoft.Compute/virtualMachineScaleSets/testdiagvmss' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda --tag product=azurecli cause=automation date=2020-12-18T14:51:04Z" => 0. 

Command "az storage account create -n clitestchetvh2qksecvpfis -g cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestchetvh2qksecvpfis -g cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda --query "[0].value" -otsv" => 0. 

Command "az group delete --name cli_test_vm_vmss_diagnostics_extensionu2whpyfe4iuyvrrlsf6mowsvaaa46336jwhda --yes --no-wait" => 0. 

_________________ VMCreateExistingOptions.test_vm_create_auth _________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9481D64F0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94F221F40>
command = 'vm create --image Debian -l westus -g cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4 -n ...3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n" --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94F221F40>
args = ['vm', 'create', '--image', 'Debian', '-l', 'westus', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9481CECA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94F221F40>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateExistingOptions testMethod=test_vm_create_auth>
resource_group = 'cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_existing')
    def test_vm_create_auth(self, resource_group):
        self.kwargs.update({
            'vm_1': 'vm1',
            'vm_2': 'vm2',
            'ssh_key': TEST_SSH_KEY_PUB,
            'ssh_key_2': self.create_temp_file(0),
            'ssh_dest': '/home/myadmin/.ssh/authorized_keys'
        })
    
        with open(self.kwargs['ssh_key_2'], 'w') as f:
            f.write(TEST_SSH_KEY_PUB_2)
    
>       self.cmd('vm create --image Debian -l westus -g {rg} -n {vm_1} --authentication-type all '
                 ' --admin-username myadmin --admin-password testPassword0 --ssh-key-value "{ssh_key}" --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1794: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4 --tag product=azurecli cause=automation date=2020-12-18T14:51:32Z" => 0. 

Command "az group delete --name cli_test_vm_create_existingptm45lubokazy6ezkmp6g3na3dmr5qd3zefs24chvtdxesp4 --yes --no-wait" => 0. 

___________ VMCreateExistingOptions.test_vm_create_existing_options ___________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C946FA5AC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C93D627970>
command = "vm create --image UbuntuLTS --os-disk-name vrfosdisk --vnet-name vrfvnet --subnet vrfsubnet --availability-set vrfava...7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n'"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D627970>
args = ['vm', 'create', '--image', 'UbuntuLTS', '--os-disk-name', 'vrfosdisk', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93F6D9E50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C93D627970>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateExistingOptions testMethod=test_vm_create_existing_options>
resource_group = 'cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6'
storage_account = 'clitestqnnhrbe3yuewv2ai4'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_existing')
    @StorageAccountPreparer()
    def test_vm_create_existing_options(self, resource_group, storage_account):
    
        self.kwargs.update({
            'availset': 'vrfavailset',
            'pubip': 'vrfpubip',
            'vnet': 'vrfvnet',
            'subnet': 'vrfsubnet',
            'nsg': 'vrfnsg',
            'vm': 'vrfvm',
            'disk': 'vrfosdisk',
            'container': 'vrfcontainer',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.cmd('vm availability-set create --name {availset} -g {rg} --unmanaged --platform-fault-domain-count 3 --platform-update-domain-count 3')
        self.cmd('network public-ip create --name {pubip} -g {rg}')
        self.cmd('network vnet create --name {vnet} -g {rg} --subnet-name {subnet}')
        self.cmd('network nsg create --name {nsg} -g {rg}')
    
>       self.cmd('vm create --image UbuntuLTS --os-disk-name {disk} --vnet-name {vnet} --subnet {subnet} --availability-set {availset} --public-ip-address {pubip} -l "West US" --nsg {nsg} --use-unmanaged-disk --size Standard_DS2 --admin-username user11 --storage-account {sa} --storage-container-name {container} -g {rg} --name {vm} --ssh-key-value \'{ssh_key}\'')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1752: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6/providers/Microsoft.Compute/virtualMachines/vrfvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6/providers/Microsoft.Compute/virtualMachines/vrfvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 --tag product=azurecli cause=automation date=2020-12-18T14:51:40Z" => 0. 

Command "az storage account create -n clitestqnnhrbe3yuewv2ai4 -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestqnnhrbe3yuewv2ai4 -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 --query "[0].value" -otsv" => 0. 

Command "vm availability-set create --name vrfavailset -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 --unmanaged --platform-fault-domain-count 3 --platform-update-domain-count 3" => 0. 

Command "network public-ip create --name vrfpubip -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6" => 0. 

Command "network vnet create --name vrfvnet -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 --subnet-name vrfsubnet" => 0. 

Command "network nsg create --name vrfnsg -g cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6" => 0. 

Command "az group delete --name cli_test_vm_create_existinglduff3s5ev5rwmqu52dvsxoi47ixsupnx3qpv5bqe35nabm6 --yes --no-wait" => 0. 

__________ VMCreateExistingOptions.test_vm_create_provision_vm_agent __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94569A130>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C946090DC0>
command = 'vm create -g cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3 -n vm1 --image UbuntuLTS --e...dmin-username azureuser --admin-password qpwWfn1qwernv#xnklwezxcvslkdfj --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946090DC0>
args = ['vm', 'create', '-g', 'cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9483D7F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946090DC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateExistingOptions testMethod=test_vm_create_provision_vm_agent>
resource_group = 'cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_provision_vm_agent_')
    def test_vm_create_provision_vm_agent(self, resource_group):
        self.kwargs.update({
            'vm1': 'vm1',
            'vm2': 'vm2',
            'pswd': 'qpwWfn1qwernv#xnklwezxcvslkdfj'
        })
    
>       self.cmd('vm create -g {rg} -n {vm1} --image UbuntuLTS --enable-agent --admin-username azureuser --admin-password {pswd} --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1771: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3 --tag product=azurecli cause=automation date=2020-12-18T14:53:08Z" => 0. 

Command "az group delete --name cli_test_vm_create_provision_vm_agent_zjqcjosrjzbixoxvzcfps7nq2xjrkvuf6kjf3 --yes --no-wait" => 0. 

_______ VMCreateExistingIdsOptions.test_vm_create_existing_ids_options ________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C946662070>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9489AC790>
command = "vm create --image UbuntuLTS --os-disk-name vrfosdisk --subnet /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/res...7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n'"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9489AC790>
args = ['vm', 'create', '--image', 'UbuntuLTS', '--os-disk-name', 'vrfosdisk', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C94667FAF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9489AC790>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateExistingIdsOptions testMethod=test_vm_create_existing_ids_options>
resource_group = 'cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx'
storage_account = 'cliteste5pcrge4ovgr5luhb'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_existing_ids')
    @StorageAccountPreparer()
    def test_vm_create_existing_ids_options(self, resource_group, storage_account):
        from azure.cli.core.commands.client_factory import get_subscription_id
        from msrestazure.tools import resource_id, is_valid_resource_id
    
        subscription_id = self.get_subscription_id()
    
        self.kwargs.update({
            'availset': 'vrfavailset',
            'pubip': 'vrfpubip',
            'vnet': 'vrfvnet',
            'subnet': 'vrfsubnet',
            'nsg': 'vrfnsg',
            'vm': 'vrfvm',
            'disk': 'vrfosdisk',
            'container': 'vrfcontainer',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.cmd('vm availability-set create --name {availset} -g {rg} --unmanaged --platform-fault-domain-count 3 --platform-update-domain-count 3')
        self.cmd('network public-ip create --name {pubip} -g {rg}')
        self.cmd('network vnet create --name {vnet} -g {rg} --subnet-name {subnet}')
        self.cmd('network nsg create --name {nsg} -g {rg}')
    
        rg = self.kwargs['rg']
        self.kwargs.update({
            'availset_id': resource_id(subscription=subscription_id, resource_group=rg, namespace='Microsoft.Compute', type='availabilitySets', name=self.kwargs['availset']),
            'pubip_id': resource_id(subscription=subscription_id, resource_group=rg, namespace='Microsoft.Network', type='publicIpAddresses', name=self.kwargs['pubip']),
            'subnet_id': resource_id(subscription=subscription_id, resource_group=rg, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name=self.kwargs['vnet'], child_name_1=self.kwargs['subnet']),
            'nsg_id': resource_id(subscription=subscription_id, resource_group=rg, namespace='Microsoft.Network', type='networkSecurityGroups', name=self.kwargs['nsg'])
        })
    
        assert is_valid_resource_id(self.kwargs['availset_id'])
        assert is_valid_resource_id(self.kwargs['pubip_id'])
        assert is_valid_resource_id(self.kwargs['subnet_id'])
        assert is_valid_resource_id(self.kwargs['nsg_id'])
    
>       self.cmd('vm create --image UbuntuLTS --os-disk-name {disk} --subnet {subnet_id} --availability-set {availset_id} --public-ip-address {pubip_id} -l "West US" --nsg {nsg_id} --use-unmanaged-disk --size Standard_DS2 --admin-username user11 --storage-account {sa} --storage-container-name {container} -g {rg} --name {vm} --ssh-key-value \'{ssh_key}\'')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1854: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx/providers/Microsoft.Compute/virtualMachines/vrfvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx/providers/Microsoft.Compute/virtualMachines/vrfvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx --tag product=azurecli cause=automation date=2020-12-18T14:53:13Z" => 0. 

Command "az storage account create -n cliteste5pcrge4ovgr5luhb -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n cliteste5pcrge4ovgr5luhb -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx --query "[0].value" -otsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "vm availability-set create --name vrfavailset -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx --unmanaged --platform-fault-domain-count 3 --platform-update-domain-count 3" => 0. 

Command "network public-ip create --name vrfpubip -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx" => 0. 

Command "network vnet create --name vrfvnet -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx --subnet-name vrfsubnet" => 0. 

Command "network nsg create --name vrfnsg -g cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx" => 0. 

Command "az group delete --name cli_test_vm_create_existing_idstdap7gi6lrt2s27ajmhpcc5y27t2fptaecyhmpmntjmx --yes --no-wait" => 0. 

__________________ VMCreateCustomIP.test_vm_create_custom_ip __________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94967EEE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9496CDB20>
command = 'vm create -n vrfvmz -g cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc --image UbuntuLTS ...ss 10.0.0.5 --public-ip-sku Standard --public-ip-address-dns-name vrfmyvm00110011z --generate-ssh-keys --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9496CDB20>
args = ['vm', 'create', '-n', 'vrfvmz', '-g', 'cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9496CF700>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9496CDB20>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateCustomIP testMethod=test_vm_create_custom_ip>
resource_group = 'cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_custom_ip')
    def test_vm_create_custom_ip(self, resource_group):
    
        self.kwargs.update({
            'vm': 'vrfvmz',
            'vm2': 'vrfvmz2',
            'dns': 'vrfmyvm00110011z',
            'public_ip_sku': 'Standard'
        })
    
>       self.cmd('vm create -n {vm} -g {rg} --image UbuntuLTS --admin-username user11 --private-ip-address 10.0.0.5 --public-ip-sku {public_ip_sku} --public-ip-address-dns-name {dns} --generate-ssh-keys --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1878: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc/providers/Microsoft.Compute/virtualMachines/vrfvmz' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc/providers/Microsoft.Compute/virtualMachines/vrfvmz' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc --tag product=azurecli cause=automation date=2020-12-18T14:54:40Z" => 0. 

Command "az group delete --name cli_test_vm_custom_ipdhuf43vrkbunw7gh3idoq6yivpvjvinad6dwedfrutq3ngzmt4zthc --yes --no-wait" => 0. 

______________ VMDiskAttachDetachTest.test_vm_disk_attach_detach ______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C946ED0AF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C946675190>
command = 'vm create -g cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at --location westus -n vm-disk...--admin-username admin123 --image centos --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946675190>
args = ['vm', 'create', '-g', 'cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at', '--location', 'westus', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948EDFB80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C946675190>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMDiskAttachDetachTest testMethod=test_vm_disk_attach_detach>
resource_group = 'cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at'

    @ResourceGroupPreparer(name_prefix='cli-test-disk')
    def test_vm_disk_attach_detach(self, resource_group):
    
        self.kwargs.update({
            'loc': 'westus',
            'vm': 'vm-diskattach-test',
            'disk1': 'd1',
            'disk2': 'd2'
        })
    
>       self.cmd('vm create -g {rg} --location {loc} -n {vm} --admin-username admin123 --image centos --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1908: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at/providers/Microsoft.Compute/virtualMachines/vm-diskattach-test' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at/providers/Microsoft.Compute/virtualMachines/vm-diskattach-test' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at --tag product=azurecli cause=automation date=2020-12-18T14:54:49Z" => 0. 

Command "az group delete --name cli-test-diskij4rproaq7tmwgkge2qa7kjdgc7dg242cjb4my6nu6iqla3vbjmvl3gnhnm2at --yes --no-wait" => 0. 

_________________ VMBootDiagnostics.test_vm_boot_diagnostics __________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C20669310>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C20372EE0>
command = 'vm create -n myvm -g cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C20372EE0>
args = ['vm', 'create', '-n', 'myvm', '-g', 'cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C2057A9D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C20372EE0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMBootDiagnostics testMethod=test_vm_boot_diagnostics>
resource_group = 'cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz'
storage_account = 'clitestbootdiag34v5zyzpi'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_diagnostics')
    @StorageAccountPreparer(name_prefix='clitestbootdiag')
    @AllowLargeResponse()
    def test_vm_boot_diagnostics(self, resource_group, storage_account):
    
        self.kwargs.update({
            'vm': 'myvm',
            'vm2': 'myvm2'
        })
        self.kwargs['storage_uri'] = 'https://{}.blob.core.windows.net/'.format(self.kwargs['sa'])
    
        self.cmd('storage account create -g {rg} -n {sa} --sku Standard_LRS -l westus')
>       self.cmd('vm create -n {vm} -g {rg} --image UbuntuLTS --authentication-type password --admin-username user11 --admin-password testPassword0 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1559: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz/providers/Microsoft.Compute/virtualMachines/myvm' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz/providers/Microsoft.Compute/virtualMachines/myvm' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz --tag product=azurecli cause=automation date=2020-12-18T14:59:47Z" => 0. 

Command "az storage account create -n clitestbootdiag34v5zyzpi -g cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestbootdiag34v5zyzpi -g cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz --query "[0].value" -otsv" => 0. 

Command "storage account create -g cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz -n clitestbootdiag34v5zyzpi --sku Standard_LRS -l westus" => 0. 

Command "az group delete --name cli_test_vm_diagnosticslxytfdzgfqr25rpkq73bpsztb75voym7w6wvhnpdp3ka2uft3nzz --yes --no-wait" => 0. 

________________ VMSSExtensionInstallTest.test_vmss_extension _________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7D7F5DF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C01556DC0>
command = 'vmss create -n vmss1 -g cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password testPassword0 --instance-count 1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01556DC0>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C02DF9280>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01556DC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSExtensionInstallTest testMethod=test_vmss_extension>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_extension')
    def test_vmss_extension(self):
    
        username = 'myadmin'
        config_file = _write_config_file(username)
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'net-pub': 'Microsoft.Azure.NetworkWatcher', 'script-pub': 'Microsoft.Azure.Extensions', 'access-pub': 'Microsoft.OSTCExtensions',
            'net-ext': 'NetworkWatcherAgentLinux', 'script-ext': 'customScript', 'access-ext': 'VMAccessForLinux',
            'username': username,
            'config_file': config_file
        })
    
>       self.cmd('vmss create -n {vmss} -g {rg} --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password testPassword0 --instance-count 1')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:1607: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb --tag product=azurecli cause=automation date=2020-12-18T15:00:18Z" => 0. 

Command "az group delete --name cli_test_vmss_extension7pchge3s5yryb43tmzz2myijpkb5tfrut2w6peeo4vy3kgdxeixb --yes --no-wait" => 0. 

________________ VMSSCreateAndModify.test_vmss_scale_in_policy ________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C02801EE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C200D9760>
command = 'vmss create -g cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2 -n vmss1 --image centos --scale-in-policy NewestVM --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C200D9760>
args = ['vmss', 'create', '-g', 'cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7D774F70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C200D9760>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateAndModify testMethod=test_vmss_scale_in_policy>
resource_group = 'cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_scale_in_policy_')
    def test_vmss_scale_in_policy(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd('vmss create -g {rg} -n {vmss} --image centos --scale-in-policy NewestVM --admin-username azureuser', checks=[
            self.check('vmss.scaleInPolicy.rules[0]', 'NewestVM')
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2209: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2 --tag product=azurecli cause=automation date=2020-12-18T15:01:07Z" => 0. 

Command "az group delete --name cli_test_vmss_scale_in_policy_ga7d3busaerd2q744g7opajq4ognsm2piboe5t4ggrld2 --yes --no-wait" => 0. 

___________________ VMSSCreateOptions.test_vmss_create_auth ___________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C023AA160>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C028BB880>
command = "vmss create --image Debian -l westus -g cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa -...7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n'"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C028BB880>
args = ['vmss', 'create', '--image', 'Debian', '-l', 'westus', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C76B4AEE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C028BB880>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateOptions testMethod=test_vmss_create_auth>
resource_group = 'cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_options')
    def test_vmss_create_auth(self, resource_group):
        self.kwargs.update({
            'vmss_1': 'vmss1',
            'vmss_2': 'vmss2',
            'ssh_key': TEST_SSH_KEY_PUB,
            'ssh_key_2': self.create_temp_file(0),
            'ssh_dest': '/home/myadmin/.ssh/authorized_keys'
        })
    
        with open(self.kwargs['ssh_key_2'], 'w') as f:
            f.write(TEST_SSH_KEY_PUB_2)
    
>       self.cmd('vmss create --image Debian -l westus -g {rg} -n {vmss_1} --authentication-type all '
                 ' --admin-username myadmin --admin-password testPassword0 --ssh-key-value \'{ssh_key}\'',
                 checks=[
                     self.check('vmss.virtualMachineProfile.osProfile.linuxConfiguration.disablePasswordAuthentication', False),
                     self.check('vmss.virtualMachineProfile.osProfile.linuxConfiguration.ssh.publicKeys[0].keyData', TEST_SSH_KEY_PUB)
                 ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2337: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa --tag product=azurecli cause=automation date=2020-12-18T15:01:13Z" => 0. 

Command "az group delete --name cli_test_vmss_create_optionstctcsp2hira3wr2dfyahddrefygfznevwnvo7ro4juozlwa --yes --no-wait" => 0. 

_ SqlServerMgmtScenarioTest.test_sql_server_public_network_access_update_mgmt _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238232D2550>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381BCB5A60>
command = 'sql server update -g clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki -n clitestservervmic4asb5n7ptm6qxx2knahxv672brkggbe5wzwdz3moa4stz --enable-public-network false'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BCB5A60>
args = ['sql', 'server', 'update', '-g', 'clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381C2725E0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BCB5A60>
ex = CloudError('Unable to set Deny Public Network Access to Yes since there is no private endpoint enabled to access the s...oft.com/azure/sql-database/sql-database-private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database).')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError('Unable to set Deny Public Network Access to Yes since there is no private endpoint enabled to access the s...oft.com/azure/sql-database/sql-database-private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database).')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sql.tests.latest.test_sql_commands.SqlServerMgmtScenarioTest testMethod=test_sql_server_public_network_access_update_mgmt>
resource_group = 'clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki'
resource_group_location = 'westeurope'

    @ResourceGroupPreparer(parameter_name='resource_group', location='westeurope')
    def test_sql_server_public_network_access_update_mgmt(self, resource_group, resource_group_location):
        server_name = self.create_random_name(server_name_prefix, server_name_max_length)
        admin_login = 'admin123'
        admin_passwords = ['SecretPassword123', 'SecretPassword456']
    
        # test create sql server with no enable-public-network passed in, verify publicNetworkAccess == Enabled
        self.cmd('sql server create -g {} --name {} --admin-user {} --admin-password {}'
                 .format(resource_group, server_name, admin_login, admin_passwords[0]),
                 checks=[
                     JMESPathCheck('name', server_name),
                     JMESPathCheck('location', resource_group_location),
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('administratorLogin', admin_login),
                     JMESPathCheck('publicNetworkAccess', 'Enabled')])
    
        # test update sql server with enable-public-network == false passed in, verify publicNetworkAccess == Disabled
>       self.cmd('sql server update -g {} -n {} --enable-public-network {}'
                 .format(resource_group, server_name, 'false'),
                 checks=[
                     JMESPathCheck('name', server_name),
                     JMESPathCheck('publicNetworkAccess', 'Disabled')])

src\azure-cli\azure\cli\command_modules\sql\tests\latest\test_sql_commands.py:230: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\commands\arm.py:579: in handler
    result = result.result()
env\lib\site-packages\msrest\polling\poller.py:183: in result
    self.wait(timeout)
env\lib\site-packages\msrest\polling\poller.py:201: in wait
    raise self._exception  # type: ignore
env\lib\site-packages\msrest\polling\poller.py:152: in _start
    self._polling_method.run()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <msrestazure.polling.arm_polling.ARMPolling object at 0x000002382327B6D0>

    def run(self):
        try:
            self._poll()
        except BadStatus:
            self._operation.status = 'Failed'
            raise CloudError(self._response)
    
        except BadResponse as err:
            self._operation.status = 'Failed'
            raise CloudError(self._response, str(err))
    
        except OperationFailed:
>           raise CloudError(self._response)
E           msrestazure.azure_exceptions.CloudError: Azure Error: PECsNotExistingToDenyPublicNetworkAccess
E           Message: Unable to set Deny Public Network Access to Yes since there is no private endpoint enabled to access the server. Please set up private endpoints and retry the operation (https://docs.microsoft.com/azure/sql-database/sql-database-private-endpoint-overview#how-to-set-up-private-link-for-azure-sql-database).

env\lib\site-packages\msrestazure\polling\arm_polling.py:400: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westeurope --name clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki --tag product=azurecli cause=automation date=2020-12-18T15:00:00Z" => 0. 

Command "sql server create -g clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki --name clitestservervmic4asb5n7ptm6qxx2knahxv672brkggbe5wzwdz3moa4stz --admin-user admin123 --admin-password SecretPassword123" => 0. 

Argument '--enable-public-network' is in preview. It may be changed/removed in a future release.
Command "az group delete --name clitest.rgeevxecfl2xjbeqicmla7hz7znjqwsiopqah4qsfsqvmmx37k6gjuqrelg2lagq7ki --yes --no-wait" => 0. 

____________ VMSSCreateOptions.test_vmss_create_ephemeral_os_disk _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C015D6280>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9822B0>
command = 'vmss create --resource-group cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k --name cli-t...ta-disk-sizes-gb 1 --storage-sku os=standard_lrs 0=premium_lrs --admin-username user_1 --admin-password testPassword09'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9822B0>
args = ['vmss', 'create', '--resource-group', 'cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k', '--name', 'cli-test-vmss-local-1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7C154AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C9822B0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateOptions testMethod=test_vmss_create_ephemeral_os_disk>
resource_group = 'cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_ephemeral_os_disk')
    def test_vmss_create_ephemeral_os_disk(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'cli-test-vmss-local-1',
            'vmss_2': 'cli-test-vmss-local-2',
            'image': 'UbuntuLTS',
            'count': 2,
            'caching': 'ReadOnly',
            'user': 'user_1',
            'password': 'testPassword09'
        })
    
        # check that we can create a vmss with local / ephemeral os disk.
>       self.cmd('vmss create --resource-group {rg} --name {vmss} --image {image} --ephemeral-os-disk --disable-overprovision '
                 '--instance-count {count} --data-disk-sizes-gb 1 --storage-sku os=standard_lrs 0=premium_lrs --admin-username {user} --admin-password {password}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2276: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k/providers/Microsoft.Compute/virtualMachineScaleSets/cli-test-vmss-local-1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k/providers/Microsoft.Compute/virtualMachineScaleSets/cli-test-vmss-local-1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k --tag product=azurecli cause=automation date=2020-12-18T15:01:18Z" => 0. 

Argument '--ephemeral-os-disk' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_vmss_create_ephemeral_os_diskscpaqg6wt56o34sefqu4bojz2jzaohue3w67k --yes --no-wait" => 0. 

_________________ VMSSCreateOptions.test_vmss_create_options __________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7EF50D30>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C208FB4F0>
command = 'vmss create --image Debian --admin-password testPassword0 -l westus -g cli_test_vmss_create_optionsb7nmi35ejwfmvfifhj...c-ip-address vrfpubip --os-disk-size-gb 40 --data-disk-sizes-gb 1 --vm-sku Standard_D2_v2 --computer-name-prefix vmss1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C208FB4F0>
args = ['vmss', 'create', '--image', 'Debian', '--admin-password', 'testPassword0', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C001D1EE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C208FB4F0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateOptions testMethod=test_vmss_create_options>
resource_group = 'cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_options')
    def test_vmss_create_options(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'vrfvmss',
            'count': 2,
            'caching': 'ReadWrite',
            'update': 'automatic',
            'ip': 'vrfpubip'
        })
    
        self.cmd('network public-ip create --name {ip} -g {rg}')
    
>       self.cmd('vmss create --image Debian --admin-password testPassword0 -l westus -g {rg} -n {vmss} --disable-overprovision --instance-count {count} --os-disk-caching {caching} --upgrade-policy-mode {update} --authentication-type password --admin-username myadmin --public-ip-address {ip} --os-disk-size-gb 40 --data-disk-sizes-gb 1 --vm-sku Standard_D2_v2 --computer-name-prefix vmss1')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2232: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg --tag product=azurecli cause=automation date=2020-12-18T15:01:24Z" => 0. 

Command "network public-ip create --name vrfpubip -g cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg" => 0. 

Command "az group delete --name cli_test_vmss_create_optionsb7nmi35ejwfmvfifhjtgyudzmkzfpx7kakvw7222moluscg --yes --no-wait" => 0. 

______________ VMSSCreateOptions.test_vmss_update_instance_disks ______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C1FE02C70>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C01FB93D0>
command = 'vmss create --image Debian --admin-username clitest1 --admin-password testPassword0 -l westus -g cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls -n vmss1  --storage-sku Standard_LRS'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01FB93D0>
args = ['vmss', 'create', '--image', 'Debian', '--admin-username', 'clitest1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7D0C6D30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01FB93D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateOptions testMethod=test_vmss_update_instance_disks>
resource_group = 'cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_options')
    def test_vmss_update_instance_disks(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'caching': 'ReadWrite',
            'update': 'automatic',
            'ip': 'vrfpubip',
            'disk': 'd1',
            'instance_id': '1',
            'sku': 'Standard_LRS'
        })
    
>       self.cmd('vmss create --image Debian --admin-username clitest1 --admin-password testPassword0 -l westus -g {rg} -n {vmss}  --storage-sku {sku}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2309: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls --tag product=azurecli cause=automation date=2020-12-18T15:01:36Z" => 0. 

Command "az group delete --name cli_test_vmss_create_options6regay5vxvyjx7ufx7xmvyluwh5p6hkjkuymzqy2nvyqnls --yes --no-wait" => 0. 

_____ VMSSCreateBalancerOptionsTest.test_vmss_create_default_app_gateway ______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C200F3730>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C084D0DF0>
command = 'vmss create -g clitest.rgjxegxytceqngxffvdabrcumeithsuljuxd57ul6rbjws4hsprka7k7ibpaka5srsy --name vmss1 --validate --...provision --instance-count 101 --single-placement-group false --admin-username ubuntuadmin --generate-ssh-keys --lb ""'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C084D0DF0>
args = ['vmss', 'create', '-g', 'clitest.rgjxegxytceqngxffvdabrcumeithsuljuxd57ul6rbjws4hsprka7k7ibpaka5srsy', '--name', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C2057ACA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C084D0DF0>
ex = CLIError(CloudError("The template deployment 'vmss_deploy_z99d2UQQ1SBooqnCHyto9hkMMUGE3zGS' is not valid according to the validation procedure. The tracking id is '21f49fe4-e318-47bf-8ce9-5f0ef4b18f70'. See inner errors for details."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment 'vmss_deploy_z99d2UQQ1SBooqnCHyto9hkMMUGE3zGS' is not valid according to the validation procedure. The tracking id is '21f49fe4-e318-47bf-8ce9-5f0ef4b18f70'. See inner errors for details."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateBalancerOptionsTest testMethod=test_vmss_create_default_app_gateway>
resource_group = 'clitest.rgjxegxytceqngxffvdabrcumeithsuljuxd57ul6rbjws4hsprka7k7ibpaka5srsy'

    @ResourceGroupPreparer(location='eastus2')
    def test_vmss_create_default_app_gateway(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
    
>       res = self.cmd('vmss create -g {rg} --name {vmss} --validate --image UbuntuLTS --disable-overprovision --instance-count 101 --single-placement-group false '
                       '--admin-username ubuntuadmin --generate-ssh-keys --lb ""').get_output_in_json()

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2395: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment 'vmss_deploy_z99d2UQQ1SBooqnCHyto9hkMMUGE3zGS' is not valid according to the validation procedure. The tracking id is '21f49fe4-e318-47bf-8ce9-5f0ef4b18f70'. See inner errors for details.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment 'vmss_deploy_z99d2UQQ1SBooqnCHyto9hkMMUGE3zGS' is not valid according to the validation procedure. The tracking id is '21f49fe4-e318-47bf-8ce9-5f0ef4b18f70'. See inner errors for details.
E           Exception Details:
E           	Error Code: QuotaExceeded
E           	Message: Operation could not be completed as it results in exceeding approved Total Regional Cores quota. Additional details - Deployment Model: Resource Manager, Location: eastus2, Current Limit: 100, Current Usage: 0, Additional Required: 101, (Minimum) New Limit Required: 101. Submit a request for Quota increase at https://aka.ms/ProdportalCRP/?#create/Microsoft.Support/Parameters/%7B%22subId%22:%22a1bfa635-f2bf-42f1-86b5-848c674fc321%22,%22pesId%22:%2206bfd9d3-516b-d5c6-5802-169c800dec89%22,%22supportTopicId%22:%22e12e3d1d-7fa0-af33-c6d0-3c50df9658a3%22%7D by specifying parameters listed in the Details section for deployment to succeed. Please read more about quota limits at https://docs.microsoft.com/en-us/azure/azure-supportability/regional-quota-requests.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name clitest.rgjxegxytceqngxffvdabrcumeithsuljuxd57ul6rbjws4hsprka7k7ibpaka5srsy --tag product=azurecli cause=automation date=2020-12-18T15:01:41Z" => 0. 

Command "az group delete --name clitest.rgjxegxytceqngxffvdabrcumeithsuljuxd57ul6rbjws4hsprka7k7ibpaka5srsy --yes --no-wait" => 0. 

_________ VMSSCreateBalancerOptionsTest.test_vmss_create_none_options _________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7D4D7FA0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1F5F2D90>
command = 'vmss create -n vmss1 -g cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k --image Debian --...VyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n\' --public-ip-address "" --tags "" --vm-sku Basic_A1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1F5F2D90>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C0D3859D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1F5F2D90>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateBalancerOptionsTest testMethod=test_vmss_create_none_options>
resource_group = 'cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_none')
    def test_vmss_create_none_options(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'ssh_key': TEST_SSH_KEY_PUB,
            'quotes': '""' if platform.system() == 'Windows' else "''"
        })
>       self.cmd('vmss create -n {vmss} -g {rg} --image Debian --load-balancer {quotes} --admin-username ubuntu --ssh-key-value \'{ssh_key}\' --public-ip-address {quotes} --tags {quotes} --vm-sku Basic_A1')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2364: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k --tag product=azurecli cause=automation date=2020-12-18T15:01:46Z" => 0. 

Command "az group delete --name cli_test_vmss_create_noneitbcmb2j2nvxlcp4d6yqie6lgbyom2mftf3mtaxi2eypaujm6k --yes --no-wait" => 0. 

_______ VMSSCreateBalancerOptionsTest.test_vmss_create_with_app_gateway _______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C174DCDF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C0229DA60>
command = "vmss create -n vmss1 -g cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt --image Debian --...e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n' --app-gateway apt1 --instance-count 5"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C0229DA60>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C200FDAF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C0229DA60>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateBalancerOptionsTest testMethod=test_vmss_create_with_app_gateway>
resource_group = 'cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_w_ag')
    def test_vmss_create_with_app_gateway(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'ssh_key': TEST_SSH_KEY_PUB
        })
>       self.cmd("vmss create -n {vmss} -g {rg} --image Debian --admin-username clittester --ssh-key-value '{ssh_key}' --app-gateway apt1 --instance-count 5",
                 checks=self.check('vmss.provisioningState', 'Succeeded'))

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2381: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt --tag product=azurecli cause=automation date=2020-12-18T15:01:52Z" => 0. 

Command "az group delete --name cli_test_vmss_create_w_agk723hwuigfdziegxr2rzbz7eg7dqg2kvmlaocu2kfzskhwedgt --yes --no-wait" => 0. 

_____________ VMSSCreateBalancerOptionsTest.test_vmss_existing_lb _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C1F8C6DF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1FDD0A30>
command = 'vmss create -g cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp -n vmss1 --load-balancer lb1 --image UbuntuLTS --admin-username clitester --admin-password TestTest12#$'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1FDD0A30>
args = ['vmss', 'create', '-g', 'cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7D4D83A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1FDD0A30>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateBalancerOptionsTest testMethod=test_vmss_existing_lb>
resource_group = 'cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_existing_lb')
    def test_vmss_existing_lb(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'lb': 'lb1'
        })
        self.cmd('network lb create -g {rg} -n {lb} --backend-pool-name test')
>       self.cmd('vmss create -g {rg} -n {vmss} --load-balancer {lb} --image UbuntuLTS --admin-username clitester --admin-password TestTest12#$')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2407: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp --tag product=azurecli cause=automation date=2020-12-18T15:02:02Z" => 0. 

Command "network lb create -g cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp -n lb1 --backend-pool-name test" => 0. 

No inbound nat pool was configured on 'lb1'
Command "az group delete --name cli_test_vmss_create_existing_lbl7hr6cu6nhrsqsqch7xyu4kjh56bc6kvmqgyhjm2byp --yes --no-wait" => 0. 

____ VMSSCreatePublicIpPerVm.test_vmss_public_ip_per_vm_custom_domain_name ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7E5E80D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7EC873A0>
command = "vmss create -n vmss1 -g cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5 --image Debian --...@example.com\n' --vm-domain-name clivmssj4d3a6tjqiuya --public-ip-per-vm --dns-servers 10.0.0.6 10.0.0.5 --nsg testnsg"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7EC873A0>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7D4EB1F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7EC873A0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreatePublicIpPerVm testMethod=test_vmss_public_ip_per_vm_custom_domain_name>
resource_group = 'cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_w_ips')
    def test_vmss_public_ip_per_vm_custom_domain_name(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'nsg': 'testnsg',
            'ssh_key': TEST_SSH_KEY_PUB,
            'dns_label': self.create_random_name('clivmss', 20)
        })
        nsg_result = self.cmd('network nsg create -g {rg} -n {nsg}').get_output_in_json()
>       self.cmd("vmss create -n {vmss} -g {rg} --image Debian --admin-username clittester --ssh-key-value '{ssh_key}' --vm-domain-name {dns_label} --public-ip-per-vm --dns-servers 10.0.0.6 10.0.0.5 --nsg {nsg}",
                 checks=self.check('vmss.provisioningState', 'Succeeded'))

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2440: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5 --tag product=azurecli cause=automation date=2020-12-18T15:02:43Z" => 0. 

Command "network nsg create -g cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5 -n testnsg" => 0. 

Command "az group delete --name cli_test_vmss_create_w_ipsdlb6skox4b7z2yfljxzlm44uchjomvzifrwe6vedyakasl6s5 --yes --no-wait" => 0. 

______________________ VMSSUpdateTests.test_vmss_update _______________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7C639940>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C7E382310>
command = 'vmss create -g cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe -n winvmss --image Win2012...tacenter --admin-username clitest1234 --admin-password Test123456789# --license-type Windows_Server --instance-count 1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E382310>
args = ['vmss', 'create', '-g', 'cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe', '-n', 'winvmss', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7CE6F430>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C7E382310>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSUpdateTests testMethod=test_vmss_update>
resource_group = 'cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_update_')
    def test_vmss_update(self, resource_group):
        self.kwargs.update({
            'vmss': 'winvmss'
        })
    
>       self.cmd('vmss create -g {rg} -n {vmss} --image Win2012R2Datacenter --admin-username clitest1234 --admin-password Test123456789# --license-type Windows_Server --instance-count 1')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2462: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe/providers/Microsoft.Compute/virtualMachineScaleSets/winvmss' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe/providers/Microsoft.Compute/virtualMachineScaleSets/winvmss' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe --tag product=azurecli cause=automation date=2020-12-18T15:02:56Z" => 0. 

Command "az group delete --name cli_test_vmss_update_s6laafn2vgvh53y4hzng4kmgwhvwv6ebhheh5bwvphsrczwy5ddpbe --yes --no-wait" => 0. 

___________________ VMSSUpdateTests.test_vmss_update_image ____________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C033A7F40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1FB52BB0>
command = 'vm create -g cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz -n vm1 --image centos --admin-username clitest1 --generate-ssh-key --nsg-rule None'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1FB52BB0>
args = ['vm', 'create', '-g', 'cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C76B57E50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1FB52BB0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSUpdateTests testMethod=test_vmss_update_image>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_update_image_')
    def test_vmss_update_image(self):
        self.kwargs.update({
            'vm': 'vm1',
            'img': 'img1',
            'vmss': 'vmss1'
        })
>       self.cmd('vm create -g {rg} -n {vm} --image centos --admin-username clitest1 --generate-ssh-key --nsg-rule None')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2502: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz --tag product=azurecli cause=automation date=2020-12-18T15:03:02Z" => 0. 

Command "az group delete --name cli_test_vmss_update_image_gxeur5ue4ulx24zl235nrxucj65su3vcnzd6agoqxh4gzmuz --yes --no-wait" => 0. 

__________ AcceleratedNetworkingTest.test_vm_accelerated_networking ___________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C1FEE1610>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C01AF41F0>
command = 'vm create -n vm1 -g clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2 --size Standard_DS4_v2 --image ubuntults --admin-username clittester --generate-ssh-keys --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01AF41F0>
args = ['vm', 'create', '-n', 'vm1', '-g', 'clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C033BDB80>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C01AF41F0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.AcceleratedNetworkingTest testMethod=test_vm_accelerated_networking>
resource_group = 'clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2'

    @ResourceGroupPreparer()
    def test_vm_accelerated_networking(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1'
        })
        # Note: CLI turns sets accelerated_networking to true based on vm size and os image.
        # See _validate_vm_vmss_accelerated_networking for more info.
>       self.cmd("vm create -n {vm} -g {rg} --size Standard_DS4_v2 --image ubuntults --admin-username clittester --generate-ssh-keys --nsg-rule NONE")

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2608: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2 --tag product=azurecli cause=automation date=2020-12-18T15:03:07Z" => 0. 

Command "az group delete --name clitest.rgrtpfk2pb3y2ecvbjtkmrzeyxkuszro33qmcn7mru2adynoih2zkmfii5z5uhtu5x2 --yes --no-wait" => 0. 

_________ AcceleratedNetworkingTest.test_vmss_accelerated_networking __________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C1FB9C6D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C209DCC10>
command = 'vmss create -n vmss1 -g cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo --vm-sku Standard...016Datacenter --admin-username clittester --admin-password Test12345678!!! --accelerated-networking --instance-count 1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C209DCC10>
args = ['vmss', 'create', '-n', 'vmss1', '-g', 'cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C03922D30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C209DCC10>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.AcceleratedNetworkingTest testMethod=test_vmss_accelerated_networking>
resource_group = 'cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_accelerated_networking')
    def test_vmss_accelerated_networking(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'vmss1'
        })
>       self.cmd("vmss create -n {vmss} -g {rg} --vm-sku Standard_DS4_v2 --image Win2016Datacenter --admin-username clittester --admin-password Test12345678!!! --accelerated-networking --instance-count 1")

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2597: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo --tag product=azurecli cause=automation date=2020-12-18T15:03:13Z" => 0. 

Command "az group delete --name cli_test_vmss_accelerated_networkingbdjhb673ltfcx2su5r74s3boh3gv4m6w3hkvmfo --yes --no-wait" => 0. 

___________________ ApplicationSecurityGroup.test_vmss_asg ____________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C20962B80>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1F27C640>
command = 'vmss create -g cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq -n vmss1 --image debian --instance-count 1 --asgs asg1 --admin-username clittester --generate-ssh-keys'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1F27C640>
args = ['vmss', 'create', '-g', 'cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C2064CAF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1F27C640>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.ApplicationSecurityGroup testMethod=test_vmss_asg>
resource_group = 'cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq'

    @ResourceGroupPreparer(name_prefix='cli_test_asg')
    def test_vmss_asg(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'vm': 'vm1',
            'asg': 'asg1'
        })
        asg_id = self.cmd('network asg create -g {rg} -n {asg}').get_output_in_json()['id']
>       self.cmd('vmss create -g {rg} -n {vmss} --image debian --instance-count 1 --asgs {asg} --admin-username clittester --generate-ssh-keys').get_output_in_json()

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq --tag product=azurecli cause=automation date=2020-12-18T15:03:19Z" => 0. 

Command "network asg create -g cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq -n asg1" => 0. 

Command "az group delete --name cli_test_asgmjy3mjonc7jujz6smuz2nl5pcds5z4cjkb47nzmw6gm5u2wsshyt2uwmhgzpvhq --yes --no-wait" => 0. 

______________ SecretsScenarioTest.test_vm_create_linux_secrets _______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7E3A1370>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C0227E5E0>
command = 'vm create -g cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe -n vm-name --admin-username ...": "https://vmlinuxkv7rh5xnibp3p.vault.azure.net/secrets/cert1/51fdd0731faa4fce8763ef7d3af0e088"}]}]\' --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C0227E5E0>
args = ['vm', 'create', '-g', 'cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe', '-n', 'vm-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C1F84CD30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C0227E5E0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.SecretsScenarioTest testMethod=test_vm_create_linux_secrets>
resource_group = 'cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_secrets')
    def test_vm_create_linux_secrets(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'admin': 'ubuntu',
            'loc': 'westus',
            'image': 'UbuntuLTS',
            'auth': 'ssh',
            'ssh_key': TEST_SSH_KEY_PUB,
            'vm': 'vm-name',
            'secrets': json.dumps([{'sourceVault': {'id': 'id'}, 'vaultCertificates': []}]),
            'vault': self.create_random_name('vmlinuxkv', 20)
        })
    
        message = 'Secret is missing vaultCertificates array or it is empty at index 0'
        with self.assertRaisesRegexp(CLIError, message):
            self.cmd('vm create -g {rg} -n {vm} --admin-username {admin} --authentication-type {auth} --image {image} --ssh-key-value \'{ssh_key}\' -l {loc} --secrets \'{secrets}\' --nsg-rule NONE')
    
        vault_out = self.cmd('keyvault create -g {rg} -n {vault} -l {loc} --enabled-for-deployment true --enabled-for-template-deployment true').get_output_in_json()
    
        time.sleep(60)
    
        self.kwargs['policy_path'] = os.path.join(TEST_DIR, 'keyvault', 'policy.json')
        self.cmd('keyvault certificate create --vault-name {vault} -n cert1 -p @"{policy_path}"')
        self.kwargs['secret_out'] = self.cmd('keyvault secret list-versions --vault-name {vault} -n cert1 --query "[?attributes.enabled].id" -o tsv').output.strip()
        vm_format = self.cmd('vm secret format -s {secret_out}').get_output_in_json()
        self.kwargs['secrets'] = json.dumps(vm_format)
    
>       self.cmd('vm create -g {rg} -n {vm} --admin-username {admin} --authentication-type {auth} --image {image} --ssh-key-value \'{ssh_key}\' -l {loc} --secrets \'{secrets}\' --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2658: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe/providers/Microsoft.Compute/virtualMachines/vm-name' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe/providers/Microsoft.Compute/virtualMachines/vm-name' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe --tag product=azurecli cause=automation date=2020-12-18T15:03:39Z" => 0. 

Command "keyvault create -g cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe -n vmlinuxkv7rh5xnibp3p -l westus --enabled-for-deployment true --enabled-for-template-deployment true" => 0. 

Command "keyvault certificate create --vault-name vmlinuxkv7rh5xnibp3p -n cert1 -p @"c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\vm\tests\latest\keyvault\policy.json"" => 0. 

Command "keyvault secret list-versions --vault-name vmlinuxkv7rh5xnibp3p -n cert1 --query "[?attributes.enabled].id" -o tsv" => 0. 

Command "vm secret format -s https://vmlinuxkv7rh5xnibp3p.vault.azure.net/secrets/cert1/51fdd0731faa4fce8763ef7d3af0e088" => 0. 

Command "az group delete --name cli_test_vm_secretscjhbczvrp3trxsak4fh6gw24n7eq6yviyhci3cghk2ufs5tz3qmd2kwe --yes --no-wait" => 0. 

__________ SqlServerDbSecurityScenarioTest.test_sql_db_security_mgmt __________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x00000238203B5910>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382A4053A0>
command = 'monitor log-analytics workspace create -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -n clilaworkspacedb24'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A4053A0>
args = ['monitor', 'log-analytics', 'workspace', 'create', '-g', 'clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382932F1F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A4053A0>
ex = CloudError("The workspace name 'clilaworkspacedb24' is not unique")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The workspace name 'clilaworkspacedb24' is not unique")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sql.tests.latest.test_sql_commands.SqlServerDbSecurityScenarioTest testMethod=test_sql_db_security_mgmt>
resource_group = 'clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit'
resource_group_2 = 'clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r'
resource_group_location = 'westus'
server = 'clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz'
storage_account = 'clitestsurkfaa6wv542dtw7'
storage_account_2 = 'clitest2bxbiyuilqrcj4ksf'

    @ResourceGroupPreparer(location='westeurope')
    @ResourceGroupPreparer(parameter_name='resource_group_2')
    @SqlServerPreparer(location='westeurope')
    @StorageAccountPreparer(location='westus')
    @StorageAccountPreparer(parameter_name='storage_account_2',
                            resource_group_parameter_name='resource_group_2')
    def test_sql_db_security_mgmt(self, resource_group, resource_group_2,
                                  resource_group_location, server,
                                  storage_account, storage_account_2):
        database_name = "cliautomationdb01"
        state_enabled = 'Enabled'
        state_disabled = 'Disabled'
    
        # get storage account endpoint and key
        storage_endpoint = self._get_storage_endpoint(storage_account, resource_group)
        key = self._get_storage_key(storage_account, resource_group)
    
        # create db
        self.cmd('sql db create -g {} -s {} -n {}'
                 .format(resource_group, server, database_name),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('name', database_name),
                     JMESPathCheck('status', 'Online')])
    
        # get audit policy
        self.cmd('sql db audit-policy show -g {} -s {} -n {}'
                 .format(resource_group, server, database_name),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('blobStorageTargetState', state_disabled),
                     JMESPathCheck('logAnalyticsTargetState', state_disabled),
                     JMESPathCheck('eventHubTargetState', state_disabled),
                     JMESPathCheck('isAzureMonitorTargetEnabled', False)])
    
        # update audit policy - enable
        retention_days = 30
        audit_actions_input = 'DATABASE_LOGOUT_GROUP DATABASE_ROLE_MEMBER_CHANGE_GROUP'
        audit_actions_expected = ['DATABASE_LOGOUT_GROUP',
                                  'DATABASE_ROLE_MEMBER_CHANGE_GROUP']
    
        self.cmd('sql db audit-policy update -g {} -s {} -n {}'
                 ' --state {} --blob-storage-target-state {} --storage-key {} --storage-endpoint={}'
                 ' --retention-days={} --actions {}'
                 .format(resource_group, server, database_name, state_enabled, state_enabled, key,
                         storage_endpoint, retention_days, audit_actions_input),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageEndpoint', storage_endpoint),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # get audit policy
        self.cmd('sql db audit-policy show -g {} -s {} -n {}'
                 .format(resource_group, server, database_name),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('blobStorageTargetState', state_enabled),
                     JMESPathCheck('logAnalyticsTargetState', state_disabled),
                     JMESPathCheck('eventHubTargetState', state_disabled),
                     JMESPathCheck('isAzureMonitorTargetEnabled', False)])
    
        # update audit policy - specify storage account and resource group. use secondary key
        storage_endpoint_2 = self._get_storage_endpoint(storage_account_2, resource_group_2)
        self.cmd('sql db audit-policy update -g {} -s {} -n {} --blob-storage-target-state {} --storage-account {}'
                 .format(resource_group, server, database_name, state_enabled, storage_account_2),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageEndpoint', storage_endpoint_2),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # update audit policy - disable
        self.cmd('sql db audit-policy update -g {} -s {} -n {} --state {}'
                 .format(resource_group, server, database_name, state_disabled),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_disabled),
                     JMESPathCheck('storageEndpoint', storage_endpoint_2),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # get threat detection policy
        self.cmd('sql db threat-policy show -g {} -s {} -n {}'
                 .format(resource_group, server, database_name),
                 checks=[JMESPathCheck('resourceGroup', resource_group)])
    
        # update threat detection policy - enable
        disabled_alerts_input = 'Sql_Injection_Vulnerability Access_Anomaly'
        disabled_alerts_expected = 'Sql_Injection_Vulnerability;Access_Anomaly'
        email_addresses_input = 'test1@example.com test2@example.com'
        email_addresses_expected = 'test1@example.com;test2@example.com'
        email_account_admins = 'Enabled'
    
        self.cmd('sql db threat-policy update -g {} -s {} -n {}'
                 ' --state {} --storage-key {} --storage-endpoint {}'
                 ' --retention-days {} --email-addresses {} --disabled-alerts {}'
                 ' --email-account-admins {}'
                 .format(resource_group, server, database_name, state_enabled, key,
                         storage_endpoint, retention_days, email_addresses_input,
                         disabled_alerts_input, email_account_admins),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageAccountAccessKey', key),
                     JMESPathCheck('storageEndpoint', storage_endpoint),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('emailAddresses', email_addresses_expected),
                     JMESPathCheck('disabledAlerts', disabled_alerts_expected),
                     JMESPathCheck('emailAccountAdmins', email_account_admins)])
    
        # update threat policy - specify storage account and resource group. use secondary key
        key_2 = self._get_storage_key(storage_account_2, resource_group_2)
        self.cmd('sql db threat-policy update -g {} -s {} -n {} --storage-account {}'
                 .format(resource_group, server, database_name, storage_account_2),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageAccountAccessKey', key_2),
                     JMESPathCheck('storageEndpoint', storage_endpoint_2),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('emailAddresses', email_addresses_expected),
                     JMESPathCheck('disabledAlerts', disabled_alerts_expected),
                     JMESPathCheck('emailAccountAdmins', email_account_admins)])
    
        # create log analytics workspace
        log_analytics_workspace_name = "clilaworkspacedb24"
    
>       log_analytics_workspace_id = self.cmd('monitor log-analytics workspace create -g {} -n {}'
                                              .format(resource_group, log_analytics_workspace_name),
                                              checks=[
                                                  JMESPathCheck('resourceGroup', resource_group),
                                                  JMESPathCheck('name', log_analytics_workspace_name),
                                                  JMESPathCheck('provisioningState', 'Succeeded')]).get_output_in_json()['id']

src\azure-cli\azure\cli\command_modules\sql\tests\latest\test_sql_commands.py:1462: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
src\azure-cli\azure\cli\command_modules\monitor\_exception_handler.py:19: in exception_handler
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\monitor\operations\log_analytics_workspace.py:32: in create_log_analytics_workspace
    return sdk_no_wait(no_wait, workspace_client.create_or_update, resource_group_name,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
env\lib\site-packages\azure\mgmt\loganalytics\operations\_workspaces_operations.py:257: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.loganalytics.operations._workspaces_operations.WorkspacesOperations object at 0x000002381E8021C0>
resource_group_name = 'clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit'
workspace_name = 'clilaworkspacedb24'
parameters = <azure.mgmt.loganalytics.models._models_py3.Workspace object at 0x000002381E802E80>
custom_headers = None, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/clitest.rgviih2xx6j7ym...f4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit/providers/Microsoft.OperationalInsights/workspaces/clilaworkspacedb24'
path_format_arguments = {'resourceGroupName': 'clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321', 'workspaceName': 'clilaworkspacedb24'}
query_parameters = {'api-version': '2020-03-01-preview'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westeurope', 'properties': {'retentionInDays': 30, 'sku': {'name': 'PerGB2018'}, 'workspaceCapping': {}}}
request = <ClientRequest [PUT]>, response = <Response [409]>

    def _create_or_update_initial(
            self, resource_group_name, workspace_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1, pattern=r'^[-\w\._\(\)]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=63, min_length=4, pattern=r'^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str', min_length=1)
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str', min_length=1)
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'Workspace')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: Conflict
E           Message: The workspace name 'clilaworkspacedb24' is not unique
E           Target: name

env\lib\site-packages\azure\mgmt\loganalytics\operations\_workspaces_operations.py:217: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westeurope --name clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit --tag product=azurecli cause=automation date=2020-12-18T15:01:23Z" => 0. 

Command "az group create --location westus --name clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r --tag product=azurecli cause=automation date=2020-12-18T15:01:25Z" => 0. 

Command "az sql server create -l westeurope -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -n clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -u admin123 -p SecretPassword123" => 0. 

Command "az storage account create -n clitestsurkfaa6wv542dtw7 -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestsurkfaa6wv542dtw7 -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit --query "[0].value" -otsv" => 0. 

Command "az storage account create -n clitest2bxbiyuilqrcj4ksf -g clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitest2bxbiyuilqrcj4ksf -g clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r --query "[0].value" -otsv" => 0. 

Command "storage account show -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -n clitestsurkfaa6wv542dtw7 --query primaryEndpoints.blob" => 0. 

Command "storage account keys list -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -n clitestsurkfaa6wv542dtw7 --query [0].value" => 0. 

Command "sql db create -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01" => 0. 

Command "sql db audit-policy show -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01" => 0. 

Command "sql db audit-policy update -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01 --state Enabled --blob-storage-target-state Enabled --storage-key hD07DANocNw/kLO0+J9R5Bzvl101CttnjbLI0LFf0Uc1gR+bSco0wJk+dHIWOC7GggF2oGGKv+DuaEbo6/KDCQ== --storage-endpoint=https://clitestsurkfaa6wv542dtw7.blob.core.windows.net/ --retention-days=30 --actions DATABASE_LOGOUT_GROUP DATABASE_ROLE_MEMBER_CHANGE_GROUP" => 0. 

Command "sql db audit-policy show -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01" => 0. 

Command "storage account show -g clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r -n clitest2bxbiyuilqrcj4ksf --query primaryEndpoints.blob" => 0. 

Command "sql db audit-policy update -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01 --blob-storage-target-state Enabled --storage-account clitest2bxbiyuilqrcj4ksf" => 0. 

Command "sql db audit-policy update -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01 --state Disabled" => 0. 

Command "sql db threat-policy show -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01" => 0. 

Command "sql db threat-policy update -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01 --state Enabled --storage-key hD07DANocNw/kLO0+J9R5Bzvl101CttnjbLI0LFf0Uc1gR+bSco0wJk+dHIWOC7GggF2oGGKv+DuaEbo6/KDCQ== --storage-endpoint https://clitestsurkfaa6wv542dtw7.blob.core.windows.net/ --retention-days 30 --email-addresses test1@example.com test2@example.com --disabled-alerts Sql_Injection_Vulnerability Access_Anomaly --email-account-admins Enabled" => 0. 

Command "storage account keys list -g clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r -n clitest2bxbiyuilqrcj4ksf --query [0].value" => 0. 

Command "sql db threat-policy update -g clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit -s clitestserver3f4a445dor76piqyhbqx6iq4lxsyo456x4qvt2by3l3jb42dz -n cliautomationdb01 --storage-account clitest2bxbiyuilqrcj4ksf" => 0. 

Command "az group delete --name clitest.rgoesy5uwl6is6sl3s4pr7qymis4mgu5u6dg4pvg5m35hqgmjdmwtjsvmndulcpad2r --yes --no-wait" => 0. 

Command "az group delete --name clitest.rgviih2xx6j7ymqrhlgf4xbzlluhccjtknxpidyvzellf2g2knj6bovyzeyvy6ohbit --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____________ SecretsScenarioTest.test_vm_create_windows_secrets ______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C0D31CE50>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C200752E0>
command = 'vm create -g clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu -n vm-name --admin-username ...: \'https://vmkeyvaultti5x5an6xs.vault.azure.net/secrets/cert1/654c4b3211a64927bbc85776bc72f53e\'}]}]" --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C200752E0>
args = ['vm', 'create', '-g', 'clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu', '-n', 'vm-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C1FE431F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C200752E0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.SecretsScenarioTest testMethod=test_vm_create_windows_secrets>
resource_group = 'clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu'
resource_group_location = 'westus'

    @ResourceGroupPreparer()
    def test_vm_create_windows_secrets(self, resource_group, resource_group_location):
    
        self.kwargs.update({
            'admin': 'windowsUser',
            'loc': 'westus',
            'image': 'Win2012R2Datacenter',
            'vm': 'vm-name',
            'secrets': json.dumps([{'sourceVault': {'id': 'id'}, 'vaultCertificates': [{'certificateUrl': 'certurl'}]}]),
            'vault': self.create_random_name('vmkeyvault', 20)
        })
    
        message = 'Secret is missing certificateStore within vaultCertificates array at secret index 0 and ' \
                  'vaultCertificate index 0'
        with self.assertRaisesRegexp(CLIError, message):
            self.cmd('vm create -g {rg} -n {vm} --admin-username {admin} --admin-password VerySecret!12 --image {image} -l {loc} --secrets \'{secrets}\' --nsg-rule NONE')
    
        vault_out = self.cmd(
            'keyvault create -g {rg} -n {vault} -l {loc} --enabled-for-deployment true --enabled-for-template-deployment true').get_output_in_json()
    
        time.sleep(60)
    
        self.kwargs['policy_path'] = os.path.join(TEST_DIR, 'keyvault', 'policy.json')
        self.cmd('keyvault certificate create --vault-name {vault} -n cert1 -p @"{policy_path}"')
    
        self.kwargs['secret_out'] = self.cmd('keyvault secret list-versions --vault-name {vault} -n cert1 --query "[?attributes.enabled].id" -o tsv').output.strip()
        self.kwargs['secrets'] = self.cmd('vm secret format -s {secret_out} --certificate-store "My"').get_output_in_json()
    
>       self.cmd('vm create -g {rg} -n {vm} --admin-username {admin} --admin-password VerySecret!12 --image {image} -l {loc} --secrets "{secrets}" --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2694: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu/providers/Microsoft.Compute/virtualMachines/vm-name' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu/providers/Microsoft.Compute/virtualMachines/vm-name' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu --tag product=azurecli cause=automation date=2020-12-18T15:05:37Z" => 0. 

Command "keyvault create -g clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu -n vmkeyvaultti5x5an6xs -l westus --enabled-for-deployment true --enabled-for-template-deployment true" => 0. 

Command "keyvault certificate create --vault-name vmkeyvaultti5x5an6xs -n cert1 -p @"c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\vm\tests\latest\keyvault\policy.json"" => 0. 

Command "keyvault secret list-versions --vault-name vmkeyvaultti5x5an6xs -n cert1 --query "[?attributes.enabled].id" -o tsv" => 0. 

Command "vm secret format -s https://vmkeyvaultti5x5an6xs.vault.azure.net/secrets/cert1/654c4b3211a64927bbc85776bc72f53e --certificate-store "My"" => 0. 

Command "az group delete --name clitest.rgkahlox4irj2x6epyj54jptdpv25mmotpq2oha64v5zvqxabgt6udmswxzlqt6fpyu --yes --no-wait" => 0. 

______ VMSSCreateLinuxSecretsScenarioTest.test_vmss_create_linux_secrets ______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C7D208700>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2117F220>
command = 'vmss create -n vmss1-name -g cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo --image Debi...{"certificateUrl": "https://vmsslinuxkvizk3xjhln.vault.azure.net/secrets/cert1/4e020213f4874353b2f3bbbf556cc594"}]}]\''
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2117F220>
args = ['vmss', 'create', '-n', 'vmss1-name', '-g', 'cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C7E948E50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2117F220>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateLinuxSecretsScenarioTest testMethod=test_vmss_create_linux_secrets>
resource_group = 'cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_linux_secrets')
    @AllowLargeResponse()
    def test_vmss_create_linux_secrets(self, resource_group):
        self.kwargs.update({
            'loc': 'westus',
            'vmss': 'vmss1-name',
            'secrets': json.dumps([{'sourceVault': {'id': 'id'}, 'vaultCertificates': []}]),
            'vault': self.create_random_name('vmsslinuxkv', 20),
            'secret': 'mysecret',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        vault_out = self.cmd('keyvault create -g {rg} -n {vault} -l {loc} --enabled-for-deployment true --enabled-for-template-deployment true').get_output_in_json()
    
        time.sleep(60)
    
        self.kwargs['policy_path'] = os.path.join(TEST_DIR, 'keyvault', 'policy.json')
        self.cmd('keyvault certificate create --vault-name {vault} -n cert1 -p @"{policy_path}"')
    
        self.kwargs['secret_out'] = self.cmd('keyvault secret list-versions --vault-name {vault} -n cert1 --query "[?attributes.enabled].id" -o tsv').output.strip()
        vm_format = self.cmd('vm secret format -s {secret_out}').get_output_in_json()
        self.kwargs['secrets'] = json.dumps(vm_format)
    
>       self.cmd('vmss create -n {vmss} -g {rg} --image Debian --admin-username deploy --ssh-key-value \'{ssh_key}\' --secrets \'{secrets}\'')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2729: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1-name' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1-name' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo --tag product=azurecli cause=automation date=2020-12-18T15:07:33Z" => 0. 

Command "keyvault create -g cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo -n vmsslinuxkvizk3xjhln -l westus --enabled-for-deployment true --enabled-for-template-deployment true" => 0. 

Command "keyvault certificate create --vault-name vmsslinuxkvizk3xjhln -n cert1 -p @"c:\users\daetienn\desktop\azure-cli\src\azure-cli\azure\cli\command_modules\vm\tests\latest\keyvault\policy.json"" => 0. 

Command "keyvault secret list-versions --vault-name vmsslinuxkvizk3xjhln -n cert1 --query "[?attributes.enabled].id" -o tsv" => 0. 

Command "vm secret format -s https://vmsslinuxkvizk3xjhln.vault.azure.net/secrets/cert1/4e020213f4874353b2f3bbbf556cc594" => 0. 

Command "az group delete --name cli_test_vmss_create_linux_secretsa46otqkgmphi52akkni6jkbttwj7lmcbte6qblxdo --yes --no-wait" => 0. 

_________ VMSSCreateExistingOptions.test_vmss_create_existing_options _________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C20EE8130>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2103B1C0>
command = "vmss create --image CentOS --os-disk-name vrfosdisk --admin-username ubuntu --vnet-name vrfvnet --subnet vrfsubnet -l...SwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n' --backend-pool-name mybepool --use-unmanaged-disk"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2103B1C0>
args = ['vmss', 'create', '--image', 'CentOS', '--os-disk-name', 'vrfosdisk', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C20D1CE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2103B1C0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateExistingOptions testMethod=test_vmss_create_existing_options>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_existing_options')
    def test_vmss_create_existing_options(self):
    
        self.kwargs.update({
            'vmss': 'vrfvmss',
            'os_disk': 'vrfosdisk',
            'container': 'vrfcontainer',
            'sku': 'Standard_A3',
            'vnet': 'vrfvnet',
            'subnet': 'vrfsubnet',
            'lb': 'vrflb',
            'bepool': 'mybepool',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.cmd('network vnet create -n {vnet} -g {rg} --subnet-name {subnet}')
        self.cmd('network lb create --name {lb} -g {rg} --backend-pool-name {bepool}')
    
>       self.cmd('vmss create --image CentOS --os-disk-name {os_disk} --admin-username ubuntu --vnet-name {vnet} --subnet {subnet} -l "West US" --vm-sku {sku} --storage-container-name {container} -g {rg} --name {vmss} --load-balancer {lb} --ssh-key-value \'{ssh_key}\' --backend-pool-name {bepool} --use-unmanaged-disk')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2758: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j --tag product=azurecli cause=automation date=2020-12-18T15:09:28Z" => 0. 

Command "network vnet create -n vrfvnet -g cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j --subnet-name vrfsubnet" => 0. 

Command "network lb create --name vrflb -g cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j --backend-pool-name mybepool" => 0. 

No inbound nat pool was configured on 'vrflb'
Command "az group delete --name cli_test_vmss_create_existing_optionsdgctrnhuits367oypqaa22adg4zvvff6egcf6j --yes --no-wait" => 0. 

_____ VMSSCreateExistingIdsOptions.test_vmss_create_existing_ids_options ______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C2150A340>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2104E130>
command = "vmss create --image CentOS --os-disk-name vrfosdisk --admin-username ubuntu --subnet /subscriptions/a1bfa635-f2bf-42f...SwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n' --backend-pool-name mybepool --use-unmanaged-disk"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2104E130>
args = ['vmss', 'create', '--image', 'CentOS', '--os-disk-name', 'vrfosdisk', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C21745AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2104E130>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateExistingIdsOptions testMethod=test_vmss_create_existing_ids_options>
resource_group = 'cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_existing_ids')
    def test_vmss_create_existing_ids_options(self, resource_group):
    
        from msrestazure.tools import resource_id, is_valid_resource_id
        subscription_id = self.get_subscription_id()
    
        self.kwargs.update({
            'vmss': 'vrfvmss',
            'os_disk': 'vrfosdisk',
            'container': 'vrfcontainer',
            'sku': 'Standard_A3',
            'vnet': 'vrfvnet',
            'subnet': 'vrfsubnet',
            'lb': 'vrflb',
            'bepool': 'mybepool',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.cmd('network vnet create -n {vnet} -g {rg} --subnet-name {subnet}')
        self.cmd('network lb create --name {lb} -g {rg} --backend-pool-name {bepool}')
    
        self.kwargs.update({
            'subnet_id': resource_id(subscription=subscription_id, resource_group=resource_group, namespace='Microsoft.Network', type='virtualNetworks', child_type_1='subnets', name=self.kwargs['vnet'], child_name_1=self.kwargs['subnet']),
            'lb_id': resource_id(subscription=subscription_id, resource_group=resource_group, namespace='Microsoft.Network', type='loadBalancers', name=self.kwargs['lb'])
        })
    
        assert is_valid_resource_id(self.kwargs['subnet_id'])
        assert is_valid_resource_id(self.kwargs['lb_id'])
    
>       self.cmd('vmss create --image CentOS --os-disk-name {os_disk} --admin-username ubuntu --subnet {subnet_id} -l "West US" --vm-sku {sku} --storage-container-name {container} -g {rg} --name {vmss} --load-balancer {lb_id} --ssh-key-value \'{ssh_key}\' --backend-pool-name {bepool} --use-unmanaged-disk')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2801: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq/providers/Microsoft.Compute/virtualMachineScaleSets/vrfvmss' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq --tag product=azurecli cause=automation date=2020-12-18T15:10:18Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "network vnet create -n vrfvnet -g cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq --subnet-name vrfsubnet" => 0. 

Command "network lb create --name vrflb -g cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq --backend-pool-name mybepool" => 0. 

No inbound nat pool was configured on '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq/providers/Microsoft.Network/loadBalancers/vrflb'
Command "az group delete --name cli_test_vmss_create_existing_idsnun5ehghvdyj2wasiq5oyyjlvumr25peao5kb4loiq --yes --no-wait" => 0. 

______________________ VMSSVMsScenarioTest.test_vmss_vms ______________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C21D53E50>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C21D9F550>
command = 'vmss create -g cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74 -n vmss1 --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password TestTest12#$ --instance-count 2'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21D9F550>
args = ['vmss', 'create', '-g', 'cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C216D5EE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21D9F550>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSVMsScenarioTest testMethod=test_vmss_vms>
resource_group = 'cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_vms')
    def test_vmss_vms(self, resource_group):
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'count': 2,
            'instance_ids': []
        })
    
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --authentication-type password --admin-username admin123 --admin-password TestTest12#$ --instance-count {count}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2829: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74 --tag product=azurecli cause=automation date=2020-12-18T15:11:07Z" => 0. 

Command "az group delete --name cli_test_vmss_vmsoescw5gmbep4qwidnfo7a2ltui2lyl7cmuklalnjjjpwr6iueux73poy74 --yes --no-wait" => 0. 

_________ SqlServerSecurityScenarioTest.test_sql_server_security_mgmt _________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A63C1C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381E83D310>
command = 'monitor log-analytics workspace create -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clilaworkspacesrv14'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381E83D310>
args = ['monitor', 'log-analytics', 'workspace', 'create', '-g', 'clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382A6288B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381E83D310>
ex = CloudError("The workspace name 'clilaworkspacesrv14' is not unique")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The workspace name 'clilaworkspacesrv14' is not unique")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.sql.tests.latest.test_sql_commands.SqlServerSecurityScenarioTest testMethod=test_sql_server_security_mgmt>
resource_group = 'clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb'
resource_group_2 = 'clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u'
resource_group_location = 'westus'
server = 'clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml'
storage_account = 'clitestydg4g54aiyunuault'
storage_account_2 = 'clitestpbmhpr4uey2jau64r'

    @ResourceGroupPreparer(location='westeurope')
    @ResourceGroupPreparer(parameter_name='resource_group_2')
    @SqlServerPreparer(location='westeurope')
    @StorageAccountPreparer(location='westus')
    @StorageAccountPreparer(parameter_name='storage_account_2',
                            resource_group_parameter_name='resource_group_2')
    def test_sql_server_security_mgmt(self, resource_group, resource_group_2,
                                      resource_group_location, server,
                                      storage_account, storage_account_2):
    
        state_enabled = 'Enabled'
        state_disabled = 'Disabled'
    
        # get storage account endpoint and key
        storage_endpoint = self._get_storage_endpoint(storage_account, resource_group)
        key = self._get_storage_key(storage_account, resource_group)
    
        # get audit policy
        self.cmd('sql server audit-policy show -g {} -n {}'
                 .format(resource_group, server),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('blobStorageTargetState', state_disabled),
                     JMESPathCheck('logAnalyticsTargetState', state_disabled),
                     JMESPathCheck('eventHubTargetState', state_disabled),
                     JMESPathCheck('isAzureMonitorTargetEnabled', False)])
    
        # update audit policy - enable
        retention_days = 30
        audit_actions_input = 'DATABASE_LOGOUT_GROUP DATABASE_ROLE_MEMBER_CHANGE_GROUP'
        audit_actions_expected = ['DATABASE_LOGOUT_GROUP',
                                  'DATABASE_ROLE_MEMBER_CHANGE_GROUP']
    
        self.cmd('sql server audit-policy update -g {} -n {}'
                 ' --state {} --blob-storage-target-state {} --storage-key {} --storage-endpoint={}'
                 ' --retention-days={} --actions {}'
                 .format(resource_group, server, state_enabled, state_enabled, key,
                         storage_endpoint, retention_days, audit_actions_input),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageEndpoint', storage_endpoint),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # get audit policy
        self.cmd('sql server audit-policy show -g {} -n {}'
                 .format(resource_group, server),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('blobStorageTargetState', state_enabled),
                     JMESPathCheck('logAnalyticsTargetState', state_disabled),
                     JMESPathCheck('eventHubTargetState', state_disabled),
                     JMESPathCheck('isAzureMonitorTargetEnabled', False)])
    
        # update audit policy - specify storage account and resource group. use secondary key
        storage_endpoint_2 = self._get_storage_endpoint(storage_account_2, resource_group_2)
        self.cmd('sql server audit-policy update -g {} -n {} --blob-storage-target-state {} --storage-account {}'
                 .format(resource_group, server, state_enabled, storage_account_2),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_enabled),
                     JMESPathCheck('storageEndpoint', storage_endpoint_2),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # update audit policy - disable
        self.cmd('sql server audit-policy update -g {} -n {} --state {}'
                 .format(resource_group, server, state_disabled),
                 checks=[
                     JMESPathCheck('resourceGroup', resource_group),
                     JMESPathCheck('state', state_disabled),
                     JMESPathCheck('retentionDays', retention_days),
                     JMESPathCheck('auditActionsAndGroups', audit_actions_expected)])
    
        # create log analytics workspace
        log_analytics_workspace_name = "clilaworkspacesrv14"
    
>       log_analytics_workspace_id = self.cmd('monitor log-analytics workspace create -g {} -n {}'
                                              .format(resource_group, log_analytics_workspace_name),
                                              checks=[
                                                  JMESPathCheck('resourceGroup', resource_group),
                                                  JMESPathCheck('name', log_analytics_workspace_name),
                                                  JMESPathCheck('provisioningState', 'Succeeded')]).get_output_in_json()['id']

src\azure-cli\azure\cli\command_modules\sql\tests\latest\test_sql_commands.py:1665: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
src\azure-cli\azure\cli\command_modules\monitor\_exception_handler.py:19: in exception_handler
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\monitor\operations\log_analytics_workspace.py:32: in create_log_analytics_workspace
    return sdk_no_wait(no_wait, workspace_client.create_or_update, resource_group_name,
src\azure-cli-core\azure\cli\core\util.py:630: in sdk_no_wait
    return func(*args, **kwargs)
env\lib\site-packages\azure\mgmt\loganalytics\operations\_workspaces_operations.py:257: in create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.loganalytics.operations._workspaces_operations.WorkspacesOperations object at 0x000002382A806130>
resource_group_name = 'clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb'
workspace_name = 'clilaworkspacesrv14'
parameters = <azure.mgmt.loganalytics.models._models_py3.Workspace object at 0x000002382A806E50>
custom_headers = None, raw = True, operation_config = {}
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourcegroups/clitest.rgrfgaxt6macp7...qedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb/providers/Microsoft.OperationalInsights/workspaces/clilaworkspacesrv14'
path_format_arguments = {'resourceGroupName': 'clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321', 'workspaceName': 'clilaworkspacesrv14'}
query_parameters = {'api-version': '2020-03-01-preview'}
header_parameters = {'Accept': 'application/json', 'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'westeurope', 'properties': {'retentionInDays': 30, 'sku': {'name': 'PerGB2018'}, 'workspaceCapping': {}}}
request = <ClientRequest [PUT]>, response = <Response [409]>

    def _create_or_update_initial(
            self, resource_group_name, workspace_name, parameters, custom_headers=None, raw=False, **operation_config):
        # Construct URL
        url = self.create_or_update.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', max_length=90, min_length=1, pattern=r'^[-\w\._\(\)]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=63, min_length=4, pattern=r'^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str', min_length=1)
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str', min_length=1)
    
        # Construct headers
        header_parameters = {}
        header_parameters['Accept'] = 'application/json'
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'Workspace')
    
        # Construct and send request
        request = self._client.put(url, query_parameters, header_parameters, body_content)
        response = self._client.send(request, stream=False, **operation_config)
    
        if response.status_code not in [200, 201, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: Conflict
E           Message: The workspace name 'clilaworkspacesrv14' is not unique
E           Target: name

env\lib\site-packages\azure\mgmt\loganalytics\operations\_workspaces_operations.py:217: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westeurope --name clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb --tag product=azurecli cause=automation date=2020-12-18T15:05:40Z" => 0. 

Command "az group create --location westus --name clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u --tag product=azurecli cause=automation date=2020-12-18T15:05:41Z" => 0. 

Command "az sql server create -l westeurope -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml -u admin123 -p SecretPassword123" => 0. 

Command "az storage account create -n clitestydg4g54aiyunuault -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestydg4g54aiyunuault -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb --query "[0].value" -otsv" => 0. 

Command "az storage account create -n clitestpbmhpr4uey2jau64r -g clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u -l westus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestpbmhpr4uey2jau64r -g clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u --query "[0].value" -otsv" => 0. 

Command "storage account show -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestydg4g54aiyunuault --query primaryEndpoints.blob" => 0. 

Command "storage account keys list -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestydg4g54aiyunuault --query [0].value" => 0. 

Command "sql server audit-policy show -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml" => 0. 

Command "sql server audit-policy update -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml --state Enabled --blob-storage-target-state Enabled --storage-key uYvo2zfo3vNOOM522rzIJ79+wsIcvncS/bB6zRmWp8oJyBaKE12J1z5E6WrKUvdX1JhBAv+F9KOtgMpmWiBefw== --storage-endpoint=https://clitestydg4g54aiyunuault.blob.core.windows.net/ --retention-days=30 --actions DATABASE_LOGOUT_GROUP DATABASE_ROLE_MEMBER_CHANGE_GROUP" => 0. 

Command "sql server audit-policy show -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml" => 0. 

Command "storage account show -g clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u -n clitestpbmhpr4uey2jau64r --query primaryEndpoints.blob" => 0. 

Command "sql server audit-policy update -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml --blob-storage-target-state Enabled --storage-account clitestpbmhpr4uey2jau64r" => 0. 

Command "sql server audit-policy update -g clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb -n clitestservermexvsiw5orwx5z5asz4d4ky6zvmumujztxdlg64bgo6bl34ml --state Disabled" => 0. 

Command "az group delete --name clitest.rglxkfh5dsvxqrecd37chl2ssunhurbp4f35ehllvbdosxwexbsz6km4u2m2udipg7u --yes --no-wait" => 0. 

Command "az group delete --name clitest.rgrfgaxt6macp7vap5ifqedcav6a2xjhwgkyh6cevc3nelzcjzk4sisrmp6gs34rbnb --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____________ VMUnmanagedDataDiskTest.test_vm_data_unmanaged_disk _____________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C948A1B760>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C948336AF0>
command = 'vm create -g cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45 --location westus -n vm-data...u --image UbuntuLTS --admin-password testPassword0 --authentication-type password --use-unmanaged-disk --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C948336AF0>
args = ['vm', 'create', '-g', 'cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45', '--location', 'westus', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C93BC83820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C948336AF0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMUnmanagedDataDiskTest testMethod=test_vm_data_unmanaged_disk>
resource_group = 'cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45'

    @ResourceGroupPreparer(name_prefix='cli-test-disk')
    def test_vm_data_unmanaged_disk(self, resource_group):
    
        self.kwargs.update({
            'loc': 'westus',
            'vm': 'vm-datadisk-test',
            'disk': 'd7'
        })
    
>       self.cmd('vm create -g {rg} --location {loc} -n {vm} --admin-username ubuntu --image UbuntuLTS --admin-password testPassword0 --authentication-type password --use-unmanaged-disk --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2076: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45/providers/Microsoft.Compute/virtualMachines/vm-datadisk-test' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45/providers/Microsoft.Compute/virtualMachines/vm-datadisk-test' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45 --tag product=azurecli cause=automation date=2020-12-18T15:17:22Z" => 0. 

Command "az group delete --name cli-test-diskjvyrcz7dym4i33zgdhu3gvgtfnkflql774qpu532gma2uz2ioycztntbz62l45 --yes --no-wait" => 0. 

__________ VMCreateCustomDataScenarioTest.test_vm_create_custom_data __________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94F82CCD0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C948F0C5B0>
command = "vm create -g cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl -n vm-name --admin-username ...Bicz5Ew2+jdyGNQQ== test@example.com\n' -l westus --custom-data '#cloud-config\nhostname: myVMhostname' --nsg-rule NONE"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C948F0C5B0>
args = ['vm', 'create', '-g', 'cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl', '-n', 'vm-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948B1BEE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C948F0C5B0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateCustomDataScenarioTest testMethod=test_vm_create_custom_data>
resource_group = 'cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl'

    @ResourceGroupPreparer(name_prefix='cli_test_create_vm_custom_data')
    def test_vm_create_custom_data(self, resource_group):
    
        self.kwargs.update({
            'deployment': 'azurecli-test-dep-vm-create-custom-data',
            'username': 'ubuntu',
            'loc': 'westus',
            'image': 'UbuntuLTS',
            'auth': 'ssh',
            'vm': 'vm-name',
            'custom_data': '#cloud-config\nhostname: myVMhostname',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --admin-username {username} --authentication-type {auth} --image {image} --ssh-key-value \'{ssh_key}\' -l {loc} --custom-data \'{custom_data}\' --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2130: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl/providers/Microsoft.Compute/virtualMachines/vm-name' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl/providers/Microsoft.Compute/virtualMachines/vm-name' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl --tag product=azurecli cause=automation date=2020-12-18T15:17:28Z" => 0. 

Command "az group delete --name cli_test_create_vm_custom_datacvg4kc4zxzh2rza37wqn7jrs3aiaz4hiknekgd5o3uyyl --yes --no-wait" => 0. 

_______________ VMSSCreateAndModify.test_vmss_create_and_modify _______________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C949CB3520>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C955EF1760>
command = 'vmss create --admin-password testPassword0 --name vmss1 -g cli_test_vmss_create_and_modify5jlc72bgdr66bhmwdqwix5ejh2sieaseggdh3xuxlicb --admin-username myadmin --image Win2012R2Datacenter --instance-count 5'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C955EF1760>
args = ['vmss', 'create', '--admin-password', 'testPassword0', '--name', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C949BD5CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C955EF1760>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateAndModify testMethod=test_vmss_create_and_modify>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_and_modify')
    def test_vmss_create_and_modify(self):
    
        self.kwargs.update({
            'vmss': 'vmss1',
            'count': 5,
            'new_count': 4
        })
    
>       self.cmd('vmss create --admin-password testPassword0 --name {vmss} -g {rg} --admin-username myadmin --image Win2012R2Datacenter --instance-count {count}')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2150: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_and_modify5jlc72bgdr66bhmwdqwix5ejh2sieaseggdh3xuxlicb/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_and_modify5jlc72bgdr66bhmwdqwix5ejh2sieaseggdh3xuxlicb/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_and_modify5jlc72bgdr66bhmwdqwix5ejh2sieaseggdh3xuxlicb --tag product=azurecli cause=automation date=2020-12-18T15:17:33Z" => 0. 

Command "az group delete --name cli_test_vmss_create_and_modify5jlc72bgdr66bhmwdqwix5ejh2sieaseggdh3xuxlicb --yes --no-wait" => 0. 

_________________________ MSIScenarioTest.test_vm_msi _________________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C948993F40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C949C21490>
command = 'vm create -g cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi -n vm1 --image debian --assi...48c674fc321/resourceGroups/cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C949C21490>
args = ['vm', 'create', '-g', 'cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948989820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C949C21490>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.MSIScenarioTest testMethod=test_vm_msi>
resource_group = 'cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_msi')
    def test_vm_msi(self, resource_group):
        subscription_id = self.get_subscription_id()
    
        self.kwargs.update({
            'scope': '/subscriptions/{}/resourceGroups/{}'.format(subscription_id, resource_group),
            'vm1': 'vm1',
            'vm1_id': '/subscriptions/{}/resourceGroups/{}/providers/Microsoft.Compute/virtualMachines/vm1'.format(subscription_id, resource_group),
            'vm2': 'vm2',
            'vm3': 'vm3',
            'sub': subscription_id
        })
    
        with mock.patch('azure.cli.core.commands.arm._gen_guid', side_effect=self.create_guid):
            # create a linux vm with default configuration
>           self.cmd('vm create -g {rg} -n {vm1} --image debian --assign-identity --admin-username admin123 --admin-password PasswordPassword1! --scope {scope} --nsg-rule NONE', checks=[
                self.check('identity.role', 'Contributor'),
                self.check('identity.scope', '/subscriptions/{sub}/resourceGroups/{rg}'),
            ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3036: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi --tag product=azurecli cause=automation date=2020-12-18T15:17:39Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "az group delete --name cli_test_vm_msi4kst253fctxdrlp4fgr2ku2bkrzipiwkwvkmgwynjwhuxutxc4no2qfg6dzi --yes --no-wait" => 0. 

____________________ MSIScenarioTest.test_vm_msi_no_scope _____________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C949B876A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C949A5D160>
command = 'vm create -g cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj -n vm1 --image debian --assign-identity --admin-username admin123 --admin-password PasswordPassword1! --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C949A5D160>
args = ['vm', 'create', '-g', 'cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C94C048790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C949A5D160>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.MSIScenarioTest testMethod=test_vm_msi_no_scope>
resource_group = 'cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj'

    @ResourceGroupPreparer(name_prefix='cli_test_msi_no_scope')
    def test_vm_msi_no_scope(self, resource_group):
    
        self.kwargs.update({
            'vm1': 'vm1',
            'vmss1': 'vmss1',
            'vm2': 'vm2',
            'vmss2': 'vmss2',
        })
    
        # create a linux vm with identity but w/o a role assignment (--scope "")
>       self.cmd('vm create -g {rg} -n {vm1} --image debian --assign-identity --admin-username admin123 --admin-password PasswordPassword1! --nsg-rule NONE', checks=[
            self.check('identity.scope', None),
            self.check('identity.role', None),
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj --tag product=azurecli cause=automation date=2020-12-18T15:17:45Z" => 0. 

Command "az group delete --name cli_test_msi_no_scope7tlwhxjtfrzajwx6mpntxferyzij7l5m7uickb3da3diyyrm7ep6kj --yes --no-wait" => 0. 

___________________ MSIScenarioTest.test_vmss_explicit_msi ____________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C949743CD0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94C7B1FD0>
command = 'vmss create -g cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 -n vmss1 --image ubuntults...iupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 --instance-count 1 --generate-ssh-keys --admin-username ubuntuadmin'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94C7B1FD0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C94F8368B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94C7B1FD0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.MSIScenarioTest testMethod=test_vmss_explicit_msi>
resource_group = 'cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_explicit_msi', location='westcentralus')
    def test_vmss_explicit_msi(self, resource_group):
    
        self.kwargs.update({
            'emsi': 'id1',
            'emsi2': 'id2',
            'vmss': 'vmss1',
            'sub': self.get_subscription_id(),
            'scope': '/subscriptions/{}/resourceGroups/{}'.format(self.get_subscription_id(), resource_group)
        })
    
        # create a managed identity
        emsi_result = self.cmd('identity create -g {rg} -n {emsi}').get_output_in_json()
        emsi2_result = self.cmd('identity create -g {rg} -n {emsi2}').get_output_in_json()
    
        # create a vmss with system + user assigned identities
>       result = self.cmd('vmss create -g {rg} -n {vmss} --image ubuntults --assign-identity {emsi} [system] --role reader --scope {scope} --instance-count 1 --generate-ssh-keys --admin-username ubuntuadmin').get_output_in_json()

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3213: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westcentralus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westcentralus --name cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 --tag product=azurecli cause=automation date=2020-12-18T15:17:51Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -g cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 -n id1" => 0. 

Command "identity create -g cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 -n id2" => 0. 

Command "az group delete --name cli_test_vmss_explicit_msiupujgr4etlpra4fptfmzj4dflezycb7hmhrkyfxstarmenpa2 --yes --no-wait" => 0. 

_____________________ VMSSNicScenarioTest.test_vmss_nics ______________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382B190580>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381BAECBB0>
command = 'vmss create -g cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5 -n vmss1 --authentication-type password --admin-username admin123 --admin-password PasswordPassword1!  --image Win2012R2Datacenter'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BAECBB0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381C22A670>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381BAECBB0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSNicScenarioTest testMethod=test_vmss_nics>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_nics')
    def test_vmss_nics(self):
    
        self.kwargs.update({
            'vmss': 'vmss1',
        })
    
>       self.cmd('vmss create -g {rg} -n {vmss} --authentication-type password --admin-username admin123 --admin-password PasswordPassword1!  --image Win2012R2Datacenter')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2928: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5 --tag product=azurecli cause=automation date=2020-12-18T15:18:00Z" => 0. 

Command "az group delete --name cli_test_vmss_nicsk3adlmtoex2pomrglvlweajrqg7emnlptnozgxycgfoudxcsjditmhhg5 --yes --no-wait" => 0. 

________________________ MSIScenarioTest.test_vmss_msi ________________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94BECC160>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94BEE08B0>
command = 'vmss create -g cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h -n vmss1 --image debian --...f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94BEE08B0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C949CD3CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94BEE08B0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.MSIScenarioTest testMethod=test_vmss_msi>
resource_group = 'cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_msi')
    def test_vmss_msi(self, resource_group):
        subscription_id = self.get_subscription_id()
    
        self.kwargs.update({
            'scope': '/subscriptions/{}/resourceGroups/{}'.format(subscription_id, resource_group),
            'vmss1': 'vmss1',
            'vmss1_id': '/subscriptions/{}/resourceGroups/{}/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1'.format(subscription_id, resource_group),
            'vmss2': 'vmss2',
            'vmss3': 'vmss3',
            'sub': subscription_id
        })
        with mock.patch('azure.cli.core.commands.arm._gen_guid', side_effect=self.create_guid):
            # create linux vm with default configuration
>           self.cmd('vmss create -g {rg} -n {vmss1} --image debian --instance-count 1 --assign-identity --admin-username admin123 --admin-password PasswordPassword1! --scope {scope}', checks=[
                self.check('vmss.identity.role', 'Contributor'),
                self.check('vmss.identity.scope', '/subscriptions/{sub}/resourceGroups/{rg}'),
            ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3074: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h --tag product=azurecli cause=automation date=2020-12-18T15:18:05Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "az group delete --name cli_test_vmss_msi77q7znrd7hm7zdmr2tpdq7eotjooyfep4xyym4muv7xreeaalrr5oe2v4h --yes --no-wait" => 0. 

____________ VMSSCreateIdempotentTest.test_vmss_create_idempotent _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023829F0AEE0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382ABB2040>
command = 'vmss create -g cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla -n vmss1 --authentication-type password --admin-username admin123 --admin-password PasswordPassword1!  --image UbuntuLTS --use-unmanaged-disk'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382ABB2040>
args = ['vmss', 'create', '-g', 'cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382B133CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382ABB2040>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCreateIdempotentTest testMethod=test_vmss_create_idempotent>
resource_group = 'cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_idempotent')
    def test_vmss_create_idempotent(self, resource_group):
    
        self.kwargs.update({'vmss': 'vmss1'})
    
        # run the command twice with the same parameters and verify it does not fail
>       self.cmd('vmss create -g {rg} -n {vmss} --authentication-type password --admin-username admin123 --admin-password PasswordPassword1!  --image UbuntuLTS --use-unmanaged-disk')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2959: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla --tag product=azurecli cause=automation date=2020-12-18T15:18:07Z" => 0. 

Command "az group delete --name cli_test_vmss_create_idempotent2j3koludkzgcsu2orlm7zfj35npm7vzk3hysjaz5vpla --yes --no-wait" => 0. 

_______________________ VMSSILBTest.test_vmss_with_ilb ________________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382AE4D9A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382A50F5E0>
command = 'vmss create -g cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty -n vmss1 --admin-username admin123 --admin-password PasswordPassword1! --image centos --instance-count 1 --public-ip-address ""'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A50F5E0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382ADDE160>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A50F5E0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSILBTest testMethod=test_vmss_with_ilb>
resource_group = 'cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_ilb')
    def test_vmss_with_ilb(self, resource_group):
    
        self.kwargs.update({'vmss': 'vmss1'})
    
>       self.cmd('vmss create -g {rg} -n {vmss} --admin-username admin123 --admin-password PasswordPassword1! --image centos --instance-count 1 --public-ip-address ""')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2978: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty --tag product=azurecli cause=automation date=2020-12-18T15:18:12Z" => 0. 

Command "az group delete --name cli_test_vmss_ilbu6eswpx7lngj624w26d73yxuaeoibttc4nhi3jzg2uipqygfmyss7rugty --yes --no-wait" => 0. 

____________________ MSIScenarioTest.test_vm_explicit_msi _____________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A51E070>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382A01B4F0>
command = 'vm create -g clitest.rgvjt4jq33xh -n vm2 --image ubuntults --assign-identity id1 --generate-ssh-keys --admin-username ubuntuadmin --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A01B4F0>
args = ['vm', 'create', '-g', 'clitest.rgvjt4jq33xh', '-n', 'vm2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382A5120D0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A01B4F0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.MSIScenarioTest testMethod=test_vm_explicit_msi>
resource_group = 'clitest.rgvjt4jq33xh'

    @ResourceGroupPreparer(random_name_length=20)
    def test_vm_explicit_msi(self, resource_group):
    
        self.kwargs.update({
            'emsi': 'id1',
            'emsi2': 'id2',
            'vm': 'vm1',
            'sub': self.get_subscription_id(),
            'scope': '/subscriptions/{}/resourceGroups/{}'.format(self.get_subscription_id(), resource_group),
            'user': 'ubuntuadmin'
        })
    
        # create a managed identity
        emsi_result = self.cmd('identity create -g {rg} -n {emsi} --tags tag1=d1', checks=[
            self.check('name', '{emsi}'),
            self.check('tags.tag1', 'd1')]).get_output_in_json()
        emsi2_result = self.cmd('identity create -g {rg} -n {emsi2}').get_output_in_json()
    
        # create a vm with only user assigned identity
>       result = self.cmd('vm create -g {rg} -n vm2 --image ubuntults --assign-identity {emsi} --generate-ssh-keys --admin-username {user} --nsg-rule NONE', checks=[
            self.check('identity.role', None),
            self.check('identity.scope', None),
        ]).get_output_in_json()

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3154: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgvjt4jq33xh/providers/Microsoft.Compute/virtualMachines/vm2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgvjt4jq33xh/providers/Microsoft.Compute/virtualMachines/vm2' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgvjt4jq33xh --tag product=azurecli cause=automation date=2020-12-18T15:18:18Z" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

A few accounts are skipped as they don't have 'Enabled' state. Use '--all' to display them.
Command "account list --query "[?isDefault].id" -o tsv" => 0. 

Command "identity create -g clitest.rgvjt4jq33xh -n id1 --tags tag1=d1" => 0. 

Command "identity create -g clitest.rgvjt4jq33xh -n id2" => 0. 

Command "az group delete --name clitest.rgvjt4jq33xh --yes --no-wait" => 0. 

________ VMRunCommandScenarioTest.test_vm_run_command_with_parameters _________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023828DE3A90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023828DE36A0>
command = 'vm create -g cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7 -n test-run-command-vm2 --image debian --admin-username clitest1 --admin-password Test12345678!! --generate-ssh-keys --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023828DE36A0>
args = ['vm', 'create', '-g', 'cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7', '-n', 'test-run-command-vm2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382A51A430>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023828DE36A0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMRunCommandScenarioTest testMethod=test_vm_run_command_with_parameters>
resource_group = 'cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_run_command_w_params')
    def test_vm_run_command_with_parameters(self, resource_group):
        self.kwargs.update({'vm': 'test-run-command-vm2'})
>       self.cmd('vm create -g {rg} -n {vm} --image debian --admin-username clitest1 --admin-password Test12345678!! --generate-ssh-keys --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3438: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7/providers/Microsoft.Compute/virtualMachines/test-run-command-vm2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7/providers/Microsoft.Compute/virtualMachines/test-run-command-vm2' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7 --tag product=azurecli cause=automation date=2020-12-18T15:18:31Z" => 0. 

Command "az group delete --name cli_test_vm_run_command_w_paramsiozwlqooxlgycv25n6dt7s547z2wovnj7ms3wp4fjq7 --yes --no-wait" => 0. 

______ VMSSRunCommandScenarioTest.test_vmss_run_command_with_parameters _______
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002381BF8D460>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023829AAD0D0>
command = 'vmss create -g cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey -n test-run-command-vmss2 --image debian --admin-username clitest1 --generate-ssh-keys'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829AAD0D0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey', '-n', 'test-run-command-vmss2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000023821219C10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829AAD0D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSRunCommandScenarioTest testMethod=test_vmss_run_command_with_parameters>
resource_group = 'cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_run_command_w_params')
    def test_vmss_run_command_with_parameters(self, resource_group):
        self.kwargs.update({'vmss': 'test-run-command-vmss2'})
>       self.cmd('vmss create -g {rg} -n {vmss} --image debian --admin-username clitest1 --generate-ssh-keys')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3482: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey/providers/Microsoft.Compute/virtualMachineScaleSets/test-run-command-vmss2' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey/providers/Microsoft.Compute/virtualMachineScaleSets/test-run-command-vmss2' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey --tag product=azurecli cause=automation date=2020-12-18T15:18:36Z" => 0. 

Command "az group delete --name cli_test_vmss_run_command_w_paramshrboc4qbd37ugpmw7zcwcutu73flehojgmb6es2ey --yes --no-wait" => 0. 

______________ VMDiskEncryptionTest.test_vm_disk_encryption_e2e _______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A16D9D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023829A731F0>
command = 'vm create -g cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz -n vm1 --image win2012datacenter --admin-username clitester1 --admin-password Test123456789! --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829A731F0>
args = ['vm', 'create', '-g', 'cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002381BE4B430>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829A731F0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMDiskEncryptionTest testMethod=test_vm_disk_encryption_e2e>
resource_group = 'cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_encryption', location='westus')
    def test_vm_disk_encryption_e2e(self, resource_group, resource_group_location):
        self.kwargs.update({
            'vault': self.create_random_name('vault', 10),
            'vm': 'vm1'
        })
        self.cmd('keyvault create -g {rg} -n {vault} --enabled-for-disk-encryption "true"')
        time.sleep(60)  # to avoid 504(too many requests) on a newly created vault
>       self.cmd('vm create -g {rg} -n {vm} --image win2012datacenter --admin-username clitester1 --admin-password Test123456789! --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3525: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz --tag product=azurecli cause=automation date=2020-12-18T15:18:42Z" => 0. 

Command "keyvault create -g cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz -n vaultebou2 --enabled-for-disk-encryption "true"" => 0. 

Command "az group delete --name cli_test_vm_encryptionfybykydakpuilxrvv5op5htlwawwx3u6joxiauqmyrlgts5jak2nz --yes --no-wait" => 0. 

_______________ VMDiskEncryptionTest.test_vm_encryption_at_host _______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382AB5FDF0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382AEB1AC0>
command = 'vm create -g cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3 -n vm1 --image centos --generate-ssh-keys --nsg-rule NONE --encryption-at-host --admin-username exampleusername'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382AEB1AC0>
args = ['vm', 'create', '-g', 'cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382AB57700>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382AEB1AC0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMDiskEncryptionTest testMethod=test_vm_encryption_at_host>
resource_group = 'cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_encryption_at_host_', location='westus')
    def test_vm_encryption_at_host(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1',
            'vmss': 'vmss1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image centos --generate-ssh-keys --nsg-rule NONE --encryption-at-host --admin-username exampleusername')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3537: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3 --tag product=azurecli cause=automation date=2020-12-18T15:20:21Z" => 0. 

Command "az group delete --name cli_test_vm_encryption_at_host_n4ktq6pczwgpru6ome2xoav3r3c2cfxzpzm762p6gkz3 --yes --no-wait" => 0. 

______________________ VMOsDiskSwap.test_vm_os_disk_swap ______________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C9403450D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C92D83EE20>
command = 'vm create -g clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl -n vm1 --image centos --admin-username clitest123 --generate-ssh-keys --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C92D83EE20>
args = ['vm', 'create', '-g', 'clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C948296700>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C92D83EE20>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMOsDiskSwap testMethod=test_vm_os_disk_swap>
resource_group = 'clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl'

    @ResourceGroupPreparer()
    def test_vm_os_disk_swap(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1',
            'backupDisk': 'disk1',
        })
>       self.cmd('vm create -g {rg} -n {vm} --image centos --admin-username clitest123 --generate-ssh-keys --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3725: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl --tag product=azurecli cause=automation date=2020-12-18T15:21:31Z" => 0. 

Command "az group delete --name clitest.rgbiyafes4j5uriqgcjzwezimo2i3rc5wommtaf3jlwyqzy3jneknr7acmpyoveyfyl --yes --no-wait" => 0. 

___________________ VMGenericUpdate.test_vm_generic_update ____________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C949A25A90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C9591013D0>
command = 'vm create -g clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy -n vm1 --image debian --data-disk-sizes-gb 1 2 --admin-username cligenerics --generate-ssh-keys --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9591013D0>
args = ['vm', 'create', '-g', 'clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C9482A2CA0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C9591013D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMGenericUpdate testMethod=test_vm_generic_update>
resource_group = 'clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy'

    @ResourceGroupPreparer()
    def test_vm_generic_update(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1',
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image debian --data-disk-sizes-gb 1 2 --admin-username cligenerics --generate-ssh-keys --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3745: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy --tag product=azurecli cause=automation date=2020-12-18T15:21:38Z" => 0. 

Command "az group delete --name clitest.rgptcuciyfvrfw2eortjplxidx322nmftamfkx5ml77ojusdvwgszh5i2cowjjuiyjy --yes --no-wait" => 0. 

_____________ VMDiskEncryptionTest.test_vmss_disk_encryption_e2e ______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000023828E05CA0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000023829F20A60>
command = 'vmss create -g cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l -n vmss1 --image win2016datacenter --instance-count 1 --admin-username clitester1 --admin-password Test123456789!'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829F20A60>
args = ['vmss', 'create', '-g', 'cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238212CFF70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000023829F20A60>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMDiskEncryptionTest testMethod=test_vmss_disk_encryption_e2e>
resource_group = 'cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_encryption', location='westus')
    def test_vmss_disk_encryption_e2e(self, resource_group, resource_group_location):
        self.kwargs.update({
            'vault': self.create_random_name('vault', 20),
            'vmss': 'vmss1'
        })
        self.cmd('keyvault create -g {rg} -n {vault} --enabled-for-disk-encryption "true"')
        time.sleep(60)  # to avoid 504(too many requests) on a newly created vault
>       self.cmd('vmss create -g {rg} -n {vmss} --image win2016datacenter --instance-count 1 --admin-username clitester1 --admin-password Test123456789!')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3501: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l --tag product=azurecli cause=automation date=2020-12-18T15:20:26Z" => 0. 

Command "keyvault create -g cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l -n vaultte2ycurutqjrs5k --enabled-for-disk-encryption "true"" => 0. 

Command "az group delete --name cli_test_vmss_encryptionzyoumvgqneqhex55uwyjaw32t3exv3cyui4g3v7c4pq5agynf5l --yes --no-wait" => 0. 

_____________ VMCreateWithExistingNic.test_vm_create_existing_nic _____________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A2FE940>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002381B71E340>
command = 'vm create -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr -n vm1 --image centos --nics my-nic --generate-ssh-keys --admin-username ubuntuadmin'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B71E340>
args = ['vm', 'create', '-g', 'cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382AA88280>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002381B71E340>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateWithExistingNic testMethod=test_vm_create_existing_nic>
resource_group = 'cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr'

    @ResourceGroupPreparer(name_prefix='cli_test_create_vm_existing_nic')
    def test_vm_create_existing_nic(self, resource_group):
        import re
        self.cmd('network public-ip create -g {rg} -n my-pip')
        self.cmd('network vnet create -g {rg} -n my-vnet --subnet-name my-subnet1')
        self.cmd('network nsg create -g {rg} -n nsg')
        self.cmd('network nic create -g {rg} -n my-nic --subnet my-subnet1 --vnet-name my-vnet --public-ip-address my-pip --network-security-group nsg')
        self.cmd('network nic ip-config create -n my-ipconfig2 -g {rg} --nic-name my-nic --private-ip-address-version IPv6')
>       self.cmd('vm create -g {rg} -n vm1 --image centos --nics my-nic --generate-ssh-keys --admin-username ubuntuadmin')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3681: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr --tag product=azurecli cause=automation date=2020-12-18T15:22:11Z" => 0. 

Command "network public-ip create -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr -n my-pip" => 0. 

Command "network vnet create -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr -n my-vnet --subnet-name my-subnet1" => 0. 

Command "network nsg create -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr -n nsg" => 0. 

Command "network nic create -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr -n my-nic --subnet my-subnet1 --vnet-name my-vnet --public-ip-address my-pip --network-security-group nsg" => 0. 

Command "network nic ip-config create -n my-ipconfig2 -g cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr --nic-name my-nic --private-ip-address-version IPv6" => 0. 

Command "az group delete --name cli_test_create_vm_existing_nictb7y4q6p5huytmtyv7yjyx5k75cuhwzmpagovmckvksr --yes --no-wait" => 0. 

________ VMSSSimulateEvictionScenarioTest.test_vmss_simulate_eviction _________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSSimulateEvictionScenarioTest testMethod=test_vmss_simulate_eviction>
resource_group = 'cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_simulate_eviction')
    def test_vmss_simulate_eviction(self, resource_group):
    
        self.kwargs.update({
            'loc': 'eastus',
            'vmss1': 'vmss-simualte-eviction1',
            'vmss2': 'vmss-simulate-eviction2',
            'vmss3': 'vmss-simulate-eviction3',
            'instance_ids': []
        })
    
        # simulate-eviction on a Regular VMSS, expect failure
        self.cmd('vmss create --resource-group {rg} --name {vmss1} --location {loc} --instance-count 2 --image Centos --priority Regular')
        instance_list = self.cmd('vmss list-instances --resource-group {rg} --name {vmss1}').get_output_in_json()
        self.kwargs['instance_ids'] = [x['instanceId'] for x in instance_list]
        self.kwargs['id'] = self.kwargs['instance_ids'][0]
        self.cmd('vmss simulate-eviction --resource-group {rg} --name {vmss1} --instance-id {id}', expect_failure=True)
    
        # simulate-eviction on a Spot VMSS with Deallocate policy, expect VMSS instance to be deallocated
        self.cmd('vmss create --resource-group {rg} --name {vmss2} --location {loc} --instance-count 2 --image Centos --priority Spot --eviction-policy Deallocate --single-placement-group True')
        instance_list = self.cmd('vmss list-instances --resource-group {rg} --name {vmss2}').get_output_in_json()
        self.kwargs['instance_ids'] = [x['instanceId'] for x in instance_list]
        self.kwargs['id'] = self.kwargs['instance_ids'][0]
        self.cmd('vmss simulate-eviction --resource-group {rg} --name {vmss2} --instance-id {id}')
        time.sleep(180)
        self.cmd('vmss get-instance-view --resource-group {rg} --name {vmss2} --instance-id {id}', checks=[
            self.check('length(statuses)', 2),
            self.check('statuses[0].code', 'ProvisioningState/succeeded'),
            self.check('statuses[1].code', 'PowerState/deallocated'),
        ])
    
        # simulate-eviction on a Spot VMSS with Delete policy, expect VMSS instance to be deleted
        self.cmd('vmss create --resource-group {rg} --name {vmss3} --location {loc} --instance-count 2 --image Centos --priority Spot --eviction-policy Delete --single-placement-group True')
        instance_list = self.cmd('vmss list-instances --resource-group {rg} --name {vmss3}').get_output_in_json()
        self.kwargs['instance_ids'] = [x['instanceId'] for x in instance_list]
        self.kwargs['id'] = self.kwargs['instance_ids'][0]
        self.cmd('vmss simulate-eviction --resource-group {rg} --name {vmss3} --instance-id {id}')
        time.sleep(180)
>       self.cmd('vmss list-instances --resource-group {rg} --name {vmss3}', checks=[self.check('length(@)', len(self.kwargs['instance_ids']) - 1)])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2898: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x0000019C2075A610>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C210D0160>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'length(@)' doesn't yield expected value '1', instead the actual value is '2'. Data: 
E               [
E                 {
E                   "additionalCapabilities": null,
E                   "availabilitySet": null,
E                   "diagnosticsProfile": null,
E                   "hardwareProfile": {
E                     "vmSize": null
E                   },
E                   "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-simulate-eviction3/virtualMachines/0",
E                   "instanceId": "0",
E                   "instanceView": null,
E                   "latestModelApplied": true,
E                   "licenseType": null,
E                   "location": "eastus",
E                   "modelDefinitionApplied": "VirtualMachineScaleSet",
E                   "name": "vmss-simulate-eviction3_0",
E                   "networkProfile": {
E                     "networkInterfaces": [
E                       {
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-simulate-eviction3/virtualMachines/0/networkInterfaces/vmsss88cfNic",
E                         "primary": null,
E                         "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                       }
E                     ]
E                   },
E                   "networkProfileConfiguration": {
E                     "networkInterfaceConfigurations": [
E                       {
E                         "dnsSettings": {
E                           "dnsServers": []
E                         },
E                         "enableAcceleratedNetworking": false,
E                         "enableIpForwarding": false,
E                         "id": null,
E                         "ipConfigurations": [
E                           {
E                             "applicationGatewayBackendAddressPools": null,
E                             "applicationSecurityGroups": null,
E                             "id": null,
E                             "loadBalancerBackendAddressPools": [
E                               {
E                                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/loadBalancers/vmss-simulate-eviction3LB/backendAddressPools/vmss-simulate-eviction3LBBEPool",
E                                 "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                               }
E                             ],
E                             "loadBalancerInboundNatPools": [
E                               {
E                                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/loadBalancers/vmss-simulate-eviction3LB/inboundNatPools/vmss-simulate-eviction3LBNatPool",
E                                 "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                               }
E                             ],
E                             "name": "vmsss88cfIPConfig",
E                             "primary": null,
E                             "privateIpAddressVersion": "IPv4",
E                             "publicIpAddressConfiguration": null,
E                             "subnet": {
E                               "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/virtualNetworks/vmss-simualte-eviction1VNET/subnets/vmss-simualte-eviction1Subnet",
E                               "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                             }
E                           }
E                         ],
E                         "name": "vmsss88cfNic",
E                         "networkSecurityGroup": null,
E                         "primary": true
E                       }
E                     ]
E                   },
E                   "osProfile": {
E                     "adminPassword": null,
E                     "adminUsername": "daetienn",
E                     "allowExtensionOperations": true,
E                     "computerName": "vmsss88cf000000",
E                     "customData": null,
E                     "linuxConfiguration": {
E                       "disablePasswordAuthentication": true,
E                       "patchSettings": {
E                         "patchMode": "ImageDefault"
E                       },
E                       "provisionVmAgent": true,
E                       "ssh": {
E                         "publicKeys": [
E                           {
E                             "keyData": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDI8aYs6Q0jHMi+ZA79hsoxoTxrbVwH/eZY+ZSifVvvKicm1/80fdqKNXgfNujlTiXYG7kCN+NhsgoEtARQtJnStvYv1HzD95rb0dSegff+GqUGgAdE+/oIEMu8/CRVLQWlPrOs2qUeRvElCmG8M+BTVC2sMFFblSrwHOx5sKLdWv4eOjncICD7w9Ktbi5FNC5RHElvlxei3vUOpfUfP4GIiy5CCXUPmO5AX+BO15JkMJsaNfmGMQ7LFzFbw6F+HG+Hi4hm+Kd3mNK7qyaz0T2iGBnA6maVB2zugbZtCuY9ZlfnWxDVF8V43mVY7MNLM1BqwskDNwzKiVgeUXLDYJux",
E                             "path": "/home/daetienn/.ssh/authorized_keys"
E                           }
E                         ]
E                       }
E                     },
E                     "requireGuestProvisionSignal": true,
E                     "secrets": [],
E                     "windowsConfiguration": null
E                   },
E                   "plan": null,
E                   "protectionPolicy": null,
E                   "provisioningState": "Deleting",
E                   "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf",
E                   "resources": null,
E                   "securityProfile": null,
E                   "sku": {
E                     "capacity": null,
E                     "name": "Standard_DS1_v2",
E                     "tier": "Standard"
E                   },
E                   "storageProfile": {
E                     "dataDisks": [],
E                     "imageReference": {
E                       "exactVersion": "7.5.201808150",
E                       "id": null,
E                       "offer": "CentOS",
E                       "publisher": "OpenLogic",
E                       "sku": "7.5",
E                       "version": "latest"
E                     },
E                     "osDisk": {
E                       "caching": "ReadWrite",
E                       "createOption": "FromImage",
E                       "diffDiskSettings": null,
E                       "diskSizeGb": 30,
E                       "encryptionSettings": null,
E                       "image": null,
E                       "managedDisk": {
E                         "diskEncryptionSet": null,
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/disks/vmss-simulate-evictivmss-simulate-evictioOS__1_4f63fb58b01340d38a1903dd0dfb894a",
E                         "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf",
E                         "storageAccountType": "Premium_LRS"
E                       },
E                       "name": "vmss-simulate-evictivmss-simulate-evictioOS__1_4f63fb58b01340d38a1903dd0dfb894a",
E                       "osType": "Linux",
E                       "vhd": null,
E                       "writeAcceleratorEnabled": null
E                     }
E                   },
E                   "tags": {},
E                   "type": "Microsoft.Compute/virtualMachineScaleSets/virtualMachines",
E                   "vmId": "fdcc55f6-aaba-4081-a2fd-8ca7051d0d7a",
E                   "zones": null
E                 },
E                 {
E                   "additionalCapabilities": null,
E                   "availabilitySet": null,
E                   "diagnosticsProfile": null,
E                   "hardwareProfile": {
E                     "vmSize": null
E                   },
E                   "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-simulate-eviction3/virtualMachines/1",
E                   "instanceId": "1",
E                   "instanceView": null,
E                   "latestModelApplied": true,
E                   "licenseType": null,
E                   "location": "eastus",
E                   "modelDefinitionApplied": "VirtualMachineScaleSet",
E                   "name": "vmss-simulate-eviction3_1",
E                   "networkProfile": {
E                     "networkInterfaces": [
E                       {
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-simulate-eviction3/virtualMachines/1/networkInterfaces/vmsss88cfNic",
E                         "primary": null,
E                         "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                       }
E                     ]
E                   },
E                   "networkProfileConfiguration": {
E                     "networkInterfaceConfigurations": [
E                       {
E                         "dnsSettings": {
E                           "dnsServers": []
E                         },
E                         "enableAcceleratedNetworking": false,
E                         "enableIpForwarding": false,
E                         "id": null,
E                         "ipConfigurations": [
E                           {
E                             "applicationGatewayBackendAddressPools": null,
E                             "applicationSecurityGroups": null,
E                             "id": null,
E                             "loadBalancerBackendAddressPools": [
E                               {
E                                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/loadBalancers/vmss-simulate-eviction3LB/backendAddressPools/vmss-simulate-eviction3LBBEPool",
E                                 "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                               }
E                             ],
E                             "loadBalancerInboundNatPools": [
E                               {
E                                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/loadBalancers/vmss-simulate-eviction3LB/inboundNatPools/vmss-simulate-eviction3LBNatPool",
E                                 "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                               }
E                             ],
E                             "name": "vmsss88cfIPConfig",
E                             "primary": null,
E                             "privateIpAddressVersion": "IPv4",
E                             "publicIpAddressConfiguration": null,
E                             "subnet": {
E                               "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Network/virtualNetworks/vmss-simualte-eviction1VNET/subnets/vmss-simualte-eviction1Subnet",
E                               "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf"
E                             }
E                           }
E                         ],
E                         "name": "vmsss88cfNic",
E                         "networkSecurityGroup": null,
E                         "primary": true
E                       }
E                     ]
E                   },
E                   "osProfile": {
E                     "adminPassword": null,
E                     "adminUsername": "daetienn",
E                     "allowExtensionOperations": true,
E                     "computerName": "vmsss88cf000001",
E                     "customData": null,
E                     "linuxConfiguration": {
E                       "disablePasswordAuthentication": true,
E                       "patchSettings": {
E                         "patchMode": "ImageDefault"
E                       },
E                       "provisionVmAgent": true,
E                       "ssh": {
E                         "publicKeys": [
E                           {
E                             "keyData": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDI8aYs6Q0jHMi+ZA79hsoxoTxrbVwH/eZY+ZSifVvvKicm1/80fdqKNXgfNujlTiXYG7kCN+NhsgoEtARQtJnStvYv1HzD95rb0dSegff+GqUGgAdE+/oIEMu8/CRVLQWlPrOs2qUeRvElCmG8M+BTVC2sMFFblSrwHOx5sKLdWv4eOjncICD7w9Ktbi5FNC5RHElvlxei3vUOpfUfP4GIiy5CCXUPmO5AX+BO15JkMJsaNfmGMQ7LFzFbw6F+HG+Hi4hm+Kd3mNK7qyaz0T2iGBnA6maVB2zugbZtCuY9ZlfnWxDVF8V43mVY7MNLM1BqwskDNwzKiVgeUXLDYJux",
E                             "path": "/home/daetienn/.ssh/authorized_keys"
E                           }
E                         ]
E                       }
E                     },
E                     "requireGuestProvisionSignal": true,
E                     "secrets": [],
E                     "windowsConfiguration": null
E                   },
E                   "plan": null,
E                   "protectionPolicy": null,
E                   "provisioningState": "Succeeded",
E                   "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf",
E                   "resources": null,
E                   "securityProfile": null,
E                   "sku": {
E                     "capacity": null,
E                     "name": "Standard_DS1_v2",
E                     "tier": "Standard"
E                   },
E                   "storageProfile": {
E                     "dataDisks": [],
E                     "imageReference": {
E                       "exactVersion": "7.5.201808150",
E                       "id": null,
E                       "offer": "CentOS",
E                       "publisher": "OpenLogic",
E                       "sku": "7.5",
E                       "version": "latest"
E                     },
E                     "osDisk": {
E                       "caching": "ReadWrite",
E                       "createOption": "FromImage",
E                       "diffDiskSettings": null,
E                       "diskSizeGb": 30,
E                       "encryptionSettings": null,
E                       "image": null,
E                       "managedDisk": {
E                         "diskEncryptionSet": null,
E                         "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf/providers/Microsoft.Compute/disks/vmss-simulate-evictivmss-simulate-evictioOS__1_7af5a4d878ef470791bea7447cf640e9",
E                         "resourceGroup": "cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf",
E                         "storageAccountType": "Premium_LRS"
E                       },
E                       "name": "vmss-simulate-evictivmss-simulate-evictioOS__1_7af5a4d878ef470791bea7447cf640e9",
E                       "osType": "Linux",
E                       "vhd": null,
E                       "writeAcceleratorEnabled": null
E                     }
E                   },
E                   "tags": {},
E                   "type": "Microsoft.Compute/virtualMachineScaleSets/virtualMachines",
E                   "vmId": "b2eacb31-4b89-4eac-8ead-bba56ed14801",
E                   "zones": null
E                 }
E               ]

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --tag product=azurecli cause=automation date=2020-12-18T15:11:15Z" => 0. 

Command "vmss create --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simualte-eviction1 --location eastus --instance-count 2 --image Centos --priority Regular" => 0. 

Command "vmss list-instances --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simualte-eviction1" => 0. 

Command "vmss simulate-eviction --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simualte-eviction1 --instance-id 0" => 1. 

Command "vmss create --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction2 --location eastus --instance-count 2 --image Centos --priority Spot --eviction-policy Deallocate --single-placement-group True" => 0. 

Command "vmss list-instances --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction2" => 0. 

Command "vmss simulate-eviction --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction2 --instance-id 1" => 0. 

Command "vmss get-instance-view --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction2 --instance-id 1" => 0. 

Command "vmss create --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction3 --location eastus --instance-count 2 --image Centos --priority Spot --eviction-policy Delete --single-placement-group True" => 0. 

Command "vmss list-instances --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction3" => 0. 

Command "vmss simulate-eviction --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction3 --instance-id 0" => 0. 

Command "vmss list-instances --resource-group cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --name vmss-simulate-eviction3" => 0. 

Command "az group delete --name cli_test_vmss_simulate_eviction2p7xuciwnivwl3xt4enqgsjypn7e3clduhbc5cmh6vcf --yes --no-wait" => 0. 

___________ VMSSCustomDataScenarioTest.test_vmss_create_custom_data ___________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C210E7730>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8C22B0>
command = 'vmss create -n vmss-custom-data -g cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey --imag...BEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n" --custom-data "#cloud-config\nhostname: myVMhostname"'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8C22B0>
args = ['vmss', 'create', '-n', 'vmss-custom-data', '-g', 'cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C2146F820>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8C22B0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSCustomDataScenarioTest testMethod=test_vmss_create_custom_data>

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_custom_data')
    def test_vmss_create_custom_data(self):
    
        self.kwargs.update({
            'vmss': 'vmss-custom-data',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
>       self.cmd('vmss create -n {vmss} -g {rg} --image Debian --admin-username deploy --ssh-key-value "{ssh_key}" --custom-data "#cloud-config\nhostname: myVMhostname"')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:2912: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-custom-data' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey/providers/Microsoft.Compute/virtualMachineScaleSets/vmss-custom-data' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey --tag product=azurecli cause=automation date=2020-12-18T15:23:40Z" => 0. 

Command "az group delete --name cli_test_vmss_create_custom_datacxbpsu5h5gojtlzvjjcbr7oyle6p2hey27dcawo3oey --yes --no-wait" => 0. 

_____________ ProximityPlacementGroupScenarioTest.test_ppg_update _____________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C21D0DA00>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2185B100>
command = "vmss create -g cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27 -n vmss1 --image debian --...7EZXd29DLgp+fRIg3edpKdO7ZErWhv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n'"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2185B100>
args = ['vmss', 'create', '-g', 'cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C014DBEE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2185B100>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.ProximityPlacementGroupScenarioTest testMethod=test_ppg_update>
resource_group = 'cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27'

    @ResourceGroupPreparer(name_prefix='cli_test_ppg_update_')
    def test_ppg_update(self, resource_group):
        self.kwargs.update({
            'ppg': 'ppg1',
            'vm': 'vm1',
            'vmss': 'vmss1',
            'avset': 'avset1',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.kwargs['ppg_id'] = self.cmd('ppg create -g {rg} -n {ppg} -t standard').get_output_in_json()['id']
    
>       self.cmd('vmss create -g {rg} -n {vmss} --image debian --admin-username debian --ssh-key-value \'{ssh_key}\'')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4039: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27 --tag product=azurecli cause=automation date=2020-12-18T15:23:46Z" => 0. 

Command "ppg create -g cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27 -n ppg1 -t standard" => 0. 

Command "az group delete --name cli_test_ppg_update_6ezzz3u35eapdflcyymdhztdxu4umxrljwt6flwpikrfniiy2xy7o27 --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.compute.v2020_06_01.models._models_py3.ProximityPlacementGroup'>
_____ ProximityPlacementGroupScenarioTest.test_ppg_with_related_resources _____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C2149CF70>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C219D5BB0>
command = "vm create -g cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd -n vm1 --image debian --admi...hv7d+3Kws+e1Y+ypmR2WIVSwVyBEUfgv2C8Ts9gnTF4pNcEY/S2aBicz5Ew2+jdyGNQQ== test@example.com\n' --ppg myppg --nsg-rule NONE"
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C219D5BB0>
args = ['vm', 'create', '-g', 'cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C21672D30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C219D5BB0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.ProximityPlacementGroupScenarioTest testMethod=test_ppg_with_related_resources>
resource_group = 'cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd'

    @ResourceGroupPreparer(name_prefix='cli_test_ppg_vm_vmss_')
    def test_ppg_with_related_resources(self, resource_group):
    
        self.kwargs.update({
            'ppg': 'myppg',
            'vm': 'vm1',
            'vmss': 'vmss1',
            'avset': 'avset1',
            'ssh_key': TEST_SSH_KEY_PUB
        })
    
        self.kwargs['ppg_id'] = self.cmd('ppg create -n {ppg} -t standard -g {rg}').get_output_in_json()['id']
    
>       self.kwargs['vm_id'] = self.cmd('vm create -g {rg} -n {vm} --image debian --admin-username debian --ssh-key-value \'{ssh_key}\' --ppg {ppg} --nsg-rule NONE').get_output_in_json()['id']

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4012: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd --tag product=azurecli cause=automation date=2020-12-18T15:23:54Z" => 0. 

Command "ppg create -n myppg -t standard -g cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd" => 0. 

Command "az group delete --name cli_test_ppg_vm_vmss_4e5fexvuvqxhlhoftt43fttxr5ia2pngq54cxnukb7fa453eazv7kd --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.compute.v2020_06_01.models._models_py3.ProximityPlacementGroup'>
_____ ProximityPlacementGroupScenarioTest.test_proximity_placement_group ______
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C21C57490>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C21B804F0>
command = 'ppg create -n my_ppg_2 -t ultra -g cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21B804F0>
args = ['ppg', 'create', '-n', 'my_ppg_2', '-t', 'ultra', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C21C5E4C0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21B804F0>
ex = HttpResponseError('(BadRequest) The subscription is not registered for private preview of Ultra Proximity Placement Groups.')

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError('(BadRequest) The subscription is not registered for private preview of Ultra Proximity Placement Groups.')
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.ProximityPlacementGroupScenarioTest testMethod=test_proximity_placement_group>
resource_group = 'cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix="cli_test_ppg_cmds_")
    def test_proximity_placement_group(self, resource_group, resource_group_location):
        self.kwargs.update({
            'ppg1': 'my_ppg_1',
            'ppg2': 'my_ppg_2',
            'ppg3': 'my_ppg_3',
            'loc': resource_group_location
        })
    
        # fails because not a valid type
        self.cmd('ppg create -n fail_ppg -g {rg} -t notAvalidType', expect_failure=True)
    
        self.cmd('ppg create -n {ppg1} -t StandarD -g {rg}', checks=[
            self.check('name', '{ppg1}'),
            self.check('location', '{loc}'),
            self.check('proximityPlacementGroupType', 'Standard')
        ])
    
        self.cmd('ppg show -g {rg} -n {ppg1} --include-colocation-status', checks=[
            self.check('name', '{ppg1}'),
            self.check('location', '{loc}'),
            self.check('proximityPlacementGroupType', 'Standard'),
            self.exists('colocationStatus')
        ])
    
>       self.cmd('ppg create -n {ppg2} -t ultra -g {rg}', checks=[
            self.check('name', '{ppg2}'),
            self.check('location', '{loc}'),
            self.check('proximityPlacementGroupType', 'Ultra')
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3988: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\vm\custom.py:3396: in create_proximity_placement_group
    return client.create_or_update(resource_group_name=resource_group_name,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.compute.v2020_06_01.operations._proximity_placement_groups_operations.ProximityPlacementGroupsOperations object at 0x0000019C21ED6A90>
resource_group_name = 'cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy'
proximity_placement_group_name = 'my_ppg_2'
parameters = <azure.mgmt.compute.v2020_06_01.models._models_py3.ProximityPlacementGroup object at 0x0000019C21EE7E80>
kwargs = {}, cls = None
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2020-06-01', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy/providers/Microsoft.Compute/proximityPlacementGroups/my_ppg_2'
path_format_arguments = {'proximityPlacementGroupName': 'my_ppg_2', 'resourceGroupName': 'cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy', 'subscriptionId': 'a1bfa635-f2bf-42f1-86b5-848c674fc321'}

    def create_or_update(
        self,
        resource_group_name,  # type: str
        proximity_placement_group_name,  # type: str
        parameters,  # type: "_models.ProximityPlacementGroup"
        **kwargs  # type: Any
    ):
        # type: (...) -> "_models.ProximityPlacementGroup"
        """Create or update a proximity placement group.
    
        :param resource_group_name: The name of the resource group.
        :type resource_group_name: str
        :param proximity_placement_group_name: The name of the proximity placement group.
        :type proximity_placement_group_name: str
        :param parameters: Parameters supplied to the Create Proximity Placement Group operation.
        :type parameters: ~azure.mgmt.compute.v2020_06_01.models.ProximityPlacementGroup
        :keyword callable cls: A custom type or function that will be passed the direct response
        :return: ProximityPlacementGroup, or the result of cls(response)
        :rtype: ~azure.mgmt.compute.v2020_06_01.models.ProximityPlacementGroup
        :raises: ~azure.core.exceptions.HttpResponseError
        """
        cls = kwargs.pop('cls', None)  # type: ClsType["_models.ProximityPlacementGroup"]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2020-06-01"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self.create_or_update.metadata['url']  # type: ignore
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'proximityPlacementGroupName': self._serialize.url("proximity_placement_group_name", proximity_placement_group_name, 'str'),
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str'),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(parameters, 'ProximityPlacementGroup')
        body_content_kwargs['content'] = body_content
        request = self._client.put(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200, 201]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (BadRequest) The subscription is not registered for private preview of Ultra Proximity Placement Groups.

env\lib\site-packages\azure\mgmt\compute\v2020_06_01\operations\_proximity_placement_groups_operations.py:105: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy --tag product=azurecli cause=automation date=2020-12-18T15:24:03Z" => 0. 

Command "ppg create -n fail_ppg -g cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy -t notAvalidType" => 1. 

Command "ppg create -n my_ppg_1 -t StandarD -g cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy" => 0. 

Command "ppg show -g cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy -n my_ppg_1 --include-colocation-status" => 0. 

Command "az group delete --name cli_test_ppg_cmds_7peu3edjxsamvkip3z6bjcsyr54zhqcrfg24rvbldgpyeedjizpdmgpjy --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.compute.v2020_06_01.models._models_py3.ProximityPlacementGroup'>
[33mWARNING [0m msrest.serialization:serialization.py:187 Readonly attribute name will be ignored in class <class 'azure.mgmt.compute.v2020_06_01.models._models_py3.ProximityPlacementGroup'>
____________________ VMSecretTest.test_vm_secret_e2e_test _____________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382B3EDA90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382A0C15E0>
command = 'vm create -g cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo -n vm1 --image rhel --generate-ssh-keys --admin-username rheladmin --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A0C15E0>
args = ['vm', 'create', '-g', 'cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382AEAAD30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A0C15E0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSecretTest testMethod=test_vm_secret_e2e_test>
resource_group = 'cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo'
resource_group_location = 'westus'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_secrets')
    def test_vm_secret_e2e_test(self, resource_group, resource_group_location):
        self.kwargs.update({
            'vm': 'vm1',
            'vault': self.create_random_name('vmsecretkv', 20),
            'cert': 'vm-secrt-cert',
            'loc': resource_group_location
        })
    
        vault_result = self.cmd('keyvault create -g {rg} -n {vault} -l {loc} --enabled-for-disk-encryption true --enabled-for-deployment true').get_output_in_json()
        self.kwargs['policy_path'] = os.path.join(TEST_DIR, 'keyvault', 'policy.json')
    
>       self.cmd('vm create -g {rg} -n {vm} --image rhel --generate-ssh-keys --admin-username rheladmin --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3701: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo --tag product=azurecli cause=automation date=2020-12-18T15:23:40Z" => 0. 

Command "keyvault create -g cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo -n vmsecretkvn3ok5xarxx -l westus --enabled-for-disk-encryption true --enabled-for-deployment true" => 0. 

Command "az group delete --name cli_test_vm_secrets4pub65sklvseoh62psvj4sbtys3jmfckbf3lr2chg4h46nvsf24zeodo --yes --no-wait" => 0. 

____________________ VMGalleryImage.test_specialized_image ____________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A59CAC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382B42B610>
command = 'vm create -g cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq -n vm1 --image ubuntults --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382B42B610>
args = ['vm', 'create', '-g', 'cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382ABBBDC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382B42B610>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMGalleryImage testMethod=test_specialized_image>
resource_group = 'cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq'

    @ResourceGroupPreparer(name_prefix='cli_test_test_specialized_image_')
    def test_specialized_image(self, resource_group):
        self.kwargs.update({
            'gallery': self.create_random_name(prefix='gallery_', length=20),
            'image': 'image1',
            'snapshot': 's1',
            'vm1': 'vm1',
            'vm2': 'vm2',
            'vm3': 'vm3',
            'vmss1': 'vmss1',
            'vmss2': 'vmss2'
        })
        self.cmd('sig create -g {rg} --gallery-name {gallery}')
        self.cmd('sig image-definition create -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --os-type linux --os-state specialized -p publisher1 -f offer1 -s sku1', checks=[
            self.check('osState', 'Specialized')
        ])
>       self.cmd('vm create -g {rg} -n {vm1} --image ubuntults --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3898: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq --tag product=azurecli cause=automation date=2020-12-18T15:24:19Z" => 0. 

Command "sig create -g cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq --gallery-name gallery_dge7ghwc4gsw" => 0. 

Command "sig image-definition create -g cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq --gallery-name gallery_dge7ghwc4gsw --gallery-image-definition image1 --os-type linux --os-state specialized -p publisher1 -f offer1 -s sku1" => 0. 

Command "az group delete --name cli_test_test_specialized_image_gblkvwova5y6gifeeyjqhtb4cawzniiqv567vwcj2pq --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 hyper_vgeneration is not a known attribute of class <class 'azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage'> and will be ignored
_______ VMPriorityEvictionBillingTest.test_vm_priority_eviction_billing _______
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382AB1FF40>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382B80B6D0>
command = 'vm create -g cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf -n vm1 --image UbuntuLTS --p...-max-price 50 --admin-username azureuser --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382B80B6D0>
args = ['vm', 'create', '-g', 'cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382AB0CF70>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382B80B6D0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMPriorityEvictionBillingTest testMethod=test_vm_priority_eviction_billing>
resource_group = 'cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_priority_eviction_billing_')
    def test_vm_priority_eviction_billing(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1',
            'vmss': 'vmss1'
        })
    
        # vm create
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --priority Low --eviction-policy Deallocate --max-price 50 --admin-username azureuser --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4252: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf --tag product=azurecli cause=automation date=2020-12-18T15:25:34Z" => 0. 

Argument '--max-price' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_vm_priority_eviction_billing_ji24oyeinrozcbe6zugpkeso3vy2yyom2vpvf --yes --no-wait" => 0. 

_______________ VMCreateSpecialName.test_vm_create_special_name _______________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382B913280>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382BEE2280>
command = 'vm create -g cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff -n vm_1 --image UbuntuLTS --admin-username azureuser --admin-password testPassword0 --authentication-type password --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382BEE2280>
args = ['vm', 'create', '-g', 'cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff', '-n', 'vm_1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382BAE6DC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382BEE2280>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateSpecialName testMethod=test_vm_create_special_name>
resource_group = 'cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_special_name_')
    def test_vm_create_special_name(self, resource_group):
        """
        Compose a valid computer name from VM name if computer name is not provided.
        Remove special characters: '`~!@#$%^&*()=+_[]{}\\|;:\'\",<>/?'
        """
        self.kwargs.update({
            'vm': 'vm_1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image UbuntuLTS --admin-username azureuser --admin-password testPassword0 --authentication-type password --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4295: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff/providers/Microsoft.Compute/virtualMachines/vm_1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff/providers/Microsoft.Compute/virtualMachines/vm_1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff --tag product=azurecli cause=automation date=2020-12-18T15:25:39Z" => 0. 

Command "az group delete --name cli_test_vm_create_special_name_z5q2uvlqpu5jgcaewrujnmcvw344sam2t27vuv2d2ff --yes --no-wait" => 0. 

_______________ DiskEncryptionSetTest.test_disk_encryption_set ________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382ADEDC70>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382AC4BA60>
command = 'vm create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n vm1-msatv7y53r7m5uzg --attach-os-disk disk-wzuiltspwymcgwv --os-type linux --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382AC4BA60>
args = ['vm', 'create', '-g', 'cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64', '-n', 'vm1-msatv7y53r7m5uzg', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x00000238288B6940>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382AC4BA60>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.DiskEncryptionSetTest testMethod=test_disk_encryption_set>
resource_group = 'cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64'

    @ResourceGroupPreparer(name_prefix='cli_test_disk_encryption_set_', location='westcentralus')
    @AllowLargeResponse(size_kb=99999)
    def test_disk_encryption_set(self, resource_group):
        self.kwargs.update({
            'vault': self.create_random_name(prefix='vault-', length=20),
            'key': self.create_random_name(prefix='key-', length=20),
            'des1': self.create_random_name(prefix='des1-', length=20),
            'des2': self.create_random_name(prefix='des2-', length=20),
            'des3': self.create_random_name(prefix='des3-', length=20),
            'disk': self.create_random_name(prefix='disk-', length=20),
            'vm1': self.create_random_name(prefix='vm1-', length=20),
            'vm2': self.create_random_name(prefix='vm2-', length=20),
            'vmss': self.create_random_name(prefix='vmss-', length=20),
        })
    
        vault_id = self.cmd('keyvault create -g {rg} -n {vault} --enable-purge-protection true --enable-soft-delete true').get_output_in_json()['id']
        kid = self.cmd('keyvault key create -n {key} --vault {vault} --protection software').get_output_in_json()['key']['kid']
        self.kwargs.update({
            'vault_id': vault_id,
            'kid': kid
        })
    
        self.cmd('disk-encryption-set create -g {rg} -n {des1} --key-url {kid} --source-vault {vault}')
        des1_show_output = self.cmd('disk-encryption-set show -g {rg} -n {des1}').get_output_in_json()
        des1_sp_id = des1_show_output['identity']['principalId']
        des1_id = des1_show_output['id']
        self.kwargs.update({
            'des1_sp_id': des1_sp_id,
            'des1_id': des1_id
        })
    
        self.cmd('disk-encryption-set create -g {rg} -n {des2} --key-url {kid} --source-vault {vault}')
        des2_show_output = self.cmd('disk-encryption-set show -g {rg} -n {des2}').get_output_in_json()
        des2_sp_id = des2_show_output['identity']['principalId']
        des2_id = des2_show_output['id']
        self.kwargs.update({
            'des2_sp_id': des2_sp_id,
            'des2_id': des2_id
        })
    
        self.cmd('disk-encryption-set create -g {rg} -n {des3} --key-url {kid} --source-vault {vault}')
        des3_show_output = self.cmd('disk-encryption-set show -g {rg} -n {des3}').get_output_in_json()
        des3_sp_id = des3_show_output['identity']['principalId']
        des3_id = des3_show_output['id']
        self.kwargs.update({
            'des3_sp_id': des3_sp_id,
            'des3_id': des3_id
        })
    
        self.cmd('keyvault set-policy -n {vault} --object-id {des1_sp_id} --key-permissions wrapKey unwrapKey get')
        self.cmd('keyvault set-policy -n {vault} --object-id {des2_sp_id} --key-permissions wrapKey unwrapKey get')
        self.cmd('keyvault set-policy -n {vault} --object-id {des3_sp_id} --key-permissions wrapKey unwrapKey get')
    
        time.sleep(15)
    
        with mock.patch('azure.cli.command_modules.role.custom._gen_guid', side_effect=self.create_guid):
            self.cmd('role assignment create --assignee {des1_sp_id} --role Reader --scope {vault_id}')
            self.cmd('role assignment create --assignee {des2_sp_id} --role Reader --scope {vault_id}')
            self.cmd('role assignment create --assignee {des3_sp_id} --role Reader --scope {vault_id}')
    
        time.sleep(15)
    
        self.kwargs.update({
            'des1_pattern': '.*/{}$'.format(self.kwargs['des1']),
            'des2_pattern': '.*/{}$'.format(self.kwargs['des2']),
            'des3_pattern': '.*/{}$'.format(self.kwargs['des3'])
        })
    
        self.cmd('disk create -g {rg} -n {disk} --encryption-type EncryptionAtRestWithCustomerKey --disk-encryption-set {des1} --size-gb 10', checks=[
            self.check_pattern('encryption.diskEncryptionSetId', self.kwargs['des1_pattern']),
            self.check('encryption.type', 'EncryptionAtRestWithCustomerKey')
        ])
>       self.cmd('vm create -g {rg} -n {vm1} --attach-os-disk {disk} --os-type linux --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4415: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64/providers/Microsoft.Compute/virtualMachines/vm1-msatv7y53r7m5uzg' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64/providers/Microsoft.Compute/virtualMachines/vm1-msatv7y53r7m5uzg' is currently not available in location 'westcentralus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westcentralus --name cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 --tag product=azurecli cause=automation date=2020-12-18T15:25:45Z" => 0. 

Argument 'enable_soft_delete' has been deprecated and will be removed in a future release.
Command "keyvault create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n vault-z6oz43iw2lzbvv --enable-purge-protection true --enable-soft-delete true" => 0. 

Command "keyvault key create -n key-podhofr6zrusagju --vault vault-z6oz43iw2lzbvv --protection software" => 0. 

Command "disk-encryption-set create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des1-ezvkcn7u2bzycj4 --key-url https://vault-z6oz43iw2lzbvv.vault.azure.net/keys/key-podhofr6zrusagju/c0d41c78b5a944b88459eb0419b14977 --source-vault vault-z6oz43iw2lzbvv" => 0. 

Command "disk-encryption-set show -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des1-ezvkcn7u2bzycj4" => 0. 

Command "disk-encryption-set create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des2-7nztlrlrhgqqd3y --key-url https://vault-z6oz43iw2lzbvv.vault.azure.net/keys/key-podhofr6zrusagju/c0d41c78b5a944b88459eb0419b14977 --source-vault vault-z6oz43iw2lzbvv" => 0. 

Command "disk-encryption-set show -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des2-7nztlrlrhgqqd3y" => 0. 

Command "disk-encryption-set create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des3-de3rfnkn2cryhfi --key-url https://vault-z6oz43iw2lzbvv.vault.azure.net/keys/key-podhofr6zrusagju/c0d41c78b5a944b88459eb0419b14977 --source-vault vault-z6oz43iw2lzbvv" => 0. 

Command "disk-encryption-set show -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n des3-de3rfnkn2cryhfi" => 0. 

Command "keyvault set-policy -n vault-z6oz43iw2lzbvv --object-id b9e1722c-dd72-4c29-a99f-2f7fedb8d81e --key-permissions wrapKey unwrapKey get" => 0. 

Command "keyvault set-policy -n vault-z6oz43iw2lzbvv --object-id 475b8ed2-99e4-4e8e-85a1-85f6bfa4c973 --key-permissions wrapKey unwrapKey get" => 0. 

Command "keyvault set-policy -n vault-z6oz43iw2lzbvv --object-id 93e534c9-8d47-4864-86a9-64173ac959eb --key-permissions wrapKey unwrapKey get" => 0. 

Command "role assignment create --assignee b9e1722c-dd72-4c29-a99f-2f7fedb8d81e --role Reader --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64/providers/Microsoft.KeyVault/vaults/vault-z6oz43iw2lzbvv" => 0. 

Command "role assignment create --assignee 475b8ed2-99e4-4e8e-85a1-85f6bfa4c973 --role Reader --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64/providers/Microsoft.KeyVault/vaults/vault-z6oz43iw2lzbvv" => 0. 

Command "role assignment create --assignee 93e534c9-8d47-4864-86a9-64173ac959eb --role Reader --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64/providers/Microsoft.KeyVault/vaults/vault-z6oz43iw2lzbvv" => 0. 

Command "disk create -g cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 -n disk-wzuiltspwymcgwv --encryption-type EncryptionAtRestWithCustomerKey --disk-encryption-set des1-ezvkcn7u2bzycj4 --size-gb 10" => 0. 

Command "az group delete --name cli_test_disk_encryption_set_bkut6lgpv3cnzm4ib66x5mrst6v6gqiubakfugog5nsr64 --yes --no-wait" => 0. 

______________ DedicatedHostScenarioTest.test_dedicated_host_e2e ______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C221FD3D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8E9A90>
command = 'vm create -g cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u -n vm2 --image centos --host-group my-host-group --size Standard_D4s_v3 --nsg-rule NONE --generate-ssh-keys --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8E9A90>
args = ['vm', 'create', '-g', 'cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u', '-n', 'vm2', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C217081F0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C1C8E9A90>
ex = CLIError(CLIError('Deployment failed. Correlation ID: 50e9a338-ba09-4750-9c1f-0d086a734f98. {\r\n  "error": {\r\n    "...r",\r\n    "message": "The value of parameter hostGroup.Id is invalid.",\r\n    "target": "hostGroup.Id"\r\n  }\r\n}'))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CLIError('Deployment failed. Correlation ID: 50e9a338-ba09-4750-9c1f-0d086a734f98. {\r\n  "error": {\r\n    "...r",\r\n    "message": "The value of parameter hostGroup.Id is invalid.",\r\n    "target": "hostGroup.Id"\r\n  }\r\n}'))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.DedicatedHostScenarioTest testMethod=test_dedicated_host_e2e>
resource_group = 'cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u'
resource_group_location = 'centraluseuap'

    @ResourceGroupPreparer(name_prefix='cli_test_dedicated_host_', location='westeurope')
    @ResourceGroupPreparer(name_prefix='cli_test_dedicated_host2_', location='centraluseuap', key='rg2')
    def test_dedicated_host_e2e(self, resource_group, resource_group_location):
        self.kwargs.update({
            'host-group': 'my-host-group',
            'host-name': 'my-host',
            'vm-name': 'ded-host-vm'
        })
    
        # create resources
        self.cmd('vm host group create -n {host-group} -c 3 -g {rg} --tags "foo=bar"', checks=[
            self.check('name', '{host-group}'),
            self.check('platformFaultDomainCount', 3),
            self.check('tags.foo', 'bar')
        ])
    
        try:
            self.cmd('vm host create -n {host-name} --host-group {host-group} -d 2 -g {rg} '
                     '--sku DSv3-Type1 --auto-replace false --tags "bar=baz" ', checks=[
                         self.check('name', '{host-name}'),
                         self.check('platformFaultDomain', 2),
                         self.check('sku.name', 'DSv3-Type1'),
                         self.check('autoReplaceOnFailure', False),
                         self.check('tags.bar', 'baz')
                     ])
    
        except CLIError as e:
            if 'capacity' in str(e):
                return
    
        result = self.cmd('vm host get-instance-view --host-group {host-group} --name {host-name} -g {rg}', checks=[
            self.check('name', '{host-name}'),
        ]).get_output_in_json()
        instance_view = result["instanceView"]
        self.assertTrue(instance_view["assetId"])
        self.assertTrue(instance_view["availableCapacity"])
    
        self.cmd('vm host group get-instance-view -g {rg} -n {host-group}', checks=[
            self.exists('instanceView')
        ])
    
        host_id = self.cmd('vm host show -g {rg} -n {host-name} --host-group {host-group}').get_output_in_json()['id']
        self.kwargs.update({
            'host_id': host_id
        })
    
        self.cmd('vm create -n {vm-name} --image debian -g {rg} --size Standard_D4s_v3 '
                 '--host {host_id} --generate-ssh-keys --admin-username azureuser --nsg-rule NONE')
    
        # validate resources created successfully
        vm_json = self.cmd('vm show -n {vm-name} -g {rg}', checks=[
            self.check('name', '{vm-name}'),
            self.check('provisioningState', 'Succeeded')
        ]).get_output_in_json()
    
        host_json = self.cmd('vm host show --name {host-name} --host-group {host-group} -g {rg}', checks=[
            self.check('name', '{host-name}'),
        ]).get_output_in_json()
    
        host_group_json = self.cmd('vm host group show --name {host-group} -g {rg}', checks=[
            self.check('name', '{host-group}'),
        ]).get_output_in_json()
    
        self.assertTrue(vm_json['host']['id'].lower(), host_json['id'].lower())
        self.assertTrue(host_json['virtualMachines'][0]['id'].lower(), vm_json['id'].lower())
        self.assertTrue(host_group_json['hosts'][0]['id'].lower(), host_json['id'].lower())
    
        # delete resources (test vm host delete commands)
        self.cmd('vm delete --name {vm-name} -g {rg} --yes')
        time.sleep(30)
        self.cmd('vm host delete --name {host-name} --host-group {host-group} -g {rg} --yes')
        # Service has problem. It is not deleted yet but it returns.
        time.sleep(30)
        self.cmd('vm host group delete --name {host-group} -g {rg} --yes')
    
        # Test --automatic-placement
        self.cmd('vm host group create -n {host-group} -c 1 -g {rg2} --automatic-placement', checks=[
            self.check('supportAutomaticPlacement', True),
        ])
        host_id = self.cmd('vm host create -n {host-name} --host-group {host-group} -d 0 -g {rg2} --sku DSv3-Type1').get_output_in_json()['id']
        self.kwargs.update({
            'host_id': host_id
        })
        self.cmd('vm create -g {rg2} -n vm1 --image centos --host {host_id} --size Standard_D4s_v3 --nsg-rule NONE --generate-ssh-keys --admin-username azureuser')
>       self.cmd('vm create -g {rg2} -n vm2 --image centos --host-group {host-group} --size Standard_D4s_v3 --nsg-rule NONE --generate-ssh-keys --admin-username azureuser')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4174: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError('Deployment failed. Correlation ID: 50e9a338-ba09-4750-9c1f-0d086a734f98. {\r\n  "error": {\r\n    "code": "I...er",\r\n    "message": "The value of parameter hostGroup.Id is invalid.",\r\n    "target": "hostGroup.Id"\r\n  }\r\n}')

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Deployment failed. Correlation ID: 50e9a338-ba09-4750-9c1f-0d086a734f98. {
E             "error": {
E               "code": "InvalidParameter",
E               "message": "The value of parameter hostGroup.Id is invalid.",
E               "target": "hostGroup.Id"
E             }
E           }

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westeurope --name cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --tag product=azurecli cause=automation date=2020-12-18T15:24:16Z" => 0. 

Command "az group create --location centraluseuap --name cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u --tag product=azurecli cause=automation date=2020-12-18T15:24:18Z" => 0. 

Command "vm host group create -n my-host-group -c 3 -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --tags "foo=bar"" => 0. 

Command "vm host create -n my-host --host-group my-host-group -d 2 -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --sku DSv3-Type1 --auto-replace false --tags "bar=baz" " => 0. 

Command "vm host get-instance-view --host-group my-host-group --name my-host -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi" => 0. 

Command "vm host group get-instance-view -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi -n my-host-group" => 0. 

Command "vm host show -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi -n my-host --host-group my-host-group" => 0. 

Argument '--host' is in preview. It may be changed/removed in a future release.
Command "vm create -n ded-host-vm --image debian -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --size Standard_D4s_v3 --host /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi/providers/Microsoft.Compute/hostGroups/my-host-group/hosts/my-host --generate-ssh-keys --admin-username azureuser --nsg-rule NONE" => 0. 

Command "vm show -n ded-host-vm -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi" => 0. 

Command "vm host show --name my-host --host-group my-host-group -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi" => 0. 

Command "vm host group show --name my-host-group -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi" => 0. 

Command "vm delete --name ded-host-vm -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --yes" => 0. 

Command "vm host delete --name my-host --host-group my-host-group -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --yes" => 0. 

Command "vm host group delete --name my-host-group -g cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --yes" => 0. 

Command "vm host group create -n my-host-group -c 1 -g cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u --automatic-placement" => 0. 

Command "vm host create -n my-host --host-group my-host-group -d 0 -g cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u --sku DSv3-Type1" => 0. 

Argument '--host' is in preview. It may be changed/removed in a future release.
Command "vm create -g cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u -n vm1 --image centos --host /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u/providers/Microsoft.Compute/hostGroups/my-host-group/hosts/my-host --size Standard_D4s_v3 --nsg-rule NONE --generate-ssh-keys --admin-username azureuser" => 0. 

Argument '--host-group' is in preview. It may be changed/removed in a future release.
Command "az group delete --name cli_test_dedicated_host2_lea5bz2dzmea4n2buyvmsuxxoembaudkcxdhokv7phfr3wuz4u --yes --no-wait" => 0. 

Command "az group delete --name cli_test_dedicated_host_dys5hpyun4cwybdrehdnqup4xpb7v6crrpt6jb54pffqmt6bnpi --yes --no-wait" => 0. 

___ VMSSTerminateNotificationScenarioTest.test_vmss_terminate_notification ____
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C21390DC0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2208D4C0>
command = 'vmss create -g cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak -n vmss1 --image UbuntuLTS --terminate-notification-time 5 --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2208D4C0>
args = ['vmss', 'create', '-g', 'cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C2072CE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2208D4C0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSTerminateNotificationScenarioTest testMethod=test_vmss_terminate_notification>
resource_group = 'cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_terminate_notification_')
    def test_vmss_terminate_notification(self, resource_group):
        update_enable_key = 'virtualMachineProfile.scheduledEventsProfile.terminateNotificationProfile.enable'
        update_not_before_timeout_key = 'virtualMachineProfile.scheduledEventsProfile.terminateNotificationProfile.notBeforeTimeout'
        create_enable_key = 'vmss.' + update_enable_key
        create_not_before_timeout_key = 'vmss.' + update_not_before_timeout_key
    
        self.kwargs.update({
            'vmss1': 'vmss1',
            'vmss2': 'vmss2'
        })
    
        # Create, enable terminate notification
>       self.cmd('vmss create -g {rg} -n {vmss1} --image UbuntuLTS --terminate-notification-time 5 --admin-username azureuser',
                 checks=[
                     self.check(create_enable_key, True),
                     self.check(create_not_before_timeout_key, 'PT5M')
                 ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4202: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak --tag product=azurecli cause=automation date=2020-12-18T15:32:25Z" => 0. 

Command "az group delete --name cli_test_vmss_terminate_notification_qc52ywaw2kjsndgn7vzwyhdqbvun3drrv3g2ak --yes --no-wait" => 0. 

_______________________ DiskAccessTest.test_disk_access _______________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.DiskAccessTest testMethod=test_disk_access>
resource_group = 'cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp'

    @ResourceGroupPreparer(name_prefix='cli_test_disk_access_', location='centraluseuap')
    def test_disk_access(self, resource_group):
        self.kwargs.update({
            'loc': 'centraluseuap',
            'diskaccess': 'mydiskaccess',
            'disk': 'mydisk',
            'snapshot': 'mysnapshot'
        })
    
        self.cmd('disk-access create -g {rg} -l {loc} -n {diskaccess}')
        self.cmd('disk-access list -g {rg}', checks=[
            self.check('length(@)', 1),
            self.check('[0].name', '{diskaccess}'),
            self.check('[0].location', '{loc}')
        ])
    
        self.cmd('disk-access update -g {rg} -n {diskaccess} --tags tag1=val1')
        disk_access_output = self.cmd('disk-access show -g {rg} -n {diskaccess}', checks=[
            self.check('name', '{diskaccess}'),
            self.check('location', '{loc}'),
            self.check('tags.tag1', 'val1')
        ]).get_output_in_json()
        disk_access_id = disk_access_output['id']
    
        self.cmd('disk create -g {rg} -n {disk} --size-gb 10 --network-access-policy AllowPrivate --disk-access {diskaccess}')
>       self.cmd('disk show -g {rg} -n {disk}', checks=[
            self.check('name', '{disk}'),
            self.check('diskAccessId', disk_access_id),
            self.check('networkAccessPolicy', 'AllowPrivate')
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4660: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x0000019C2229CCD0>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C219BC130>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'diskAccessId' doesn't yield expected value '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp/providers/Microsoft.Compute/diskAccesses/mydiskaccess', instead the actual value is '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/CLI_TEST_DISK_ACCESS_UN6ED44YHYOHIOSFK7AVIDOQIYLKR5FCDCH3RFZ24H3VDSTBG56UXP/providers/Microsoft.Compute/diskAccesses/mydiskaccess'. Data: 
E               {
E                 "creationData": {
E                   "createOption": "Empty",
E                   "galleryImageReference": null,
E                   "imageReference": null,
E                   "logicalSectorSize": null,
E                   "sourceResourceId": null,
E                   "sourceUniqueId": null,
E                   "sourceUri": null,
E                   "storageAccountId": null,
E                   "uploadSizeBytes": null
E                 },
E                 "diskAccessId": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/CLI_TEST_DISK_ACCESS_UN6ED44YHYOHIOSFK7AVIDOQIYLKR5FCDCH3RFZ24H3VDSTBG56UXP/providers/Microsoft.Compute/diskAccesses/mydiskaccess",
E                 "diskIopsReadOnly": null,
E                 "diskIopsReadWrite": 120,
E                 "diskMBpsReadOnly": null,
E                 "diskMBpsReadWrite": 25,
E                 "diskSizeBytes": 10737418240,
E                 "diskSizeGb": 10,
E                 "diskState": "Unattached",
E                 "encryption": {
E                   "diskEncryptionSetId": null,
E                   "type": "EncryptionAtRestWithPlatformKey"
E                 },
E                 "encryptionSettingsCollection": null,
E                 "hyperVGeneration": null,
E                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp/providers/Microsoft.Compute/disks/mydisk",
E                 "location": "centraluseuap",
E                 "managedBy": null,
E                 "managedByExtended": null,
E                 "maxShares": null,
E                 "name": "mydisk",
E                 "networkAccessPolicy": "AllowPrivate",
E                 "osType": null,
E                 "provisioningState": "Succeeded",
E                 "resourceGroup": "cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp",
E                 "shareInfo": null,
E                 "sku": {
E                   "name": "Premium_LRS",
E                   "tier": "Premium"
E                 },
E                 "tags": {},
E                 "tier": "P3",
E                 "timeCreated": "2020-12-18T15:33:38.897048+00:00",
E                 "type": "Microsoft.Compute/disks",
E                 "uniqueId": "592912dd-7c54-4f10-b3e1-ae878f069d47",
E                 "zones": null
E               }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location centraluseuap --name cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp --tag product=azurecli cause=automation date=2020-12-18T15:32:30Z" => 0. 

Command "disk-access create -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp -l centraluseuap -n mydiskaccess" => 0. 

Command "disk-access list -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp" => 0. 

Command "disk-access update -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp -n mydiskaccess --tags tag1=val1" => 0. 

Command "disk-access show -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp -n mydiskaccess" => 0. 

Command "disk create -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp -n mydisk --size-gb 10 --network-access-policy AllowPrivate --disk-access mydiskaccess" => 0. 

Command "disk show -g cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp -n mydisk" => 0. 

Command "az group delete --name cli_test_disk_access_un6ed44yhyohiosfk7avidoqiylkr5fcdch3rfz24h3vdstbg56uxp --yes --no-wait" => 0. 

_ VMSSAutomaticRepairsScenarioTest.test_vmss_update_automatic_repairs_with_health_extension _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C22C41E20>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C22AF2460>
command = 'vmss create -g cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu -n vmss1 --image UbuntuLTS --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C22AF2460>
args = ['vmss', 'create', '-g', 'cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C22EAA3A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C22AF2460>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSAutomaticRepairsScenarioTest testMethod=test_vmss_update_automatic_repairs_with_health_extension>
resource_group = 'cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_update_automatic_repairs_with_health_extension_')
    def test_vmss_update_automatic_repairs_with_health_extension(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1'
        })
    
        # Prepare vmss
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username azureuser')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4824: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu --tag product=azurecli cause=automation date=2020-12-18T15:37:32Z" => 0. 

Command "az group delete --name cli_test_vmss_update_automatic_repairs_with_health_extension_3liu34udx6x6cu --yes --no-wait" => 0. 

___________________ VMCreateNSGRule.test_vm_create_nsg_rule ___________________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C22960B80>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C22720CD0>
command = 'vm create -g cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5 -n vm1 --image centos --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C22720CD0>
args = ['vm', 'create', '-g', 'cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C22DFD8B0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C22720CD0>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMCreateNSGRule testMethod=test_vm_create_nsg_rule>
resource_group = 'cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_create_nsg_rule_')
    def test_vm_create_nsg_rule(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image centos --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4863: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5 --tag product=azurecli cause=automation date=2020-12-18T15:37:39Z" => 0. 

Command "az group delete --name cli_test_vm_create_nsg_rule_34yev6efbsxdifkyqjqrjs765rccwrm34e5tdwz56zbwsx5 --yes --no-wait" => 0. 

_ VMSSAutomaticRepairsScenarioTest.test_vmss_create_automatic_repairs_with_health_probe _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382CD0C6A0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382C3C7250>
command = 'vmss create -g cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs -n vmss1 --image UbuntuLTS --load-balancer lb1 --health-probe probe --automatic-repairs-grace-period 30 --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382C3C7250>
args = ['vmss', 'create', '-g', 'cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382C4C9A60>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382C3C7250>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSAutomaticRepairsScenarioTest testMethod=test_vmss_create_automatic_repairs_with_health_probe>
resource_group = 'cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_create_automatic_repairs_with_health_probe_')
    def test_vmss_create_automatic_repairs_with_health_probe(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'lb': 'lb1',
            'probe': 'probe',
            'lbrule': 'lbrule'
        })
    
        # Test raise error if not provide health probe or load balance
        with self.assertRaises(CLIError):
            self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --automatic-repairs-grace-period 30 --admin-username azureuser')
        with self.assertRaises(CLIError):
            self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --load-balancer {lb} --automatic-repairs-grace-period 30 --admin-username azureuser')
        with self.assertRaises(CLIError):
            self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --health-probe {probe} --automatic-repairs-grace-period 30 --admin-username azureuser')
    
        # Prepare health probe
        self.cmd('network lb create -g {rg} -n {lb}')
        self.cmd('network lb probe create -g {rg} --lb-name {lb} -n {probe} --protocol Tcp --port 80')
        self.cmd('network lb rule create -g {rg} --lb-name {lb} -n {lbrule} --probe-name {probe} --protocol Tcp --frontend-port 80 --backend-port 80')
        # Test enable automatic repairs with a health probe when create vmss
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --load-balancer {lb} --health-probe {probe} --automatic-repairs-grace-period 30 --admin-username azureuser',
                 checks=[
                     self.check('vmss.automaticRepairsPolicy.enabled', True),
                     self.check('vmss.automaticRepairsPolicy.gracePeriod', 'PT30M')
                 ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4770: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs --tag product=azurecli cause=automation date=2020-12-18T15:37:05Z" => 0. 

Command "network lb create -g cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs -n lb1" => 0. 

Command "network lb probe create -g cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs --lb-name lb1 -n probe --protocol Tcp --port 80" => 0. 

Command "network lb rule create -g cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs --lb-name lb1 -n lbrule --probe-name probe --protocol Tcp --frontend-port 80 --backend-port 80" => 0. 

No inbound nat pool was configured on 'lb1'
Command "az group delete --name cli_test_vmss_create_automatic_repairs_with_health_probe_qury5rcj54xulpepzs --yes --no-wait" => 0. 

_ VMSSAutomaticRepairsScenarioTest.test_vmss_update_automatic_repairs_with_health_probe _
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382CED2C10>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382D370880>
command = 'vmss create -g cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn -n vmss1 --image UbuntuLTS --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382D370880>
args = ['vmss', 'create', '-g', 'cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382CF0FDC0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382D370880>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSAutomaticRepairsScenarioTest testMethod=test_vmss_update_automatic_repairs_with_health_probe>
resource_group = 'cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_update_automatic_repairs_with_health_probe_')
    def test_vmss_update_automatic_repairs_with_health_probe(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'probe': 'probe',
            'lbrule': 'lbrule'
        })
    
        # Prepare vmss
>       self.cmd('vmss create -g {rg} -n {vmss} --image UbuntuLTS --admin-username azureuser')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4785: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn --tag product=azurecli cause=automation date=2020-12-18T15:38:53Z" => 0. 

Command "az group delete --name cli_test_vmss_update_automatic_repairs_with_health_probe_zajjpxzam62gnihqpn --yes --no-wait" => 0. 

________________ VMAutoUpdateScenarioTest.test_vm_auto_update _________________
[gw0] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000002382A49A340>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000002382A2E6970>
command = 'vm create -g cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee -n vm1 --image Win2019Datace...nable-auto-update --patch-mode AutomaticByOS --admin-username azureuser --admin-password testPassword0 --nsg-rule NONE'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A2E6970>
args = ['vm', 'create', '-g', 'cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000002382CCF8EE0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000002382A2E6970>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMAutoUpdateScenarioTest testMethod=test_vm_auto_update>
resource_group = 'cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_auto_update_')
    def test_vm_auto_update(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1'
        })
    
>       self.cmd('vm create -g {rg} -n {vm} --image Win2019Datacenter --enable-agent --enable-auto-update --patch-mode AutomaticByOS --admin-username azureuser --admin-password testPassword0 --nsg-rule NONE')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4983: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee --tag product=azurecli cause=automation date=2020-12-18T15:39:00Z" => 0. 

Command "az group delete --name cli_test_vm_auto_update_t5ofxovxqivfstxdzcdzvcdompokhztm2ktmchgv3sp3zj57cee --yes --no-wait" => 0. 

_ VMSSSetOrchestrationServiceStateScenarioTest.test_vmss_set_orchestration_service_state _
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C221E3B20>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C21B4B910>
command = 'vmss create -g cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud -n vmss1 --image UbuntuLTS --load-balancer lb1 --health-probe probe --automatic-repairs-grace-period 30 --admin-username azureuser'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21B4B910>
args = ['vmss', 'create', '-g', 'cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud', '-n', 'vmss1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C22FA3790>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C21B4B910>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMSSSetOrchestrationServiceStateScenarioTest testMethod=test_vmss_set_orchestration_service_state>
resource_group = 'cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud'

    @ResourceGroupPreparer(name_prefix='cli_test_vmss_set_orchestration_service_state_')
    def test_vmss_set_orchestration_service_state(self, resource_group):
        self.kwargs.update({
            'vmss': 'vmss1',
            'lb': 'lb1',
            'probe': 'probe',
            'lbrule': 'lbrule',
            'service_name': 'AutomaticRepairs'
        })
    
        # Prepare health probe
        self.cmd('network lb create -g {rg} -n {lb}')
        self.cmd('network lb probe create -g {rg} --lb-name {lb} -n {probe} --protocol Tcp --port 80')
        self.cmd(
            'network lb rule create -g {rg} --lb-name {lb} -n {lbrule} --probe-name {probe} --protocol Tcp --frontend-port 80 --backend-port 80')
>       self.cmd(
            'vmss create -g {rg} -n {vmss} --image UbuntuLTS --load-balancer {lb} --health-probe {probe} --automatic-repairs-grace-period 30 --admin-username azureuser',
            checks=[
                self.check('vmss.automaticRepairsPolicy.enabled', True),
                self.check('vmss.automaticRepairsPolicy.gracePeriod', 'PT30M')
            ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4886: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud --tag product=azurecli cause=automation date=2020-12-18T15:37:44Z" => 0. 

Command "network lb create -g cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud -n lb1" => 0. 

Command "network lb probe create -g cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud --lb-name lb1 -n probe --protocol Tcp --port 80" => 0. 

Command "network lb rule create -g cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud --lb-name lb1 -n lbrule --probe-name probe --protocol Tcp --frontend-port 80 --backend-port 80" => 0. 

No inbound nat pool was configured on 'lb1'
Command "az group delete --name cli_test_vmss_set_orchestration_service_state_4vyut3iy63ic4zkxwirqe5w2gv6ud --yes --no-wait" => 0. 

______________ VMAutoShutdownScenarioTest.test_vm_auto_shutdown _______________
[gw1] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000019C21FC6160>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000019C2260D850>
command = 'vm create -g cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg -n vm1 --image centos --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2260D850>
args = ['vm', 'create', '-g', 'cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg', '-n', 'vm1', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000019C21EAFE50>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000019C2260D850>
ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CLIError(CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-4...ry another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'."))
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CLIError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMAutoShutdownScenarioTest testMethod=test_vm_auto_shutdown>
resource_group = 'cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg'

    @ResourceGroupPreparer(name_prefix='cli_test_vm_auto_shutdown')
    def test_vm_auto_shutdown(self, resource_group):
        self.kwargs.update({
            'vm': 'vm1'
        })
>       self.cmd('vm create -g {rg} -n {vm} --image centos --nsg-rule NONE --admin-username azureuser --admin-password testPassword0 --authentication-type password')

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:4907: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:709: in _run_job
    return cmd_copy.exception_handler(ex)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-...try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.")

    def handle_template_based_exception(ex):
        try:
            raise CLIError(ex.inner_exception.error.message)
        except AttributeError:
>           raise CLIError(ex)
E           knack.util.CLIError: Azure Error: InvalidTemplateDeployment
E           Message: The template deployment failed with error: 'The resource with id: '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg/providers/Microsoft.Compute/virtualMachines/vm1' failed validation with message: 'The requested size for resource '/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg/providers/Microsoft.Compute/virtualMachines/vm1' is currently not available in location 'westus' zones '' for subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321'. Please try another size or deploy to a different location or zones. See https://aka.ms/azureskunotavailable for details.'.'.

src\azure-cli-core\azure\cli\core\commands\arm.py:105: CLIError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location westus --name cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg --tag product=azurecli cause=automation date=2020-12-18T15:39:29Z" => 0. 

Command "az group delete --name cli_test_vm_auto_shutdowny4tejby74xxpbidgna7ntmh7rui3uwwskezl5qyntwleqpfyvg --yes --no-wait" => 0. 

_______________________ VMGalleryImage.test_gallery_e2e _______________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94C0BB9D0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x000001C94BF39610>
command = 'sig image-version create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-nam...--target-region-encryption des1-5srs4bylixfii42,0,des1-5srs4bylixfii42 --managed-image managedImage1 --replica-count 1'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94BF39610>
args = ['sig', 'image-version', 'create', '-g', 'clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci', '--gallery-name', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x000001C94BEB4D30>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x000001C94BF39610>
ex = HttpResponseError("(InvalidParameter) The subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321' is not registered for the feature 'Microsoft.Compute/SIGEncryption'. Please register the subscription before retrying the call.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = HttpResponseError("(InvalidParameter) The subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321' is not registered for the feature 'Microsoft.Compute/SIGEncryption'. Please register the subscription before retrying the call.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception HttpResponseError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMGalleryImage testMethod=test_gallery_e2e>
resource_group = 'clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci'
resource_group_location = 'eastus2'

    @ResourceGroupPreparer(location='eastus2')
    def test_gallery_e2e(self, resource_group, resource_group_location):
        self.kwargs.update({
            'vm': 'vm1',
            'vm2': 'vmFromImage',
            'gallery': self.create_random_name(prefix='gallery_', length=20),
            'image': 'image1',
            'version': '1.1.2',
            'version2': '1.1.3',
            'captured': 'managedImage1',
            'image_id': 'TBD',
            'location': resource_group_location,
            'location2': 'westus2',
            'vault': self.create_random_name(prefix='vault-', length=20),
            'key': self.create_random_name(prefix='key-', length=20),
            'des1': self.create_random_name(prefix='des1-', length=20),
        })
    
        self.cmd('sig create -g {rg} --gallery-name {gallery}', checks=self.check('name', self.kwargs['gallery']))
        self.cmd('sig list -g {rg}', checks=self.check('length(@)', 1))
        self.cmd('sig show -g {rg} --gallery-name {gallery}', checks=self.check('name', self.kwargs['gallery']))
        self.cmd('sig image-definition create -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --os-type linux -p publisher1 -f offer1 -s sku1',
                 checks=self.check('name', self.kwargs['image']))
        self.cmd('sig image-definition list -g {rg} --gallery-name {gallery}', checks=self.check('length(@)', 1))
        res = self.cmd('sig image-definition show -g {rg} --gallery-name {gallery} --gallery-image-definition {image}',
                       checks=self.check('name', self.kwargs['image'])).get_output_in_json()
        self.kwargs['image_id'] = res['id']
        self.cmd('vm create -g {rg} -n {vm} --image ubuntults --data-disk-sizes-gb 10 --admin-username clitest1 --generate-ssh-key --nsg-rule NONE')
        self.cmd('vm run-command invoke -g {rg} -n {vm} --command-id RunShellScript --scripts "echo \'sudo waagent -deprovision+user --force\' | at -M now + 1 minutes"')
        time.sleep(70)
    
        self.cmd('vm deallocate -g {rg} -n {vm}')
        self.cmd('vm generalize -g {rg} -n {vm}')
        self.cmd('image create -g {rg} -n {captured} --source {vm}')
        self.cmd('sig image-version create -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --gallery-image-version {version} --managed-image {captured} --replica-count 1',
                 checks=[self.check('name', self.kwargs['version']), self.check('publishingProfile.replicaCount', 1)])
    
        self.cmd('sig image-version list -g {rg} --gallery-name {gallery} --gallery-image-definition {image}',
                 checks=self.check('length(@)', 1))
        self.cmd('sig image-version show -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --gallery-image-version {version}',
                 checks=self.check('name', self.kwargs['version']))
    
        self.cmd('sig image-version update -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --gallery-image-version {version} --target-regions {location2}=1 {location} --replica-count 2',
                 checks=[
                     self.check('publishingProfile.replicaCount', 2),
                     self.check('length(publishingProfile.targetRegions)', 2),
                     self.check('publishingProfile.targetRegions[0].name', 'West US 2'),
                     self.check('publishingProfile.targetRegions[0].regionalReplicaCount', 1),
                     self.check('publishingProfile.targetRegions[0].storageAccountType', 'Standard_LRS'),
                     self.check('publishingProfile.targetRegions[1].name', 'East US 2'),
                     self.check('publishingProfile.targetRegions[1].regionalReplicaCount', 2),
                     self.check('publishingProfile.targetRegions[1].storageAccountType', 'Standard_LRS')
                 ])
    
        # Create disk encryption set
        vault_id = self.cmd('keyvault create -g {rg} -n {vault} --enable-purge-protection true --enable-soft-delete true').get_output_in_json()['id']
        kid = self.cmd('keyvault key create -n {key} --vault {vault} --protection software').get_output_in_json()['key']['kid']
        self.kwargs.update({
            'vault_id': vault_id,
            'kid': kid
        })
    
        self.cmd('disk-encryption-set create -g {rg} -n {des1} --key-url {kid} --source-vault {vault}')
        des1_show_output = self.cmd('disk-encryption-set show -g {rg} -n {des1}').get_output_in_json()
        des1_sp_id = des1_show_output['identity']['principalId']
        des1_id = des1_show_output['id']
        self.kwargs.update({
            'des1_sp_id': des1_sp_id,
            'des1_id': des1_id
        })
    
        self.cmd('keyvault set-policy -n {vault} --object-id {des1_sp_id} --key-permissions wrapKey unwrapKey get')
    
        time.sleep(15)
    
        with mock.patch('azure.cli.command_modules.role.custom._gen_guid', side_effect=self.create_guid):
            self.cmd('role assignment create --assignee {des1_sp_id} --role Reader --scope {vault_id}')
    
        time.sleep(15)
    
        # Test --target-region-encryption
>       self.cmd('sig image-version create -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --gallery-image-version {version2} --target-regions {location}=1 --target-region-encryption {des1},0,{des1} --managed-image {captured} --replica-count 1', checks=[
            self.check('publishingProfile.targetRegions[0].name', 'East US 2'),
            self.check('publishingProfile.targetRegions[0].regionalReplicaCount', 1),
            self.check('publishingProfile.targetRegions[0].encryption.osDiskImage.diskEncryptionSetId', '{des1_id}'),
            self.check('publishingProfile.targetRegions[0].encryption.dataDiskImages[0].lun', 0),
            self.check('publishingProfile.targetRegions[0].encryption.dataDiskImages[0].diskEncryptionSetId', '{des1_id}'),
        ])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3841: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\vm\custom.py:3329: in create_image_version
    return client.gallery_image_versions.begin_create_or_update(
env\lib\site-packages\azure\mgmt\compute\v2019_12_01\operations\_gallery_image_versions_operations.py:161: in begin_create_or_update
    raw_result = self._create_or_update_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.compute.v2019_12_01.operations._gallery_image_versions_operations.GalleryImageVersionsOperations object at 0x000001C94C6D9250>
resource_group_name = 'clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci'
gallery_name = 'gallery_p3z6gjvioayv', gallery_image_name = 'image1'
gallery_image_version_name = '1.1.3'
gallery_image_version = <azure.mgmt.compute.v2019_12_01.models._models_py3.GalleryImageVersion object at 0x000001C94C6D90D0>
kwargs = {'headers': {'x-ms-authorization-auxiliary': None}}
cls = <function GalleryImageVersionsOperations.begin_create_or_update.<locals>.<lambda> at 0x000001C94C6C0670>
error_map = {401: <class 'azure.core.exceptions.ClientAuthenticationError'>, 404: <class 'azure.core.exceptions.ResourceNotFoundError'>, 409: <class 'azure.core.exceptions.ResourceExistsError'>}
api_version = '2019-12-01', content_type = 'application/json'
accept = 'application/json'
url = 'https://management.azure.com/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgtyxmxth32vwi...4z6ywct6rovkelskzkncmososibsci/providers/Microsoft.Compute/galleries/gallery_p3z6gjvioayv/images/image1/versions/1.1.3'
path_format_arguments = {'galleryImageName': 'image1', 'galleryImageVersionName': '1.1.3', 'galleryName': 'gallery_p3z6gjvioayv', 'resourceGroupName': 'clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci', ...}

    def _create_or_update_initial(
        self,
        resource_group_name,  # type: str
        gallery_name,  # type: str
        gallery_image_name,  # type: str
        gallery_image_version_name,  # type: str
        gallery_image_version,  # type: "_models.GalleryImageVersion"
        **kwargs  # type: Any
    ):
        # type: (...) -> "_models.GalleryImageVersion"
        cls = kwargs.pop('cls', None)  # type: ClsType["_models.GalleryImageVersion"]
        error_map = {
            401: ClientAuthenticationError, 404: ResourceNotFoundError, 409: ResourceExistsError
        }
        error_map.update(kwargs.pop('error_map', {}))
        api_version = "2019-12-01"
        content_type = kwargs.pop("content_type", "application/json")
        accept = "application/json"
    
        # Construct URL
        url = self._create_or_update_initial.metadata['url']  # type: ignore
        path_format_arguments = {
            'subscriptionId': self._serialize.url("self._config.subscription_id", self._config.subscription_id, 'str'),
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str'),
            'galleryName': self._serialize.url("gallery_name", gallery_name, 'str'),
            'galleryImageName': self._serialize.url("gallery_image_name", gallery_image_name, 'str'),
            'galleryImageVersionName': self._serialize.url("gallery_image_version_name", gallery_image_version_name, 'str'),
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}  # type: Dict[str, Any]
        query_parameters['api-version'] = self._serialize.query("api_version", api_version, 'str')
    
        # Construct headers
        header_parameters = {}  # type: Dict[str, Any]
        header_parameters['Content-Type'] = self._serialize.header("content_type", content_type, 'str')
        header_parameters['Accept'] = self._serialize.header("accept", accept, 'str')
    
        body_content_kwargs = {}  # type: Dict[str, Any]
        body_content = self._serialize.body(gallery_image_version, 'GalleryImageVersion')
        body_content_kwargs['content'] = body_content
        request = self._client.put(url, query_parameters, header_parameters, **body_content_kwargs)
        pipeline_response = self._client._pipeline.run(request, stream=False, **kwargs)
        response = pipeline_response.http_response
    
        if response.status_code not in [200, 201, 202]:
            map_error(status_code=response.status_code, response=response, error_map=error_map)
>           raise HttpResponseError(response=response, error_format=ARMErrorFormat)
E           azure.core.exceptions.HttpResponseError: (InvalidParameter) The subscription 'a1bfa635-f2bf-42f1-86b5-848c674fc321' is not registered for the feature 'Microsoft.Compute/SIGEncryption'. Please register the subscription before retrying the call.

env\lib\site-packages\azure\mgmt\compute\v2019_12_01\operations\_gallery_image_versions_operations.py:98: HttpResponseError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --tag product=azurecli cause=automation date=2020-12-18T15:21:44Z" => 0. 

Command "sig create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv" => 0. 

Command "sig list -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci" => 0. 

Command "sig show -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv" => 0. 

Command "sig image-definition create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1 --os-type linux -p publisher1 -f offer1 -s sku1" => 0. 

Command "sig image-definition list -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv" => 0. 

Command "sig image-definition show -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1" => 0. 

Command "vm create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n vm1 --image ubuntults --data-disk-sizes-gb 10 --admin-username clitest1 --generate-ssh-key --nsg-rule NONE" => 0. 

Command "vm run-command invoke -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n vm1 --command-id RunShellScript --scripts "echo 'sudo waagent -deprovision+user --force' | at -M now + 1 minutes"" => 0. 

Command "vm deallocate -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n vm1" => 0. 

Command "vm generalize -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n vm1" => 0. 

Command "image create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n managedImage1 --source vm1" => 0. 

Command "sig image-version create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1 --gallery-image-version 1.1.2 --managed-image managedImage1 --replica-count 1" => 0. 

Command "sig image-version list -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1" => 0. 

Command "sig image-version show -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1 --gallery-image-version 1.1.2" => 0. 

Command "sig image-version update -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --gallery-name gallery_p3z6gjvioayv --gallery-image-definition image1 --gallery-image-version 1.1.2 --target-regions westus2=1 eastus2 --replica-count 2" => 0. 

Argument 'enable_soft_delete' has been deprecated and will be removed in a future release.
Command "keyvault create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n vault-irb2lswwqcdwfj --enable-purge-protection true --enable-soft-delete true" => 0. 

Command "keyvault key create -n key-yqnoinxlmyzwcddd --vault vault-irb2lswwqcdwfj --protection software" => 0. 

Command "disk-encryption-set create -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n des1-5srs4bylixfii42 --key-url https://vault-irb2lswwqcdwfj.vault.azure.net/keys/key-yqnoinxlmyzwcddd/0725ba8ef07f4d16814cf7ee3d385838 --source-vault vault-irb2lswwqcdwfj" => 0. 

Command "disk-encryption-set show -g clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci -n des1-5srs4bylixfii42" => 0. 

Command "keyvault set-policy -n vault-irb2lswwqcdwfj --object-id 7802c728-056c-45f4-b28d-7b8896772db9 --key-permissions wrapKey unwrapKey get" => 0. 

Command "role assignment create --assignee 7802c728-056c-45f4-b28d-7b8896772db9 --role Reader --scope /subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci/providers/Microsoft.KeyVault/vaults/vault-irb2lswwqcdwfj" => 0. 

Command "az group delete --name clitest.rgtyxmxth32vwial2se4e342iaaelc5kfwrkw4z6ywct6rovkelskzkncmososibsci --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 hyper_vgeneration is not a known attribute of class <class 'azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage'> and will be ignored
[33mWARNING [0m msrest.serialization:serialization.py:185 source is not a known attribute of class <class 'azure.mgmt.compute.v2019_12_01.models._models_py3.GalleryImageVersionPublishingProfile'> and will be ignored
[33mWARNING [0m msrest.serialization:serialization.py:185 source is not a known attribute of class <class 'azure.mgmt.compute.v2019_12_01.models._models_py3.GalleryImageVersionPublishingProfile'> and will be ignored
___________________ VMGalleryImage.test_gallery_specialized ___________________
[gw2] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.command_modules.vm.tests.latest.test_vm_commands.VMGalleryImage testMethod=test_gallery_specialized>
resource_group = 'cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c'

    @ResourceGroupPreparer(name_prefix='cli_test_gallery_specialized_', location='eastus2')
    def test_gallery_specialized(self, resource_group):
        self.kwargs.update({
            'gallery': self.create_random_name(prefix='gallery_', length=20),
            'image': 'image1'
        })
        self.cmd('sig create -g {rg} --gallery-name {gallery}', checks=self.check('name', '{gallery}'))
>       self.cmd('sig image-definition create -g {rg} --gallery-name {gallery} --gallery-image-definition {image} --os-type linux --os-state specialized --hyper-v-generation V2 -p publisher1 -f offer1 -s sku1',
                 checks=[self.check('name', '{image}'), self.check('osState', 'Specialized'),
                         self.check('hyperVGeneration', 'V2')])

src\azure-cli\azure\cli\command_modules\vm\tests\latest\test_vm_commands.py:3864: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:264: in assert_with_checks
    c(self)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.testsdk.checkers.JMESPathCheck object at 0x000001C94D6D94F0>
execution_result = <azure.cli.testsdk.base.ExecutionResult object at 0x000001C94D6D9460>

    def __call__(self, execution_result):
        json_value = execution_result.get_output_in_json()
        actual_result = None
        try:
            actual_result = jmespath.search(self._query, json_value,
                                            jmespath.Options(collections.OrderedDict))
        except jmespath.exceptions.JMESPathTypeError:
            raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                              execution_result.output)
        if self._case_sensitive:
            equals = actual_result == self._expected_result or str(actual_result) == str(self._expected_result)
        else:
            equals = actual_result == self._expected_result \
                or str(actual_result).lower() == str(self._expected_result).lower()
        if not equals:
            if actual_result:
>               raise JMESPathCheckAssertionError(self._query, self._expected_result, actual_result,
                                                  execution_result.output)
E               azure.cli.testsdk.exceptions.JMESPathCheckAssertionError: Query 'hyperVGeneration' doesn't yield expected value 'V2', instead the actual value is 'V1'. Data: 
E               {
E                 "description": null,
E                 "disallowed": null,
E                 "endOfLifeDate": null,
E                 "eula": null,
E                 "features": null,
E                 "hyperVGeneration": "V1",
E                 "id": "/subscriptions/a1bfa635-f2bf-42f1-86b5-848c674fc321/resourceGroups/cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c/providers/Microsoft.Compute/galleries/gallery_fhf5ybw64xzk/images/image1",
E                 "identifier": {
E                   "offer": "offer1",
E                   "publisher": "publisher1",
E                   "sku": "sku1"
E                 },
E                 "location": "eastus2",
E                 "name": "image1",
E                 "osState": "Specialized",
E                 "osType": "Linux",
E                 "privacyStatementUri": null,
E                 "provisioningState": "Succeeded",
E                 "purchasePlan": null,
E                 "recommended": null,
E                 "releaseNoteUri": null,
E                 "resourceGroup": "cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c",
E                 "tags": {},
E                 "type": "Microsoft.Compute/galleries/images"
E               }

src\azure-cli-testsdk\azure\cli\testsdk\checkers.py:34: JMESPathCheckAssertionError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus2 --name cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c --tag product=azurecli cause=automation date=2020-12-18T15:51:22Z" => 0. 

Command "sig create -g cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c --gallery-name gallery_fhf5ybw64xzk" => 0. 

Command "sig image-definition create -g cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c --gallery-name gallery_fhf5ybw64xzk --gallery-image-definition image1 --os-type linux --os-state specialized --hyper-v-generation V2 -p publisher1 -f offer1 -s sku1" => 0. 

Command "az group delete --name cli_test_gallery_specialized_75u7yeqq3ta43nu7kceedqr6gujowvtxtfihwdl5bs4y6c --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m msrest.serialization:serialization.py:185 hyper_vgeneration is not a known attribute of class <class 'azure.mgmt.compute.v2020_09_30.models._models_py3.GalleryImage'> and will be ignored
________ BatchAIEndToEndScenariosTest.test_batchai_auto_scale_scenario ________
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1C69A1C0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F073B6640>
command = 'batchai workspace create -g clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F073B6640>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1C693040>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F073B6640>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_auto_scale_scenario>
resource_group = 'clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg'
storage_account = 'clitestyu554rmzuxjhzpg7t'

    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_auto_scale_scenario(self, resource_group, storage_account):
        # Typical usage scenario for auto scale cluster.
        # 1. Create a compute cluster
        # 2. Submit a job
        # 3. The cluster will auto scale to execute the job
        # 4. Examine the job execution results
        # 5. The cluster will down scale
        with self._given_configured_environment(resource_group, storage_account):
            # Create a file share 'share' to be mounted on the cluster
            self.cmd('az storage share create -n share')
            # Create a workspace
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group),
                     checks=[JMESPathCheck('name', 'workspace')])

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1C83A520>
resource_group_name = 'clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1C83A370>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg --tag product=azurecli cause=automation date=2020-12-18T18:01:44Z" => 0. 

Command "az storage account create -n clitestyu554rmzuxjhzpg7t -g clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestyu554rmzuxjhzpg7t -g clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg --query "[0].value" -otsv" => 0. 

Command "storage account keys list -n clitestyu554rmzuxjhzpg7t -g clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg --query "[0].value" -otsv" => 0. 

Command "az storage share create -n share" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rgigrqujfoqrwovu6y6ypylydvoqlab4capw5jevw365h6tvqj5cqvbezq7q263q2yg --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_____ BatchAIEndToEndScenariosTest.test_batchai_cluster_with_auto_storage _____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F17079160>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1B1C6BB0>
command = 'batchai workspace create -g clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7 -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1B1C6BB0>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1C040160>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1B1C6BB0>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_cluster_with_auto_storage>
resource_group = 'clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7'
storage_account = 'bairnn7zejwu6ak4bdhf2chi'

    @AllowLargeResponse()
    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(name_prefix='bai', location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_cluster_with_auto_storage(self, resource_group, storage_account):
        # Test creation of a cluster with auto-storage account.
        with mock.patch('azure.cli.command_modules.batchai.custom._get_auto_storage_resource_group') as p:
            p.return_value = resource_group
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group))

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:292: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F18844190>
resource_group_name = 'clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F16798190>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7 --tag product=azurecli cause=automation date=2020-12-18T18:02:15Z" => 0. 

Command "az storage account create -n bairnn7zejwu6ak4bdhf2chi -g clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7 -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n bairnn7zejwu6ak4bdhf2chi -g clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7 --query "[0].value" -otsv" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rgwxyug2f4drihd35hb2nuv6rxceyblyrwvks2nxj3has56ouoz6e36vurgrfzeoot7 --yes --no-wait" => 0. 

_____ BatchAIEndToEndScenariosTest.test_batchai_cluster_with_file_systems _____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1C8E3CD0>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1BF42C10>
command = 'batchai workspace create -g clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1BF42C10>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1BF5C700>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1BF42C10>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_cluster_with_file_systems>
resource_group = 'clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is'
storage_account = 'clitestsyee3t5pqldcb7uyk'

    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_cluster_with_file_systems(self, resource_group, storage_account):
        # Tests creation of a cluster with mounted file systems defined in config.
        # 1. Create an Azure File Share and Azure Blob Container to mount on the cluster.
        # 2. Create a cluster and verify parameters.
        # 3. Verify that cluster was able to start nodes.
        with self._given_configured_environment(resource_group, storage_account):
            # Create a file share 'share' and blob container 'container' to be mounted on cluster nodes.
            self.cmd('az storage share create -n share')
            self.cmd('az storage container create -n container')
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group),
                     checks=[JMESPathCheck('name', 'workspace')])

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1C90CE50>
resource_group_name = 'clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1C912E80>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is --tag product=azurecli cause=automation date=2020-12-18T18:02:40Z" => 0. 

Command "az storage account create -n clitestsyee3t5pqldcb7uyk -g clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestsyee3t5pqldcb7uyk -g clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is --query "[0].value" -otsv" => 0. 

Command "storage account keys list -n clitestsyee3t5pqldcb7uyk -g clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is --query "[0].value" -otsv" => 0. 

Command "az storage share create -n share" => 0. 

Command "az storage container create -n container" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rg5wae6iywevmxdssbpqim7nz2pfrme3wqctbzg3enezluyvewwe6dgyysqbbwc42is --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____ BatchAIEndToEndScenariosTest.test_batchai_cluster_with_setup_command _____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1CCA2190>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1CC202B0>
command = 'batchai workspace create -g clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3 -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1CC202B0>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1C9D2550>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1CC202B0>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_cluster_with_setup_command>
resource_group = 'clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3'
storage_account = 'baibr5ffyxujzatkqsfw6c27'

    @AllowLargeResponse()
    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(name_prefix='bai', location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_cluster_with_setup_command(self, resource_group, storage_account):
        # Test creation of a cluster with auto-storage account and setup task.
        with mock.patch('azure.cli.command_modules.batchai.custom._get_auto_storage_resource_group') as p:
            p.return_value = resource_group
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group))

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:314: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1CCB4F10>
resource_group_name = 'clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1CCB4160>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3 --tag product=azurecli cause=automation date=2020-12-18T18:03:08Z" => 0. 

Command "az storage account create -n baibr5ffyxujzatkqsfw6c27 -g clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3 -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n baibr5ffyxujzatkqsfw6c27 -g clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3 --query "[0].value" -otsv" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rgshcvalprquy7nb7v7qwrky364mcn37v2hhw3xll2n35kvzdnexnceq2geamlzo5j3 --yes --no-wait" => 0. 

_ BatchAIEndToEndScenariosTest.test_batchai_config_less_cluster_with_file_systems _
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1D0A6D90>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1D2F53A0>
command = 'batchai workspace create -g clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1D2F53A0>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1D2163A0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1D2F53A0>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_config_less_cluster_with_file_systems>
resource_group = 'clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u'
storage_account = 'clitestikmzshtxkczc4eh2p'

    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_config_less_cluster_with_file_systems(self, resource_group, storage_account):
        # Test creation of a cluster with mount file systems defined via command line.
        with self._given_configured_environment(resource_group, storage_account):
            self.cmd('az storage share create -n share')
            self.cmd('az storage container create -n container')
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group))

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:259: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1B1D2820>
resource_group_name = 'clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1B0668B0>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u --tag product=azurecli cause=automation date=2020-12-18T18:03:33Z" => 0. 

Command "az storage account create -n clitestikmzshtxkczc4eh2p -g clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestikmzshtxkczc4eh2p -g clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u --query "[0].value" -otsv" => 0. 

Command "storage account keys list -n clitestikmzshtxkczc4eh2p -g clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u --query "[0].value" -otsv" => 0. 

Command "az storage share create -n share" => 0. 

Command "az storage container create -n container" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rgs7myciyxcwlnfldmjnn4zohsebyhkin6zdhlae542uwsekhds4h6gavzciat7jb2u --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
____ BatchAIEndToEndScenariosTest.test_batchai_job_level_mounting_scenario ____
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1C7B5E80>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1CA74400>
command = 'batchai workspace create -g clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1CA74400>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1C780C10>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1CA74400>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_job_level_mounting_scenario>
resource_group = 'clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le'
storage_account = 'clitestmdyxxntc3wxagsz2r'

    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_job_level_mounting_scenario(self, resource_group, storage_account):
        # Typical usage scenario for regular (not auto scale) cluster.
        # 1. Create a compute cluster.
        # 2. Execute a job with job level filesystems when file systems specified in config file.
        # 3. Check the job succeeded and files are generated.
        # 4. Execute a job with job level filesystems when file systems specified via command line.
        # 5. Check the job succeeded and files are generated.
        with self._given_configured_environment(resource_group, storage_account):
            # Create a file share 'share' to be mounted on the cluster
            self.cmd('az storage share create -n share')
            self.cmd('az storage container create -n container')
            # Create a workspace
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group))

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:344: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1C8AFDF0>
resource_group_name = 'clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1C8AEC70>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le --tag product=azurecli cause=automation date=2020-12-18T18:04:02Z" => 0. 

Command "az storage account create -n clitestmdyxxntc3wxagsz2r -g clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestmdyxxntc3wxagsz2r -g clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le --query "[0].value" -otsv" => 0. 

Command "storage account keys list -n clitestmdyxxntc3wxagsz2r -g clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le --query "[0].value" -otsv" => 0. 

Command "az storage share create -n share" => 0. 

Command "az storage container create -n container" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rglsru65cguhrhucenndnocdi2cskciihyvauwgzb5apslfiaqfk2jwinjt3cqjc4le --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
_______ BatchAIEndToEndScenariosTest.test_batchai_manual_scale_scenario _______
[gw3] win32 -- Python 3.8.6 C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe

self = <azure.cli.testsdk.base.ExecutionResult object at 0x0000020F1D915490>
cli_ctx = <azure.cli.core.mock.DummyCli object at 0x0000020F1D5E1520>
command = 'batchai workspace create -g clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa -n workspace'
expect_failure = False

    def _in_process_execute(self, cli_ctx, command, expect_failure=False):
        from six import StringIO
        from vcr.errors import CannotOverwriteExistingCassetteException
    
        if command.startswith('az '):
            command = command[3:]
    
        stdout_buf = StringIO()
        logging_buf = StringIO()
        try:
            # issue: stderr cannot be redirect in this form, as a result some failure information
            # is lost when command fails.
>           self.exit_code = cli_ctx.invoke(shlex.split(command), out_file=stdout_buf) or 0

src\azure-cli-testsdk\azure\cli\testsdk\base.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1D5E1520>
args = ['batchai', 'workspace', 'create', '-g', 'clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa', '-n', ...]
initial_invocation_data = None
out_file = <_io.StringIO object at 0x0000020F1D910AF0>

    def invoke(self, args, initial_invocation_data=None, out_file=None):
        """ Invoke a command.
    
        :param args: The arguments that represent the command
        :type args: list, tuple
        :param initial_invocation_data: Prime the in memory collection of key-value data for this invocation.
        :type initial_invocation_data: dict
        :param out_file: The file to send output to. If not used, we use out_file for knack.cli.CLI instance
        :type out_file: file-like object
        :return: The exit code of the invocation
        :rtype: int
        """
        from .util import CommandResultItem
    
        if not isinstance(args, (list, tuple)):
            raise TypeError('args should be a list or tuple.')
        exit_code = 0
        try:
            if self.enable_color:
                import colorama
                colorama.init()
                if self.out_file == sys.__stdout__:
                    # point out_file to the new sys.stdout which is overwritten by colorama
                    self.out_file = sys.stdout
    
            args = self.completion.get_completion_args() or args
            out_file = out_file or self.out_file
    
            self.logging.configure(args)
            logger.debug('Command arguments: %s', args)
    
            self.raise_event(EVENT_CLI_PRE_EXECUTE)
            if CLI._should_show_version(args):
                self.show_version()
                self.result = CommandResultItem(None)
            else:
                self.invocation = self.invocation_cls(cli_ctx=self,
                                                      parser_cls=self.parser_cls,
                                                      commands_loader_cls=self.commands_loader_cls,
                                                      help_cls=self.help_cls,
                                                      initial_data=initial_invocation_data)
                cmd_result = self.invocation.execute(args)
                self.result = cmd_result
                exit_code = self.result.exit_code
                output_type = self.invocation.data['output']
                if cmd_result and cmd_result.result is not None:
                    formatter = self.output.get_formatter(output_type)
                    self.output.out(cmd_result, formatter=formatter, out_file=out_file)
        except KeyboardInterrupt as ex:
            exit_code = 1
            self.result = CommandResultItem(None, error=ex, exit_code=exit_code)
        except Exception as ex:  # pylint: disable=broad-except
>           exit_code = self.exception_handler(ex)

env\lib\site-packages\knack\cli.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.cli.core.mock.DummyCli object at 0x0000020F1D5E1520>
ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")

    def exception_handler(self, ex):  # pylint: disable=no-self-use
        from azure.cli.core.util import handle_exception
>       return handle_exception(ex)

src\azure-cli-core\azure\cli\core\__init__.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

ex = CloudError("The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.")
args = (), kwargs = {}

    def _handle_main_exception(ex, *args, **kwargs):  # pylint: disable=unused-argument
        if isinstance(ex, CannotOverwriteExistingCassetteException):
            # This exception usually caused by a no match HTTP request. This is a product error
            # that is caused by change of SDK invocation.
            raise ex
    
>       raise CliExecutionError(ex)
E       azure.cli.testsdk.exceptions.CliExecutionError: The CLI throws exception CloudError during execution and fails the command.

src\azure-cli-testsdk\azure\cli\testsdk\patches.py:35: CliExecutionError

During handling of the above exception, another exception occurred:

self = <azure.cli.command_modules.batchai.tests.latest.test_batchai_scenario.BatchAIEndToEndScenariosTest testMethod=test_batchai_manual_scale_scenario>
resource_group = 'clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa'
storage_account = 'clitestvmjkrmwu4o3ndujhx'

    @ResourceGroupPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    @StorageAccountPreparer(location=LOCATION_FOR_SCENARIO_TESTS)
    def test_batchai_manual_scale_scenario(self, resource_group, storage_account):
        # Typical usage scenario for regular (not auto scale) cluster.
        # 1. Create a compute cluster
        # 2. Execute some jobs on the cluster
        # 3. Resize the compute cluster to 0
        # 4. Resize the compute cluster to have some nodes
        # 5. Execute more jobs and examine execution results
        # 6. Delete the cluster
        # 7. Delete the jobs
        with self._given_configured_environment(resource_group, storage_account):
            # Create a file share 'share' to be mounted on the cluster
            self.cmd('az storage share create -n share')
            # Create a workspace
>           self.cmd('az batchai workspace create -g {0} -n workspace'.format(resource_group),
                     checks=[JMESPathCheck('name', 'workspace')])

src\azure-cli\azure\cli\command_modules\batchai\tests\latest\test_batchai_scenario.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\azure-cli-testsdk\azure\cli\testsdk\base.py:167: in cmd
    return execute(self.cli_ctx, command, expect_failure=expect_failure).assert_with_checks(checks)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:238: in __init__
    self._in_process_execute(cli_ctx, command, expect_failure=expect_failure)
src\azure-cli-testsdk\azure\cli\testsdk\base.py:301: in _in_process_execute
    raise ex.exception
env\lib\site-packages\knack\cli.py:215: in invoke
    cmd_result = self.invocation.execute(args)
src\azure-cli-core\azure\cli\core\commands\__init__.py:654: in execute
    raise ex
src\azure-cli-core\azure\cli\core\commands\__init__.py:717: in _run_jobs_serially
    results.append(self._run_job(expanded_arg, cmd_copy))
src\azure-cli-core\azure\cli\core\commands\__init__.py:710: in _run_job
    six.reraise(*sys.exc_info())
env\lib\site-packages\six.py:703: in reraise
    raise value
src\azure-cli-core\azure\cli\core\commands\__init__.py:688: in _run_job
    result = cmd_copy(params)
src\azure-cli-core\azure\cli\core\commands\__init__.py:325: in __call__
    return self.handler(*args, **kwargs)
src\azure-cli-core\azure\cli\core\__init__.py:784: in default_command_handler
    return op(**command_args)
src\azure-cli\azure\cli\command_modules\batchai\custom.py:621: in create_workspace
    return client.create(resource_group, workspace_name, location).result()
env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:277: in create
    raw_result = self._create_initial(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <azure.mgmt.batchai.operations.workspaces_operations.WorkspacesOperations object at 0x0000020F1D7A4340>
resource_group_name = 'clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa'
workspace_name = 'workspace', location = 'eastus', tags = None
custom_headers = None, raw = True, operation_config = {}
parameters = <azure.mgmt.batchai.models.workspace_create_parameters_py3.WorkspaceCreateParameters object at 0x0000020F1D937EE0>
url = 'https://management.azure.com/subscriptions/5e87627b-4ffa-4abf-8040-b1103c84a2fd/resourceGroups/clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa/providers/Microsoft.BatchAI/workspaces/workspace'
path_format_arguments = {'resourceGroupName': 'clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa', 'subscriptionId': '5e87627b-4ffa-4abf-8040-b1103c84a2fd', 'workspaceName': 'workspace'}
query_parameters = {'api-version': '2018-05-01'}
header_parameters = {'Content-Type': 'application/json; charset=utf-8', 'accept-language': 'en-US'}
body_content = {'location': 'eastus'}, request = <ClientRequest [PUT]>

    def _create_initial(
            self, resource_group_name, workspace_name, location, tags=None, custom_headers=None, raw=False, **operation_config):
        parameters = models.WorkspaceCreateParameters(location=location, tags=tags)
    
        # Construct URL
        url = self.create.metadata['url']
        path_format_arguments = {
            'resourceGroupName': self._serialize.url("resource_group_name", resource_group_name, 'str', pattern=r'^[-\w\._]+$'),
            'workspaceName': self._serialize.url("workspace_name", workspace_name, 'str', max_length=64, min_length=1, pattern=r'^[-\w_]+$'),
            'subscriptionId': self._serialize.url("self.config.subscription_id", self.config.subscription_id, 'str')
        }
        url = self._client.format_url(url, **path_format_arguments)
    
        # Construct parameters
        query_parameters = {}
        query_parameters['api-version'] = self._serialize.query("self.api_version", self.api_version, 'str')
    
        # Construct headers
        header_parameters = {}
        header_parameters['Content-Type'] = 'application/json; charset=utf-8'
        if self.config.generate_client_request_id:
            header_parameters['x-ms-client-request-id'] = str(uuid.uuid1())
        if custom_headers:
            header_parameters.update(custom_headers)
        if self.config.accept_language is not None:
            header_parameters['accept-language'] = self._serialize.header("self.config.accept_language", self.config.accept_language, 'str')
    
        # Construct body
        body_content = self._serialize.body(parameters, 'WorkspaceCreateParameters')
    
        # Construct and send request
        request = self._client.put(url, query_parameters)
        response = self._client.send(
            request, header_parameters, body_content, stream=False, **operation_config)
    
        if response.status_code not in [200, 202]:
            exp = CloudError(response)
            exp.request_id = response.headers.get('x-ms-request-id')
>           raise exp
E           msrestazure.azure_exceptions.CloudError: Azure Error: LocationNotAvailableForResourceType
E           Message: The provided location 'eastus' is not available for resource type 'Microsoft.BatchAI/workspaces'. List of available regions for the resource type is 'westus'.

env\lib\site-packages\azure\mgmt\batchai\operations\workspaces_operations.py:235: CloudError
---------------------------- Captured stderr call -----------------------------
Command "az group create --location eastus --name clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa --tag product=azurecli cause=automation date=2020-12-18T18:04:28Z" => 0. 

Command "az storage account create -n clitestvmjkrmwu4o3ndujhx -g clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa -l eastus --sku Standard_LRS --kind Storage --https-only " => 0. 

Command "storage account keys list -n clitestvmjkrmwu4o3ndujhx -g clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa --query "[0].value" -otsv" => 0. 

Command "storage account keys list -n clitestvmjkrmwu4o3ndujhx -g clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa --query "[0].value" -otsv" => 0. 

Command "az storage share create -n share" => 0. 

This command is implicitly deprecated because command group 'batchai' is deprecated and will be removed in a future release.
Command "az group delete --name clitest.rgxxh7u76kardnz7vevwwha6f2ub6nep5ozsit22yh3sxvdnex5ipyocvhxwcfchnfa --yes --no-wait" => 0. 

------------------------------ Captured log call ------------------------------
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'bytes'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
[33mWARNING [0m root:utilities.py:55 <class 'str'>
- generated xml file: C:\Users\daetienn\.azdev\env_config\Users\daetienn\Desktop\azure-cli\env\test_results.xml -
=========================== short test summary info ===========================
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ephemeral_disk
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_custom.py::AcsCustomCommandTest::test_k8s_install_kubelogin_with_custom_source_url
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_with_service_principal
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_managed_disk
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad_msi
FAILED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_with_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool_msi
FAILED src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool_msi
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_create
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_delete
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list_credentials
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_show
FAILED src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_update
FAILED src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_elastic_plan
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_basic
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_fixed
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_recurring
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rule_with_dimensions
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rules
FAILED src/azure-cli/azure/cli/command_modules/deploymentmanager/tests/latest/test_deploymentmanager_scenario.py::DeploymentManagerTests::test_deploymentmanager_scenario
FAILED src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_cluster_commands.py::EHNamespaceCURDScenarioTest::test_eh_cluster
FAILED src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_namespace_byok_test.py::EHNamespaceBYOKCURDScenarioTest::test_eh_namespace_byok
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_data_export
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_recover
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_dynamic_metric_alert_multiple_scopes
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_condition_create
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_for_rg_and_sub
FAILED src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_multiple_scopes
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_application
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_autoscale_operation
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka
FAILED src/azure-cli/azure/cli/command_modules/netappfiles/tests/latest/test_volume_commands.py::AzureNetAppFilesVolumeServiceScenarioTest::test_create_volume_with_subnet_in_different_rg
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkAppGatewayDefaultScenarioTest::test_network_appgw_creation_with_public_and_private_ip
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkRouteFilterScenarioTest::test_network_route_filter
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteScenarioTest::test_network_express_route
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteIPv6PeeringScenarioTest::test_network_express_route_ipv6_peering
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_global_reach
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteGlobalReachScenarioTest::test_network_express_route_peer_connection
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkNicConvenienceCommandsScenarioTest::test_network_nic_convenience_commands
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_optional_disk_args
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_min_args
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_resize
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkVNetPeeringScenarioTest::test_network_vnet_peering
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_packet_capture
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkWatcherScenarioTest::test_network_watcher_vm
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkBastionHostScenarioTest::test_network_batsion_host_create
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_nw_connection_monitor.py::NWConnectionMonitorScenarioTest::test_nw_connection_monitor_v1
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkWebappScenarioTest::test_private_endpoint_connection_webapp
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_default
FAILED src/azure-cli/azure/cli/command_modules/network/tests/latest/test_private_endpoint_commands.py::NetworkPrivateLinkAppGwScenarioTest::test_appgw_private_endpoint_with_overwrite_default
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_cluster_config
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_at_host
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_in_transit
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_minimal_tls_version
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_relay_and_privatelink
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_ssh_creds
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_monitor
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_script_action
FAILED src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_virtual_machine
FAILED src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_identity_hub
FAILED src/azure-cli/azure/cli/command_modules/resource/tests/latest/test_resource.py::DeploymentTestAtManagementGroup::test_management_group_deployment
FAILED src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_e2e
FAILED src/azure-cli/azure/cli/command_modules/role/tests/latest/test_role.py::RoleAssignmentScenarioTest::test_role_assignment_handle_conflicted_assignments
FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlManagedDatabaseLogReplayScenarionTest::test_sql_midb_logreplay_mgmt
FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_create_and_delete
FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_mgmt
FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmScenarioTest::test_sqlvm_update_license_and_sku
FAILED src/azure-cli/azure/cli/command_modules/sqlvm/tests/latest/test_sqlvm_commands.py::SqlVmAndGroupScenarioTest::test_sqlvm_add_and_remove
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_double_encryption
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_create_storage_account_with_files_aadds_true
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_storage_create_with_encryption_key_type
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountTests::test_update_storage_account_with_files_aadds_true
FAILED src/azure-cli/azure/cli/command_modules/storage/tests/latest/test_storage_account_scenarios.py::StorageAccountSkuScenarioTest::test_storage_account_sku
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMWindowsLicenseTest::test_vm_windows_license_type
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCustomImageTest::test_vm_custom_image_name_conflict
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateFromUnmanagedDiskTest::test_vm_create_from_unmanaged_disk
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_specialized_unmanaged_disk
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithSpecializedUnmanagedDiskTest::test_vm_create_with_unmanaged_data_disks
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_os_and_data_disks
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAttachDisksOnCreate::test_vm_create_by_attach_unmanaged_os_and_data_disks
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOSDiskSize::test_vm_set_os_disk_size
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_managed_image
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMManagedDiskScenarioTest::test_vm_disk_max_shares_etc
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_image_builder_commands.py::ImageTemplateTest::test_image_build_shared_image
FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_application.py::ServiceFabricApplicationTests::test_application
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGeneralizeScenarioTest::test_vm_generalize
FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_basic_cluster
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSimulateEvictionScenarioTest::test_vm_simulate_eviction
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMNoWaitScenarioTest::test_vm_create_no_wait
FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_cert_and_ext
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_instance_name
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMExtensionScenarioTest::test_vm_extension_with_id
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateUbuntuScenarioTest::test_vm_create_ubuntu
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateEphemeralOsDisk::test_vm_create_ephemeral_os_disk
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMMultiNicScenarioTest::test_vm_create_multi_nics
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension_instance_name
FAILED src/azure-cli/azure/cli/command_modules/servicefabric/tests/latest/test_sf_managed_cluster.py::ServiceFabricManagedClustersTests::test_node_type_operation
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiagnosticsExtensionInstallTest::test_diagnostics_extension_install
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_auth
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_existing_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingOptions::test_vm_create_provision_vm_agent
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateExistingIdsOptions::test_vm_create_existing_ids_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomIP::test_vm_create_custom_ip
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskAttachDetachTest::test_vm_disk_attach_detach
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMBootDiagnostics::test_vm_boot_diagnostics
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSExtensionInstallTest::test_vmss_extension
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_scale_in_policy
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_auth
FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerMgmtScenarioTest::test_sql_server_public_network_access_update_mgmt
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_ephemeral_os_disk
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_create_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateOptions::test_vmss_update_instance_disks
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_default_app_gateway
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_none_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_create_with_app_gateway
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateBalancerOptionsTest::test_vmss_existing_lb
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreatePublicIpPerVm::test_vmss_public_ip_per_vm_custom_domain_name
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSUpdateTests::test_vmss_update_image
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vm_accelerated_networking
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::AcceleratedNetworkingTest::test_vmss_accelerated_networking
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ApplicationSecurityGroup::test_vmss_asg
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_linux_secrets
FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerDbSecurityScenarioTest::test_sql_db_security_mgmt
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::SecretsScenarioTest::test_vm_create_windows_secrets
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateLinuxSecretsScenarioTest::test_vmss_create_linux_secrets
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingOptions::test_vmss_create_existing_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateExistingIdsOptions::test_vmss_create_existing_ids_options
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSVMsScenarioTest::test_vmss_vms
FAILED src/azure-cli/azure/cli/command_modules/sql/tests/latest/test_sql_commands.py::SqlServerSecurityScenarioTest::test_sql_server_security_mgmt
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMUnmanagedDataDiskTest::test_vm_data_unmanaged_disk
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateCustomDataScenarioTest::test_vm_create_custom_data
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateAndModify::test_vmss_create_and_modify
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_msi_no_scope
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_explicit_msi
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSNicScenarioTest::test_vmss_nics
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vmss_msi
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCreateIdempotentTest::test_vmss_create_idempotent
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSILBTest::test_vmss_with_ilb
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::MSIScenarioTest::test_vm_explicit_msi
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMRunCommandScenarioTest::test_vm_run_command_with_parameters
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSRunCommandScenarioTest::test_vmss_run_command_with_parameters
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_disk_encryption_e2e
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vm_encryption_at_host
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMOsDiskSwap::test_vm_os_disk_swap
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGenericUpdate::test_vm_generic_update
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMDiskEncryptionTest::test_vmss_disk_encryption_e2e
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateWithExistingNic::test_vm_create_existing_nic
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSimulateEvictionScenarioTest::test_vmss_simulate_eviction
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSCustomDataScenarioTest::test_vmss_create_custom_data
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_update
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_ppg_with_related_resources
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::ProximityPlacementGroupScenarioTest::test_proximity_placement_group
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSecretTest::test_vm_secret_e2e_test
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_specialized_image
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMPriorityEvictionBillingTest::test_vm_priority_eviction_billing
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateSpecialName::test_vm_create_special_name
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskEncryptionSetTest::test_disk_encryption_set
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DedicatedHostScenarioTest::test_dedicated_host_e2e
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSTerminateNotificationScenarioTest::test_vmss_terminate_notification
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::DiskAccessTest::test_disk_access
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_extension
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMCreateNSGRule::test_vm_create_nsg_rule
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_create_automatic_repairs_with_health_probe
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSAutomaticRepairsScenarioTest::test_vmss_update_automatic_repairs_with_health_probe
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoUpdateScenarioTest::test_vm_auto_update
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMSSSetOrchestrationServiceStateScenarioTest::test_vmss_set_orchestration_service_state
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMAutoShutdownScenarioTest::test_vm_auto_shutdown
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_e2e
FAILED src/azure-cli/azure/cli/command_modules/vm/tests/latest/test_vm_commands.py::VMGalleryImage::test_gallery_specialized
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_auto_scale_scenario
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_auto_storage
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_file_systems
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_setup_command
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_config_less_cluster_with_file_systems
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_job_level_mounting_scenario
FAILED src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_manual_scale_scenario
========= 197 failed, 319 passed, 32 skipped in 50031.74s (13:53:51) ==========
============================= test session starts =============================
platform win32 -- Python 3.8.6, pytest-6.1.2, py-1.9.0, pluggy-0.13.1 -- C:\Users\daetienn\Desktop\azure-cli\env\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\daetienn\Desktop\azure-cli
plugins: forked-1.3.0, xdist-2.1.0
collecting ... collected 2409 items / 2212 deselected / 197 selected
run-last-failure: rerun previous 197 failures

src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_aadv1_and_update_with_managed_aad_msi PASSED [  0%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_cluster_with_apiserver_authorized_ranges_then_update_msi PASSED [  1%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_default_setting_msi PASSED [  1%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update FAILED [  2%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_private_cluster_then_update_msi FAILED [  2%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_default_mgd_outbound_ip_then_update_msi FAILED [  3%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_slb_vmss_with_outbound_ip_then_update_msi FAILED [  3%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_spot_node_pool FAILED [  4%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_ephemeral_disk FAILED [  4%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_managed_disk FAILED [  5%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_paid_sku_msi FAILED [  5%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_create_with_windows_msi FAILED [  6%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad FAILED [  6%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_aad_msi FAILED [  7%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_managed_identity_with_service_principal FAILED [  7%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_create_scale_delete_msi FAILED [  8%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_nodepool_system_pool_msi FAILED [  8%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_cluster_msi FAILED [  9%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool FAILED [  9%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_aks_commands.py::AzureKubernetesServiceScenarioTest::test_aks_upgrade_node_image_only_nodepool_msi FAILED [ 10%]
src/azure-cli/azure/cli/command_modules/acs/tests/latest/test_custom.py::AcsCustomCommandTest::test_k8s_install_kubelogin_with_custom_source_url FAILED [ 10%]
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::FunctionAppServicePlan::test_functionapp_elastic_plan FAILED [ 11%]
src/azure-cli/azure/cli/command_modules/appservice/tests/latest/test_webapp_commands.py::WebappWindowsContainerBasicE2ETest::test_webapp_create_with_msi PASSED [ 11%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_create FAILED [ 12%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_delete FAILED [ 12%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list FAILED [ 13%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_list_credentials FAILED [ 13%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_show FAILED [ 14%]
src/azure-cli/azure/cli/command_modules/aro/tests/latest/test_aro_commands.py::AroScenarioTests::test_aro_update FAILED [ 14%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_auto_scale_scenario FAILED [ 15%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_auto_storage FAILED [ 15%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_file_systems FAILED [ 16%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_cluster_with_setup_command FAILED [ 16%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_config_less_cluster_with_file_systems FAILED [ 17%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_job_level_mounting_scenario FAILED [ 17%]
src/azure-cli/azure/cli/command_modules/batchai/tests/latest/test_batchai_scenario.py::BatchAIEndToEndScenariosTest::test_batchai_manual_scale_scenario FAILED [ 18%]
src/azure-cli/azure/cli/command_modules/deploymentmanager/tests/latest/test_deploymentmanager_scenario.py::DeploymentManagerTests::test_deploymentmanager_scenario FAILED [ 18%]
src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_cluster_commands.py::EHNamespaceCURDScenarioTest::test_eh_cluster PASSED [ 19%]
src/azure-cli/azure/cli/command_modules/eventhubs/tests/latest/test_eventhub_commands_namespace_byok_test.py::EHNamespaceBYOKCURDScenarioTest::test_eh_namespace_byok FAILED [ 19%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_application FAILED [ 20%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_autoscale_operation FAILED [ 20%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka FAILED [ 21%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_kafka_with_optional_disk_args FAILED [ 21%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_min_args FAILED [ 22%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_resize FAILED [ 22%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_cluster_config FAILED [ 23%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_at_host FAILED [ 23%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_encryption_in_transit FAILED [ 24%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_minimal_tls_version FAILED [ 24%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_relay_and_privatelink FAILED [ 25%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_cluster_with_ssh_creds FAILED [ 25%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_monitor FAILED [ 26%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_script_action FAILED [ 26%]
src/azure-cli/azure/cli/command_modules/hdinsight/tests/latest/test_hdinsight_commands.py::HDInsightClusterTests::test_hdinsight_virtual_machine FAILED [ 27%]
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_identity_hub FAILED [ 27%]
src/azure-cli/azure/cli/command_modules/iot/tests/latest/test_iot_commands.py::IoTHubTest::test_identity_hub ERROR [ 27%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_basic FAILED [ 28%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_basic ERROR [ 28%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_fixed FAILED [ 28%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_fixed ERROR [ 28%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_recurring FAILED [ 29%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_recurring ERROR [ 29%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rule_with_dimensions FAILED [ 29%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rule_with_dimensions ERROR [ 29%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rules FAILED [ 30%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_autoscale.py::TestMonitorAutoscaleScenario::test_monitor_autoscale_rules ERROR [ 30%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_data_export FAILED [ 30%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_data_export ERROR [ 30%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_recover FAILED [ 31%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_log_analytics_workspace.py::TestLogProfileScenarios::test_monitor_log_analytics_workspace_recover ERROR [ 31%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_dynamic_metric_alert_multiple_scopes FAILED [ 31%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_dynamic_metric_alert_multiple_scopes ERROR [ 31%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_condition_create FAILED [ 32%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_condition_create ERROR [ 32%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_for_rg_and_sub FAILED [ 32%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_for_rg_and_sub ERROR [ 32%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_multiple_scopes FAILED [ 33%]
src/azure-cli/azure/cli/command_modules/monitor/tests/latest/test_monitor_metric_alert_scenarios.py::MonitorTests::test_metric_alert_multiple_scopes ERROR [ 33%]
src/azure-cli/azure/cli/command_modules/netappfiles/tests/latest/test_volume_commands.py::AzureNetAppFilesVolumeServiceScenarioTest::test_create_volume_with_subnet_in_different_rg FAILED [ 34%]
src/azure-cli/azure/cli/command_modules/netappfiles/tests/latest/test_volume_commands.py::AzureNetAppFilesVolumeServiceScenarioTest::test_create_volume_with_subnet_in_different_rg ERROR [ 34%]
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkAppGatewayDefaultScenarioTest::test_network_appgw_creation_with_public_and_private_ip FAILED [ 34%]
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkAppGatewayDefaultScenarioTest::test_network_appgw_creation_with_public_and_private_ip ERROR [ 34%]
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkRouteFilterScenarioTest::test_network_route_filter FAILED [ 35%]
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkRouteFilterScenarioTest::test_network_route_filter ERROR [ 35%]
src/azure-cli/azure/cli/command_modules/network/tests/latest/test_network_commands.py::NetworkExpressRouteScenarioTest::test_network_express_route 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! KeyboardInterrupt !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.8_3.8.1776.0_x64__qbz5n2kfra8p0\lib\codecs.py:905: KeyboardInterrupt
(to show a full traceback on KeyboardInterrupt use --full-trace)
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? 
Terminate batch job (Y/N)? Terminate batch job (Y/N)? 
