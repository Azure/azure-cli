# Reference standards

## General guidelines 

General guidelines apply to both reference and conceptual content.

1. Develop and test all reference examples in both a Bash and PowerShell environment.  When commands have syntax differences between environments, create one example for Bash and another for PowerShell.  For copyability, use different code blocks with a notation.  Here is an example:

    ```azurecli-interactive
    # Bash command syntax 
    az command –written-for-Bash 
    ```

    ```azurecli-interactive
    # Azure PowerShell syntax 
    az command –with-quoting-differences 
    ```

1. Do not replicate code blocks for line break differences.  The new Azure CLI code block Copy button removes Bash and PowerShell line break characters. Focus on syntax differences.

1. Embed URLs in source code help judiciously.
    - Write the link for Markdown syntax.  Example: \[article name](link). 
    - Remove `/en-us/` from all links.
    - Remove `?view=azure-cli-latest` from all links.
    - Add `&preserve-view=true` to any URL that needs a moniker to support versioning.  Example: `?view=azure-ml-py&preserve-view=true`.

    > [!NOTE]
    > Failure to remove `/en-us/`or `?view=azure-cli-latest` causes a build warning in MicrosoftDocs/azure-docs-cli.

1. Do not use HTML tags (`<>`)in descriptions or examples.  These render blank in autogenerated reference content. Here is an example of what NOT to do: `location=<location>`.

    ```python
     - name: --location -l
       summary: 'Location. Values from: `az account list-locations`. You can configure the default location using `az configure --defaults location=<location>`.'
    ```

1. Use links to conceptual content judiciously.  There isn't an automated process to fix broken links in the Python source code files.  Incorrect links also cause build validation warnings and errors in MicrosoftDocs/azure-docs-cli.  See General guidelines for best practices when embedding links into *.py files. 

## TOC – Azure CLI

The [reference TOC in MicsoftDocs/azure-docs-cli](https://github.com/MicrosoftDocs/azure-docs-cli/blob/main/latest/docs-ref-autogen/TOC.yml) is controlled by two files:

- Core references are mapped in [azure-cli/src/azure-cli/service_name.json](https://github.com/Azure/azure-cli/blob/dev/src/azure-cli/service_name.json).
- Extension references are mapped in [azure-cli-extensions/src/service_name.json](https://github.com/Azure/azure-cli-extensions/blob/main/src/service_name.json).

**Each time a reference TOC top-level name is changed, a redirect has to be created.**  If you aren’t sure what service or product to place a new reference group in, contact Damien Caro (dcar@microsoft.com) or Delora Bradish (dbradish@microsoft.com).

- Placement in the reference TOC should reflect customer search terms and patterns.

- The reference TOC is organized by Azure service or product without the “Azure” or “Microsoft” prefix.

- The reference TOC organization is intended to help our customers answer the question: “What Azure CLI commands are available to me when working with [an Azure product]?”

## TOC – Azure service 

Each Azure service that has supporting Azure CLI reference content needs a link to the autogenerated reference docs in their TOC. The `displayName` property is optional. Here is an example:

```yml
- name: Reference
  items:
    - name: Azure CLI
      href: /cli/azure/service-page/database%20for%20cosmos%20db
      displayName: az cosmosdb, cassandra, dts, gremlin, mongocluster
    - name: Azure PowerShell
    - href: /powershell/module/az.cosmosdb/#cosmos-db
```

## Reference content 

One purpose of autogenerated reference content is to decrease the number of Quickstarts and allow Microsoft content writers to use their abilities to teach a cross-service scenario or job to be done. We are not trying to eliminate Quickstarts -- we do want the Azure CLI autogenerated content to be Best in Class!

Follow these guidelines when creating examples for in-line help, and consequently, for autogenerated reference content.

### Summaries

There are two Python properties for summaries: **short-summary** and **long-summary**.

### Short summary

In autogenerated reference content, short summaries show in reference tables.  For an example, see the tables in [Reference Index A-Z](https://learn.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest) and [az account](https://learn.microsoft.com/en-us/cli/azure/account).

Short summaries also appear as the first sentence under an H1.  For [az account](https://learn.microsoft.com/en-us/cli/azure/account) the short summary is "Manage Azure subscription information".

- The intent of the short summary is _a single sentence_ that describes the reference command.
- The short summary should not exceed 200 characters.
- Include in the short summary sentence information that cannot be immediately deduced from the reference command name.
- Write the short summary in active voice within _a single sentence_ that contains a noun, a verb and a direct object.  Active voice has an understood "you".


### Long summary

The long summary, if available, prints directly under the short summary.  Long summaries are not rendered in table format.  

- The intent of the long summary is to provide additional tips and techniques for our customers.
- The long summary indicates what users can expect when running the command.
- The long summary can be a paragraph but should not exceed 2000 characters.
- Include additional information about what the command will do and what customers should know, for example “[…]The output includes credentials that you must protect[…]”  
- The long summary property is not the place for Quickstart or How-to guidance.  **Keep the long summary focused on information _about the command_, not how to use it.**

For an example of a long summary, see [az acr helm repo add](https://learn.microsoft.com/en-us/cli/azure/acr/helm/repo?view=azure-cli-latest#az-acr-helm-repo-add).  The Python source code for `az acr helm repo add` is found in [/acr/_help.py](https://github.com/azure/azure-cli/blob/dev/src/azure-cli/azure/cli/command_modules/acr/_help.py):

```python
helps['acr helm repo add'] = """
type: command
short-summary: Add a helm chart repository from an Azure Container Registry through the Helm CLI.
long-summary: Helm must be installed on your machine.
examples:
  - name: Add a helm chart repository from an Azure Container Registry to manage helm charts.
    text: >
        az acr helm repo add -n MyRegistry
"""
```

## Examples

Examples provided in the reference documentation provide customers with information on how to use a given command and associated parameters. Examples are usually created in `_help.py` and published in [MicrosoftDocs/azure-docs-cli/latest/docs-ref-autogen](https://github.com/MicrosoftDocs/azure-docs-cli/tree/main/latest/docs-ref-autogen).

- Don’t assume a level of knowledge.  Reference content is translated into many languages and customers have diverse technical skills. What is intuitive for one customer, is a frustrating roadblock for another.

- Give special attention to create command examples. These are often revenue-generating and Microsoft loses the potential for a billable resource when a `create` or `add` command fails.

- Provide at least two examples for each reference command.
  - One example should be the most common use case for the command.
  - The second example should be a real-life example that includes an advanced combination of filters.  

- Get/list operations should include one example with a filter parameter or `--query` example to reflect real world use cases.

- The examples provided should use the **\```azurecli** or **\```azurecli-interactive** code block tag to facilitate the copy/paste of the code.

- Bash examples should be formatted for readability using a line continuation character of `\`.  PowerShell examples should use [splatting](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_splatting).  Your Python source code will look like this:

```python
helps['vm create'] = """
type: command
short-summary: Create a virtual machine.
examples:
  - name: Simple example
  - text: az vm create -name MyVm -group MyResourceGroup --image UbuntuServer
  - name: Create a Debian11 VM with SSH key authentication and a public DNS entry, located on an existing virtual network and availability set.
    text: |
        az vm create --param1 MyParam1Value \\
                     --param2 MyParam2Value \\
                     --param3 MyParam3Value \\
  - name: next diverse example
    text: |
```

- Create diverse, not repetitive examples.

  ```azurecli
  # example
  az vm create -n MyVm -g MyResourceGroup --image UbuntuSever
  
  # repetitive
  az vm create -n MyVm -g MyResourceGroup --image Debian11
  
  # helpful and readable
  az vm create --group MyResourceGroup \
               --name MyVm \
               --image /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myRG/providers/Microsoft.Compute/galleries/myGallery/images/myImage

  # diverse and readable
  az vm create --name MyVm \
               --group MyResourceGroup \
               --image Debian11 \
               --vnet-name MyVnet 
               --subnet subnet1 \
               --availability-set MyAvailabilitySet \
               --public-ip-address-dns-name MyUniqueDnsName \
               --ssh-key-values @key-file
  ```

- Not all examples can be shell agnostic due to the quoting differences between Bash and PowerShell.  For examples that only run in Bash, provide a second example for PowerShell.  If you are testing examples in PowerShell, here are some considerations:
  - [Quoting issues with PowerShell](https://github.com/Azure/azure-cli/blob/dev/doc/quoting-issues-with-powershell.md)
  - [Use quotation marks in Azure CLI parameters](./use-cli-effectively.md#use-quotation-marks-in-parameters)
  - Compare syntax of CMD, PowerShell and Bash in [Query command output using JMESPath](./query-azure-cli.md)
  - [Error handling for the Azure CLI in PowerShell](./use-cli-effectively.md#error-handling-for-azure-cli-in-powershell)

### Use of parameters in examples

- Use Global Parameters such as `--output` and `--query`, in examples when needed for clarity. Showing customers how to get a value from an Azure resource and store it in a variable is especially helpful when the `--query` syntax required is not intuitive. Frustrations with `--query` are seen in many customer feedback forums. Let's work to change this!

- Avoid parameter abbreviations in examples. This requires the customer to look up abbreviations. Reference examples strive for clarity and readability, not reduced keystrokes.
  - Bad: `az vm create -h`
  - Good: `az vm create --help`

- Provide real-world parameter values. Helpful examples do not expect the customer to figure out an actual value or format for the command.  See [parameter guidelines](#parameters) for more information.

- Do not use HTML tags (`<>`) around parameter values in Python source code that becomes autogenerated reference content.  In `az someCommand --group <MyRG> --nextParameter <MyParemeterValue>` both parameter values will render as a blank space.  In MicrosoftDocs Markdown code blocks, using `<myValue>` is fine.

- Provide examples for complex parameters or those that require a particular format.  

- Provide examples for parameters that should be used in groups.  When there are a significant number of parameters for a single reference command, it is confusing for customers to understand what parameters should be used together. See the [az vm create](https://learn.microsoft.com/en-us/cli/azure/vm#az-vm-create) reference documentation for an example of a command with many parameters. Enter `az vm create -h` in a terminal and notice the groupings provided in the in-line help:
  - Authentication Arguments
  - Dedicated Host Arguments
  - Managed Service Identity Arguments
  - Marketplace Image Plan Arguments
  - Monitor Arguments
  - Network Arguments
  - Storage Arguments
  - Global Arguments

## Parameter help

The parameter help, usually located in `_params.py`, is an excellent opportunity to provide additional information to customers and avoid formatting errors! Think of the parameter help as a blank canvas and throw on it all the tips and technique paint you can. Parameter help is different than the command `short/long-summary` properties.  To start, there is only one property and it is located in the `c.argument` line.

Here is example source code:

```python
c.argument('vmss', help='Name or ID of an existing virtual machine scale set that the virtual machine should be assigned to. None by default.')
c.argument('nsg', help='The name to use when creating a new Network Security Group (default) or referencing an existing one. Can also reference an existing NSG by ID or specify "" for none (\'""\' in Azure CLI using PowerShell or --% operator).', arg_group='Network')
```

> [!NOTE]
> For instructions on creating and formatting the `_params.py` file, see [something]().

- Many of our GitHub issues and negative HaTS results come from misunderstood parameter usage or formats. You may feel you are "over explaining" but take time to build out the parameter help especially for create/add commands.

- Keep parameter help information _about_ the parameter, not a Quickstart on how to _use_ the parameter.

- When possible, tell customers how to find the value for a parameter. Example: "Use `az account list-locations` to find available location values."

- Include the following information in the `help=` property for each parameter when applicable:
  - **Description**. Be succinct but provide as much helpful information as you know.
  - **Accepted values**.
  - **Azure CLI default value**.  Always provide default value information for true/false parameters.
  - **Azure service default value**.
  - Information about **parameter pairs**. Examples:
    - "If p1 is used, you must also supply p2."
    - "If p1 is used, you do not need to supply p2."
    - "If p1 is used, you cannot supply p2."
    - "P1 is optional if p2 has been provided."
  - **Format examples**.  Although all parameter values in the Azure CLI are strings, parameter formats are not always intuitive.
  - **Example value**.
    - Give individual parameter examples in the parameter help. (Focus code block examples on common scenarios.)
    - Individual example values are especially important when example code blocks do not use all available parameters.
    - Don't repeat values in parameter examples with identical values in example code blocks. Redundancy does not add value.
    - Do not expect the customer to know Bash, or to intuitively figure out parameter formats.
      - If a parameter accepts multiple values, provide a multi-value string example. Is it comma delimited? Space delimited? Are there quotes around each value, the entire string, or no quotes at all?
      - If a parameter "can be passed in as file or string", how would the contents of the file be formatted? What information is acceptable? What would a multi-value string look like?

## Output

When developing scripts, customers will likely combine two or more of the create, read, update and delete operations. With no documentation about the format of the returned object, customers have no choice but to run each command one by one and analyze the response. Include information about the returned object. **WHERE?**

Here is a customer verbatim: [no response format for cli calls anywhere in the docs · Issue #17332](https://github.com/Azure/azure-cli/issues/17332).

## Conceptual content

Minimum viable conceptual content for the Azure CLI is one Quickstart or How-to guide for every command group that contains at least one create command. Easily meet this requirement using one of these solutions:

- Copy an existing Azure portal article replacing Azure portal instructions with Azure CLI reference commands. 
- Add a conceptual tab to an existing H2. This a good solution when there aren't enough reference commands to replicate an entire portal article. 
- This solution is not preferred, but add an H2 to the bottom of an existing article with links to related Azure CLI reference content. This does not qualify as "conceptual content", but it's a start when you are pressed for time. 

See [Azure CLI article guidelines]() in the Contributor’s Guide for more detail.  Review the [Azure CLI editor’s checklist]() before publishing docs containing Azure CLI content.
